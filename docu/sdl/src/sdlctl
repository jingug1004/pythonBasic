
#!/bin/sh

home=`cd ..;pwd`

usage()
{
cat<<EOF
Usage : sdlctl (start|stop|restart|status)
	start - start sdlctl
	stop - stop sdlctl
	restart - restart sdlctl
	status - show sdlctl status
	help - show help message
EOF
echo "$home"
}

startp()
{
	set classpath
	set pid
	classpath="$home/classes"
	files=`ls $home/lib`
	for file in $files
	do classpath=$classpath":"$home/lib/$file
	done
	java -Xms512m -Xmx1024m -classpath $classpath -Dhome=$home org.sosfo.sdl.cra.server.serial.ToteRead > /dev/null 2>&1 &
	pid=$!
	touch $home/bin/sdl.pid
	echo $pid 1>$home/bin/sdl.pid
	echo "sdl started"
}

stopp()
{
	set pid
	if [ -s $home/bin/sdl.pid ] ; then
		pid=`cat $home/bin/sdl.pid`
		kill -9 $pid 3>/dev/null
		`rm $home/bin/sdl.pid`
		echo "sdl stopped"
	else
		echo "sdl is not running"
	fi
}

statusp()
{
	if [ -s $home/bin/sdl.pid ] ; then
		echo "sdl is running"
	else
		echo "sdl is not running"
	fi
}

main()
{
	if [ $# != 1 ] ; then
		statusp
		exit 1
	fi

	case $1 in
	start)
		startp
		;;
	stop)
		stopp
		;;
	restart)
		stopp
		startp
		;;
	help)
		usage
		;;
	status)
		statusp
		;;
	*)
		usage
		;;
	esac
}

main $*

