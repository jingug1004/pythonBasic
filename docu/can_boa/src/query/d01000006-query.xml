<?xml version="1.0" encoding='EUC-KR'?>
<queryMap desc="tbdm_bord_mngr(게시판)">
	<query id="tbdm_bord_fa001" desc="LIST쿼리" fetchSize="10">
        <![CDATA[
			SELECT 
			      ROW_ID
			    , CLS_CD
                , SEQ_NO                               
                , GRP_NO                               
                , GRP_RANK_NO                          
                , GRP_LOW_NO                           
                , MAKE_MAN                              
                , SBJT       
                , SHOWSBJT                          
                , BORD_DESC                            
                , SRCH_CNT                             
                , PROG_STAT                            
                , DEL_YN                               
                , INST_ID                              
                , INST_DTM
                , UPDT_ID                              
                , UPDT_DTM
		    FROM (SELECT    
                          ROWNUM ROW_ID
                        , CLS_CD
                        , SEQ_NO                               
                        , GRP_NO                               
                        , GRP_RANK_NO                          
                        , GRP_LOW_NO                           
                        , MAKE_MAN                              
                        , SBJT
                        , LPAD('  ',GRP_RANK_NO *2,'  ')||SBJT SHOWSBJT                         
                        , BORD_DESC                            
                        , SRCH_CNT                             
                        , PROG_STAT                            
                        , DEL_YN                               			        	
                        , INST_ID                              			        	
                        , TO_CHAR(INST_DTM,'YYYYMMDD') INST_DTM			        	
                        , UPDT_ID                              			        	
                        , TO_CHAR(UPDT_DTM,'YYYYMMDD') UPDT_DTM			        	
			        FROM (SELECT 
			        	          CLS_CD
                                , SEQ_NO
				                , GRP_NO                               
				                , GRP_RANK_NO                          
				                , GRP_LOW_NO   
                                , MAKE_MAN
                                , SBJT
                                , BORD_DESC
                                , SRCH_CNT
                                , PROG_STAT
                                , DEL_YN
                                , INST_ID
                                , INST_DTM
                                , UPDT_ID
                                , UPDT_DTM
			        		FROM TBDM_BORD
			        		WHERE DEL_YN 	= ?
			        		AND CLS_CD   	= ?
							AND SBJT        LIKE NVL('%' || ? || '%', SBJT)
							AND BORD_DESC   LIKE NVL('%' || ? || '%', BORD_DESC)
							AND (MAKE_MAN    LIKE NVL('%' || ? || '%', MAKE_MAN)
								--임시로 삽입 시작.08.04.10
								OR MAKE_MAN IS NULL
								--임시로 삽입 끝
								)
							AND SEQ_NO		=    NVL(?				, SEQ_NO)
			        		
			        		ORDER BY GRP_NO DESC, GRP_LOW_NO ASC)
			        )							
			WHERE ROW_ID BETWEEN (? - 1) * ? + 1 AND ? * ?
        ]]>
    </query>     
    
    <query id="tbdm_bord_fa002" desc="카운트쿼리" fetchSize="10">
        <![CDATA[
			SELECT COUNT(SEQ_NO) TOTCOUNT FROM TBDM_BORD
			WHERE	DEL_YN = ?
			AND	 	CLS_CD = ?
			AND 	SBJT        LIKE NVL('%' || ? || '%', SBJT)
			AND 	BORD_DESC   LIKE NVL('%' || ? || '%', BORD_DESC)
			AND 	MAKE_MAN    LIKE NVL('%' || ? || '%', MAKE_MAN)
        ]]>
    </query>     
    		   
    <query id="tbdm_bord_fa003" desc="SEQNOGET쿼리" fetchSize="10">
        <![CDATA[
			SELECT
			      (SELECT NVL(MAX(SEQ_NO),0) + 1 FROM TBDM_BORD) NEXTSEQNO
			 	,  NEXTFILESEQNO
			FROM DUAL
        ]]>
    </query> 
    
    <query id="tbdm_bord_fa004" desc="파일정보가져오기쿼리" fetchSize="10">
        <![CDATA[
			SELECT
			      CLS_CD
			    , SEQ_NO
			    , FILE_SEQ
			    , FILE_SIZE
			    , FILE_NAME
			    , FILE_URL
			    , FILE_SIZE
			    , INST_ID
			    , INST_DTM
			    , UPDT_ID
			    , UPDT_DTM
			    , 0 AS CHK
			FROM TBDM_BORD_ATMNT
			WHERE   CLS_CD      = ?
			AND     SEQ_NO      = ?
        ]]>
    </query>     
    
     <query id="tbdm_bord_ra001" desc="답변쿼리" fetchSize="10">
        <![CDATA[
			INSERT INTO TBDM_BORD (
		          CLS_CD
		        , SEQ_NO
		        , GRP_NO
		        , GRP_RANK_NO
		        , GRP_LOW_NO
		        , MAKE_MAN
		        , SBJT
		        , BORD_DESC
		        , SRCH_CNT
		        , PROG_STAT
		        , DEL_YN
		        , INST_ID
		        , INST_DTM
		        , UPDT_ID
		        , UPDT_DTM
			) VALUES (
		        ?
		        , (SELECT NVL(MAX(SEQ_NO),0) + 1 FROM TBDM_BORD)
		        , ?
		        , ?
		        , ?
		        , ?
		        , ?
		        , ?
		        , ?
		        , ?
		        , ?
		        , ?
		        , SYSDATE
		        , ?
		        , SYSDATE
			)
        ]]>
    </query> 
        
     <query id="tbdm_bord_ia001" desc="입력쿼리" fetchSize="10">
        <![CDATA[
			INSERT INTO TBDM_BORD (
		          CLS_CD
		        , SEQ_NO
		        , GRP_NO
		        , GRP_RANK_NO
		        , GRP_LOW_NO
		        , MAKE_MAN
		        , SBJT
		        , BORD_DESC
		        , SRCH_CNT
		        , PROG_STAT
		        , DEL_YN
		        , INST_ID
		        , INST_DTM
		        , UPDT_ID
		        , UPDT_DTM
			) VALUES (
		        ?
		        , (SELECT NVL(MAX(SEQ_NO),0) + 1 FROM TBDM_BORD)
		        , (SELECT NVL(MAX(SEQ_NO),0) + 1 FROM TBDM_BORD)
		        , 0
		        , 0
		        , ?
		        , ?
		        , ?
		        , ?
		        , ?
		        , ?
		        , ?
		        , SYSDATE
		        , ?
		        , SYSDATE
			)
        ]]>
    </query> 
    
    
    <query id="tbdm_bord_ia002" desc="답변선작업쿼리" fetchSize="10">
        <![CDATA[
			UPDATE TBDM_BORD 
			    SET GRP_LOW_NO = GRP_LOW_NO + 1 
			WHERE GRP_NO = ? 
			AND GRP_LOW_NO >= ? 
			AND GRP_RANK_NO != 0
        ]]>
    </query> 
    
    <query id="tbdm_bord_ia003" desc="파일입력" fetchSize="10">
        <![CDATA[
			INSERT INTO TBDM_BORD_ATMNT (
	              CLS_CD
				, SEQ_NO
				, FILE_SEQ
				, FILE_NAME
				, FILE_URL
				, FILE_SIZE
				, INST_ID
				, INST_DTM
				, UPDT_ID
				, UPDT_DTM
			) VALUES (
		          ?					-- cls_cd
		        , (SELECT NVL(MAX(SEQ_NO),0) FROM TBDM_BORD)			    -- seq_no
		        , (SELECT NVL(MAX(FILE_SEQ),0) + 1 FROM TBDM_BORD_ATMNT)	-- file_seq
		        , ?					-- file_name
		        , ?					-- file_url
		        , ?					-- file_size
		        , ?					-- inst_id
		        , SYSDATE			-- inst_dtm
		        , ?					-- updt_id
		        , SYSDATE			-- updt_dtm
			)
        ]]>
    </query>     
    
    <query id="tbdm_bord_ia004" desc="파일입력" fetchSize="10">
        <![CDATA[
			INSERT INTO TBDM_BORD_ATMNT (
	              CLS_CD
				, SEQ_NO
				, FILE_SEQ
				, FILE_NAME
				, FILE_URL
				, FILE_SIZE
				, INST_ID
				, INST_DTM
				, UPDT_ID
				, UPDT_DTM
			) VALUES (
		          ?					-- cls_cd
		        , ?			    -- seq_no
		        , (SELECT NVL(MAX(FILE_SEQ),0) + 1 FROM TBDM_BORD_ATMNT)	-- file_seq
		        , ?					-- file_name
		        , ?					-- file_url
		        , ?					-- file_size
		        , ?					-- inst_id
		        , SYSDATE			-- inst_dtm
		        , ?					-- updt_id
		        , SYSDATE			-- updt_dtm
			)
        ]]>
    </query>     
        
    <query id="tbdm_bord_ua002" desc="수정쿼리" fetchSize="10">
        <![CDATA[
			UPDATE TBDM_BORD 
			SET SBJT = ?
			    , BORD_DESC = ?
			    , UPDT_ID = ?
			    , UPDT_DTM = SYSDATE
			WHERE SEQ_NO = ?	
        ]]>
    </query> 

    <query id="tbdm_bord_ua001" desc="조회수증가쿼리" fetchSize="10">
        <![CDATA[
			UPDATE TBDM_BORD 
				SET SRCH_CNT = SRCH_CNT + 1
			WHERE SEQ_NO = ?
        ]]>
    </query> 
        
    <query id="tbdm_bord_da001" desc="삭제쿼리" fetchSize="10">
        <![CDATA[
			UPDATE TBDM_BORD 
				SET DEL_YN = ?
			WHERE SEQ_NO = ?
        ]]>
    </query> 
    
    <query id="tbdm_bord_da002" desc="삭제쿼리" fetchSize="10">
        <![CDATA[
			DELETE FROM TBDM_BORD_ATMNT
			WHERE CLS_CD 		=	 ?
			AND	  SEQ_NO		=    ?
			AND	  FILE_SEQ		=    NVL(?, FILE_SEQ)
        ]]>
    </query> 
     
</queryMap>