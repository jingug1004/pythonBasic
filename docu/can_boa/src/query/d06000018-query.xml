<?xml version="1.0" encoding='EUC-KR'?>
<queryMap desc="분해조립집계"> 
    <query id="tbdn_cand_race_detl_fn001" desc="기수 조회" fetchSize="10">
		<![CDATA[
			SELECT  CD  RACER_PERIO_NO
				 FROM  TBDM_SPEC_CD
				 WHERE GRP_CD  = 'D10000'
				 ORDER BY CD DESC
	    ]]>
    </query>
	
    <query id="tbdn_motor_assem_estm_total_fn001" desc="모터분해조립집계 조회" fetchSize="10">
        <![CDATA[
			SELECT   A1.RACER_PERIO_NO 
                    ,A1.CAND_NO        
                    ,A1.NM_KOR
                    ,A1.ROUND1_ASSIGN_SCR
                    ,A1.ROUND2_ASSIGN_SCR
                    ,A1.ROUND3_ASSIGN_SCR
                    ,A1.ROUND1_DCSN
                    ,A1.ROUND2_DCSN
                    ,A1.ROUND3_DCSN
                    ,A1.ROUND1_DT  
                    ,A1.ROUND2_DT  
                    ,A1.ROUND3_DT  
                    ,A1.AVG_ASSIGN_SCR
            FROM
            (
                SELECT
                        B.RACER_PERIO_NO 
                        ,B.CAND_NO        
                        ,B.NM_KOR
                        ,NVL(MAX(CASE WHEN A.ROUND = '1' THEN A.DCSN END),0) AS ROUND1_DCSN
                        ,NVL(MAX(CASE WHEN A.ROUND = '2' THEN A.DCSN END),0) AS ROUND2_DCSN
                        ,NVL(MAX(CASE WHEN A.ROUND = '3' THEN A.DCSN END),0) AS ROUND3_DCSN
                        ,NVL(MAX(CASE WHEN A.ROUND = '1' THEN A.DT END),'') AS ROUND1_DT
                        ,NVL(MAX(CASE WHEN A.ROUND = '2' THEN A.DT END),'') AS ROUND2_DT
                        ,NVL(MAX(CASE WHEN A.ROUND = '3' THEN A.DT END),'') AS ROUND3_DT
                        ,ROUND(NVL(AVG(CASE WHEN A.ROUND = '1' THEN A.ASSIGN_SCR END),0),1) AS ROUND1_ASSIGN_SCR
                        ,ROUND(NVL(AVG(CASE WHEN A.ROUND = '2' THEN A.ASSIGN_SCR END),0),1) AS ROUND2_ASSIGN_SCR
                        ,ROUND(NVL(AVG(CASE WHEN A.ROUND = '3' THEN A.ASSIGN_SCR END),0),1) AS ROUND3_ASSIGN_SCR
                        ,NVL(ROUND(AVG(A.ASSIGN_SCR),1), 0)                                 AS AVG_ASSIGN_SCR
                FROM    TBDN_CAND_IDENT    B, TBDN_MOTOR_ASSEM_ESTM A    
                WHERE   B.RACER_PERIO_NO    = A.RACER_PERIO_NO
                AND     B.CAND_NO           = A.CAND_NO
                AND     NVL(B.DEL_YN,'N')   = 'N'  
                AND     B.RACER_PERIO_NO    = ?
                GROUP BY B.RACER_PERIO_NO,B.CAND_NO,B.NM_KOR 
            )A1
            GROUP BY A1.RACER_PERIO_NO,A1.CAND_NO,A1.NM_KOR,A1.ROUND1_ASSIGN_SCR,A1.ROUND2_ASSIGN_SCR
                    ,A1.ROUND3_ASSIGN_SCR,A1.AVG_ASSIGN_SCR,A1.ROUND1_DCSN,A1.ROUND2_DCSN,A1.ROUND3_DCSN
                    ,A1.ROUND1_DT,A1.ROUND2_DT,A1.ROUND3_DT      
            ORDER BY A1.CAND_NO

		]]>
    </query>  
    
</queryMap>