<?xml version="1.0" encoding='EUC-KR'?>
<queryMap desc="출주표"> 
    <query id="tbdn_cand_ident_fn100" desc="기수 조회" fetchSize="10">
		<![CDATA[
		       SELECT  CD  RACER_PERIO_NO
				 FROM  TBDM_SPEC_CD
				 WHERE GRP_CD  = 'D10000'
				 ORDER BY CD DESC
	    ]]>
    </query>
    <query id="tbdn_cand_race_fn000" desc="기수 조회" fetchSize="10">
		<![CDATA[
			SELECT
			       NVL(MAX(DAY_NO), 0) + 1 DAY_NO         -- 출주번호
			FROM   TBDN_CAND_RACE
			WHERE  RACER_PERIO_NO = ?
	    ]]>
    </query>
    <query id="tbdn_cand_race_fn001" desc="기수 조회" fetchSize="10">
		<![CDATA[
			SELECT
			         RACER_PERIO_NO  -- 기수
			       , DAY_NO          -- 출주번호
			       , DT              -- 일자
			       , PLC_CD          -- 장소
			       , ROUND_CNT       -- 라운드횟수
			       , WEATHER         -- 날씨      
			       , WIND_DIRC       -- 풍향      
			       , WIND_SPD        -- 풍속      
			       , TEMPT           -- 기온      
			       , HUMID           -- 습도      
			       , WAT_TEMP        -- 수온      
			       , WAT_LEV         -- 수위     
			       , (SELECT CD_NM FROM  TBDM_SPEC_CD WHERE CD = PLC_CD AND GRP_CD  = 'D10085') AS PLC_CD_N
				   , (SELECT CD_NM FROM  TBDM_SPEC_CD WHERE CD = WEATHER AND GRP_CD  = 'D10020') AS WEATHER_N 
				   , (SELECT CD_NM FROM  TBDM_SPEC_CD WHERE CD = WIND_DIRC AND GRP_CD  = 'D10021') AS WIND_DIRC_N
				   , CFM_YN			 -- 확정여부 
			       , INST_ID         -- 작성자ID  
			       , INST_DTM        -- 작성일자  
			       , UPDT_ID         -- 수정자ID  
			       , UPDT_DTM        -- 수정일자  
			FROM   TBDN_CAND_RACE
			WHERE  RACER_PERIO_NO = NVL(?, RACER_PERIO_NO)
			AND    DAY_NO         = NVL(?, DAY_NO)
			AND    DT             = NVL(?, DT)
			ORDER BY DAY_NO
	    ]]>
    </query>

    <query id="tbdn_race_plan_se001" desc="경정후보생 출주표조회" fetchSize="10">
		<![CDATA[
			SELECT A.RACER_PERIO_NO,
			           A.CAND_NO, 
			           A.NM_KOR,
			           NVL(B.DAY_NO, ?) AS DAY_NO,
			           NVL(B.DT, ?) AS DT,
			           B.RACE_P,
			           B.RACE_2,
			           B.RACE_3,
			           B.RACE_S,
			           B.RACE_T
			FROM ( SELECT *
			           FROM TBDN_CAND_IDENT
			           WHERE CAND_NO NOT IN ( SELECT CAND_NO 
			                                                FROM TBDN_TEMP_ABS
			                                                WHERE GEN_DT <=  ?
			                                                          AND GBN IN ('001', '003'))) A, TBDN_CAND_RACE_PLAN B
			WHERE 1=1
			          AND A.RACER_PERIO_NO = B.RACER_PERIO_NO(+)
			          AND A.CAND_NO = B.CAND_NO(+)
			          AND A.RACER_PERIO_NO = ?
			          AND B.DAY_NO(+) = ? 		
	    ]]>
    </query>
    
    <query id="tbdn_cand_race_in001" desc="출주 입력" fetchSize="10">
		<![CDATA[
			INSERT INTO TBDN_CAND_RACE
			(
			         RACER_PERIO_NO  -- 기수
			       , DAY_NO          -- 출주번호
			       , DT              -- 일자
			       , PLC_CD          -- 장소
			       , ROUND_CNT       -- 라운드횟수
			       , WEATHER         -- 날씨      
			       , WIND_DIRC       -- 풍향      
			       , WIND_SPD        -- 풍속      
			       , TEMPT           -- 기온      
			       , HUMID           -- 습도      
			       , WAT_TEMP        -- 수온      
			       , WAT_LEV         -- 수위      
			       , INST_ID         -- 작성자ID  
			       , INST_DTM        -- 작성일자  
			       , UPDT_ID         -- 수정자ID  
			       , UPDT_DTM        -- 수정일자  
			) VALUES (
			         ?               -- 기수
			       , ?               -- 출주번호
			       , ?               -- 일자
			       , ?               -- 장소
			       , ?               -- 라운드횟수
			       , ?               -- 날씨      
			       , ?               -- 풍향      
			       , ?               -- 풍속      
			       , ?               -- 기온      
			       , ?               -- 습도      
			       , ?               -- 수온      
			       , ?               -- 수위      
			       , ?               -- 작성자ID  
			       , SYSDATE         -- 작성일자  
			       , ?               -- 수정자ID  
			       , SYSDATE         -- 수정일자  
			)
	    ]]>
    </query>
    <query id="tbdn_cand_race_un001" desc="출주 삭제" fetchSize="10">
		<![CDATA[
			UPDATE TBDN_CAND_RACE SET
			         DT             = ?       -- 일자
			       , PLC_CD         = ?       -- 장소
			       , ROUND_CNT      = ?       -- 라운드횟수
			       , WEATHER        = ?       -- 날씨      
			       , WIND_DIRC      = ?       -- 풍향      
			       , WIND_SPD       = ?       -- 풍속      
			       , TEMPT          = ?       -- 기온      
			       , HUMID          = ?       -- 습도      
			       , WAT_TEMP       = ?       -- 수온      
			       , WAT_LEV        = ?       -- 수위      
			       , UPDT_ID        = ?       -- 수정자ID  
			       , UPDT_DTM       = SYSDATE -- 수정일자  
			WHERE  RACER_PERIO_NO   = ?       -- 기수
			AND    DAY_NO           = ?       -- 출주번호
	    ]]>
    </query>
    <query id="tbdn_cand_race_dn001" desc="출주 삭제" fetchSize="10">
		<![CDATA[
			DELETE 
			FROM   TBDN_CAND_RACE
			WHERE  RACER_PERIO_NO   = ?       -- 기수
			AND    DAY_NO           = ?       -- 출주번호
	    ]]>
    </query>
    
    <query id="tbdn_race_plan_me001" desc="경정후보생 출주표 입력/수정" fetchSize="10">
		<![CDATA[
			MERGE INTO TBDN_CAND_RACE_PLAN A
			USING DUAL
			ON(	 A.RACER_PERIO_NO = ?
			     AND A.DAY_NO = ?
			     AND A.DT = ?
			     AND A.CAND_NO = ?)
			WHEN MATCHED THEN
			UPDATE SET   A.RACE_P = ?,
		                 A.RACE_2 = ?,
		                 A.RACE_3 = ?,
		                 A.RACE_S = ?,
		                 A.RACE_T = ?,
		                 A.UPDT_ID = ?,
		                 A.UPDT_DTM = SYSDATE
			WHEN NOT MATCHED THEN
			INSERT (A.RACER_PERIO_NO,
		            A.DAY_NO,
		            A.DT,
		            A.CAND_NO,
		            A.RACE_P,
		            A.RACE_2,
		            A.RACE_3,
		            A.RACE_S,
		            A.RACE_T,
		            A.INST_ID,
		            A.INST_DTM)
			VALUES( ?,
		            ?,
		            ?,
		            ?,
		            ?,
		            ?,
		            ?,
		            ?,
		            ?,
		            ?,
		            SYSDATE)     
	    ]]>
    </query>    
    
</queryMap>