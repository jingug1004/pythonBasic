<?xml version="1.0" encoding='EUC-KR'?>
<queryMap desc="tbef_acdnt_report 사고조사보고서 ">
	<query id="tbef_acdnt_report_ff001" desc="사고조사보고서 조회" fetchSize="50">
        <![CDATA[
            SELECT 
		    	ROWNUM AS NUM, T1.*
			FROM (
			    SELECT  
			        0 AS CHK,
			        TRAS.STND_YEAR, TRAS.MBR_CD, TRAS.TMS, TRAS.DAY_ORD,  TRAS.RACE_NO, TRAS.SEQ,  TRDO.RACE_DAY,
			        TRAS.RACE_REG_NOS, TRAS.RACER_NOS,
			        RACER_NMS, TRAS.MOT_NOS,  TRAS.BOAT_NOS,ACDNT_SUMMARY,
			        CIRCUIT_CNT_CD, ACDNT_LOC_CD, ACDENT_DESC , PRS_STAT, CNF_DT,PRS_DESC
			    FROM TBEF_ACDNT_REPORT TRAS, TBEB_RACE_DAY_ORD  TRDO
			    WHERE TRAS.STND_YEAR = TRDO.STND_YEAR 
			    AND TRAS.TMS = TRDO.TMS 
			    AND TRAS.DAY_ORD = TRDO.DAY_ORD 
			    AND TRDO.STND_YEAR||LPAD(TRDO.TMS,3, '0') BETWEEN  ?||LPAD(?,3,'0') AND ?||LPAD(?,3,'0')
			    AND TRDO.MBR_CD LIKE ?||'%'
			    AND RACER_NMS LIKE '%'||?||'%'
           		AND NVL(PRS_STAT, '001') LIKE ?||'%'
           		ORDER BY STND_YEAR DESC, TMS DESC, DAY_ORD DESC, RACE_NO DESC
			)T1
            
        ]]>
    </query> 
    
    <query id="tbef_acdnt_report_ff002" desc="사고조사보고서 조회(경주 상황  경주조회)" fetchSize="50">
        <![CDATA[
            -- 사고 조사 보고서 조회 (경주 조회 )
			SELECT 
				0 CHK, -- check
			    RACE_DAY,    --경주일
			    STND_YEAR,  -- 기준년도
			    MBR_CD,  -- 경정장 코드 
			    TMS,    -- 회차 
			    DAY_ORD,     -- 일차
			    RACE_NO,    -- 경주번호
			    RACE_REG_NO,    -- 정번
			    RACER_NO,   -- 선수등록번호
			    RACER_NM,    -- 선수명 
			    MOT_NO, -- 모터번호
			    BOAT_NO,    -- 보트번호
			    MOT_REG_NO, -- 모터 등록번호 번호
			    BOAT_REG_NO,    -- 보트 등록 번호 번호
			    RANK -- 순위 
			FROM (
			    SELECT  
			        TRDO.RACE_DAY, TOR.MBR_CD, TOR.STND_YEAR, TOR.TMS, TOR.DAY_ORD, TOR.RACE_NO,
			        TOR.RACE_REG_NO, TOR.RACER_NO,
			        (SELECT NM_KOR FROM TBEC_RACER_MASTER TBM WHERE TBM.RACER_NO = TOR.RACER_NO) AS RACER_NM,    -- 선수명 
			        TOR.MOT_NO,TOR. BOAT_NO,
			        SUBSTR(TOR.MOT_NO,1,1)||SUBSTR(TOR.MOT_NO,6,3) AS MOT_REG_NO,
			        SUBSTR(TOR.BOAT_NO,1,1)||SUBSTR(TOR.BOAT_NO,6,3) AS BOAT_REG_NO, TOR.RANK
			    FROM TBEB_ORGAN TOR, TBEB_RACE_DAY_ORD  TRDO 
			    WHERE TOR.STND_YEAR = TRDO.STND_YEAR
			    AND TOR.MBR_CD = TRDO.MBR_CD
			    AND TOR.TMS = TRDO.TMS
			    AND TOR.DAY_ORD = TRDO.DAY_ORD 
			    AND TOR.STND_YEAR=?
			    AND TOR.MBR_CD =?
			    AND TOR.TMS=TO_NUMBER(?)
			    AND TOR.DAY_ORD=TO_NUMBER(?)
			    AND TOR.RACE_NO=?
			)
			ORDER BY RACE_REG_NO
        ]]>
    </query> 
   
    <query id="tbef_acdnt_report_if001" desc="사고조사 보고서 등록 " fetchSize="10">
        <![CDATA[
        	-- 사고조사 보고서 등록  
           INSERT INTO TBEF_ACDNT_REPORT (
           	   STND_YEAR,	-- 기준년도
			   MBR_CD, 	-- 경정장 코드   
			   TMS, 	-- 회차 
			   DAY_ORD, 	-- 일차 
			   RACE_NO, 	-- 경주번호 
			   RACE_REG_NOS, 	-- 정번 
			   RACER_NOS, 	-- 선수  
			   RACER_NMS, 	-- 선수명
			   MOT_NOS, 	-- 모터 
			   BOAT_NOS, 	-- 보트 
			   SEQ, 	-- 일련번호 
			   CNF_DT, 	-- 확정일자 
			   CIRCUIT_CNT_CD,	-- 고장개소 
			   ACDNT_LOC_CD,	-- 발생상태 
			   PRS_STAT,	-- 처리상태 
			   ACDNT_SUMMARY, -- 사고상태 
			   ACDENT_DESC,	-- 사고상황 
			   PRS_DESC,	-- 처리상황 
			   INST_ID, 	-- 작성자 ID
			   INST_DTM		-- 작성일시 
		   ) 
		   VALUES ( 
		   		?,	-- 기준년도
			   ?, 	-- 경정장 코드   
			   ?, 	-- 회차 
			   ?, 	-- 일차 
			   ?, 	-- 경주번호 
			   ?, 	-- 정번 
			   ?, 	-- 선수  
			   ?, 	-- 선수명
			   ?, 	-- 모터 
			   ?, 	-- 보트 
			    SQ_TBEF_ACDNT_REPORT.NEXTVAL, 	-- 일련번호 
			   ?, 	-- 확정일자 
			   ?,	-- 고장개소 
			   ?,	-- 발생상태 
			   ?,	-- 처리상태 
			   ?, 	-- 사고상태 
			   ?,	-- 사고상황 
			   ?,	-- 처리상황 
			   ?, 	-- 작성자 ID
			    SYSDATE 	-- 작성일시 
		     )
        ]]>
    </query> 
    <query id="tbef_acdnt_report_uf001" desc="사고조사 보고서 수정" fetchSize="10">
        <![CDATA[
        	-- 사고조사 보고서 수정  
           UPDATE TBEF_ACDNT_REPORT
			SET    RACE_REG_NOS = ?, 	-- 정번 
				   RACER_NOS = ?, 	-- 선수  
				   RACER_NMS = ?, 	-- 선수명
				   MOT_NOS = ?, 	-- 모터 
				   BOAT_NOS = ?, 	-- 보트 
				   CNF_DT	   = ?,	-- 확정일자 
				   CIRCUIT_CNT_CD = ?,
			   	   ACDNT_LOC_CD = ?, 
				   PRS_STAT    = ?,	-- 처리상태 
				   ACDNT_SUMMARY = ?,
				   ACDENT_DESC = ?,	-- 사고상황 
			       PRS_DESC    = ?,	-- 처리상황 
			       UPDT_ID     = ?,	-- 수정자  ID
			       UPDT_DTM    = SYSDATE	-- 수정일시
			WHERE  STND_YEAR   = ?	-- 기준년도
			AND    MBR_CD      = ?	-- 경정장 코드  
			AND    TMS         = ?	-- 회차 
			AND    DAY_ORD     = ?	-- 일차 
			AND    RACE_NO     = ?	-- 경주번호 
			AND    SEQ         = ?	-- 일련번호 

			       
        ]]>
    </query> 
    <query id="tbef_acdnt_report_df001" desc="사고조사 보서서 삭제" fetchSize="10">
        <![CDATA[
           	-- 사고보사보고서 삭제 
			DELETE 
			FROM TBEF_ACDNT_REPORT
			WHERE  STND_YEAR   = ?	-- 기준년도
			AND    MBR_CD      = ?	-- 경정장 코드  
			AND    TMS         = ?	-- 회차 
			AND    DAY_ORD     = ?	-- 일차 
			AND    RACE_NO     = ?	-- 경주번호 
			AND    SEQ         = ?	-- 일련번호 
        ]]>
    </query> 
    
    
    
</queryMap>