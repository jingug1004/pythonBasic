<?xml version="1.0" encoding='EUC-KR'?>
<queryMap desc="통계">
 	<query id="tbdn_cand_race_recd_fn001" desc="스타트 타임" fetchSize="10">
		<![CDATA[
			    SELECT
						 RACER_PERIO_NO		--기수
						,CAND_NO            --후보생번호
						,FC_CAND_NM_003(CAND_NO) AS CAND_NM
						,TOT_CNT_REAL       --총 스타스연습 횟수
						,TOT_F_CNT          --F경주수
						,TOT_L_CNT          --L경주수
						,TOT_CNT            --총 스타스연습 횟수(F/L포함)
						,TOT_TIME           --연습시간
						,DECODE(TOT_CNT_REAL,0,0,ROUND(TOT_CTIME/TOT_CNT_REAL,2)) AVG_T --평균 시간
						,DECODE(TOT_001_T,0,0,ROUND(TOT_001_T/CNTR_001,2)) AVG_001_T --1코스 평균시간
						,DECODE(TOT_002_T,0,0,ROUND(TOT_002_T/CNTR_002,2)) AVG_002_T --2코스 평균시간
						,DECODE(TOT_003_T,0,0,ROUND(TOT_003_T/CNTR_003,2)) AVG_003_T --3코스 평균시간
						,DECODE(TOT_004_T,0,0,ROUND(TOT_004_T/CNTR_004,2)) AVG_004_T --4코스 평균시간
						,DECODE(TOT_005_T,0,0,ROUND(TOT_005_T/CNTR_005,2)) AVG_005_T --5코스 평균시간
						,DECODE(TOT_006_T,0,0,ROUND(TOT_006_T/CNTR_006,2)) AVG_006_T --6코스 평균시간
						,CNT_001             --1코스 횟수
						,CNT_002             --2코스 횟수
						,CNT_003             --3코스 횟수
						,CNT_004             --4코스 횟수
						,CNT_005             --5코스 횟수
						,CNT_006             --6코스 횟수
					FROM (
						SELECT
					    	RACER_PERIO_NO
					    	,CAND_NO
					    	,COUNT(RACE_COURSE) AS TOT_CNT                                              --F/L포함  경주수
					    	,SUM(CASE WHEN RACE_FL = '001' THEN 1 ELSE 0 END)         AS TOT_CNT_REAL	--정상경주 수
					    	,SUM(CASE WHEN RACE_FL = '001' THEN RACE_TIME ELSE 0 END) AS TOT_CTIME      --정상경주 코스타임
					    	,SUM(DECODE(RACE_SEQ,'1',BOAT_TIME,0)) AS TOT_TIME       --연습시간
					        ,SUM(CASE WHEN RACE_FL = '002' THEN 1 ELSE 0 END)         AS TOT_F_CNT		--F경주 수
					        ,SUM(CASE WHEN RACE_FL = '003' THEN 1 ELSE 0 END)         AS TOT_L_CNT		--L경주 수
							,SUM(CASE WHEN RACE_COURSE = '1' AND RACE_FL = '001' THEN RACE_TIME ELSE 0 END) AS TOT_001_T
							,SUM(CASE WHEN RACE_COURSE = '2' AND RACE_FL = '001' THEN RACE_TIME ELSE 0 END) AS TOT_002_T
							,SUM(CASE WHEN RACE_COURSE = '3' AND RACE_FL = '001' THEN RACE_TIME ELSE 0 END) AS TOT_003_T
							,SUM(CASE WHEN RACE_COURSE = '4' AND RACE_FL = '001' THEN RACE_TIME ELSE 0 END) AS TOT_004_T
							,SUM(CASE WHEN RACE_COURSE = '5' AND RACE_FL = '001' THEN RACE_TIME ELSE 0 END) AS TOT_005_T
							,SUM(CASE WHEN RACE_COURSE = '6' AND RACE_FL = '001' THEN RACE_TIME ELSE 0 END) AS TOT_006_T
					    	,SUM(CASE WHEN RACE_COURSE = '1' AND RACE_FL = '001' THEN 1 ELSE 0 END) AS CNTR_001	--코스별 정상경주수
					    	,SUM(CASE WHEN RACE_COURSE = '2' AND RACE_FL = '001' THEN 1 ELSE 0 END) AS CNTR_002
					    	,SUM(CASE WHEN RACE_COURSE = '3' AND RACE_FL = '001' THEN 1 ELSE 0 END) AS CNTR_003
					    	,SUM(CASE WHEN RACE_COURSE = '4' AND RACE_FL = '001' THEN 1 ELSE 0 END) AS CNTR_004
					    	,SUM(CASE WHEN RACE_COURSE = '5' AND RACE_FL = '001' THEN 1 ELSE 0 END) AS CNTR_005
					    	,SUM(CASE WHEN RACE_COURSE = '6' AND RACE_FL = '001' THEN 1 ELSE 0 END) AS CNTR_006
					    	,SUM(CASE WHEN RACE_COURSE = '1' THEN 1 ELSE 0 END) AS CNT_001
					    	,SUM(CASE WHEN RACE_COURSE = '2' THEN 1 ELSE 0 END) AS CNT_002
					    	,SUM(CASE WHEN RACE_COURSE = '3' THEN 1 ELSE 0 END) AS CNT_003
					    	,SUM(CASE WHEN RACE_COURSE = '4' THEN 1 ELSE 0 END) AS CNT_004
					    	,SUM(CASE WHEN RACE_COURSE = '5' THEN 1 ELSE 0 END) AS CNT_005
					    	,SUM(CASE WHEN RACE_COURSE = '6' THEN 1 ELSE 0 END) AS CNT_006
						FROM (
							SELECT
								 B.RACER_PERIO_NO
							    ,A.DT
								,D.CAND_NO
								,B.DAY_NO
								,B.ROUND
								,B.GBN
								,B.BOAT_TIME
								,C.RACE_FL
								,RACE_SEQ
								,RACE_COURSE
								,RACE_TIME
							FROM TBDN_CAND_RACE A, TBDN_CAND_RACE_RACE B, TBDN_CAND_RACE_RECD C, TBDN_CAND_RACE_ORGAN D, TBDN_CAND_IDENT E
							WHERE 1=1
							AND A.RACER_PERIO_NO = ?
							AND A.RACER_PERIO_NO = B.RACER_PERIO_NO
							AND A.DAY_NO = B.DAY_NO
							AND A.ROUND_CNT >= B.ROUND
							AND A.CFM_YN = 'Y'
							AND A.RACER_PERIO_NO = C.RACER_PERIO_NO
							AND B.DAY_NO = C.DAY_NO
							AND B.ROUND = C.ROUND
							AND A.RACER_PERIO_NO = D.RACER_PERIO_NO
							AND C.DAY_NO = D.DAY_NO
							AND C.ROUND = D.ROUND
							AND C.TEAM_NO = D.TEAM_NO
							AND C.RACE_REG_NO = D.RACE_REG_NO
							AND B.GBN = '005'    --ST연습
							AND RACE_COURSE IS NOT NULL
							AND D.RACER_PERIO_NO = E.RACER_PERIO_NO
							AND D.CAND_NO = E.CAND_NO
							AND E.DEL_YN = 'N'
						) GROUP BY RACER_PERIO_NO, CAND_NO
					) ORDER BY CAND_NO
	    ]]>
    </query>
    
	<query id="tbdn_cand_race_organ_fn002" desc="모의경주성적" fetchSize="10">
		<![CDATA[
		    SELECT
					RACER_PERIO_NO
					,CAND_NO
					,FC_CAND_NM_003(CAND_NO) CAND_NM
					,TOT_CNT	--승정횟수
					,TOT_TIME	--승정시간
					,CNT_1		--1착횟수
					,CNT_2      --2착횟수
					,CNT_3		--3착횟수
					,DECODE(TOT_CNT,0,0,ROUND(CNT_1/TOT_CNT*100,2)) AS WIN_RATE         --승율
					,DECODE(TOT_CNT,0,0,ROUND((CNT_1+CNT_2)/TOT_CNT*100,2)) AS YUN_RATE --연대율
					,DECODE(TOT_CNT,0,0,ROUND((CNT_1+CNT_2+CNT_3)/TOT_CNT*100,2)) AS TRI_RATE         --삼연대율
					,DECODE(REAL_CNT,0,0,ROUND(TOT_C_TIME/REAL_CNT,2)) AS AVG_COURSE_TIME   --평균T
					,DECODE(TOT_001_T,0,0,ROUND(TOT_001_T/CNT_001,2)) AVG_001_T --1코스 평균시간
					,DECODE(TOT_002_T,0,0,ROUND(TOT_002_T/CNT_002,2)) AVG_002_T --2코스 평균시간
					,DECODE(TOT_003_T,0,0,ROUND(TOT_003_T/CNT_003,2)) AVG_003_T --3코스 평균시간
					,DECODE(TOT_004_T,0,0,ROUND(TOT_004_T/CNT_004,2)) AVG_004_T --4코스 평균시간
					,DECODE(TOT_005_T,0,0,ROUND(TOT_005_T/CNT_005,2)) AVG_005_T --5코스 평균시간
					,DECODE(TOT_006_T,0,0,ROUND(TOT_006_T/CNT_006,2)) AVG_006_T --6코스 평균시간
					,TOT_VIOL_CNT	--위반행위 횟수
					,TOT_VIOL_SCR   --위반점
				FROM
				(
					SELECT
						 RACER_PERIO_NO
						,CAND_NO
				        ,COUNT(CAND_NO) TOT_CNT	   --승정횟수
				        ,SUM(BOAT_TIME) TOT_TIME   --승정시간
				        ,SUM(DECODE(ARRIV_ORD,1,1,0)) CNT_1 --1착
				        ,SUM(DECODE(ARRIV_ORD,2,1,0)) CNT_2 --2착
				        ,SUM(DECODE(ARRIV_ORD,3,1,0)) CNT_3 --3착
				        ,SUM( CASE WHEN RACE_FL = '001' THEN 1 ELSE 0 END) REAL_CNT --F/L없는 카운트
				        ,SUM((CASE WHEN RACE_FL = '001' AND RACE_COURSE = '1' THEN RACE_TIME ELSE 0 END)) TOT_001_T
						,SUM((CASE WHEN RACE_FL = '001' AND RACE_COURSE = '2' THEN RACE_TIME ELSE 0 END)) TOT_002_T
						,SUM((CASE WHEN RACE_FL = '001' AND RACE_COURSE = '3' THEN RACE_TIME ELSE 0 END)) TOT_003_T
						,SUM((CASE WHEN RACE_FL = '001' AND RACE_COURSE = '4' THEN RACE_TIME ELSE 0 END)) TOT_004_T
						,SUM((CASE WHEN RACE_FL = '001' AND RACE_COURSE = '5' THEN RACE_TIME ELSE 0 END)) TOT_005_T
						,SUM((CASE WHEN RACE_FL = '001' AND RACE_COURSE = '6' THEN RACE_TIME ELSE 0 END)) TOT_006_T
				        ,SUM((CASE WHEN RACE_FL = '001' THEN RACE_TIME ELSE 0 END)) TOT_C_TIME
						,SUM( CASE WHEN RACE_FL = '001' AND RACE_COURSE = '1' THEN 1 ELSE 0 END) AS CNT_001
						,SUM( CASE WHEN RACE_FL = '001' AND RACE_COURSE = '2' THEN 1 ELSE 0 END) AS CNT_002
						,SUM( CASE WHEN RACE_FL = '001' AND RACE_COURSE = '3' THEN 1 ELSE 0 END) AS CNT_003
						,SUM( CASE WHEN RACE_FL = '001' AND RACE_COURSE = '4' THEN 1 ELSE 0 END) AS CNT_004
						,SUM( CASE WHEN RACE_FL = '001' AND RACE_COURSE = '5' THEN 1 ELSE 0 END) AS CNT_005
						,SUM( CASE WHEN RACE_FL = '001' AND RACE_COURSE = '6' THEN 1 ELSE 0 END) AS CNT_006
						,SUM(VIOL_CNT) TOT_VIOL_CNT
						,SUM(VIOL_SCR) TOT_VIOL_SCR
					FROM (
						SELECT
							 B.RACER_PERIO_NO
						    ,A.DT
							,D.CAND_NO
				    		, CASE WHEN RACE_FL = '001' THEN ARRIV_ORD ELSE 0 END ARRIV_ORD
							,D.STRATEGY
							,B.DAY_NO
							,B.ROUND
							,B.BOAT_TIME
							,C.RACE_FL
							,RACE_COURSE
							, CASE WHEN RACE_FL = '001' THEN RACE_TIME ELSE 0 END RACE_TIME
							,( SELECT COUNT(RACER_PERIO_NO) FROM TBDN_CAND_RACE_VIOL
								 WHERE RACER_PERIO_NO = D.RACER_PERIO_NO
								 AND DAY_NO = D.DAY_NO
								 AND ROUND = D.ROUND
								 AND TEAM_NO = D.TEAM_NO
								 AND RACE_REG_NO = D.RACE_REG_NO
								 AND VIOL_CD IS NOT NULL
							) VIOL_CNT
							,( SELECT SUM(VIOL_SCR) FROM TBDN_CAND_RACE_VIOL
								 WHERE RACER_PERIO_NO = D.RACER_PERIO_NO
								 AND DAY_NO = D.DAY_NO
								 AND ROUND = D.ROUND
								 AND TEAM_NO = D.TEAM_NO
								 AND RACE_REG_NO = D.RACE_REG_NO
								 AND VIOL_CD IS NOT NULL
							) VIOL_SCR
						FROM TBDN_CAND_RACE A, TBDN_CAND_RACE_RACE B, TBDN_CAND_RACE_RECD C, TBDN_CAND_RACE_ORGAN D, TBDN_CAND_IDENT E
						WHERE 1=1
						AND A.RACER_PERIO_NO = ?
						AND A.RACER_PERIO_NO = B.RACER_PERIO_NO
						AND A.DAY_NO = B.DAY_NO
						AND A.ROUND_CNT >= B.ROUND
						AND A.CFM_YN = 'Y'
						AND A.RACER_PERIO_NO = C.RACER_PERIO_NO
						AND B.DAY_NO = C.DAY_NO
						AND B.ROUND = C.ROUND
						AND A.RACER_PERIO_NO = D.RACER_PERIO_NO
						AND C.DAY_NO = D.DAY_NO
						AND C.ROUND = D.ROUND
						AND C.TEAM_NO = D.TEAM_NO
						AND C.RACE_REG_NO = D.RACE_REG_NO
						AND B.GBN = '006'    --모의경주
						AND RACE_COURSE IS NOT NULL
						AND D.RACER_PERIO_NO = E.RACER_PERIO_NO
						AND D.CAND_NO = E.CAND_NO
						AND E.DEL_YN = 'N'
						
					)
				 	GROUP BY RACER_PERIO_NO, CAND_NO
				) ORDER BY CAND_NO
	    ]]>
	</query>    
    <query id="tbdn_cand_race_organ_fn003" desc="승정시간집계표" fetchSize="10">
		<![CDATA[
			SELECT
				 RACER_PERIO_NO     AS RACER_PERIO_NO			-- 기수
				,CAND_NO            AS CAND_NO                  -- 후보생번호
				,FC_CAND_NM_003(CAND_NO) CAND_NM
				,COUNT(DISTINCT DT) AS DT_CNT 					-- 승정일수
				,SUM(DECODE(GBN,'001',BOAT_CNT,0))  AS CNT_001  -- 기본선회 승정횟수
				,SUM(DECODE(GBN,'002',BOAT_CNT,0))  AS CNT_002  -- 2정선회  승정횟수
				,SUM(DECODE(GBN,'003',BOAT_CNT,0))  AS CNT_003  -- 3정선회  승정횟수
				,SUM(DECODE(GBN,'004',BOAT_CNT,0))  AS CNT_004  -- 편대항주 승정횟수
				,SUM(DECODE(GBN,'005',BOAT_CNT,0))  AS CNT_005  -- ST연습   승정횟수
				,SUM(DECODE(GBN,'006',BOAT_CNT,0))  AS CNT_006  -- 모의경주 승정횟수
				,SUM(DECODE(GBN,'007',BOAT_CNT,0))  AS CNT_007  -- 기초과정 승정횟수
				,SUM(BOAT_CNT)                      AS CNT_TOT  -- 총 승정횟수
				,ROUND(SUM(BOAT_CNT)/COUNT(DISTINCT DT),2) AS AVG_CNT_DT --일별 평균 승정횟수
				,SUM(DECODE(GBN,'001',BOAT_TIME,0)) AS TIME_001  -- 기본선회 승정시간
				,SUM(DECODE(GBN,'002',BOAT_TIME,0)) AS TIME_002  -- 2정선회  승정시간
				,SUM(DECODE(GBN,'003',BOAT_TIME,0)) AS TIME_003  -- 3정선회  승정시간
				,SUM(DECODE(GBN,'004',BOAT_TIME,0)) AS TIME_004  -- 편대항주 승정시간
				,SUM(DECODE(GBN,'005',BOAT_TIME,0)) AS TIME_005  -- ST연습   승정시간
				,SUM(DECODE(GBN,'006',BOAT_TIME,0)) AS TIME_006  -- 모의경주 승정시간
				,SUM(DECODE(GBN,'007',BOAT_TIME,0)) AS TIME_007  -- 기초과정 승정시간
				,SUM(BOAT_TIME)                     AS TIME_TOT  -- 총 승정시간
				,ROUND(SUM(BOAT_TIME)/COUNT(DISTINCT DT),2) AS AVG_TIME_DT --일별 평균 승정시간
				,SUM(VIOL_CNT)						AS VIOL_CNT  -- 위반행위 횟수
			FROM
			(
				SELECT
					 RACER_PERIO_NO
					,CAND_NO
					,DT
					,GBN
					,SUM(CASE WHEN GBN = '005' AND RACE_SEQ != 1 THEN 0 ELSE 1 END) BOAT_CNT
					,SUM(CASE WHEN GBN = '005' AND RACE_SEQ != 1 THEN 0 ELSE BOAT_TIME END) BOAT_TIME
					,SUM(CASE WHEN GBN = '005' AND RACE_SEQ != 1 THEN 0 ELSE VIOL_CNT END)  VIOL_CNT
				FROM (
					SELECT
						 B.RACER_PERIO_NO
					    ,A.DT
						,D.CAND_NO
						,B.DAY_NO
						,B.ROUND
						,B.GBN
						,B.BOAT_TIME
						,C.RACE_FL
						,RACE_SEQ
						,RACE_COURSE
						,RACE_TIME
						,( SELECT COUNT(RACER_PERIO_NO) FROM TBDN_CAND_RACE_VIOL
							 WHERE RACER_PERIO_NO = D.RACER_PERIO_NO
							 AND DAY_NO = D.DAY_NO
							 AND ROUND = D.ROUND
							 AND TEAM_NO = D.TEAM_NO
							 AND RACE_REG_NO = D.RACE_REG_NO
							 AND VIOL_CD IS NOT NULL
						) VIOL_CNT
					FROM TBDN_CAND_RACE A, TBDN_CAND_RACE_RACE B, TBDN_CAND_RACE_RECD C, TBDN_CAND_RACE_ORGAN D, TBDN_CAND_IDENT E
					WHERE 1=1
					AND A.RACER_PERIO_NO = ?
					AND A.RACER_PERIO_NO = B.RACER_PERIO_NO
					AND A.DAY_NO = B.DAY_NO
					AND A.ROUND_CNT >= B.ROUND
					AND A.CFM_YN = 'Y'
					AND A.RACER_PERIO_NO = C.RACER_PERIO_NO
					AND B.DAY_NO = C.DAY_NO
					AND B.ROUND = C.ROUND
					AND A.RACER_PERIO_NO = D.RACER_PERIO_NO
					AND C.DAY_NO = D.DAY_NO
					AND C.ROUND = D.ROUND
					AND C.TEAM_NO = D.TEAM_NO
					AND C.RACE_REG_NO = D.RACE_REG_NO
					AND (    (B.GBN IN ('005','006') AND RACE_COURSE IS NOT NULL)          --ST연습, 모의경주는 C 입력경주만
						  OR (B.GBN IN ('001','002','003','004','007') AND RACE_SEQ = '1') --나머지 경주는 1건의 데이터만
					     )
					AND D.RACER_PERIO_NO = E.RACER_PERIO_NO
					AND D.CAND_NO = E.CAND_NO
					AND E.DEL_YN = 'N'				
				)
				WHERE 1=1
				GROUP BY RACER_PERIO_NO, CAND_NO, GBN, DT
			)
			GROUP BY RACER_PERIO_NO, CAND_NO
			ORDER BY RACER_PERIO_NO, CAND_NO

	    ]]>
	</query>    

    <query id="tbdn_cand_race_organ_fn004" desc="위반행위계표" fetchSize="10">
		<![CDATA[
			SELECT
				 E.RACER_PERIO_NO
				,E.CAND_NO
				,FC_CAND_NM_003(E.CAND_NO) CAND_NM
				,NVL(A.CNT_001,0) CNT_001
				,NVL(A.CNT_002,0) CNT_002
				,NVL(A.CNT_003,0) CNT_003
				,NVL(A.CNT_004,0) CNT_004
				,NVL(A.CNT_125,0) CNT_125
				,NVL(A.CNT_130,0) CNT_130
				,NVL(A.CNT_140,0) CNT_140
				,NVL(A.CNT_150,0) CNT_150
				,NVL(A.CNT_210,0) CNT_210
				,NVL(A.CNT_220,0) CNT_220
				,NVL(A.CNT_301,0) CNT_301
				,NVL(A.CNT_302,0) CNT_302
				,NVL(A.CNT_993,0) CNT_993
				,NVL(A.CNT_994,0) CNT_994
				,NVL(A.CNT_999,0) CNT_999
			FROM
			(
				SELECT
					 B.RACER_PERIO_NO
					,B.CAND_NO
					,SUM(DECODE(B.VIOL_CD, '001', 1,0)) CNT_001
					,SUM(DECODE(B.VIOL_CD, '002', 1,0)) CNT_002
					,SUM(DECODE(B.VIOL_CD, '003', 1,0)) CNT_003
					,SUM(DECODE(B.VIOL_CD, '004', 1,0)) CNT_004
					,SUM(DECODE(B.VIOL_CD, '125', 1,0)) CNT_125
					,SUM(DECODE(B.VIOL_CD, '130', 1,0)) CNT_130
					,SUM(DECODE(B.VIOL_CD, '140', 1,0)) CNT_140
					,SUM(DECODE(B.VIOL_CD, '150', 1,0)) CNT_150
					,SUM(DECODE(B.VIOL_CD, '210', 1,0)) CNT_210
					,SUM(DECODE(B.VIOL_CD, '220', 1,0)) CNT_220
					,SUM(DECODE(B.VIOL_CD, '301', 1,0)) CNT_301
					,SUM(DECODE(B.VIOL_CD, '302', 1,0)) CNT_302
					,SUM(DECODE(B.VIOL_CD, '993', 1,0)) CNT_993
					,SUM(DECODE(B.VIOL_CD, '994', 1,0)) CNT_994
					,SUM(DECODE(B.VIOL_CD, '999', 1,0)) CNT_999
				FROM TBDN_CAND_RACE A, TBDN_CAND_RACE_VIOL B
				WHERE 1=1
				AND A.RACER_PERIO_NO = ?
				AND A.RACER_PERIO_NO = B.RACER_PERIO_NO
				AND A.DAY_NO = B.DAY_NO
				AND A.ROUND_CNT >= B.ROUND
				AND A.CFM_YN = 'Y'
				GROUP BY B.RACER_PERIO_NO, B.CAND_NO
			) A,
			TBDN_CAND_IDENT E
			WHERE 1=1
			AND A.RACER_PERIO_NO(+) = E.RACER_PERIO_NO
			AND A.CAND_NO(+) = E.CAND_NO
			AND E.DEL_YN = 'N'
			AND E.RACER_PERIO_NO = ?
			ORDER BY E.CAND_NO

	    ]]>
	</query>    	
</queryMap>