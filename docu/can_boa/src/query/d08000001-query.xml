<?xml version="1.0" encoding='EUC-KR'?>
<queryMap desc="TBDP_EQUIP_DETL(경정장비내역)"> 
 
  	<query id="d08000001_fb001" desc="장비내역  조회" fetchSize="10">
        <![CDATA[
			SELECT	 
					'0' AS CHK
					,EQUIP_GBN
					,EQIP.EQUIP_NO
					,EQIP.ENT_DT
					,EQIP.STATE
					,EQIP.RMK
				    ,SCR.RUN_CNT
			        ,SCR.RACE_CNT
			        ,SCR.RACE_DAY_CNT
			        ,SCR.RANK_1_CNT
			        ,SCR.RANK_2_CNT
			        ,SCR.RANK_3_CNT
			        ,SCR.RANK_4_CNT
			        ,SCR.RANK_5_CNT
			        ,SCR.RANK_6_CNT
			        ,SCR.AMU_RANK_SCR
			        ,SCR.AVG_RANK_SCR
			        ,SCR.WIN_RATIO
	                ,SCR.HIGH_RANK_RATIO
	                ,SCR.HIGH_3_RANK_RATIO 
			FROM	TBDP_EQUIP_DETL EQIP,
				(
					SELECT   EQUIP_NO
					        ,RUN_CNT
					        ,RACE_CNT
					        ,RACE_DAY_CNT
					        ,RANK_1_CNT
					        ,RANK_2_CNT
					        ,RANK_3_CNT
					        ,RANK_4_CNT
					        ,RANK_5_CNT
					        ,RANK_6_CNT
					        ,AMU_RANK_SCR
					        ,AVG_RANK_SCR
					        ,WIN_RATIO
			                ,HIGH_RANK_RATIO
			                ,HIGH_3_RANK_RATIO
			        FROM    (
			                SELECT   BOAT_NO 								EQUIP_NO
							   	    ,NVL(ROUND(AVG(RUN_CNT),2),0)  			RUN_CNT				--출전회수
							   	    ,NVL(ROUND(AVG(RACE_CNT),2),0)  		RACE_CNT			--출주횟수 
							   	    ,NVL(ROUND(AVG(RACE_DAY_CNT),2),0)  	RACE_DAY_CNT		--출전일수
							   	    ,NVL(ROUND(AVG(RANK_1_CNT),2),0)  		RANK_1_CNT			--1착회수
							   	    ,NVL(ROUND(AVG(RANK_2_CNT),2),0)  		RANK_2_CNT			--2착회수
							   	    ,NVL(ROUND(AVG(RANK_3_CNT),2),0)  		RANK_3_CNT			--3착회수
							   	    ,NVL(ROUND(AVG(RANK_4_CNT),2),0)  		RANK_4_CNT			--4착회수
							   	    ,NVL(ROUND(AVG(RANK_5_CNT),2),0)  		RANK_5_CNT			--5착회수
							   	    ,NVL(ROUND(AVG(RANK_6_CNT),2),0)  		RANK_6_CNT			--6착회수
							   	    ,NVL(ROUND(AVG(AMU_RANK_SCR),2),0)  	AMU_RANK_SCR		--누적착순점 
							   	    ,NVL(ROUND(AVG(AVG_RANK_SCR),2),0)  	AVG_RANK_SCR		--평균착순점
							   	    ,NVL(ROUND(AVG(WIN_RATIO),2),0) 		WIN_RATIO			--연간승률
							    	,NVL(ROUND(AVG(HIGH_RANK_RATIO),2),0) 	HIGH_RANK_RATIO		--연대율
							    	,NVL(ROUND(AVG(HIGH_3_RANK_RATIO),2),0) HIGH_3_RANK_RATIO	--3연대율
							FROM    MRASYS.TBEB_BOAT_RECD_ACCU_SUM
							GROUP BY BOAT_NO
							UNION ALL
							SELECT   MOT_NO 								EQUIP_NO
							        ,NVL(ROUND(AVG(RUN_CNT),2),0)  			RUN_CNT				--출전회수
							   	    ,NVL(ROUND(AVG(RACE_CNT),2),0)  		RACE_CNT			--출주횟수 
							   	    ,NVL(ROUND(AVG(RACE_DAY_CNT),2),0)  	RACE_DAY_CNT		--출전일수
							   	    ,NVL(ROUND(AVG(RANK_1_CNT),2),0)  		RANK_1_CNT			--1착회수
							   	    ,NVL(ROUND(AVG(RANK_2_CNT),2),0)  		RANK_2_CNT			--2착회수
							   	    ,NVL(ROUND(AVG(RANK_3_CNT),2),0)  		RANK_3_CNT			--3착회수
							   	    ,NVL(ROUND(AVG(RANK_4_CNT),2),0)  		RANK_4_CNT			--4착회수
							   	    ,NVL(ROUND(AVG(RANK_5_CNT),2),0)  		RANK_5_CNT			--5착회수
							   	    ,NVL(ROUND(AVG(RANK_6_CNT),2),0)  		RANK_6_CNT			--6착회수
							   	    ,NVL(ROUND(AVG(AMU_RANK_SCR),2),0)  	AMU_RANK_SCR		--누적착순점 
							   	    ,NVL(ROUND(AVG(AVG_RANK_SCR),2),0)  	AVG_RANK_SCR		--평균착순점
							   	    ,NVL(ROUND(AVG(WIN_RATIO),2),0) 		WIN_RATIO			--연간승률
							    	,NVL(ROUND(AVG(HIGH_RANK_RATIO),2),0) 	HIGH_RANK_RATIO		--연대율
							    	,NVL(ROUND(AVG(HIGH_3_RANK_RATIO),2),0) HIGH_3_RANK_RATIO	--3연대율 
							FROM     MRASYS.TBEB_MOT_RECD_ACCU_SUM
							GROUP BY MOT_NO
			                )
					) SCR
			WHERE	EQIP.EQUIP_NO=SCR.EQUIP_NO(+)
					AND EQIP.EQUIP_GBN = NVL(?,EQIP.EQUIP_GBN)
					AND EQIP.EQUIP_NO LIKE ?||'%'
			ORDER BY EQIP.EQUIP_GBN
					,EQIP.EQUIP_NO
		]]>
    </query> 
    
    <query id="d08000001_ib001" desc="장비내역  입력" fetchSize="10">
        <![CDATA[
			INSERT
			INTO	TBDP_EQUIP_DETL
					(
					EQUIP_GBN
					,EQUIP_NO
					,ENT_DT
					,STATE
					,RMK
					,RACE_CNT
					,INST_ID
					,INST_DTM
					,USER_GBN
					)
			VALUES	(
					?
					,?
					,?
					,?
					,?
					,0
					,?
					,SYSDATE
					,?
					)
		]]>
    </query>
    
    <query id="d08000001_ub001" desc="장비내역 갱신" fetchSize="10">
        <![CDATA[
			UPDATE	TBDP_EQUIP_DETL
			SET		ENT_DT = ?
					,STATE = ?
					,RMK = ?
					,UPDT_ID = ?
					,UPDT_DTM = SYSDATE
					,USER_GBN = ?
			WHERE	EQUIP_GBN = ?
			AND 	EQUIP_NO = ?
				
		]]>
    </query>
    
    <query id="d08000001_db001" desc="장비내역  삭제" fetchSize="10">
        <![CDATA[
			DELETE	FROM	TBDP_EQUIP_DETL
			WHERE	EQUIP_GBN = ?
			  AND   EQUIP_NO  = ?
					
		]]>
    </query>
    
    
    <query id="d08000001_fb002" desc="정비내역  조회" fetchSize="10">
        <![CDATA[
			SELECT	EQUIP_GBN
					,EQUIP_NO
					,SEQ
					,MANTC_DT
					,MANTC_GBN
					,MANTC_MAN
					,CHECK_MAN
					,USER_GBN
					,USER_NO
					,USER_NM
					,MANTC_CMT
					,SPEC_DESC
			FROM	TBDP_MANTC_DETL
			WHERE	EQUIP_GBN = ?
					AND EQUIP_NO = ?
		]]>
    </query>
    
    <query id="d08000001_ib002" desc="정비내역  입력" fetchSize="10">
        <![CDATA[
        	INSERT	
        	INTO	TBDP_MANTC_DETL
        			(
					 EQUIP_GBN
					,EQUIP_NO
					,SEQ
					,MANTC_DT
					,MANTC_GBN
					,MANTC_MAN
					,CHECK_MAN
					,USER_GBN
					,USER_NO
					,USER_NM
					,MANTC_CMT
					,SPEC_DESC
					,INST_ID
					,INST_DTM
					)
			VALUES	(
					?
					,?
					,	(
						SELECT	NVL(MAX(SEQ),0)+1
						FROM	TBDP_MANTC_DETL
						WHERE	EQUIP_GBN = ?
								AND EQUIP_NO = ?
						)
					,?
					,?
					,?
					,?
					,?
					,?
					,?
					,?
					,?
					,?
					,SYSDATE
					)
		]]>
    </query>
    
    <query id="d08000001_ub002" desc="정비내역  갱신" fetchSize="10">
        <![CDATA[
			UPDATE	TBDP_MANTC_DETL
			SET		 MANTC_DT 	= ?
					,MANTC_GBN 	= ?
					,MANTC_MAN 	= ?
					,CHECK_MAN 	= ?
					,USER_GBN 	= ?
					,USER_NO 	= ?
					,USER_NM 	= ?
					,MANTC_CMT 	= ?
					,SPEC_DESC 	= ?
					,UPDT_ID 	= ?
					,UPDT_DTM = SYSDATE
			WHERE	EQUIP_GBN 	= ?
					AND EQUIP_NO= ?
					AND SEQ 	= ?
		]]>
    </query>
    
    <query id="d08000001_db002" desc="정비내역 삭제" fetchSize="10">
        <![CDATA[
			DELETE
			FROM	TBDP_MANTC_DETL
			WHERE	EQUIP_GBN 	= ?
			  AND 	EQUIP_NO	= ?
			  AND 	SEQ 		= ?
		]]>
    </query>
    
    <query id="d08000001_db005" desc="정비내역 삭제(장비삭제)" fetchSize="10">
        <![CDATA[
			DELETE
			FROM	TBDP_MANTC_DETL
			WHERE	EQUIP_GBN 	= ?
			  AND 	EQUIP_NO 	= ?
		]]>
    </query>
    
     
    <query id="d08000001_fb003" desc="유류입고 조회" fetchSize="10">
        <![CDATA[
			SELECT  0 AS CHK
					,ENT_DT
			        ,OIL_GBN
			        ,SUPR
			        ,ENT_QUANT
			        ,C-D AS OIL_STOCK
			        ,RMK
			FROM    (        
			        SELECT	ENT_DT
			                ,OIL_GBN
			                ,SUPR
			                ,ENT_QUANT
			                ,NVL((SELECT SUM(ENT_QUANT) FROM TBDP_OIL_ENT WHERE OIL_GBN=A.OIL_GBN AND ENT_DT <=A.ENT_DT),0) AS C
			                ,NVL((SELECT SUM(OUT_QUANT) FROM TBDP_OIL_OUT WHERE OIL_GBN=A.OIL_GBN AND OUT_DT <=A.ENT_DT),0) AS D
			                ,RMK
			        FROM	TBDP_OIL_ENT A
			        WHERE	A.OIL_GBN = NVL(?,A.OIL_GBN)
			                AND SUBSTR(A.ENT_DT,1,4) LIKE NVL(?, '%')||NVL(?,'%')||'%'
			        ) 
			ORDER BY ENT_DT DESC
		]]>
    </query>
    
    <query id="d08000001_ib003" desc="유류입고 입력" fetchSize="10">
        <![CDATA[
			INSERT
			INTO	TBDP_OIL_ENT
					(
					ENT_DT
					,OIL_GBN
					,SUPR
					,ENT_QUANT
					,RMK
					,INST_ID
					,INST_DTM
					)
			VALUES	(
					?
					,?
					,?
					,?
					,?
					,?
					,SYSDATE
					)
		]]>
    </query>
    
    <query id="d08000001_ub003" desc="유류입고 수정" fetchSize="10">
        <![CDATA[
			UPDATE	TBDP_OIL_ENT
			SET		SUPR 		= ?
					,ENT_QUANT 	= ?
					,RMK 		= ?
					,UPDT_ID 	= ?
					,UPDT_DTM 	= SYSDATE
			WHERE	ENT_DT 		= ?
					AND OIL_GBN = ?
		]]>
    </query>
    
    <query id="d08000001_db003" desc="유류입고 삭제" fetchSize="10">
        <![CDATA[
			DELETE
			FROM	TBDP_OIL_ENT
			WHERE	ENT_DT 	= ?
			  AND 	OIL_GBN = ?	
		]]>
    </query>
      
    <query id="d08000001_fb004" desc="유류출고 조회" fetchSize="10">
        <![CDATA[
			SELECT  0 AS CHK
					,OUT_DT
			        ,OIL_GBN
			        ,OUT_OBJ
			        ,OUT_QUANT
			        ,C-D AS OIL_STOCK
			        ,CCIT_CNT
			        ,RMK
			FROM    (
			        SELECT  OUT_DT
			                ,OIL_GBN
			                ,OUT_OBJ
			                ,OUT_QUANT
			                ,NVL((SELECT SUM(ENT_QUANT) FROM TBDP_OIL_ENT WHERE OIL_GBN=A.OIL_GBN AND ENT_DT <=A.OUT_DT),0) AS C
			                ,NVL((SELECT SUM(OUT_QUANT) FROM TBDP_OIL_OUT WHERE OIL_GBN=A.OIL_GBN AND OUT_DT <=A.OUT_DT),0) AS D
			                ,CCIT_CNT
			                ,RMK
			        FROM	TBDP_OIL_OUT A
			        WHERE   A.OUT_QUANT > 0
			            AND A.OIL_GBN = NVL(?,A.OIL_GBN)
			            AND A.OUT_DT LIKE ?||?||'%'
			        )
			ORDER
			BY		OUT_DT DESC, OIL_GBN, OUT_OBJ
		]]>
    </query>
    
    <query id="d08000001_fb005" desc="유류간편출고 조회" fetchSize="10">
        <![CDATA[
			SELECT /* d08000001_fb005 */
			       '0' AS CHK,
			       OUT_DT,
			       SUM(OUT_QUANT11) AS OUT_QUANT11,
			       SUM(OUT_QUANT12) AS OUT_QUANT12,
			       SUM(OUT_QUANT13) AS OUT_QUANT13,
			       SUM(OUT_QUANT14) AS OUT_QUANT14,
			       SUM(OUT_QUANT21) AS OUT_QUANT21,
			       SUM(OUT_QUANT22) AS OUT_QUANT22,
			       SUM(OUT_QUANT23) AS OUT_QUANT23,
			       SUM(OUT_QUANT24) AS OUT_QUANT24,
			       SUM(OUT_QUANT10) OUT_QUANT10,
			       SUM(OUT_QUANT20) OUT_QUANT20,
			       SUM(OUT_QUANT10) + SUM(OUT_QUANT20) OUT_QUANT_SUM
			FROM (
			    SELECT  OUT_DT,
			            CASE WHEN OIL_GBN = '001' AND OUT_OBJ = '001' THEN OUT_QUANT END AS OUT_QUANT11,  
			            CASE WHEN OIL_GBN = '001' AND OUT_OBJ = '002' THEN OUT_QUANT END AS OUT_QUANT12,   
			            CASE WHEN OIL_GBN = '001' AND OUT_OBJ = '003' THEN OUT_QUANT END AS OUT_QUANT13,   
			            CASE WHEN OIL_GBN = '001' AND OUT_OBJ = '004' THEN OUT_QUANT END AS OUT_QUANT14,   
			            CASE WHEN OIL_GBN = '001' THEN OUT_QUANT END AS OUT_QUANT10,
			            CASE WHEN OIL_GBN = '002' AND OUT_OBJ = '001' THEN OUT_QUANT END AS OUT_QUANT21,   
			            CASE WHEN OIL_GBN = '002' AND OUT_OBJ = '002' THEN OUT_QUANT END AS OUT_QUANT22,   
			            CASE WHEN OIL_GBN = '002' AND OUT_OBJ = '003' THEN OUT_QUANT END AS OUT_QUANT23,   
			            CASE WHEN OIL_GBN = '002' AND OUT_OBJ = '004' THEN OUT_QUANT END AS OUT_QUANT24, 
			            CASE WHEN OIL_GBN = '002' THEN OUT_QUANT END AS OUT_QUANT20            
			    FROM    TBDP_OIL_OUT A
			    WHERE   A.OUT_DT LIKE NVL(?, '%')||NVL(?,'%')||'%'
			    )
			GROUP BY OUT_DT
			ORDER BY OUT_DT 
		]]>
    </query>
    
    <query id="d08000001_ib004" desc="유류출고 입력" fetchSize="10">
        <![CDATA[
			INSERT
			INTO	TBDP_OIL_OUT
					(
					OUT_DT
					,OIL_GBN
					,OUT_OBJ
					,OUT_QUANT
					,CCIT_CNT
					,RMK
					,INST_ID
					,INST_DTM
					)
			VALUES	(
					?
					,?
					,?
					,?
					,?
					,?
					,?
					,SYSDATE
					)
		]]>
    </query>
    
    <query id="d08000001_ub004" desc="유류출고 수정" fetchSize="10">
        <![CDATA[
			UPDATE	TBDP_OIL_OUT
			SET		OUT_QUANT 	= ?
					,CCIT_CNT	= ?
					,RMK 		= ?
					,UPDT_ID 	= ?
					,UPDT_DTM = SYSDATE
			WHERE	OUT_DT 		= ?
			  AND OIL_GBN 		= ?
			  AND OUT_OBJ 		= ?
		]]>
    </query>
    
    <query id="d08000001_db004" desc="유류출고 삭제" fetchSize="10">
        <![CDATA[
			DELETE
			FROM	TBDP_OIL_OUT
			WHERE	OUT_DT 	= ?
			  AND 	OIL_GBN = ?
			  AND 	OUT_OBJ = ?
		]]>
    </query>
     
    <query id="d08000001_iub001" desc="유류출고 입력" fetchSize="10">
        <![CDATA[
			MERGE  /* d08000001_iub001 */
			       INTO tbdp_oil_out dest
			USING (
			    SELECT ? AS out_dt,
			           ? AS oil_gbn,
			           ? AS out_obj,
			           NVL(?,0) AS out_quant,
			           ? AS user_id
			    FROM   dual
			    ) src
			    ON (
			        dest.out_dt  = src.out_dt
			    AND dest.oil_gbn = src.oil_gbn
			    AND dest.out_obj = src.out_obj
			    )
			    WHEN MATCHED THEN
			        UPDATE set
			            dest.out_quant = src.out_quant,
			            dest.updt_id = src.user_id,
			            dest.updt_dtm = SYSDATE
			   WHEN NOT MATCHED THEN
			        INSERT (
			            out_dt,
			            oil_gbn,
			            out_obj,
			            out_quant,
			            inst_id,
			            inst_dtm)
			        VALUES (
			            src.out_dt,
			            src.oil_gbn,
			            src.out_obj,
			            src.out_quant,
			            src.user_id,
			            SYSDATE
			       )
        
     	]]>
    </query>
        
    <query id="d08000001_iub002" desc="유류출고 일자별 삭제" fetchSize="10">
        <![CDATA[
			DELETE
			FROM	TBDP_OIL_OUT
			WHERE	OUT_DT 	= ?
		]]>
    </query>

     <query id="d08000001_out_sum" desc="출고 종합현황" fetchSize="10">
        <![CDATA[
		    SELECT  NM AS NM
		    		,NVL(PLY,0) AS PLY
			        ,NVL(CAN,0) AS CAN
			        ,NVL(HLP,0) AS HLP
			        ,NVL(ETC,0) AS ETC
			        ,NVL(PLY,0)+NVL(CAN,0)+NVL(HLP,0)+NVL(ETC,0) AS SUMM
			FROM    (
			        SELECT  '가솔린(리터)' AS NM
			        		,PLY
			                ,CAN
			                ,HLP
			                ,ETC
			                ,1 AS ORD
			        FROM    (SELECT SUM(OUT_QUANT) AS PLY FROM TBDP_OIL_OUT WHERE OIL_GBN = '001' AND OUT_OBJ='001' AND SUBSTR(OUT_DT,1,6) LIKE ?||?||'%')
			                ,(SELECT SUM(OUT_QUANT) AS CAN FROM TBDP_OIL_OUT WHERE OIL_GBN = '001' AND OUT_OBJ='002' AND SUBSTR(OUT_DT,1,6) LIKE ?||?||'%')
			                ,(SELECT SUM(OUT_QUANT) AS HLP FROM TBDP_OIL_OUT WHERE OIL_GBN = '001' AND OUT_OBJ='003' AND SUBSTR(OUT_DT,1,6) LIKE ?||?||'%')
			                ,(SELECT SUM(OUT_QUANT) AS ETC FROM TBDP_OIL_OUT WHERE OIL_GBN = '001' AND OUT_OBJ='004' AND SUBSTR(OUT_DT,1,6) LIKE ?||?||'%')
			        UNION ALL
			        SELECT  '엔진오일(개수)' AS NM
			        		,PLY
			                ,CAN
			                ,HLP
			                ,ETC
			                ,2 AS ORD
			        FROM    (SELECT SUM(OUT_QUANT) AS PLY FROM TBDP_OIL_OUT WHERE OIL_GBN = '002' AND OUT_OBJ='001' AND SUBSTR(OUT_DT,1,6) LIKE ?||?||'%')
			                ,(SELECT SUM(OUT_QUANT) AS CAN FROM TBDP_OIL_OUT WHERE OIL_GBN = '002' AND OUT_OBJ='002' AND SUBSTR(OUT_DT,1,6) LIKE ?||?||'%')
			                ,(SELECT SUM(OUT_QUANT) AS HLP FROM TBDP_OIL_OUT WHERE OIL_GBN = '002' AND OUT_OBJ='003' AND SUBSTR(OUT_DT,1,6) LIKE ?||?||'%')
			                ,(SELECT SUM(OUT_QUANT) AS ETC FROM TBDP_OIL_OUT WHERE OIL_GBN = '002' AND OUT_OBJ='004' AND SUBSTR(OUT_DT,1,6) LIKE ?||?||'%')
			        UNION ALL
			        SELECT  '주회수(R)' AS NM
			        		,PLY
			                ,CAN
			                ,HLP
			                ,ETC
			                ,3 AS ORD
			        FROM    (SELECT SUM(CCIT_CNT) AS PLY FROM TBDP_OIL_OUT WHERE OUT_OBJ='001' AND SUBSTR(OUT_DT,1,6) LIKE ?||?||'%')
			                ,(SELECT SUM(CCIT_CNT) AS CAN FROM TBDP_OIL_OUT WHERE OUT_OBJ='002' AND SUBSTR(OUT_DT,1,6) LIKE ?||?||'%')
			                ,(SELECT SUM(CCIT_CNT) AS HLP FROM TBDP_OIL_OUT WHERE OUT_OBJ='003' AND SUBSTR(OUT_DT,1,6) LIKE ?||?||'%')
			                ,(SELECT SUM(CCIT_CNT) AS ETC FROM TBDP_OIL_OUT WHERE OUT_OBJ='004' AND SUBSTR(OUT_DT,1,6) LIKE ?||?||'%')
			        )
			ORDER BY ORD
		]]>
    </query>
    
   <query id="d08000001_year" desc="조회" fetchSize="10">
        <![CDATA[
			SELECT DT AS CD
				   ,DT AS CD_NM
			FROM    (
			        SELECT  DISTINCT(SUBSTR(DT,1,4)) DT
			        FROM    (
			                SELECT  OUT_DT AS DT
			                FROM    TBDP_OIL_OUT
			                UNION ALL
			                SELECT  ENT_DT AS DT
			                FROM    TBDP_OIL_ENT
			                )
			        )
			ORDER
			BY      CD DESC
		]]>
    </query>
     
</queryMap>
