<?xml version="1.0" encoding='EUC-KR'?>
<queryMap desc="모터정비실기평가측정"> 
    <query id="tbdn_motor_assem_cd_fn001" desc="기수 조회" fetchSize="10">
		<![CDATA[
			
			 SELECT  CD  RACER_PERIO_NO
				 FROM  TBDM_SPEC_CD
				 WHERE GRP_CD  = 'D10000'
				 ORDER BY CD DESC
			
	    ]]>
    </query>
    
    <query id="tbdn_motor_assem_cd_fn002" desc="모터정비실기평가 항목 조회" fetchSize="10">
        <![CDATA[
			SELECT   RACER_PERIO_NO
					,ESTM_ITEM_CD
					,ESTM_ITEM_DETL_CD
					,ASSIGN_SCR_LIMIT
					,VERY_SUPER_ASSIGN_SCR
					,SUPER_ASSIGN_SCR
					,NORM_ASSIGN_SCR
					,INSUF_ASSIGN_SCR
					,VERY_INSUF_ASSIGN_SCR
					,'0' CHK
			FROM    TBDN_MOTOR_ASSEM_CD	
			WHERE	RACER_PERIO_NO 		= ?
			AND		ESTM_ITEM_CD 		= '201'
		]]>
    </query>   

    <query id="tbdn_motor_assem_cd_fn003" desc="모터정비실기 평가 항목 조회" fetchSize="10">
        <![CDATA[
			SELECT   RACER_PERIO_NO
					,ESTM_ITEM_CD
					,ESTM_ITEM_DETL_CD
					,ASSIGN_SCR_LIMIT
					,VERY_SUPER_ASSIGN_SCR
					,SUPER_ASSIGN_SCR
					,NORM_ASSIGN_SCR
					,INSUF_ASSIGN_SCR
					,VERY_INSUF_ASSIGN_SCR
					,'0' CHK
			FROM    TBDN_MOTOR_ASSEM_CD	
			WHERE	RACER_PERIO_NO 	= ?
			AND		ESTM_ITEM_CD 	= '202'
		]]>
    </query>   
    
    <query id="tbdn_motor_assem_cd_fn004" desc="모터정비실기 평가 항목 조회" fetchSize="10">
        <![CDATA[
			SELECT   RACER_PERIO_NO
					,ESTM_ITEM_CD
					,ESTM_ITEM_DETL_CD
					,ASSIGN_SCR_LIMIT
					,VERY_SUPER_ASSIGN_SCR
					,SUPER_ASSIGN_SCR
					,NORM_ASSIGN_SCR
					,INSUF_ASSIGN_SCR
					,VERY_INSUF_ASSIGN_SCR
					,'0' CHK
			FROM    TBDN_MOTOR_ASSEM_CD	
			WHERE	RACER_PERIO_NO 		= ?
			AND		ESTM_ITEM_CD 		= '203'
		]]>
    </query>   
    
    <query id="tbdn_motor_assem_cd_un001" desc="모터정비실기 평가 항목 수정" fetchSize="10">
        <![CDATA[
			UPDATE TBDN_MOTOR_ASSEM_CD 
			SET  ASSIGN_SCR_LIMIT			= ?
    			,VERY_SUPER_ASSIGN_SCR 		= ?
    			,SUPER_ASSIGN_SCR 			= ?
    			,NORM_ASSIGN_SCR 			= ?
    			,INSUF_ASSIGN_SCR 			= ?
    			,VERY_INSUF_ASSIGN_SCR 		= ?
			WHERE RACER_PERIO_NO 			= ?
			  AND ESTM_ITEM_CD 				= ?
			  AND ESTM_ITEM_DETL_CD 		= ?
		]]>
    </query>
    
    <query id="tbdn_motor_assem_cd_in001" desc="모터정비실기 평가 항목 입력" fetchSize="10">
        <![CDATA[
			INSERT INTO TBDN_MOTOR_ASSEM_CD (
			      RACER_PERIO_NO
			    , ESTM_ITEM_CD
			    , ESTM_ITEM_DETL_CD
			    , ASSIGN_SCR_LIMIT
			    , VERY_SUPER_ASSIGN_SCR
			    , SUPER_ASSIGN_SCR
			    , NORM_ASSIGN_SCR
			    , INSUF_ASSIGN_SCR
			    , VERY_INSUF_ASSIGN_SCR
			) VALUES (
				 ?
				,?
				,?
				,?
				,?
				,?
				,?
				,?
				,?
			)
		]]>
    </query>
    
    <query id="tbdn_motor_assem_estm_dn001" desc="모터정비실기 평가 항목 삭제" fetchSize="10">
        <![CDATA[
			DELETE FROM   TBDN_MOTOR_ASSEM_CD 
			WHERE  RACER_PERIO_NO 		= ?
			AND    ESTM_ITEM_CD 		= ?   
			AND    ESTM_ITEM_DETL_CD 	= ?   
		]]>
    </query> 
    
    <query id="tbdn_motor_assem_estm_fn001" desc="모터정비실기 평가표 조회" fetchSize="10">
        <![CDATA[ 
			SELECT   B.RACER_PERIO_NO 
		            ,B.CAND_NO  
		            ,B.NM_KOR
		            ,A.ESTM_ID
		            ,A.ROUND            
		            ,A.DT                        
		            ,A.ASSEM_SCR
		            ,A.ASSEM_TIME_SCR
		            ,A.ASSIGN_SCR
		            ,CASE WHEN A.ASSIGN_SCR IS NULL THEN NULL
	                      WHEN A.ASSIGN_SCR >= 60 THEN '001' 
	                      ELSE '003' END DCSN
		            ,A.RMK
			FROM   TBDN_MOTOR_ASSEM_ESTM A, TBDN_CAND_IDENT B    
			WHERE 1=1
		          AND A.RACER_PERIO_NO(+) = B.RACER_PERIO_NO
		          AND A.CAND_NO(+)        = B.CAND_NO
		          AND NVL(B.DEL_YN, 'N')  = 'N'
		          AND B.TH_STAT IN ('001','002','003')
		          AND B.RACER_PERIO_NO    =  ?
		          AND A.ROUND(+)          =  ?
		          AND A.ESTM_ID(+)        =  ?
		          AND B.CAND_NO NOT IN (SELECT CAND_NO
                                        FROM TBDN_TEMP_ABS
                                        WHERE 1=1
                                              AND RACER_PERIO_NO =  B.RACER_PERIO_NO
                                              AND GEN_DT <  NVL(A.DT, TO_CHAR(SYSDATE, 'YYYYDDMM'))
                                              AND GBN IN ('001', '003'))  
			ORDER BY B.CAND_NO
		]]>
    </query>   
    
    <query id="tbdn_motor_assem_estm_fn002" desc="모터정비실기 평가표 조회-개인별 분해조립 숙련도" fetchSize="10">
        <![CDATA[
        	SELECT  A.RACER_PERIO_NO 
			        ,'' ROUND 
			        ,'' CAND_NO
			        ,'' ESTM_ID 
			        ,A.ESTM_ITEM_CD 
			        ,A.ESTM_ITEM_DETL_CD
                    ,A.ASSIGN_SCR_LIMIT 
                    ,A.VERY_SUPER_ASSIGN_SCR 
                    ,A.SUPER_ASSIGN_SCR 
                    ,A.NORM_ASSIGN_SCR 
                    ,A.INSUF_ASSIGN_SCR 
                    ,A.VERY_INSUF_ASSIGN_SCR
                    ,'' ESTM_SCR
            FROM TBDN_MOTOR_ASSEM_CD A
			WHERE A.RACER_PERIO_NO 	= ?
			AND A.ESTM_ITEM_CD 		= '201'
			AND A.ESTM_ITEM_DETL_CD NOT IN (
												SELECT ESTM_ITEM_DETL_CD 
												  FROM TBDN_MOTOR_ASSEM_ESTM_DETL 
												 WHERE RACER_PERIO_NO  = ?
												   AND ROUND 		   = ?
												   AND ESTM_ITEM_CD    = '201'
												   AND CAND_NO 		   = ?
												   AND ESTM_ID		   = ?
										    )
			UNION
			SELECT  A.RACER_PERIO_NO
			       ,TO_CHAR(A.ROUND)
			       ,A.CAND_NO
			       ,A.ESTM_ID
			       ,A.ESTM_ITEM_CD
			       ,A.ESTM_ITEM_DETL_CD
    			   ,B.ASSIGN_SCR_LIMIT
    			   ,B.VERY_SUPER_ASSIGN_SCR
    			   ,B.SUPER_ASSIGN_SCR
    			   ,B.NORM_ASSIGN_SCR
    			   ,B.INSUF_ASSIGN_SCR
    			   ,B.VERY_INSUF_ASSIGN_SCR
    			   ,TO_CHAR(A.ESTM_SCR)
			FROM TBDN_MOTOR_ASSEM_ESTM_DETL A,
    			 TBDN_MOTOR_ASSEM_CD B
			WHERE A.RACER_PERIO_NO 	= B.RACER_PERIO_NO
			AND A.ESTM_ITEM_CD 		= B.ESTM_ITEM_CD
			AND A.ESTM_ITEM_DETL_CD = B.ESTM_ITEM_DETL_CD
			AND A.RACER_PERIO_NO 	= ?
			AND A.ROUND 			= ?
			AND A.CAND_NO 			= ?
			AND A.ESTM_ID           = ?
			AND A.ESTM_ITEM_CD 		= '201'
			ORDER BY ESTM_ITEM_DETL_CD
		]]>
    </query>           
    
    <query id="tbdn_motor_assem_estm_fn003" desc="모터분해조립 평가표 조회 개인별 분해조립 시간" fetchSize="10">
        <![CDATA[
        	SELECT 	A.RACER_PERIO_NO
			       	,TO_CHAR(A.ROUND) ROUND
			       	,A.CAND_NO
			       	,A.ESTM_ID
			       	,A.ESTM_ITEM_CD
			       	,A.ESTM_ITEM_DETL_CD
    				,B.ASSIGN_SCR_LIMIT
    				,B.VERY_SUPER_ASSIGN_SCR
    				,B.SUPER_ASSIGN_SCR
    				,B.NORM_ASSIGN_SCR
    				,B.INSUF_ASSIGN_SCR
    				,B.VERY_INSUF_ASSIGN_SCR
    				,TO_CHAR(A.ESTM_SCR) ESTM_SCR
    				,TO_CHAR(A.ESTM_REC) ESTM_REC
			FROM    TBDN_MOTOR_ASSEM_ESTM_DETL A,
    				TBDN_MOTOR_ASSEM_CD B
			WHERE A.RACER_PERIO_NO 	= B.RACER_PERIO_NO
			AND A.ESTM_ITEM_CD 		= B.ESTM_ITEM_CD
			AND A.ESTM_ITEM_DETL_CD = B.ESTM_ITEM_DETL_CD
			AND A.RACER_PERIO_NO	= ?
			AND A.ROUND 			= ?
			AND A.ESTM_ITEM_CD 		= '202'
			AND A.CAND_NO 			= ?
			AND A.ESTM_ID           = ?
			UNION
			SELECT 	 A.RACER_PERIO_NO
			       	,'' ROUND
			       	,'' CAND_NO
			       	,'' ESTM_ID
			       	,A.ESTM_ITEM_CD
			       	,A.ESTM_ITEM_DETL_CD
      				,A.ASSIGN_SCR_LIMIT
      				,A.VERY_SUPER_ASSIGN_SCR
      				,A.SUPER_ASSIGN_SCR
      				,A.NORM_ASSIGN_SCR
      				,A.INSUF_ASSIGN_SCR
      				,A.VERY_INSUF_ASSIGN_SCR
      				,'' ESTM_SCR, '' ESTM_REC
			FROM TBDN_MOTOR_ASSEM_CD A
			WHERE A.RACER_PERIO_NO 		= ?
			AND A.ESTM_ITEM_CD 			= '202'
			AND A.ESTM_ITEM_DETL_CD NOT IN (
											SELECT ESTM_ITEM_DETL_CD 
											FROM TBDN_MOTOR_ASSEM_ESTM_DETL 
											WHERE RACER_PERIO_NO 	= ?
											AND   ROUND 			= ?
											AND   ESTM_ITEM_CD 		= '202'
											AND   CAND_NO 			= ?
											AND   ESTM_ID           = ?
										)
			ORDER BY ESTM_ITEM_DETL_CD
		]]>
    </query>
    
    <query id="tbdn_motor_assem_estm_fn004" desc="모터분해조립 평가표 조회 개인별 -기타" fetchSize="10">
        <![CDATA[
				    SELECT   A.RACER_PERIO_NO
							,TO_CHAR(A.ROUND) ROUND
							,A.CAND_NO
							,A.ESTM_ID
							,A.ESTM_ITEM_CD
							,A.ESTM_ITEM_DETL_CD
							,B.ASSIGN_SCR_LIMIT
							,B.VERY_SUPER_ASSIGN_SCR
							,B.SUPER_ASSIGN_SCR
							,B.NORM_ASSIGN_SCR
							,B.INSUF_ASSIGN_SCR
							,B.VERY_INSUF_ASSIGN_SCR
							,TO_CHAR(A.ESTM_SCR) ESTM_SCR
							,TO_CHAR(A.ESTM_REC) ESTM_REC
					FROM TBDN_MOTOR_ASSEM_ESTM_DETL A,
						 TBDN_MOTOR_ASSEM_CD B
					WHERE A.RACER_PERIO_NO 	= B.RACER_PERIO_NO
					AND A.ESTM_ITEM_CD 		= B.ESTM_ITEM_CD
					AND A.ESTM_ITEM_DETL_CD = B.ESTM_ITEM_DETL_CD
					AND A.RACER_PERIO_NO 	= ?
					AND A.ROUND 			= ?
					AND A.ESTM_ITEM_CD 		= '203'
					AND A.CAND_NO 			= ?
					AND A.ESTM_ID           = ?
					UNION
					SELECT  A.RACER_PERIO_NO
					        ,'' ROUND
					        ,'' CAND_NO
					        ,'' ESTM_ID
					        ,A.ESTM_ITEM_CD
					        ,A.ESTM_ITEM_DETL_CD
						   	,A.ASSIGN_SCR_LIMIT
							,A.VERY_SUPER_ASSIGN_SCR
							,A.SUPER_ASSIGN_SCR
							,A.NORM_ASSIGN_SCR
							,A.INSUF_ASSIGN_SCR
							,A.VERY_INSUF_ASSIGN_SCR
							,'' ESTM_SCR
							,'' ESTM_REC
					FROM TBDN_MOTOR_ASSEM_CD A
					WHERE A.RACER_PERIO_NO 	= ?
					AND A.ESTM_ITEM_CD 		= '203'
        ]]>
    </query>
    
    <query id="tbdn_motor_estm_item_sum_fn001" desc="차수별 평가결과 조회" fetchSize="10">
		<![CDATA[
            
                 SELECT  A.RACER_PERIO_NO  RACER_PERIO_NO 
                        ,A.CAND_NO         CAND_NO
                        ,B.NM_KOR          NM_KOR
                        ,A.ROUND           ROUND
                        ,A.DT              DT
                        ,A.ESTM_ID         ESTM_ID 
                        ,(SELECT USER_NM FROM USRBM.TBRK_USER WHERE USER_ID = A.ESTM_ID) USER_NM 
                        ,NVL(A.ASSIGN_SCR, 0)      ASSIGN_SCR
                        ,NVL((SELECT CD_NM FROM TBDM_SPEC_CD WHERE GRP_CD ='D10006' AND CD = A.DCSN), '불합격') DCSN_NM
                 FROM    TBDN_CAND_IDENT  B, TBDN_MOTOR_ASSEM_ESTM A    
                WHERE   B.RACER_PERIO_NO    = A.RACER_PERIO_NO
                AND     B.CAND_NO           = A.CAND_NO
                AND     NVL(B.DEL_YN,'N')   = 'N'  
                AND     B.RACER_PERIO_NO    = ?
                AND     A.ROUND             = ?
               ORDER BY A.RACER_PERIO_NO,A.CAND_NO,B.NM_KOR,A.ROUND
	    ]]>
    </query>    
    <query id="tbdn_motor_estm_item_sum_fn002" desc="차수별 평가결과 조회(인쇄)" fetchSize="10">
		<![CDATA[
            
    			   SELECT  A.CAND_NO
			   		  ,B.NM_KOR          NM_KOR
			   		  ,MAX(CASE WHEN ESTM_ID = '02005' THEN A.ASSIGN_SCR END) AS A
					  ,MAX(CASE WHEN ESTM_ID = '00127' THEN A.ASSIGN_SCR END) AS B
					  ,MAX(CASE WHEN ESTM_ID = '02085' THEN A.ASSIGN_SCR END) AS C
					  ,SUM(A.ASSIGN_SCR) AS TOT
					  ,ROUND(AVG(A.ASSIGN_SCR),2) AS AVG
					  ,MAX(NVL((SELECT CD_NM FROM TBDM_SPEC_CD WHERE GRP_CD ='D10006' AND CD = A.DCSN), '불합격')) AS DCSN
			   FROM  TBDN_CAND_IDENT  B, TBDN_MOTOR_ASSEM_ESTM A  
			   WHERE   B.RACER_PERIO_NO    = A.RACER_PERIO_NO 
			    AND     B.CAND_NO           = A.CAND_NO
                AND     NVL(B.DEL_YN,'N')   = 'N'  
                AND     B.RACER_PERIO_NO    = ?
				AND     A.ROUND = ?
			   GROUP BY A.CAND_NO,B.NM_KOR
			   ORDER BY	A.CAND_NO	  		 
		    ]]>
    </query>  		   
    <query id="tbdn_motor_assem_estm_un001" desc="모터분해조립 평가표 수정" fetchSize="10">
        <![CDATA[
			UPDATE TBDN_MOTOR_ASSEM_ESTM 
			SET  DT 			= ?
    			,ASSEM_SCR 		= ?
    			,ASSEM_TIME_SCR = ?
    			,ASSIGN_SCR 	= ?
    			,DCSN 			= ?
    			,RMK 			= ?
    			,UPDT_ID 		= ?
    			,UPDT_DTM 		= SYSDATE
			WHERE RACER_PERIO_NO = ?
			AND	ROUND 			 = ?
			AND CAND_NO 		 = ?
			AND ESTM_ID          = ?
		]]>
    </query>
    
    <query id="tbdn_motor_assem_estm_in001" desc="모터분해조립 평가표 입력" fetchSize="10">
        <![CDATA[
			INSERT INTO TBDN_MOTOR_ASSEM_ESTM 
			(
			      RACER_PERIO_NO
			    , ROUND
			    , CAND_NO
			    , ESTM_ID
			    , DT
			    , ASSEM_SCR
			    , ASSEM_TIME_SCR
			    , ASSIGN_SCR
			    , DCSN
			    , RMK
			    , INST_ID
			    , INST_DTM
			) VALUES (
				 ?
				,?
				,?
				,?
				,?
				,?
				,?
				,?
				,?
				,?
				,?
				,SYSDATE
			)
		]]>
    </query>
    
    <query id="tbdn_motor_assem_estm_un002" desc="모터분해조립 평가표 수정-숙련도배점 수정" fetchSize="10">
        <![CDATA[
			UPDATE TBDN_MOTOR_ASSEM_ESTM_DETL 
			SET  ESTM_SCR = ?
    			,UPDT_ID  = ?
    			,UPDT_DTM = SYSDATE
			WHERE RACER_PERIO_NO 	= ?
			AND	  ROUND 			= ?
			AND   CAND_NO 			= ?
			AND   ESTM_ITEM_CD 		= ?
			AND   ESTM_ITEM_DETL_CD = ?
			AND   ESTM_ID           = ?
		]]>
    </query>
    
    <query id="tbdn_motor_assem_estm_in002" desc="모터분해조립 평가-세부 입력" fetchSize="10">
        <![CDATA[
			INSERT INTO TBDN_MOTOR_ASSEM_ESTM_DETL 
			(
			      RACER_PERIO_NO
			    , ROUND
			    , CAND_NO
			    , ESTM_ID
			    , ESTM_ITEM_CD
			    , ESTM_ITEM_DETL_CD
			    , ESTM_SCR
			    , INST_ID
			    , INST_DTM
			) VALUES (
				 ?
				,?
				,?
				,?
				,?
				,?
				,?
				,?
				,SYSDATE
			)
		]]>
    </query>
    
    <query id="tbdn_motor_assem_estm_un003" desc="모터분해조립 평가표 수정-분해조립시간 수정" fetchSize="10">
        <![CDATA[
			UPDATE TBDN_MOTOR_ASSEM_ESTM_DETL 
			SET  ESTM_SCR = ?
    			,ESTM_REC = ? 
    			,UPDT_ID = ?
    			,UPDT_DTM = SYSDATE
			WHERE RACER_PERIO_NO 	= ?
			AND	ROUND 				= ?
			AND CAND_NO 			= ?
			AND ESTM_ITEM_CD 		= ?
			AND ESTM_ITEM_DETL_CD 	= ?
			AND ESTM_ID             = ?
		]]>
    </query>
    
    <query id="tbdn_motor_assem_estm_in003" desc="모터분해조립 평가-분해조립시간 입력" fetchSize="10">
        <![CDATA[
			INSERT INTO TBDN_MOTOR_ASSEM_ESTM_DETL 
			(
			      RACER_PERIO_NO
			    , ROUND
			    , CAND_NO
			    , ESTM_ID 
			    , ESTM_ITEM_CD
			    , ESTM_ITEM_DETL_CD
			    , ESTM_SCR
			    , ESTM_REC
			    , INST_ID
			    , INST_DTM
			) VALUES (
				 ?
				,?
				,?
				,?
				,?
				,?
				,?
				,?
				,?
				,SYSDATE
			)
		]]>
    </query>
       
</queryMap>