<?xml version="1.0" encoding='EUC-KR'?>
<queryMap desc="tbdn_cmpt_edu_outl_mngr(주단위기준등록)">

    <query id="tbdn_cmpt_wk_std_fn001" desc="기수 조회" fetchSize="10">
        <![CDATA[
			
			   SELECT  CD  RACER_PERIO_NO
				 FROM  TBDM_SPEC_CD
				 WHERE GRP_CD  = 'D10000'
				 ORDER BY CD DESC 	
		]]>
    </query>
    
    <query id="tbdn_cmpt_wk_std_fn002" desc="년도 조회" fetchSize="10">
        <![CDATA[
			SELECT DISTINCT(YY) YY       
			FROM   TBDN_WK_ABS
			ORDER BY YY DESC		
        ]]>
    </query>     
        
    <query id="tbdn_cmpt_wk_std_fn003" desc="주단위기준  조회" fetchSize="10">
        <![CDATA[
			SELECT  RACER_PERIO_NO
					,YY
					,MM 
					,WK
					,STR_DT
					,END_DT
					,RMK
					,0 CHK
			FROM   TBDN_WK_ABS		
			WHERE  RACER_PERIO_NO = ?
			AND    YY             = NVL(?, YY)				
			AND    MM             = NVL(?, MM)		 
			ORDER BY STR_DT		          		
        ]]>
    </query>
                 
    <query id="tbdn_cmpt_wk_std_fn004" desc="확정" fetchSize="10">
        <![CDATA[
		    SELECT 	RACER_PERIO_NO
		   			,YY
		    		,MN_ID
		    		,CFM_FG 
		    FROM  TBDN_CFM
			WHERE RACER_PERIO_NO = ?
			--AND YY = ?  
			AND TRIM(MN_ID) = ?
        ]]>
    </query>           

    <query id="tbdn_cmpt_wk_std_in001" desc="주단위기준 입력" fetchSize="10">
        <![CDATA[
			INSERT INTO TBDN_WK_ABS (
			      RACER_PERIO_NO
			    , YY
			    , MM
			    , WK
			    , STR_DT
			    , END_DT
			    , RMK
			    , INST_ID
			    , INST_DTM
			)VALUES (
				 ?
				,?
				,?
				,?
				,?
				,?
				,?
				,?
				,SYSDATE
				
			)    
		]]>
    </query>
    
    <query id="tbdn_cmpt_wk_std_un001" desc="주단위기준 갱신" fetchSize="10">
        <![CDATA[
			UPDATE TBDN_WK_ABS 
			SET   STR_DT         = ?
			     ,END_DT         = ?
			     ,RMK            = ?
			     ,UPDT_ID        = ?
			     ,UPDT_DTM       = SYSDATE
			WHERE RACER_PERIO_NO = ?
			AND   YY             = ?		   
			AND   MM             = ?
			AND   WK             = ?	       
		]]>
    </query>
              
    <query id="tbdn_cmpt_wk_std_dn001" desc="주단위기준 삭제" fetchSize="10">
        <![CDATA[
        
			DELETE 
			FROM  TBDN_WK_ABS
			WHERE RACER_PERIO_NO = ?
			AND   YY             = ?		   
			AND   MM             = ?
			AND   WK             = ?   
		]]>
    </query>     

    <query id="tbdn_cmpt_wk_std_in002" desc="확정 입력" fetchSize="10">
        <![CDATA[
 			MERGE INTO TBDN_CFM TC
 	   				USING   DUAL
					ON (  TC.RACER_PERIO_NO = ?
							  	 AND  TC.MN_ID	  = ?
								 --AND  TC.YY		  = ? 
							   )
			 		WHEN MATCHED THEN
								 UPDATE  SET
								  CFM_FG 	= ?
								 ,UPDT_ID   = ?
								 ,UPDT_DTM  = SYSDATE
					WHEN NOT MATCHED THEN			 
								 INSERT (	
									 RACER_PERIO_NO
									,MN_ID
									,CFM_FG
									,INST_ID
									,INST_DTM	
								 )VALUES(
								 ?,?,?,?,SYSDATE
								 )
		]]>
    </query>
    
</queryMap>