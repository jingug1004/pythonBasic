<?xml version="1.0" encoding='EUC-KR'?>
<queryMap desc="출주표 위반행위"> 
    <query id="tbdn_cand_race_viol_fn001" desc="출주 위반행위조회" fetchSize="10">
		<![CDATA[
			SELECT
			  RACER_PERIO_NO
			, DAY_NO
			, ROUND
			, TEAM_NO
			, RACE_REG_NO
			, CAND_NO
			, VIOL_SEQ
			, VIOL_CD
			, VIOL_SCR
			, VIOL_CNTNT
			,(
				SELECT
					RTRIM(XMLAGG(XMLELEMENT("VIOL_NM", VIOL_NM, ',') ORDER BY ROWNUM).EXTRACT('//text()').GETSTRINGVAL(),',') VIOL_CNTNT
				FROM
				(
					SELECT
						RACE_REG_NO,
						FC_CODE_NM_003('D10075', VIOL_CD) VIOL_NM
					FROM TBDN_CAND_RACE_VIOL
					WHERE  1=1
					AND RACER_PERIO_NO = ?	-- 기수
					AND DAY_NO         = ?  -- 출주번호
					AND ROUND          = ?  -- 라운드
					AND TEAM_NO        = ?  -- 조번호
					AND RACE_REG_NO    = ?  -- 정번
				)
				GROUP BY RACE_REG_NO
			) VIOL_DETL
			FROM  TBDN_CAND_RACE_VIOL A
			WHERE 1=1
			AND RACER_PERIO_NO = ?
			AND DAY_NO         = ?
			AND ROUND          = ?
			AND TEAM_NO        = ?
			AND RACE_REG_NO    = ?

	    ]]>
    </query>
   
    <query id="tbdn_cand_race_viol_ins001" desc="출주 위반행위 입력" fetchSize="10">
		<![CDATA[
			INSERT INTO TBDN_CAND_RACE_VIOL
			(
			        RACER_PERIO_NO --기수
			      , DAY_NO         --출주번호
			      , ROUND 		   --라운드
			      , TEAM_NO        --조번호
			      , RACE_REG_NO    --정번
			      , CAND_NO        --후보생번호
			      , VIOL_SEQ       --일련번호
			      , VIOL_CD        --위반코드
			      , VIOL_SCR       --위반점
			      , VIOL_CNTNT     --위반내용 
			      , INST_ID        -- 작성자ID  
			      , INST_DTM       -- 작성일자  
			      , UPDT_ID        -- 수정자ID  
			      , UPDT_DTM       -- 수정일자  
			) VALUES (
			         ?               
			       , ?               
			       , ?               
			       , ?               
			       , ?
			       , ?               
			       , ?               
			       , ?               
			       , ?
			       , ?
			       , ?               -- 작성자ID  
			       , SYSDATE         -- 작성일자  
			       , ?               -- 수정자ID  
			       , SYSDATE         -- 수정일자  
			)
	    ]]>
    </query>

    <query id="tbdn_cand_race_viol_ups001" desc="출주 위반행위수정" fetchSize="10">
		<![CDATA[
			UPDATE TBDN_CAND_RACE_VIOL SET
			         VIOL_CD       = ?        -- 위반코드
			       , VIOL_SCR        = ?      -- 위반점
			       , VIOL_CNTNT     = ?       -- 위반내용
			       , UPDT_ID        = ?       -- 수정자ID  
			       , UPDT_DTM       = SYSDATE -- 수정일자  
			WHERE  1=1
			AND RACER_PERIO_NO  = ?
			AND DAY_NO = ?
			AND ROUND = ?
			AND TEAM_NO = ?
			AND RACE_REG_NO = ?
			AND CAND_NO = ?
			AND VIOL_SEQ = ?
	    ]]>
    </query>
    
     <query id="tbdn_cand_race_viol_del001" desc="출주 위반행위삭제" fetchSize="10">
		<![CDATA[
			DELETE FROM TBDN_CAND_RACE_VIOL
			WHERE  1=1
			AND RACER_PERIO_NO = NVL(?,RACER_PERIO_NO)
			AND DAY_NO         = NVL(?,DAY_NO        )
			AND ROUND          = NVL(?,ROUND         )
			AND TEAM_NO        = NVL(?,TEAM_NO       )
			AND RACE_REG_NO    = NVL(?,RACE_REG_NO   )
			AND CAND_NO        = NVL(?,CAND_NO       )
			AND VIOL_SEQ       = NVL(?,VIOL_SEQ      )
	    ]]>
    </query>
  </queryMap>