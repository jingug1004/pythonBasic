<?xml version="1.0" encoding='EUC-KR'?>
<queryMap desc="COMMON RACE">
    <query id="common_tbeb_race_tms_fb001" desc="조회" fetchSize="10">
        <![CDATA[
			SELECT  /* common_tbeb_race_tms_fb001 */
			         TRT.STND_YEAR
			       , TRT.MBR_CD
			       , TRT.TMS
			       , TRT.QURT_CD
                   , TRST.QURT_CD AS QURT_CD_2
			       , TRT.MONTH
			       , TRT.STR_DT
			       , TRT.END_DT
			       , TRT.CFRNT_CD
			       , TRT.RMK
			       , TRT.RACE_TMS_STAT_CD
				   , TRT.ARRANGE_CMPL_YN
				   , TRT.EQUIP_DRWLT_CMPL_YN
			       , TCM.RACE_KINDS_CD
			       , (  
			            SELECT COUNT(*)
			            FROM   TBEB_RACE_DAY_ORD TRDO
				        WHERE  TRDO.STND_YEAR = TRT.STND_YEAR
			            AND    TRDO.MBR_CD    = TRT.MBR_CD
			            AND    TRDO.TMS       = TRT.TMS
			          ) DAY_ORD
			FROM     TBEB_RACE_TMS   TRT
			       , TBEB_CFRNT_METH TCM
                   , TBEB_RECD_STND_TERM TRST
			WHERE  TRT.CFRNT_CD  = TCM.CFRNT_CD
	        AND    TRT.STND_YEAR = ?
            AND    TRT.MBR_CD    = ?
			AND    TRT.QURT_CD   = NVL(?, TRT.QURT_CD)
            AND    TRT.STR_DT >= TRST.STR_DT
            AND    TRT.END_DT <= TRST.END_DT
			ORDER BY TRT.TMS DESC
        ]]>
    </query> 
    <query id="common_tbeb_race_day_ord_fb001" desc="조회" fetchSize="10">
        <![CDATA[
			SELECT  /* common_tbeb_race_day_ord_fb001 */
                     STND_YEAR      -- 기준년도
                   , MBR_CD         -- 경정장코드
                   , TMS            -- 회차
                   , DAY_ORD        -- 일차
                   , RACE_DAY       -- 경주일자
                   , RACE_CNT       -- 경주수
                   , ORGAN_STAT_CD  -- 편성상태
                   , TO_CHAR(TO_DATE(RACE_DAY, 'YYYYMMDD'), 'DAY') DAY -- 요일
			FROM   TBEB_RACE_DAY_ORD
			WHERE  STND_YEAR = ?
            AND    MBR_CD    = ?
			AND    TMS       = ?
			AND    DAY_ORD   = NVL(?, DAY_ORD)
			ORDER BY STND_YEAR
			       , MBR_CD
			       , TMS
			       , DAY_ORD
        ]]>
    </query> 
    <query id="common_tbeb_race_fb001" desc="조회" fetchSize="10">
        <![CDATA[
			SELECT   /* common_tbeb_race_fb001 */
			         TR.STND_YEAR         -- 기준년도    
			       , TR.MBR_CD            -- 경정장코드  
			       , TR.TMS               -- 회차        
			       , TR.DAY_ORD           -- 일차        
			       , TR.RACE_NO           -- 경주번호    
			       , TR.RACE_DGRE_CD      -- 경주등급코드
			       , ( SELECT CD_NM FROM TBEA_SPEC_CD WHERE GRP_CD = 'E00005' AND CD = TR.RACE_DGRE_CD ) RACE_DGRE_NM
			       , TR.ST_MTHD_CD        -- ST방법코드
			       , ( SELECT CD_NM FROM TBEA_SPEC_CD WHERE GRP_CD = 'E00002' AND CD = TR.ST_MTHD_CD   ) ST_MTHD_NM
			       , TR.STRT_TIME         -- 출발시간    
			       , TR.RACE_REG_NO_CNT   -- 정번수      
			       , TR.RACE_DIST         -- 경주거리    
			       , TR.TURN_CNT          -- 주회수      
			       , TR.RACE_END_YN       -- 경주마감여부
			       , TR.RACE_STTS_CD      -- 경주상황코드
			FROM   MRASYS.TBEB_RACE  TR
			WHERE  TR.STND_YEAR = ?
			AND    TR.MBR_CD    = ?
			AND    TR.TMS       = ?
			AND    TR.DAY_ORD   = ?
			ORDER BY TR.STND_YEAR
			       , TR.TMS
			       , TR.DAY_ORD
			       , TR.RACE_NO
        ]]>
    </query> 

    <query id="common_cur_race_fb001" desc="조회" fetchSize="10">
        <![CDATA[
			SELECT /* common_cur_race_fb001 */
			      TRT .STND_YEAR
			    , TRT .MBR_CD
			    , TRT .TMS
			    , TRT .QURT_CD
			    , TRT .MONTH
			    , TRT .STR_DT
			    , TRT .END_DT
			    , TRT .CFRNT_CD
			    , TRT .RMK
			    , TRT .RACE_TMS_STAT_CD
			    , TRDO.DAY_ORD
			    , TRDO.RACE_DAY
			    , DECODE(RACE_DAY, TO_CHAR(SYSDATE, 'YYYYMMDD'), 'TRUE', 'FALSE') CURDATE
			  FROM     MRASYS.TBEB_RACE_TMS     TRT
			         , MRASYS.TBEB_RACE_DAY_ORD TRDO
			  WHERE  TRT .STND_YEAR = TRDO.STND_YEAR
			  AND    TRT .MBR_CD    = TRDO.MBR_CD
			  AND    TRT .TMS       = TRDO.TMS
			  AND    TRT .MBR_CD    = ?
			  AND    TRT .STND_YEAR||LPAD(TRT .TMS,3, '0')  = NVL((
			                              SELECT STND_YEAR||LPAD(TMS,3,'0') 
			                              FROM   MRASYS.TBEB_RACE_TMS
			                              WHERE  TO_CHAR(SYSDATE, 'YYYYMMDD') BETWEEN STR_DT
			                                                                      AND END_DT
			                              AND    ROWNUM = 1
			                          ), (
			                              SELECT MAX(STND_YEAR||LPAD(TMS,3,'0'))  
			                              FROM   MRASYS.TBEB_RACE_TMS
			                          ))
			  ORDER BY TRT .STND_YEAR
			         , TRT .TMS
			         , TRDO.DAY_ORD
        ]]>
    </query>
</queryMap>
