<?xml version="1.0" encoding="euc-kr"?>
<Window>
	<Form Height="464" Id="comCodeNm" Left="8" OnKeyDown="comcodenm_OnKeyDown" OnLoadCompleted="fcFormLoadSetting" PidAttrib="7" Title="코드조회&#32;공통화면" Top="8" Ver="1.0" Width="500" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="dsCombo">
				<Contents></Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="dsTM_COMMHP">
				<Contents>
					<colinfo id="POPP_CODE" size="256" type="STRING"/>
					<colinfo id="XMLS_STRT" size="256" type="STRING"/>
					<colinfo id="SELT_SYNT" size="256" type="STRING"/>
					<colinfo id="FROM_SYNT" size="256" type="STRING"/>
					<colinfo id="WHRE_SYN0" size="256" type="STRING"/>
					<colinfo id="WHRE_SYN1" size="256" type="STRING"/>
					<colinfo id="WHRE_SYN2" size="256" type="STRING"/>
					<colinfo id="WHRE_SYN3" size="256" type="STRING"/>
					<colinfo id="ORDR_SYNT" size="256" type="STRING"/>
					<colinfo id="FORM_CAPT" size="256" type="STRING"/>
					<colinfo id="FORM_INFO" size="256" type="STRING"/>
					<colinfo id="COLM_CONT" size="256" type="STRING"/>
					<colinfo id="GRID_TITL" size="256" type="STRING"/>
					<colinfo id="BE_SURE" size="1" type="STRING"/>
					<colinfo id="BE_SHAR" size="1" type="STRING"/>
					<record>
						<BE_SHAR>Y</BE_SHAR>
						<BE_SURE></BE_SURE>
						<COLM_CONT></COLM_CONT>
						<FORM_CAPT>화면&#32;Caption</FORM_CAPT>
						<FORM_INFO>부서정보</FORM_INFO>
						<FROM_SYNT>TBZA_SAMCODE01</FROM_SYNT>
						<GRID_TITL></GRID_TITL>
						<ORDR_SYNT></ORDR_SYNT>
						<POPP_CODE>DEPT</POPP_CODE>
						<SELT_SYNT>DEPT_CD,&#32;DEPT_NM</SELT_SYNT>
						<WHRE_SYN0></WHRE_SYN0>
						<WHRE_SYN1></WHRE_SYN1>
						<WHRE_SYN2></WHRE_SYN2>
						<WHRE_SYN3></WHRE_SYN3>
						<XMLS_STRT>&lt;contents&gt;&lt;format&#32;id=&quot;Default&quot;&gt;&lt;columns&gt;&lt;col&#32;width=&quot;76&quot;/&gt;&lt;col&#32;width=&quot;210&quot;/&gt;&lt;/columns&gt;&lt;head&gt;&lt;cell&#32;col=&quot;0&quot;&#32;display=&quot;text&quot;&#32;text=&quot;부서코드&quot;/&gt;&lt;cell&#32;col=&quot;1&quot;&#32;display=&quot;text&quot;&#32;text=&quot;부서명&quot;/&gt;&lt;/head&gt;&lt;body&gt;&lt;cell&#32;col=&quot;0&quot;&#32;colid=&quot;COL_TMP0&quot;&#32;display=&quot;text&quot;/&gt;&lt;cell&#32;col=&quot;1&quot;&#32;colid=&quot;COL_TMP1&quot;&#32;display=&quot;text&quot;/&gt;&lt;/body&gt;&lt;/format&gt;&lt;/contents&gt;</XMLS_STRT>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="dsOutCode"></Dataset>
			<Dataset DataSetType="Dataset" Id="dsInCode" ServiceDSetID="dsInCode">
				<Contents>
					<colinfo id="INCOND" size="6" type="STRING"/>
					<record>
						<INCOND></INCOND>
					</record>
				</Contents>
			</Dataset>
		</Datasets>
		<Image Height="32" Id="Image0" ImageID="pop_bg" LeftMargin="25" TabOrder="9" Width="500"></Image>
		<Shape BKColor="user0" Bottom="89" Height="30" Id="Shape1" Left="6" LineColor="user1" LineKind="Vertical" Right="494" RoundHeight="8" RoundUnit="Pixel" RoundWidth="8" TabOrder="5" Top="59" Type="RoundRect" Width="488"></Shape>
		<Combo Border="Flat" CodeColumn="No" DataColumn="codeName" Height="22" Id="cmbSearch" InnerDataset="dsCombo" Left="10" OnChanged="cmbSearch_OnChanged" ResetIndex="FIRST" Style="snis_if_input01" TabOrder="2" Top="62" Width="167"></Combo>
		<Edit AutoSelect="TRUE" Border="Flat" Height="22" Id="edSearch" ImeMode="native" Left="176" LeftMargin="5" OnKeyDown="edsearch_OnKeyDown" Style="snis_if_input01" TabOrder="0" Top="63" Width="313"></Edit>
		<Grid AreaSelect="true" BindDataset="dsOutCode" BKColor="user15" BkColor2="user16" BkSelColor="user17" BoldHead="true" Border="Flat" BorderColor="user22" Bottom="437" ColSizing="TRUE" Enable="true" EndLineColor="default" HeadHeight="20" Height="325" Id="grdTM_COMMHP" InputPanel="FALSE" Left="6" LineColor="default" MultiSelect="TRUE" OnCellDBLClick="grdTM_COMMHP_OnCellDblClick" OnHeadClick="fcGridSort" OnKeyDown="grdTM_COMMHP_OnKeyDown" Right="494" Style="snis_grid" TabOrder="1" TabStop="true" Top="112" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="488"></Grid>
		<Static Height="20" Id="st_FormTitle" Left="28" Style="snis_pop_title" TabOrder="4" Top="8" VAlign="Middle" Width="455"></Static>
		<Static Height="20" Id="stInformation" Left="6" Style="styFormSearchInfo" TabOrder="6" Top="93" VAlign="Middle" Width="488"></Static>
		<Static Font="굴림,9,Bold" Height="16" Id="Static0" Left="6" Style="snis_txt" TabOrder="7" Text="*&#32;해당&#32;항목에서&#32;더블클릭&#32;또는&#32;Enter&#32;Key를&#32;누르시면&#32;선택&#32;됩니다!&#32;*" Top="441" VAlign="Middle" Width="480"></Static>
		<Div Height="22" Id="divBtnCode" Left="276" TabOrder="8" Text="Div0" Top="35" Url="common::comButtonCode.xml" Width="216">
			<Contents></Contents>
		</Div>
	</Form>
	<Script><![CDATA[/***************************************************************************************************
*   Form Common Script                                                                             *
*     현재 총 100 컬럼임 되도록 100 컬럼 안으로 코딩을 하세요                                      *
123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 1234567890
***************************************************************************************************/
/***************************************************************************************************
*                                         공통 Script Include                                      *
***************************************************************************************************/
#include "lib::can_common_script.js";
#include "lib::can_app_script.js";

/***************************************************************************************************
*                                          화면 변수 선언부                                        *
***************************************************************************************************/
var sSEARCHKIND = "";                              //Open 할 Popup ID
var sINPUTVALUE = "";                              //Default로 조회 할 내용
var sCOMMONGUBN = "";                              //공통코드 조회 시 Head 코드 값

/***************************************************************************************************
*                                         공통 Event 처리 부분                                     *
***************************************************************************************************/
/*-------------------------------------------------------------------------------------------------+
>>  01. 최초 화면 Load時 처리 할 사항
+-------------------------------------------------------------------------------------------------*/
function fcFormLoadSetting(obj){
	//화면 제목 설정
	stFormTitle.Text = obj.Title;

	sSEARCHKIND    = sSearchKind;       //Open 할  Popup ID
	sINPUTVALUE    = sInputValue;       //검색 조건 Text
	sCOMMONGUBN    = sCommonGubn;       //공통 구분 코드
	edSearch.Text  = sINPUTVALUE;       //Text Box Display
	fcFormDesignQuery(sSEARCHKIND);    //화면 디자인을 위한 정보 조회
}

/*-----------------------------------+
|  화면 ID에 다른 Form Setting       |
+------------------------------------*/
function fcFormDesignQuery(sSEARCHKIND){

	var sMethodName = "SEARCH00";                             //서버에서 호출 될 Method 명
	var sInDataSet  = "";                                     //자료 저장 시 보낼 DataSet 명칭
	var sOutDataSet = "dsTM_COMMHP=dsTM_COMMHP";              //조회 후 돌려 받을 DataSet 명칭
	//var sArgument   = fn_CreateArgument(sMethodName);         //조회 시 넘길 Argument 생성
	
	//fnc_TransactionCall(this, sMethodName, sInDataSet, sOutDataSet, sArgument, "fn_CallBack");	
	fcPostProcess(sMethodName);         //삭제할 것 
}

/*------------------------------------+
|  Transaction 후 Post Process!       |
+-------------------------------------*/
function fcPostProcess(sMethodName) {

	if (sMethodName=='SEARCH00') {

		fn_ComboGridSetting();                                      //Combo 및 Grid Setting
		
		if (dsTM_COMMHP.GetColumn(dsTM_COMMHP.currow, 'BE_SHAR')=='Y') { 
			fn_SearchComCodeList();   //검색 조건이 있으면 Default 조회
		} else { 
			if (length(trim(edSearch.Text)) > 0) fn_SearchComCodeList();   //검색 조건이 있으면 Default 조회
		}
		
	} else if (sMethodName=='SEARCH01') {
	
		//조회 결과 Display
		fnc_Information(stInformation, dsOutCode.CaseCount("RowLevel==0"), "SHR"); 
		grdTM_COMMHP.SetFocus();
	} 
}

/*---------------------------------------------------+
|  조회 된 내용으로 Grid 및 화면 Display(Setting) !  |
+----------------------------------------------------*/
function fn_ComboGridSetting(){

	this.Title            = dsTM_COMMHP.GetColumn(0, "FORM_CAPT");   //화면 Caption
	st_FormTitle.Text     = dsTM_COMMHP.GetColumn(0, "FORM_INFO");   //Form Title
	dsCombo.Contents      = dsTM_COMMHP.GetColumn(0, "GRID_TITL");   //검색 조건 Combo Setting
	grdTM_COMMHP.Contents = dsTM_COMMHP.GetColumn(0, "XMLS_STRT");   //Grid Setting
}
/***************************************************************************************************
*                                      공통 버튼 Event 처리 부분                                   *
***************************************************************************************************/
/*-------------------------------------------------------------------------------------------------+
>>  01. 취소 버튼 클릭 時 처리
+-------------------------------------------------------------------------------------------------*/
function btnSearch_OnClick(obj){
	//Query String 만든 후 조회 실행
	fn_SearchComCodeList();
}
/*-------------------------------------------------------------------------------------------------+
>>  공통 조회 실행 !
+-------------------------------------------------------------------------------------------------*/
function fn_SearchComCodeList() {
	var sServiceName = "commonAction";                    //서버에 요청할 Sevice 명
	var sInDataSet   = "dsInCode=dsInCode";               //자료 저장 시 보낼 DataSet 명칭
	var sOutDataSet  = "dsOutCode=dsOutCode";             //조회 후 돌려 받을 DataSet 명칭
	var sMethodName  = "cmd=searchDept";                  //서버에서 호출 될 Method 명
	
	fn_CopyCondition();		
	gfn_callService(this, sServiceName, sInDataSet, sOutDataSet, sMethodName, "fn_CallBack");
	grdTM_COMMHP.SetFocus();
}

function fn_CopyCondition() {
	dsInCode.clearData();
	dsInCode.AddRow();
	dsInCode.SetColumn(0, "INCOND", edSearch.Text);
}
/*-------------------------------------------------------------------------------------------------+
>>  02. 선택 버튼 클릭 시 처리 !
+-------------------------------------------------------------------------------------------------*/
function fcChoice(obj){
	// 배열에 해당 값을 반환 하고 종료
	fcConfirm();
}
/*-------------------------------------------------------------------------------------------------+
>>  03. 닫기 버튼 클릭 시 처리 !
+-------------------------------------------------------------------------------------------------*/
function fcClose(obj){
	Close(false);
}

/***************************************************************************************************
*                                      사용자 정의  처리 부분                                      *
***************************************************************************************************/
/*-------------------------------------------------------------------------------------------------+
>>  01. Transaction 후 처리 해야 할 내용!
+-------------------------------------------------------------------------------------------------*/
function fn_CallBack(sMethodName, ErrorCode, ErrorMSG) {
	//Service에서 오류 발생 시 처리 
	if (ErrorCode < 0) {
		fnc_Message("SERVERMSG", "N", ErrorMSG); 
	} else {
		//오류가 없이 정상 처리되었다면...
		fcPostProcess(sMethodName);
	}
}
/*-------------------------------------------------------------------------------------------------+
>>  02. Transaction 후 Post Process!
+-------------------------------------------------------------------------------------------------*/
function fcPostProcess(sMethodName) {
}

/*-------------------------------------------------------------------------------------------------+
>>  03. Enter Key Press 시 조회 실행 !
+-------------------------------------------------------------------------------------------------*/
function edSearch_OnKeyDown(obj,nChar,bShift,bCtrl, bAlt,LLParam,HLParam){
	if (nChar==13) btnSearch.Click();
}
/*-------------------------------------------------------------------------------------------------+
>>  04. 검색 조건 Combo가 바뀔 때 검색 조건 Text로 Focus!
+-------------------------------------------------------------------------------------------------*/
function cmbSearch_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex) {
	edSearch.SetFocus();
}

/*-----------------------------------------------+
|  그리드에서 더블 클릭 시 선택과 동일한 작업 !  |
+------------------------------------------------*/
function grdTM_COMMHP_OnCellDblClick(obj,nRow,nCell,nX,nY) {
	// 배열에 해당 값을 반환 하고 종료
	fcConfirm();

}

/*-----------------------------------------------+
|  그리드에서 Enter Key 시 선택과 동일한 작업 !  |
+------------------------------------------------*/
function grdTM_COMMHP_OnKeyDown(obj,nChar,bShift,bCtrl,bAlt,nLLParam,nHLParam) {
	
	// 엔터키 입력 시 배열에 해당 값을 반환 하고 종료
	if (nChar==13) fcConfirm();
}

/*--------------+
|  확인 처리 !  |
+---------------*/
function fcConfirm(){

	var iColumnCount = dsOutCode.GetColCount();        //결과 값을 반환 할 Count
	var arrReturn    = array(iColumnCount);               //결과 반환 할 Array
	
	for (var i=0; i < iColumnCount; i++) {
	
		//반환 할 자료(Array) 만들기
		arrReturn[i] = dsOutCode.GetColumn(dsOutCode.Row, "COL_TMP" + i);
	}
	Close(arrReturn);
}

/*-----------------------+
|  그리드 클릭 시 Sort!  |
+------------------------*/
function fcGridSort(obj,nCell,nX,nY) {
	
	//특정 Head 클릭 시 해당 항목으로 Sort(만약 특정 컬럼을 누를때만 소트하고자 한다면 nCell로 조건)
	fnc_GridSort(obj, object(obj.BindDataset), nCell);
	
}

/*--------------+
|  취소 처리 !  |
+---------------*/
function fcClose(){

	//Null 반환 후 종료
	Close("");
}

/*--------------------------------------+
|  Form에서 ESC Key 누르면 화면 종료 !  |
+---------------------------------------*/
function comcodenm_OnKeyDown(obj,objSenderObj,nChar,bShift,bControl,bAlt,nLLParam,nHLParam) {
	
	if (nChar==27) fcClose();
}]]></Script>
</Window>