<?xml version="1.0" encoding='EUC-KR'?>
<queryMap desc="tbef_order 주문서등록 ">
    <query id="e06050030_s01" desc="공급처 리스트 조회" fetchSize="10">
        <![CDATA[
		            select
            			jumun_no
            			,vendr_nm
            from
            			tbef_supp_io
            			,tbef_supp_vendr
            where jumun_no is not null
            order by jumun_no desc
        ]]>
    </query>
    

	<query id="e06050030_s02" desc="주문서 조회 " fetchSize="50">
        <![CDATA[
            -- 주문서 조회
			SELECT  /* e06050030_s02 */
			        JUMUN_NO                  --주문번호
			       ,GET_SUPP_NM(MIN(A.SUPP_CD))||DECODE(COUNT(*), 1, '', ' 외 '||TO_CHAR(COUNT(*) -1,'999')||'종') AS ORDER_CON
			 FROM  TBEF_SUPP_IO A, TBEF_SUPP_CD B 
			 WHERE IO_TYPE = '2'
			 AND   A.SUPP_CD = B.SUPP_CD
			 AND   A.JUMUN_NO BETWEEN ? AND ?
			 GROUP BY JUMUN_NO 
			 ORDER BY JUMUN_NO DESC
        ]]>
    </query>
    <query id="e06050030_s03" desc="주문 상세 내역 조회 " fetchSize="50">
        <![CDATA[
            -- 주문 상세 내역 조회  
	         SELECT /* e06050030_s03 */  
 			        IO_DT                     --출납 일자
			       ,IO_TYPE                   --입출 구분(1:이월,2:주문서,3:입고,4:출고)
			       ,A.SUPP_CD                   --소모품 코드
			       ,B.SUPP_NM
			       ,B.SPEC
			       ,B.DANGA
			       ,SEQ                       --연번
			       ,JUMUN_NO                  --주문번호
			       ,QTY  AS ORDER_CNT                     --수량
			       ,AMOUNT                    --금액
			       ,OUT_ID                    --출고자
			       ,ACCEPT_ID                 --수령자
			       ,RMK                       --비고
			       ,IFIS_FLAG                 --통합재무 처리여부       
			 FROM TBEF_SUPP_IO A, TBEF_SUPP_CD B 
			 WHERE IO_TYPE = '2'
			 AND   A.SUPP_CD = B.SUPP_CD
			 AND JUMUN_NO  = ?
        ]]>
    </query>   
        <query id="e06050030_m01" desc="주문서 등록/수정  " fetchSize="10">        <![CDATA[        	/* 주문내역 등록 및 수정  */            MERGE /* e06050030_m01 */
                  INTO TBEF_SUPP_IO DST            USING (
            	SELECT 				   ?   AS IO_DT,       	-- 주문일자
	               ?   AS IO_TYPE,		-- 입출구분 				   ?   AS SUPP_CD, 		-- 소모품코드
				   ?   AS SEQ,			-- 연번
				   ?   AS JUMUN_NO,		-- 주문번호(주문일자)
				   ?   AS QTY,			-- 주문수량
			       ?   AS AMOUNT,			-- 금액
				   ?   AS USER_ID 		-- 작성자 아이디 				FROM DUAL
			) SRC
            ON (    DST.IO_DT   = SRC.IO_DT		-- 주문일자
            	AND DST.IO_TYPE = SRC.IO_TYPE	-- 입출구분
				AND DST.SUPP_CD = SRC.SUPP_CD	-- 소모품코드
			    )
			WHEN MATCHED THEN				UPDATE							 	SET	DST.JUMUN_NO = SRC.JUMUN_NO,	-- 주문번호				    DST.QTY      = SRC.QTY,			-- 주문수량				    DST.AMOUNT   = SRC.AMOUNT,		-- 주문금액				    DST.UPDT_ID  = SRC.USER_ID,		-- 수정자 ID				    DST.UPDT_DT  = SYSDATE   			WHEN NOT MATCHED THEN				INSERT (				    IO_DT		               ,IO_TYPE 				   ,SUPP_CD 				   ,SEQ					   ,JUMUN_NO				   ,QTY	
			       ,AMOUNT	
			       ,INST_ID 				   ,INST_DT  				   ) 				VALUES ( 
				    SRC.IO_DT
				   ,SRC.IO_TYPE
				   ,SRC.SUPP_CD
				   ,(SELECT NVL(MAX(SEQ)+1,0)
				     FROM   TBEF_SUPP_IO
				     WHERE  IO_DT   = ?
				     AND    IO_TYPE = ?
				     AND    SUPP_CD = ?)
				   ,SRC.JUMUN_NO
				   ,SRC.QTY
				   ,SRC.AMOUNT				   ,SRC.USER_ID  				   ,SYSDATE)
        ]]>
    </query> 
    <query id="e06050030_d01" desc="주문서 상세 내역 삭제(마스터 삭제시) " fetchSize="10">
        <![CDATA[
           	DELETE /* e06050030_d01 */			FROM   TBEF_SUPP_IO			WHERE  IO_DT    = ?			AND    IO_TYPE  = ? 		    AND    SUPP_CD  = ?
		    AND    SEQ      = ?
        ]]>
    </query> 
</queryMap>