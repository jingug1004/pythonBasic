<?xml version="1.0" encoding='EUC-KR'?>
<queryMap desc="tbee_brch_rtrn(지점고액환급정보)">
    <query id="tbee_brch_rtrn_fe001" desc="지점고액환급정보조회" fetchSize="10">
        <![CDATA[
--사용안함(자바코드에 삽입)       
			SELECT   SR_NO
				   , STND_YEAR
				   , MBR_CD
				   , TMS
				   , DAY_ORD
				   , RACE_NO
				   , OTB_NM
				   , CUST_NM
				   , BUY_PLC
				   , RETURN_PLC 
				   , WINNER
				   , NVL(EXA_RATE,0) AS EXA_RATE
				   , NVL(EXA_WON1,0) AS EXA_WON1
				   , NVL(EXA_WON2,0) AS EXA_WON2
				   , NVL(EXA_WON3,0) AS EXA_WON3
				   , NVL(EXA_WON4,0) AS EXA_WON4
				   , NVL(EXA_WON5,0) AS EXA_WON5
				   , NVL(EXA_NO1,0) AS EXA_NO1
				   , NVL(EXA_NO2,0) AS EXA_NO2
				   , NVL(EXA_NO3,0) AS EXA_NO3
				   , NVL(EXA_NO4,0) AS EXA_NO4
				   , NVL(EXA_NO5,0) AS EXA_NO5
				   , NVL(QUI_RATE,0) AS QUI_RATE
				   , NVL(QUI_WON1,0) AS QUI_WON1
				   , NVL(QUI_WON2,0) AS QUI_WON2
				   , NVL(QUI_WON3,0) AS QUI_WON3
				   , NVL(QUI_WON4,0) AS QUI_WON4
				   , NVL(QUI_WON5,0) AS QUI_WON5
				   , NVL(QUI_NO1,0) AS QUI_NO1
				   , NVL(QUI_NO2,0) AS QUI_NO2
				   , NVL(QUI_NO3,0) AS QUI_NO3
				   , NVL(QUI_NO4,0) AS QUI_NO4
				   , NVL(QUI_NO5,0) AS QUI_NO5
				   , NVL(TRI_RATE,0) AS TRI_RATE
				   , NVL(TRI_WON1,0) AS TRI_WON1
				   , NVL(TRI_WON2,0) AS TRI_WON2
				   , NVL(TRI_WON3,0) AS TRI_WON3
				   , NVL(TRI_WON4,0) AS TRI_WON4
				   , NVL(TRI_WON5,0) AS TRI_WON5
				   , NVL(TRI_NO1,0) AS TRI_NO1
				   , NVL(TRI_NO2,0) AS TRI_NO2
				   , NVL(TRI_NO3,0) AS TRI_NO3 
				   , NVL(TRI_NO4,0) AS TRI_NO4
				   , NVL(TRI_NO5,0) AS TRI_NO5
				   , NVL(TOTAL_RETURN,0) AS TOTAL_RETURN
				   , VEH_NO
				   , VEH_COLOR
				   , CUST_TEL
				   , CUST_ADDR
				   , RMK
				   , INST_NM
				   , REG_IP
				   , PHOTO_NM
				   , PHOTO_PATH
				   , PHOTO_TYPE
				   , FILE_NM
				   , FILE_PATH
				   , FILE_TYPE
				   , FILE_SIZE
				   , TO_CHAR(INST_DTM,'YYYYMMDD') AS INST_DTM
			FROM   TBEE_BRCH_RTRN 
            WHERE  (STND_YEAR, MBR_CD, TMS, DAY_ORD, RACE_NO) IN (SELECT STND_YEAR, MBR_CD, TMS, DAY_ORD, RACE_NO
																	FROM TBEB_ORGAN 
																   WHERE RACE_DAY BETWEEN ? AND ?
																	 AND MBR_CD = '001') 
        ]]>
    </query>
    <query id="tbee_brch_rtrn_fe002" desc="해당경주 순위선수조회" fetchSize="10">
        <![CDATA[
			SELECT   A.RACER_NO
				   , B.NM_KOR RACER_NM
				   , A.RACE_REG_NO
				   , A.RANK
				   , A.RANK||'위 '||A.RACE_REG_NO||'번 '||B.NM_KOR AS TMP
			FROM     TBEB_ORGAN A
				   , TBEC_RACER_MASTER B
			WHERE  A.STND_YEAR = ?
			  AND  A.MBR_CD = '001' 
			  AND  A.TMS = ? 
			  AND  A.DAY_ORD = ?
			  AND  A.RACE_NO = ?
			  AND  A.RANK BETWEEN 1 AND 3 
			  AND  B.RACER_NO = A.RACER_NO
			ORDER BY A.RANK 
        ]]>
    </query>
    <query id="tbee_brch_rtrn_fe003" desc="조회" fetchSize="10">
        <![CDATA[
			SELECT *
			  FROM TBEE_BRCH_RTRN 
			 WHERE SR_NO = ?

        ]]>
    </query>
    <query id="tbee_brch_rtrn_fe004" desc="조회" fetchSize="10">
        <![CDATA[
			SELECT   POOL_CD
			       , PAYOFF
			  FROM USRBM.TBES_SDL_RS
			 WHERE STND_YEAR = ?
			   AND MEET_CD = '003'
			   AND TMS = ?
			   AND DAY_ORD = ?
			   AND RACE_NO = ?
			   AND POOL_CD IN('004', '005', '006')
        ]]>
    </query>
    <query id="tbee_brch_rtrn_ie001" desc="저장" fetchSize="10">
        <![CDATA[
			MERGE INTO TBEE_BRCH_RTRN TBR
			USING   DUAL
			ON		(
					SR_NO = ?
					)
            WHEN MATCHED THEN
				UPDATE	SET
						STND_YEAR		= ?,
						MBR_CD			= '001',
						TMS				= ?,
						DAY_ORD			= ?,
						RACE_NO			= ?,
						OTB_NM			= ?,
						CUST_NM			= ?,
						BUY_PLC			= ?,
						RETURN_PLC		= ?,
						WINNER			= ?,
						EXA_RATE		= ?,
						EXA_WON1		= ?,
						EXA_WON2		= ?,
						EXA_WON3		= ?,
						EXA_WON4		= ?,
						EXA_WON5		= ?,
						EXA_NO1			= ?,
						EXA_NO2			= ?,
						EXA_NO3			= ?,
						EXA_NO4			= ?,
						EXA_NO5			= ?,
						QUI_RATE		= ?,
						QUI_WON1		= ?,
						QUI_WON2		= ?,
						QUI_WON3		= ?,
						QUI_WON4		= ?,
						QUI_WON5		= ?,
						QUI_NO1			= ?,
						QUI_NO2			= ?,
						QUI_NO3			= ?,
						QUI_NO4			= ?,
						QUI_NO5			= ?,
						TRI_RATE		= ?,
						TRI_WON1		= ?,
						TRI_WON2		= ?,
						TRI_WON3		= ?,
						TRI_WON4		= ?,
						TRI_WON5		= ?,
						TRI_NO1			= ?,
						TRI_NO2			= ?,
						TRI_NO3			= ?,
						TRI_NO4			= ?,
						TRI_NO5			= ?,
						TOTAL_RETURN	= ?,
						VEH_NO			= ?,
						VEH_COLOR		= ?,
						CUST_TEL		= ?,
						CUST_ADDR		= ?,
						RMK				= ?,
						INST_NM			= ?,
						REG_IP			= ?,
						PHOTO_NM		= ?,
						PHOTO_PATH		= ?,
						PHOTO_TYPE		= ?,
						PHOTO_SIZE		= ?,
						FILE_NM			= ?,
						FILE_PATH		= ?,
						FILE_TYPE		= ?,
						FILE_SIZE		= ?,
						UPDT_ID			= ?,
						UPDT_DTM		= SYSDATE	--수정일시 
			WHEN NOT MATCHED THEN
				INSERT
					(	 
						SR_NO,
						STND_YEAR,
						MBR_CD,
						TMS,
						DAY_ORD,
						RACE_NO,
						OTB_NM,
						CUST_NM,
						BUY_PLC,
						RETURN_PLC,
						WINNER,
						EXA_RATE,
						EXA_WON1,
						EXA_WON2,
						EXA_WON3,
						EXA_WON4,
						EXA_WON5,
						EXA_NO1,
						EXA_NO2,
						EXA_NO3,
						EXA_NO4,
						EXA_NO5,
						QUI_RATE,
						QUI_WON1,
						QUI_WON2,
						QUI_WON3,
						QUI_WON4,
						QUI_WON5,
						QUI_NO1,
						QUI_NO2,
						QUI_NO3,
						QUI_NO4,
						QUI_NO5,
						TRI_RATE,
						TRI_WON1,
						TRI_WON2,
						TRI_WON3,
						TRI_WON4,
						TRI_WON5,
						TRI_NO1,
						TRI_NO2,
						TRI_NO3,
						TRI_NO4,
						TRI_NO5,
						TOTAL_RETURN,
						VEH_NO,
						VEH_COLOR,
						CUST_TEL,
						CUST_ADDR,
						RMK,
						INST_NM,
						REG_IP,
						PHOTO_NM,
						PHOTO_PATH,
						PHOTO_TYPE,
						PHOTO_SIZE,
						FILE_NM,
						FILE_PATH,
						FILE_TYPE,
						FILE_SIZE,
						INST_ID,
						INST_DTM
					)
					VALUES
					(
						(SELECT NVL(MAX(SR_NO),0)+1 FROM TBEE_BRCH_RTRN),
						?,'001',?,?,?,?,?,?,?,?,
						?,?,?,?,?,?,?,?,?,?,
						?,?,?,?,?,?,?,?,?,?,
						?,?,?,?,?,?,?,?,?,?,
						?,?,?,?,?,?,?,?,?,?,
						?,?,?,?,?,?,?,?,?,?,SYSDATE
					)
        ]]>
    </query> 
    <query id="tbee_brch_rtrn_de001" desc="삭제" fetchSize="10">
        <![CDATA[
             DELETE FROM TBEE_BRCH_RTRN 
             WHERE SR_NO = ?
        ]]>
    </query> 
    <query id="tbee_brch_rtrn_ue001" desc="첨부사진삭제" fetchSize="10">
        <![CDATA[
			UPDATE TBEE_BRCH_RTRN SET
				     PHOTO_NM = ''
				   , PHOTO_PATH = ''
				   , PHOTO_TYPE = ''
				   , PHOTO_SIZE = ''
				   , UPDT_ID = ?
				   , UPDT_DTM = SYSDATE
			 WHERE SR_NO = ?
        ]]>
    </query> 
    <query id="tbee_brch_rtrn_ue002" desc="첨부파일삭제" fetchSize="10">
        <![CDATA[
			UPDATE TBEE_BRCH_RTRN SET
				     FILE_NM = ''
				   , FILE_PATH = ''
				   , FILE_TYPE = ''
				   , FILE_SIZE = ''
				   , UPDT_ID = ?
				   , UPDT_DTM = SYSDATE
			 WHERE SR_NO = ?
        ]]>
    </query> 
</queryMap>