<?xml version="1.0" encoding='EUC-KR'?>
<queryMap desc="tbee_doping_test(약물검사 선수등록)">
    <query id="tbee_doping_test_fe001" desc="조회" fetchSize="10">
        <![CDATA[
			SELECT	CASE NVL(TDT.RACER_NO, '0') WHEN '0' THEN '0' ELSE '1' END AS CHK,
					TA.STND_YEAR,
            		TA.MBR_CD,
                    TA.TMS,
            		TA.RACER_NO, 
                    TRM.NM_KOR,
                    TRM.RACER_PERIO_NO,
                    TRM.RACER_GRD_CD,
                    TDT.DOPING_DESC
            FROM	TBEB_ARRANGE		TA
            INNER JOIN
            		TBEC_RACER_MASTER	TRM
			ON		TA.RACER_NO = TRM.RACER_NO
            LEFT JOIN
            		TBEE_DOPING_TEST	TDT
            ON		TA.STND_YEAR = TDT.STND_YEAR
            AND		TA.MBR_CD = TDT.MBR_CD
            AND		TA.TMS = TDT.TMS
            AND		TA.RACER_NO = TDT.RACER_NO
			WHERE	TA.STND_YEAR 	= ?
            AND		TA.MBR_CD 		= ?
            AND		TA.TMS			= ?
            ORDER BY TA.RACER_NO
        ]]>
    </query>
    <query id="tbee_doping_test_fe002" desc="조회" fetchSize="10">
        <![CDATA[
			SELECT	TRM.RACER_NO, 											--등록번호
            		TRM.NM_KOR, 											--성명
                    TRM.RACER_GRD_CD,										--등급
            		COUNT(TDT.RACER_NO)						AS TOTAL,		--계
                    COUNT(CASE TDT.TMS WHEN 1 THEN 1 END)	AS ROUND_1,
                    COUNT(CASE TDT.TMS WHEN 2 THEN 1 END)	AS ROUND_2,
                    COUNT(CASE TDT.TMS WHEN 3 THEN 1 END)	AS ROUND_3,
                    COUNT(CASE TDT.TMS WHEN 4 THEN 1 END)	AS ROUND_4,
                    COUNT(CASE TDT.TMS WHEN 5 THEN 1 END)	AS ROUND_5,
                    COUNT(CASE TDT.TMS WHEN 6 THEN 1 END)	AS ROUND_6,
                    COUNT(CASE TDT.TMS WHEN 7 THEN 1 END)	AS ROUND_7,
                    COUNT(CASE TDT.TMS WHEN 8 THEN 1 END)	AS ROUND_8,
                    COUNT(CASE TDT.TMS WHEN 9 THEN 1 END)	AS ROUND_9,
                    COUNT(CASE TDT.TMS WHEN 10 THEN 1 END)	AS ROUND_10,
                    COUNT(CASE TDT.TMS WHEN 11 THEN 1 END)	AS ROUND_11,
                    COUNT(CASE TDT.TMS WHEN 12 THEN 1 END)	AS ROUND_12,
                    COUNT(CASE TDT.TMS WHEN 13 THEN 1 END)	AS ROUND_13,
                    COUNT(CASE TDT.TMS WHEN 14 THEN 1 END)	AS ROUND_14,
                    COUNT(CASE TDT.TMS WHEN 15 THEN 1 END)	AS ROUND_15,
                    COUNT(CASE TDT.TMS WHEN 16 THEN 1 END)	AS ROUND_16,
                    COUNT(CASE TDT.TMS WHEN 17 THEN 1 END)	AS ROUND_17,
                    COUNT(CASE TDT.TMS WHEN 18 THEN 1 END)	AS ROUND_18,
                    COUNT(CASE TDT.TMS WHEN 19 THEN 1 END)	AS ROUND_19,
                    COUNT(CASE TDT.TMS WHEN 20 THEN 1 END)	AS ROUND_20,
                    COUNT(CASE TDT.TMS WHEN 21 THEN 1 END)	AS ROUND_21,
                    COUNT(CASE TDT.TMS WHEN 22 THEN 1 END)	AS ROUND_22,
                    COUNT(CASE TDT.TMS WHEN 23 THEN 1 END)	AS ROUND_23,
                    COUNT(CASE TDT.TMS WHEN 24 THEN 1 END)	AS ROUND_24,
                    COUNT(CASE TDT.TMS WHEN 25 THEN 1 END)	AS ROUND_25,
                    COUNT(CASE TDT.TMS WHEN 26 THEN 1 END)	AS ROUND_26,
                    COUNT(CASE TDT.TMS WHEN 27 THEN 1 END)	AS ROUND_27,
                    COUNT(CASE TDT.TMS WHEN 28 THEN 1 END)	AS ROUND_28,
                    COUNT(CASE TDT.TMS WHEN 29 THEN 1 END)	AS ROUND_29,
                    COUNT(CASE TDT.TMS WHEN 30 THEN 1 END)	AS ROUND_30,
                    COUNT(CASE TDT.TMS WHEN 31 THEN 1 END)	AS ROUND_31,
                    COUNT(CASE TDT.TMS WHEN 32 THEN 1 END)	AS ROUND_32,
                    COUNT(CASE TDT.TMS WHEN 33 THEN 1 END)	AS ROUND_33,
                    COUNT(CASE TDT.TMS WHEN 34 THEN 1 END)	AS ROUND_34,
                    COUNT(CASE TDT.TMS WHEN 35 THEN 1 END)	AS ROUND_35,
                    COUNT(CASE TDT.TMS WHEN 36 THEN 1 END)	AS ROUND_36,
                    COUNT(CASE TDT.TMS WHEN 37 THEN 1 END)	AS ROUND_37,
                    COUNT(CASE TDT.TMS WHEN 38 THEN 1 END)	AS ROUND_38,
                    COUNT(CASE TDT.TMS WHEN 39 THEN 1 END)	AS ROUND_39,
                    COUNT(CASE TDT.TMS WHEN 40 THEN 1 END)	AS ROUND_40,
                    COUNT(CASE TDT.TMS WHEN 41 THEN 1 END)	AS ROUND_41,
                    COUNT(CASE TDT.TMS WHEN 42 THEN 1 END)	AS ROUND_42,
                    COUNT(CASE TDT.TMS WHEN 43 THEN 1 END)	AS ROUND_43,
                    COUNT(CASE TDT.TMS WHEN 44 THEN 1 END)	AS ROUND_44,
                    COUNT(CASE TDT.TMS WHEN 45 THEN 1 END)	AS ROUND_45
            FROM	TBEC_RACER_MASTER	TRM
            LEFT JOIN
            		TBEE_DOPING_TEST	TDT
			ON		TRM.RACER_NO = TDT.RACER_NO
			AND		TDT.STND_YEAR 	= ?
            GROUP BY TRM.RACER_NO, TRM.NM_KOR, TRM.RACER_GRD_CD
            ORDER BY TRM.RACER_NO
        ]]>
    </query>
    <query id="tbee_doping_test_ie001" desc="저장" fetchSize="10">
        <![CDATA[
        	MERGE INTO TBEE_DOPING_TEST TDT
            USING   DUAL
            ON		(
            		STND_YEAR 			= ?			--기준년도
            AND		MBR_CD 				= ?			--경정장코드
            AND		TMS 				= ?  		--회차  
            AND		RACER_NO			= ? 		--선수등록번호
                    )
            WHEN MATCHED THEN
	            UPDATE	SET
						DOPING_DESC 	= ?,		--내용    
				      	UPDT_ID			= ?,		--수정자ID    
				      	UPDT_DTM		= SYSDATE	--수정일시 
            WHEN NOT MATCHED THEN
				INSERT
					(	 
				        STND_YEAR, 					--기준년도
				        MBR_CD,						--경정장코드
				        TMS,						--회차
				        RACER_NO, 					--선수등록번호
				        DOPING_DESC,				--내용
						INST_ID,					--입력자   
				        INST_DTM					--작성일시
					)
					VALUES
					(
						?, 							--기준년도
				        ?,							--경정장코드
				        ?,							--회차
				        ?, 							--선수등록번호
				        ?,							--내용
						?,							--입력자   
				        SYSDATE						--작성일시
					)
        ]]>
    </query> 
    <query id="tbee_doping_test_ue001" desc="수정" fetchSize="10">
        <![CDATA[
			UPDATE	TBEE_DOPING_TEST SET
					DOPING_DESC 	= ?,		--내용    
			      	UPDT_ID			= ?,		--수정자ID    
			      	UPDT_DTM		= SYSDATE	--수정일시 
			WHERE	STND_YEAR 		= ?			--기준년도
            AND		MBR_CD 			= ?			--경정장코드
            AND		TMS 			= ?  		--회차  
            AND		RACER_NO		= ? 		--선수등록번호
        ]]>
    </query> 
    <query id="tbee_doping_test_de001" desc="삭제" fetchSize="10">
        <![CDATA[
			DELETE
			FROM 	TBEE_DOPING_TEST
			WHERE	STND_YEAR 	= ?		--기준년도
            AND		MBR_CD 		= ?		--경정장코드
            AND		TMS 		= ?  	--회차
            AND		RACER_NO	= ?		--선수등록번호
        ]]>
    </query> 
</queryMap>