<?xml version="1.0" encoding="euc-kr"?>
<Window>
	<Form Height="590" Id="E04200010" Left="8" OnLoadCompleted="fcFormLoadSetting" OnUnloadCompleted="fcFormUnloadProcess" PidAttrib="7" Title="입소&#32;교육생&#32;선별" Top="8" Ver="1.0" Width="1014" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="dsMain">
				<Contents>
					<colinfo id="RACER_NO" size="256" summ="default" type="STRING"/>
					<colinfo id="RACER_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="RACER_GRD_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="STND_YEAR" size="256" summ="default" type="STRING"/>
					<colinfo id="MEET_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="TMS" size="256" summ="default" type="STRING"/>
					<colinfo id="EDU_TARGET_RACER" size="256" summ="default" type="STRING"/>
					<colinfo id="RMK" size="256" summ="default" type="STRING"/>
					<colinfo id="DOWN_CNT" size="256" summ="default" type="STRING"/>
					<colinfo id="FAIL_CNT" size="256" summ="default" type="STRING"/>
					<colinfo id="LAZY_CNT" size="256" summ="default" type="STRING"/>
					<colinfo id="EDU_CNT" size="256" summ="default" type="STRING"/>
					<colinfo id="VIOL_POINT" size="256" summ="default" type="STRING"/>
					<colinfo id="RUN_TMS_CNT" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Shape BKColor="user0" Bottom="56" Height="26" Id="Shape1" Left="8" LineColor="user1" LineKind="Vertical" Right="1010" RoundHeight="10" RoundUnit="Pixel" RoundWidth="10" TabOrder="3" Top="30" Type="RoundRect" Width="1002"></Shape>
		<Image Height="20" Id="imgFormTitle" ImageID="m_titleblet" Left="7" TabOrder="6" TabStop="FALSE" Top="10" Width="17"></Image>
		<Static Font="굴림,10,Bold" Height="22" Id="stFormTitle" Left="28" Style="snis_m_title" TabOrder="4" Text="입소&#32;교육생&#32;선별" Top="8" VAlign="Middle" Width="400"></Static>
		<Div Height="22" Id="divBtnLst" Left="634" TabOrder="2" Text="Div0" Top="6" Url="common::comButtonType.xml" Width="374">
			<Contents></Contents>
		</Div>
		<Combo Border="Flat" CodeColumn="STND_YEAR" DataColumn="STND_YEAR" Height="20" Id="cboStndYear" ImeMode="none" Left="53" OnChanged="cboStndYear_OnChanged" Style="snis_if_input01" TabOrder="7" Top="33" Width="72"></Combo>
		<Combo BindDataset="dsTms" Border="Flat" CodeColumn="TMS" DataColumn="TMS" Height="20" Id="cboTms" ImeMode="none" Left="176" OnChanged="fcSearch" Style="snis_if_input01" TabOrder="8" Top="33" Width="50"></Combo>
		<Div BKColor="user0" Height="20" Id="divRacerSearch" Left="632" TabOrder="9" Text="Div0" Top="33" Width="349">
			<Contents></Contents>
		</Div>
		<Grid AutoEnter="TRUE" AutoFit="TRUE" AutoFitEndLine="Hide" BindDataset="dsMain" BKColor="user15" BkColor2="user16" BkSelColor="user17" BoldHead="true" Border="Flat" BorderColor="user22" Bottom="583" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="20" Height="513" Id="noEntrMngr" InputPanel="FALSE" Left="8" LineColor="user18" MinWidth="100" OnCellClick="noEntrMngr_OnCellClick" OnCellDBLClick="noEntrMngr_OnCellDblClick" OnHeadClick="fcGridSort" Right="1008" SelColor="user19" Style="snis_grid" TabOrder="1" TabStop="FALSE" Top="70" UseDBuff="true" UsePopupMenu="true" UseSelColor="FALSE" Visible="true" VLineColor="default" WheelScrollRow="1" Width="1000">
			<contents>
				<format id="Default">
					<columns>
						<col width="30"/>
						<col width="76"/>
						<col width="93"/>
						<col width="59"/>
						<col width="60"/>
						<col width="60"/>
						<col width="60"/>
						<col width="60"/>
						<col width="60"/>
						<col width="70"/>
						<col width="60"/>
					</columns>
					<head>
						<cell bkcolor="user20" celltype="head" col="0" color="user21" display="text" font="굴림,9"/>
						<cell bkcolor="user20" col="1" color="user21" display="text" edit="uppernum" font="굴림,9" text="등록번호"/>
						<cell bkcolor="user20" col="2" color="user21" display="text" font="굴림,9" text="선수명"/>
						<cell bkcolor="user20" col="3" color="user21" display="text" font="굴림,9" text="등급"/>
						<cell bkcolor="user20" col="4" color="user21" display="text" font="굴림,9" text="낙수"/>
						<cell bkcolor="user20" col="5" color="user21" display="text" font="굴림,9" text="전복"/>
						<cell bkcolor="user20" col="6" color="user21" display="text" font="굴림,9" text="출주제외"/>
						<cell bkcolor="user20" col="7" color="user21" display="text" font="굴림,9" text="교육"/>
						<cell bkcolor="user20" col="8" color="user21" display="text" font="굴림,9" text="출주회수"/>
						<cell bkcolor="user20" col="9" color="user21" display="text" font="굴림,9" text="위험지수"/>
						<cell bkcolor="user20" col="10" color="user21" display="text" font="굴림,9" text="교육대상"/>
					</head>
					<body>
						<cell align="center" celltype="head" col="0" display="text" expr="row+1"/>
						<cell align="center" checklength="Byte" col="1" colid="RACER_NO" display="text" imemode="english" limit="6" Mask="########" useime="false"/>
						<cell align="center" checklength="Byte" col="2" colid="RACER_NM" display="text" limit="40"/>
						<cell align="center" checklength="Byte" col="3" colid="RACER_GRD_CD" display="text" limit="40"/>
						<cell align="center" checklength="Byte" col="4" colid="dOWN_CNT" cursor="hand" display="text" limit="40"/>
						<cell align="center" checklength="Byte" col="5" colid="fAIL_CNT" cursor="hand" display="text" limit="40"/>
						<cell align="center" checklength="Byte" col="6" colid="lAZY_CNT" cursor="hand" display="text" limit="40"/>
						<cell align="center" checklength="Byte" col="7" colid="eDU_CNT" cursor="hand" display="text" limit="40"/>
						<cell align="center" checklength="Byte" col="8" colid="RUN_TMS_CNT" display="text" limit="40"/>
						<cell align="center" bkcolor="expr:iif(VIOL_POINT&gt;=50,&apos;RED&apos;,&apos;default&apos;)" col="9" colid="VIOL_POINT" cursor="hand" display="normal"/>
						<cell align="center" checklength="Byte" col="10" colid="edu_tARGET_RACER" display="checkbox" edit="checkbox" limit="40"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Static Align="Center" Border="None" Height="20" Id="stYear" Left="16" Style="snis_if_lable" TabOrder="4" Text="년도" Top="34" VAlign="Middle" Width="40"></Static>
		<Static Align="Center" Border="None" Height="20" Id="stTms" Left="136" Style="snis_if_lable" TabOrder="5" Text="회차" Top="34" VAlign="Middle" Width="40"></Static>
		<Static Align="Right" Height="22" Id="stFormLocation" Left="495" Style="styFormLocation" TabOrder="11" Top="2" VAlign="Middle" Width="288"></Static>
		<Static Align="Center" Border="None" Height="20" Id="stInputDt" Left="352" Style="snis_if_lable" TabOrder="13" Text="기준일" Top="34" VAlign="Middle" Width="48"></Static>
		<Calendar Border="Flat" Height="20" Id="calFromInputDt" Left="408" SaturdayTextColor="blue" Style="snis_if_input01" SundayTextColor="red" TabOrder="12" Top="34" Width="88"></Calendar>
		<Static Align="Right" Border="None" Height="20" Id="Static1" Left="241" Style="snis_if_lable" TabOrder="15" Text="산정대상" Top="34" VAlign="Middle" Width="47"></Static>
		<Combo BindDataset="dsTms" Border="Flat" CodeColumn="CD" DataColumn="CD_NM" Height="20" Id="cboMeetCd" ImeMode="none" Left="288" Style="snis_if_input01" TabOrder="14" Top="33" Width="50"></Combo>
		<Static Border="None" Height="20" Id="Static0" Left="504" Style="snis_if_lable" TabOrder="16" Text="(기준일&#32;이전&#32;10회차)" Top="35" VAlign="Middle" Width="200"></Static>
	</Form>
	<Script><![CDATA[/***************************************************************************************************
*                                         공통 Script Include                                      *
***************************************************************************************************/
#include "lib::cra_common_script.js";
#include "lib::cra_app_script.js";

/***************************************************************************************************
*                                          화면 변수 선언부                                        *
***************************************************************************************************/
var sFormId       = 'JRM0002';
var sBUTTONLIST   = 'TTTTTTT';                          //공통기능정의(버튼순으로 T or F)
var sUSERAUTH     = '';                                //사용자별 프로그램 사용 권한
var sFORMCAPTION  = '';                                //Form의 Title 정보
var sFORMLOCATION = '';                                //Form의 Location 정보
/***************************************************************************************************
*                                         공통 Event 처리 부분                                     *
***************************************************************************************************/
/*-------------------------------------------------------------------------------------------------+
>> 최초 화면 Load時 처리 할 사항
+-------------------------------------------------------------------------------------------------*/
function fcFormLoadSetting(obj) {
	sBUTTONLIST   = 'FT' + sInpt + 'FFFT';

	// 화면환경 설정
	sFORMCAPTION  = obj.Title;
	sFORMLOCATION = "";

	// 화면 정보 Display 및 Button 권한 설정
	fnc_FormLoadSetting(obj, sFORMCAPTION, sFORMLOCATION, sBUTTONLIST, sUSERAUTH);

	// 초기 화면 BK Color설정
	fnc_SetBKColor(this);
	
	// 그리드 사이즈 조정
	fcOnSize(parent.width, parent.height);
	
	// 경주정보 조회
	fcd_GetRaceInfo(sFormId, cboStndYear, cboMeetcd, cboTms, NULL, NULL);

	dsJRM0002cboMeetCd.InsertRow(0);
	dsJRM0002cboMeetCd.SetColumn(0,"CD","");
	dsJRM0002cboMeetCd.SetColumn(0,"CD_NM","전체");
	cboMeetCd.index = 0;
	
	// 공통코드 조회
	//fcd_GetComboDs(dsInComCd);
	

	// 그냥 오늘날짜 10주 전..
	//calFromInputDt.Value = fnc_calDate(fnc_currDate(),70,true);
	//calToInputDt.Value = fnc_currDate();

	// 오늘 기준 10주전 금요일 부터 일요일 세팅
	var nDay = GetDay(fnc_currDate());
	/*var strDay = Decode( nDay, 0, "Sunday", 1, "Monthday", 2, "Tuesday", 
	3, "Wednesday", 4, "Thursday", 5, "Friday", 6, "saturday" ); 	*/
	calFromInputDt.Value= AddDate(fnc_currDate(),5-nDay-7 * 10);
	calToInputDt.Value 	= AddDate(fnc_currDate(),0-nDay);	

	divRacerSearch.url = DIV_CODE_URL;

	fcSearch(obj);	
}

/*-------------------------------------------------------------------------------------------------+
>> 선수등록번호
+-------------------------------------------------------------------------------------------------*/
function fcSetDivInit(obj) {
	if (obj == divRacerSearch) {
		divRacerSearch.setDivInit("002", "");
		divRacerSearch.setDivTitle("선수조회");
		// divRacerSearch.setDivWidths(140, 70, 100);
	}
}


/*-------------------------------------------------------------------------------------------------+
>> 최초 화면 UNLoad時 처리 할 사항
+-------------------------------------------------------------------------------------------------*/
function fcFormUnloadProcess(obj) {
	// 자료 변경 여부를 체크하고자 하는  DataSet Object를 넘긴다.
	var sDataset = "dsMain"; 
	if (!fnc_FormUnloadCheck(sDataset, sFormId)) return false;
}
/*-------------------------------------------------------------------------------------------------+
>> 그리드 사이즈 조정
+-------------------------------------------------------------------------------------------------*/
function fcOnSize(nCx, nCy) {
	noEntrMngr.Height = nCy - noEntrMngr.Top  - 10;
}
/*-------------------------------------------------------------------------------------------------+
>> 그리드 정렬
+-------------------------------------------------------------------------------------------------*/
function fcGridSort(obj, nCell, nX, nY, nPivotIndex) {
	fnc_GridSort(obj, object(obj.BindDataset), nCell);
}
/*-------------------------------------------------------------------------------------------------+
>> 조회
+-------------------------------------------------------------------------------------------------*/
function fcSearchCheck(obj) {	
	return true;
}

function fcSearch(obj) {
	if ( !fcSearchCheck(obj) ) return;	
	
	var sServiceName = "jju0004-service:searchEntrMngr";
    var sInDataSet   = "";
    var sOutDataSet  = "dsMain=dsMain "; 
	
	fcd_AddParam("STND_YEAR", cboStndYear.Value); 
	fcd_AddParam("MEET_CD", cboMeetcd.Value);
	fcd_AddParam("TMS", 	cboTms.Value );
	fcd_AddParam("STARTDT", calFromInputDt.Value );
	fcd_AddParam("ENDDT",  	calToInputDt.Value );
	
	if (length(Trim(divRacerSearch.edCode.Text)) != 0) {
		fcd_AddParam("RACER_NO", Trim(divRacerSearch.edCode.Text));
	}
	fcd_SendTransaction(sServiceName, sInDataSet, sOutDataSet, "fcCallBack", true);		
}

/*-------------------------------------------------------------------------------------------------+
>>  저장 버튼 클릭 時 처리
+-------------------------------------------------------------------------------------------------*/
function fcSaveCheck(obj) {  

	// 저장할 자료가 있는지 체크
	if ( !fnc_DatasetChangeCheck(this.dsMain)) {
		//저장 할 자료가 없음
		fnc_Message(SNIS_COM_1006, "N");	
		return false;
	}

	return true;
}

function fcSave(obj) {
	if ( !fcSaveCheck() ) return;

    var sServiceName = "jju0004-service:saveEntrEduMng";
    var sInDataSet   = "dsMain=dsMain:u ";    
    var sOutDataSet  = "";    
    
	fcd_AddParam("STND_YEAR", cboStndYear.Value); 
	fcd_AddParam("MEET_CD", GBL_MEET_CD);	
	fcd_AddParam("TMS", cboTms.Value );
	    
    fcd_SendTransaction(sServiceName, sInDataSet, sOutDataSet, "fcCallBack", false);		
}


function fcCallBack(sServiceName, ErrorCode, ErrorMSG) {

	if ( !fnc_result(ErrorCode, ErrorMSG) ) return;
	
	// 조회 완료 후
	switch (sServiceName) {				
		case "jju0004-service:searchEntrList":
					
			if( dsMain.rowcount > 0  ) {

			}
			break;		
			
		case "jju0004-service:saveEntrEduMng":
			fcSearch( NULL );
			break;

			
			
	}
}

/*-------------------------------------------------------------------------------------------------+
>> 화면 종료(닫기) 버튼 클릭 時 처리
+-------------------------------------------------------------------------------------------------*/
function fcEnd(obj) {
	// 화면 종료
	Close();
}


function noEntrMngr_OnCellClick(obj,nRow,nCell,nX,nY,nPivotIndex)
{
	switch (nCell)  
	{
		case 11 :
			
			strParam = "";
		
			strParam += " sRacerNo=" + dsMain.GetColumn(nRow,"RACER_NO");
			strParam += " sRacerNm=" + dsMain.GetColumn(nRow,"RACER_NM");
			strParam += " sFrDt=" + calFromInputDt.Value;
			strParam += " sToDt=" + calToInputDt.Value;
			strParam += " sMeetCd=" + cboMeetcd.value ;
			GBL_FRM_REL_VALUE = strParam;
	
			global.FrameBottom.fcOpenMdiForm("JRM0005", "개인별낙차통계", "frm_jju::JRM0005.xml");			
			
			
			break;
	
	}
}

function cboStndYear_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
	switch (obj.Id) {
		case "cboStndYear" :
			fcd_GetTms(sFormId, cboTms, cboStndYear.Value, GBL_MEET_CD, false, null, null);
			fcSearch(obj);
			break;
	}
}

function noEntrMngr_OnCellDblClick(obj,nRow,nCell,nX,nY,nPivotIndex)
{
	strParam = "";
	
	if(nCell == 4 or nCell ==9) {
		strParam += " sRacerNo=" + dsMain.GetColumn(nRow,"RACER_NO");
		strParam += " sRacerNm=" + dsMain.GetColumn(nRow,"RACER_NM");
		strParam += " sFrDt=" + calFromInputDt.Value;
		strParam += " sToDt=" + calToInputDt.Value;
		strParam += " sMeetCd=" + cboMeetcd.value ;
		GBL_FRM_REL_VALUE = strParam;

		global.FrameBottom.fcOpenMdiForm("JRM0004", "개인별낙차현황", "frm_jju::JRM0004.xml");

	}
	else if (nCell == 5 or nCell==6)  {	
		//alert(nCell);
		strParam += " sRacerNo=" + dsMain.GetColumn(nRow,"RACER_NO");
		strParam += " sRacerNm=" + dsMain.GetColumn(nRow,"RACER_NM");
		strParam += " sFrDt=" + calFromInputDt.Value;
		strParam += " sToDt=" + calToInputDt.Value;
		strParam += " sMeetCd=" + cboMeetcd.value ;
		GBL_FRM_REL_VALUE = strParam;

		global.FrameBottom.fcOpenMdiForm("JJU0033", "회차(개인)별 위반현황", "frm_jju::JJU0033.xml");
	}	
	else if(nCell = 7) {

		strParam += " sRacerNo=" + dsMain.GetColumn(nRow,"RACER_NO");
		strParam += " sRacerNm=" + dsMain.GetColumn(nRow,"RACER_NM");
		strParam += " sFrDt=" + calFromInputDt.Value;
		strParam += " sToDt=" + calToInputDt.Value;
		strParam += " sMeetCd=" + cboMeetcd.value ;
		GBL_FRM_REL_VALUE = strParam;

		global.FrameBottom.fcOpenMdiForm("JRM0003", "교육현황관리", "frm_jju::JRM0003.xml");
	}
}
]]></Script>
</Window>