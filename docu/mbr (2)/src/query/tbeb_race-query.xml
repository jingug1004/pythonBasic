<?xml version="1.0" encoding='EUC-KR'?>
<queryMap desc="tbeb_race(경주)">
    <query id="tbeb_race_fb001" desc="경주조회" fetchSize="10">
        <![CDATA[
			SELECT
			         TR.STND_YEAR         -- 기준년도    
			       , TR.MBR_CD            -- 경정장코드
			       , TR.TMS               -- 회차        
			       , TR.DAY_ORD           -- 일차        
			       , TR.RACE_NO           -- 경주번호    
			       , TR.RACE_DGRE_CD      -- 경주등급코드
			       , ( SELECT RMK FROM TBEA_SPEC_CD WHERE GRP_CD = 'E00005' AND CD = TR.RACE_DGRE_CD ) RACE_DGRE
			       , TR.ST_MTHD_CD        -- ST방법코드
			       , ( SELECT CD_NM FROM TBEA_SPEC_CD WHERE GRP_CD = 'E00002' AND CD = TR.ST_MTHD_CD   ) ST_MTHD
			       , TR.STRT_TIME         -- 출발시각    
			       , TR.RACE_REG_NO_CNT   -- 정번수      
			       , TR.RACE_DIST         -- 경주거리    
			       , TR.TURN_CNT          -- 주회수      
			       , TR.ANTC_DESC         -- 예상내용    
			       , TR.RSLT_DESC         -- 결과내용    
			       , TR.ANTC_RANK         -- 예상등수    
			       , TR.RSLT_RANK         -- 결과등수    
			       , TR.TOT_SALE_AMT      -- 총매출액    
			       , TR.RACE_END_YN       -- 경주마감여부
			       , TR.RACE_STTS_CD      -- 경주상황코드
			       , TR.RACE_STTS_DESC    -- 경주상황내용
			       , TR.WEATH_CD          -- 기상코드    
			       , TR.TEMPT             -- 기온        
			       , TR.WIND_SPD          -- 풍속        
			       , TR.WIND_DIRC_CD      -- 풍향코드    
			       , TR.WATER_TEMPT       -- 수온        
			       , TR.WAVE              -- 파고        
			       , TR.WATER_LVL         -- 수위        
			       , TR.DIS_NEED_TIME     -- 심의소요시간
			       , TR.MNG               -- 담당자      
			       , TR.REFE_HEAD         -- 심판장      
			       , TR.INSP_CMAN         -- 심사위원    
			       , TR.LAPTIME_1         -- 랩타임1     
			       , TR.LAPTIME_2         -- 랩타임2     
			       , TR.LAPTIME_3         -- 랩타임3     
			       , TR.INST_ID           -- 작성자ID    
			       , TR.INST_DTM          -- 작성일시    
			       , TR.UPDT_ID           -- 수정자ID    
			       , TR.UPDT_DTM          -- 수정일시    
			FROM   TBEB_RACE TR
			WHERE  TR.STND_YEAR = ?
			AND    TR.MBR_CD    = ?
			AND    TR.TMS       = ?
			AND    TR.DAY_ORD   = NVL(?, TR.DAY_ORD)
			AND    TR.RACE_NO   = NVL(?, TR.RACE_NO)
        ]]>
    </query> 
    <query id="tbeb_race_fb002" desc="경주조회" fetchSize="10">
        <![CDATA[
			SELECT /*  tbeb_race_fb002 IWORK_SFR-008 경정 선수편성 메뉴 개선. 정렬추가  */
			         TR.RACE_NO
			       , TR.RACE_REG_NO_CNT
			FROM   TBEB_RACE TR
			WHERE  TR.STND_YEAR = ?
			AND    TR.MBR_CD    = ?
			AND    TR.TMS       = ?
			AND    TR.DAY_ORD   = ?
			ORDER  BY TR.RACE_NO
        ]]>
    </query> 
    <query id="tbeb_race_fb003" desc="경주조회" fetchSize="10">
        <![CDATA[
			SELECT
			         DAY_ORD
			       , RACE_NO
			       , RACE_END_YN
			FROM   TBEB_RACE
			WHERE  STND_YEAR = ?
			AND    MBR_CD    = ?
			AND    TMS       = ?
			AND    NVL(RACE_END_YN, 'N') <> 'Y'
        ]]>
    </query> 
    <query id="tbeb_race_ib001" desc="경주저장" fetchSize="10">
        <![CDATA[
			MERGE INTO TBEB_RACE TR
			USING (
			        SELECT
			                  ? STND_YEAR       -- 기준년도    
			                , ? MBR_CD          -- 경정장코드
			                , ? TMS             -- 회차        
			                , DAY_ORD           -- 일차        
			                , RACE_NO           -- 경주번호    
			                , RACE_DGRE_CD      -- 경주등급코드
			                , ST_MTHD_CD        -- ST방법코드
			                , STRT_TIME         -- 출발시각    
			                , RACE_REG_NO_CNT   -- 정번수      
			                , RACE_DIST         -- 경주거리    
			                , TURN_CNT          -- 주회수      
			                , ? INST_ID         -- 작성자ID    
			                , SYSDATE INST_DTM  -- 작성일시    
			                , ? UPDT_ID         -- 수정자ID    
			                , SYSDATE UPDT_DTM  -- 수정일시    
			        FROM    TBEB_CFRNT_RACE
			        WHERE   CFRNT_CD = ?
			      ) TCR
			ON (    TR.STND_YEAR = TCR.STND_YEAR
			    AND TR.MBR_CD    = TCR.MBR_CD
			    AND TR.TMS       = TCR.TMS
			    AND TR.DAY_ORD   = TCR.DAY_ORD
			    AND TR.RACE_NO   = TCR.RACE_NO
			    )
			WHEN MATCHED THEN                              --데이터 중복건이 있는경우 Update
			           UPDATE SET 
			                        TR.RACE_DGRE_CD    = TCR.RACE_DGRE_CD    
			                      , TR.ST_MTHD_CD      = TCR.ST_MTHD_CD                            
			                      , TR.STRT_TIME       = TCR.STRT_TIME                             
			                      , TR.RACE_REG_NO_CNT = TCR.RACE_REG_NO_CNT                       
			                      , TR.RACE_DIST       = TCR.RACE_DIST                             
			                      , TR.TURN_CNT        = TCR.TURN_CNT                              
			                      , TR.UPDT_ID         = TCR.UPDT_ID                               
			                      , TR.UPDT_DTM        = TCR.UPDT_DTM                              
			WHEN NOT MATCHED THEN                      -- 중복건이 없는 경우 처리 Insert
			           INSERT (
			                        TR.STND_YEAR       
			                      , TR.MBR_CD                          
			                      , TR.TMS                             
			                      , TR.DAY_ORD                         
			                      , TR.RACE_NO                         
			                      , TR.RACE_DGRE_CD    
			                      , TR.ST_MTHD_CD                            
			                      , TR.STRT_TIME                             
			                      , TR.RACE_REG_NO_CNT                       
			                      , TR.RACE_DIST                             
			                      , TR.TURN_CNT                              
			                      , TR.INST_ID                               
			                      , TR.INST_DTM                              
			                      , TR.UPDT_ID                               
			                      , TR.UPDT_DTM     
			                  ) VALUES (
			                        TCR.STND_YEAR       
			                      , TCR.MBR_CD          
			                      , TCR.TMS             
			                      , TCR.DAY_ORD         
			                      , TCR.RACE_NO         
			                      , TCR.RACE_DGRE_CD    
			                      , TCR.ST_MTHD_CD      
			                      , TCR.STRT_TIME       
			                      , TCR.RACE_REG_NO_CNT 
			                      , TCR.RACE_DIST       
			                      , TCR.TURN_CNT        
			                      , TCR.INST_ID         
			                      , TCR.INST_DTM        
			                      , TCR.UPDT_ID         
			                      , TCR.UPDT_DTM        
			                  )                         
        ]]>
    </query> 
    <query id="tbeb_race_ib002" desc="경주저장" fetchSize="10">
        <![CDATA[
			INSERT INTO TBEB_RACE
			(
			        STND_YEAR         -- 기준년도    
			      , MBR_CD            -- 경정장코드
			      , TMS               -- 회차        
			      , DAY_ORD           -- 일차        
			      , RACE_NO           -- 경주번호    
			      , RACE_DGRE_CD      -- 경주등급코드
			      , ST_MTHD_CD        -- ST방법코드
			      , STRT_TIME         -- 출발시각    
			      , RACE_REG_NO_CNT   -- 정번수      
			      , RACE_DIST         -- 경주거리    
			      , TURN_CNT          -- 주회수      
			      , INST_ID           -- 작성자ID    
			      , INST_DTM          -- 작성일시    
			      , UPDT_ID           -- 수정자ID    
			      , UPDT_DTM          -- 수정일시    
			) SELECT
  			        ?                 -- 기준년도    
			      , ?                 -- 경정장코드
  			      , ?                 -- 회차        
  			      , DAY_ORD           -- 일차        
  			      , RACE_NO           -- 경주번호    
  			      , RACE_DGRE_CD      -- 경주등급코드
  			      , ST_MTHD_CD        -- ST방법코드
  			      , STRT_TIME         -- 출발시각    
  			      , RACE_REG_NO_CNT   -- 정번수      
  			      , RACE_DIST         -- 경주거리    
  			      , TURN_CNT          -- 주회수      
  			      , ?                 -- 작성자ID    
  			      , SYSDATE           -- 작성일시    
  			      , ?                 -- 수정자ID    
  			      , SYSDATE           -- 수정일시    
			  FROM  TBEB_CFRNT_RACE 
			  WHERE CFRNT_CD = ?
        ]]>
    </query> 
    <query id="tbeb_race_ub001" desc="경주수정" fetchSize="10">
        <![CDATA[
			UPDATE TBEB_RACE SET
			        RACE_DGRE_CD    = ?       -- 경주등급코드
			      , ST_MTHD_CD      = ?       -- ST방법코드
			      , STRT_TIME       = ?       -- 출발시각    
			      , RACE_REG_NO_CNT = ?       -- 정번수      
			      , RACE_DIST       = ?       -- 경주거리    
			      , TURN_CNT        = ?       -- 주회수      
			      , UPDT_ID         = ?       -- 수정자ID    
			      , UPDT_DTM        = SYSDATE -- 수정일시    
			WHERE STND_YEAR         = ?       -- 기준년도    
			AND   MBR_CD            = ?       -- 경정장코드
			AND   TMS               = ?       -- 회차        
			AND   DAY_ORD           = ?       -- 일차        
			AND   RACE_NO           = ?       -- 경주번호    
        ]]>
    </query> 
    <query id="tbeb_race_db001" desc="경주삭제" fetchSize="10">
        <![CDATA[
			DELETE
			FROM  TBEB_RACE
			WHERE STND_YEAR        = ?               -- 기준년도    
			AND   MBR_CD           = ?               -- 경정장코드
			AND   TMS              = ?               -- 회차        
			AND   DAY_ORD          = NVL(?, DAY_ORD) -- 일차        
			AND   RACE_NO          = NVL(?, RACE_NO) -- 경주번호    
        ]]>
    </query> 
    <query id="tbeb_race_db002" desc="경주삭제" fetchSize="10">
        <![CDATA[
			DELETE
			FROM  TBEB_RACE
			WHERE STND_YEAR    = ?               -- 기준년도
			AND   MBR_CD       = ?               -- 경정장코드
			AND   TMS          = ?               -- 회차    
			AND    ( STND_YEAR
			       , MBR_CD
			       , TMS
			       , DAY_ORD
			       , RACE_NO  ) NOT IN (
			                                SELECT
			                                         TRT.STND_YEAR
			                                       , TRT.MBR_CD
			                                       , TRT.TMS
			                                       , TCR.DAY_ORD
			                                       , TCR.RACE_NO
			                                FROM     TBEB_RACE_TMS     TRT
			                                       , TBEB_CFRNT_RACE   TCR
			                                WHERE  TRT.CFRNT_CD  = TCR .CFRNT_CD
			                                AND    STND_YEAR    = ?               -- 기준년도
			                                AND    MBR_CD       = ?               -- 경정장코드
			                                AND    TMS          = ?               -- 회차    
			                           )
        ]]>
    </query> 
</queryMap>