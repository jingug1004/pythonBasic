<?xml version="1.0" encoding='EUC-KR'?>
<queryMap desc="COMMON RACE">
    <query id="common_tbeb_race_tms_fb001" desc="조회" fetchSize="10">
        <![CDATA[ 
			SELECT /* common_tbeb_race_tms_fb001 IWORK_SFR-008 회차 최고 정번수 추가. */
			         TRT.STND_YEAR
			       , TRT.MBR_CD
			       , TRT.TMS
			       , TRT.QURT_CD
                   , TRST.QURT_CD AS QURT_CD_2
			       , TRT.MONTH
			       , TRT.STR_DT
			       , TRT.END_DT
			       , TRT.CFRNT_CD
			       , TRT.RMK
			       , TRT.RACE_TMS_STAT_CD
				   , TRT.ARRANGE_CMPL_YN
				   , TRT.EQUIP_DRWLT_CMPL_YN
			       , TCM.RACE_KINDS_CD
			       , (  
			            SELECT COUNT(*)
			            FROM   TBEB_RACE_DAY_ORD TRDO
				        WHERE  TRDO.STND_YEAR = TRT.STND_YEAR
			            AND    TRDO.MBR_CD    = TRT.MBR_CD
			            AND    TRDO.TMS       = TRT.TMS
			          ) DAY_ORD
			       ,(
                        SELECT  MAX(TR.RACE_REG_NO_CNT)
                        FROM    TBEB_RACE TR
                        WHERE   TR.STND_YEAR = TRT.STND_YEAR
                        AND     TR.MBR_CD = TRT.MBR_CD
                        AND     TR.TMS = TRT.TMS
                     ) MAX_RACE_REG_NO_CNT
			FROM     TBEB_RACE_TMS   TRT
			       , TBEB_CFRNT_METH TCM
                   , TBEB_RECD_STND_TERM TRST
			WHERE  TRT.CFRNT_CD  = TCM.CFRNT_CD
	        AND    TRT.STND_YEAR = ?
            AND    TRT.MBR_CD    = ?
			AND    TRT.QURT_CD   = NVL(?, TRT.QURT_CD)
            AND    TRT.STR_DT >= TRST.STR_DT
            AND    TRT.END_DT <= TRST.END_DT
			ORDER BY TRT.TMS DESC
        ]]>
    </query> 
    <query id="common_tbeb_race_day_ord_fb001" desc="조회" fetchSize="10">
        <![CDATA[
			SELECT	/* common_tbeb_race_day_ord_fb001 IWORK_정번수 추가. */
                     TRDO.STND_YEAR      -- 기준년도
                   , TRDO.MBR_CD         -- 경정장코드
                   , TRDO.TMS            -- 회차
                   , TRDO.DAY_ORD        -- 일차
                   , TRDO.RACE_DAY       -- 경주일자
                   , TRDO.RACE_CNT       -- 경주수
                   , TRDO.ORGAN_STAT_CD  -- 편성상태
                   , TO_CHAR(TO_DATE(TRDO.RACE_DAY, 'YYYYMMDD'), 'DAY') DAY -- 요일
                   , (SELECT  MAX(A.RACE_REG_NO_CNT) 
                        FROM    TBEB_RACE A
                        WHERE   A.STND_YEAR = TRDO.STND_YEAR
                        AND     A.MBR_CD = TRDO.MBR_CD
                        AND     A.TMS = TRDO.TMS
                        AND     A.DAY_ORD = TRDO.DAY_ORD) MAX_RACE_REG_NO_CNT
			FROM   TBEB_RACE_DAY_ORD TRDO
			WHERE  TRDO.STND_YEAR = ?
            AND    TRDO.MBR_CD    = ?
			AND    TRDO.TMS       = ?
			AND    TRDO.DAY_ORD   = NVL(?, TRDO.DAY_ORD)
			ORDER BY TRDO.STND_YEAR
			       , TRDO.MBR_CD
			       , TRDO.TMS
			       , TRDO.DAY_ORD
        ]]>
    </query> 
    <query id="common_tbeb_race_fb001" desc="조회" fetchSize="10">
        <![CDATA[
			SELECT
			         TR.STND_YEAR         -- 기준년도    
			       , TR.MBR_CD            -- 경정장코드  
			       , TR.TMS               -- 회차        
			       , TR.DAY_ORD           -- 일차        
			       , TR.RACE_NO           -- 경주번호    
			       , TR.RACE_DGRE_CD      -- 경주등급코드
			       , ( SELECT RMK FROM TBEA_SPEC_CD WHERE GRP_CD = 'E00005' AND CD = TR.RACE_DGRE_CD ) RACE_DGRE_NM
			       , TR.ST_MTHD_CD        -- ST방법코드
			       , ( SELECT CD_NM FROM TBEA_SPEC_CD WHERE GRP_CD = 'E00002' AND CD = TR.ST_MTHD_CD   ) ST_MTHD_NM
			       , TR.STRT_TIME         -- 출발시간    
			       , TR.RACE_REG_NO_CNT   -- 정번수      
			       , TR.RACE_DIST         -- 경주거리    
			       , TR.TURN_CNT          -- 주회수      
			       , TR.RACE_END_YN       -- 경주마감여부
			       , TR.RACE_STTS_CD      -- 경주상황코드
			FROM   TBEB_RACE  TR
			WHERE  TR.STND_YEAR = ?
			AND    TR.MBR_CD    = ?
			AND    TR.TMS       = ?
			AND    TR.DAY_ORD   = ?
			ORDER BY TR.STND_YEAR
			       , TR.TMS
			       , TR.DAY_ORD
			       , TR.RACE_NO
        ]]>
    </query> 
    <query id="common_cur_race_fb001_backup" desc="조회" fetchSize="10">
        <![CDATA[
			SELECT 
			         TRT .STND_YEAR
			       , TRT .MBR_CD
			       , TRT .TMS
			       , TRT .QURT_CD
			       , TRT .MONTH
			       , TRT .STR_DT
			       , TRT .END_DT
			       , TRT .CFRNT_CD
			       , TRT .RMK
			       , TRT .RACE_TMS_STAT_CD
			       , TRDO.DAY_ORD
			       , TRDO.RACE_DAY
			       , DECODE(RACE_DAY, TO_CHAR(SYSDATE, 'YYYYMMDD'), 'TRUE', 'FALSE') CURDATE
			FROM     TBEB_RACE_TMS     TRT
			       , TBEB_RACE_DAY_ORD TRDO
			WHERE  TRT .STND_YEAR = TRDO.STND_YEAR
            AND    TRT .MBR_CD    = ?
			AND    TRT .TMS       = TRDO.TMS
			AND    TRT .STND_YEAR = TO_CHAR(SYSDATE, 'YYYY')
			AND    TRT .TMS       = NVL((
			                            SELECT TMS 
			                            FROM   TBEB_RACE_TMS
			                            WHERE  STND_YEAR = TO_CHAR(SYSDATE, 'YYYY')
			                            AND    TO_CHAR(SYSDATE, 'YYYYMMDD') BETWEEN STR_DT
			                                                                    AND END_DT
			                            AND    ROWNUM = 1
			                        ), (
			                            SELECT MIN(TMS) 
			                            FROM   TBEB_RACE_TMS
			                            WHERE  STND_YEAR = TO_CHAR(SYSDATE, 'YYYY')
			                            AND    TO_CHAR(SYSDATE, 'YYYYMMDD') < END_DT
			                        ))
			ORDER BY TRT .STND_YEAR
			       , TRT .TMS
			       , TRDO.DAY_ORD
        ]]>
    </query>
    <query id="common_cur_race_fb001" desc="조회" fetchSize="10">
        <![CDATA[
			SELECT
			      TRT .STND_YEAR
			    , TRT .MBR_CD
			    , TRT .TMS
			    , TRT .QURT_CD
			    , TRT .MONTH
			    , TRT .STR_DT
			    , TRT .END_DT
			    , TRT .CFRNT_CD
			    , TRT .RMK
			    , TRT .RACE_TMS_STAT_CD
			    , TRDO.DAY_ORD
			    , TRDO.RACE_DAY
			    , DECODE(RACE_DAY, TO_CHAR(SYSDATE, 'YYYYMMDD'), 'TRUE', 'FALSE') CURDATE
			  FROM     TBEB_RACE_TMS     TRT
			         , TBEB_RACE_DAY_ORD TRDO
			  WHERE  TRT .STND_YEAR = TRDO.STND_YEAR
			  AND    TRT .MBR_CD    = TRDO.MBR_CD
			  AND    TRT .TMS       = TRDO.TMS
			  AND    TRT .MBR_CD    = ?
			  AND    TRT .STND_YEAR||LPAD(TRT .TMS,3, '0')  = NVL((
			                              SELECT STND_YEAR||LPAD(TMS,3,'0') 
			                              FROM   TBEB_RACE_TMS
			                              WHERE  TO_CHAR(SYSDATE, 'YYYYMMDD') BETWEEN STR_DT
			                                                                      AND END_DT
			                              AND    ROWNUM = 1
			                          ), (
			                              SELECT MAX(STND_YEAR||LPAD(TMS,3,'0'))  
			                              FROM   TBEB_RACE_TMS
			                          ))
			  ORDER BY TRT .STND_YEAR
			         , TRT .TMS
			         , TRDO.DAY_ORD
        ]]>
    </query>
    
    <query id="common_raceday_fb001" desc="조회" fetchSize="10">
        <![CDATA[
  		   SELECT /* common_raceday_fb001 */
  			      RACE_DAY
  			     ,TO_CHAR (TO_DATE (RACE_DAY, 'YYYYMMDD'),
                           'DY',
                           'NLS_DATE_LANGUAGE = ENGLISH'
                         ) DY
                 ,TO_CHAR (TO_DATE (RACE_DAY, 'YYYYMMDD'),
                           'DY',
                           'NLS_DATE_LANGUAGE = KOREAN'
                         ) DY_HAN
             FROM TBEB_RACE_DAY_ORD
            WHERE STND_YEAR = ?
              AND MBR_CD    = ?
              AND TMS       = ?
              AND DAY_ORD   = ?
        ]]>
    </query>
</queryMap>
