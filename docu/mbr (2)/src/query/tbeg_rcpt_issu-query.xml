<?xml version="1.0" encoding='EUC-KR'?>
<queryMap desc="tbeg_rcpt_issu 사업소득원천징수영수증 발급">
    <query id="tbeg_rcpt_issu_ff001" desc="사업기타소득내역 조회" fetchSize="10">
        <![CDATA[
		SELECT		/* tbeg_rcpt_issu_ff001 */
		             A.SEQ		      													
					,A.ISSU_YEAR       													
					,A.ISSU_SEQ        													
					,A.RACER_NO   														
					,B.NM_KOR															
					,GET_DEC(C.RES_NO)								AS RES_NO			
					,C.CELPON_NO														
					,TO_CHAR(A.INST_DT, 'YYYY-MM-DD HH:MI:SS')		AS INST_DT 			
					,A.USES_CONT														
					,A.PROG_STAT														
					,A.DISPOSAL_ID														
					,D.USER_NM															
					,TO_CHAR(A.DISPOSAL_DT, 'YYYY-MM-DD HH:MI:SS')	AS DISPOSAL_DT		
					,A.RJT_RS															
		FROM		 TBEG_RCPT_ISSU       A												
					,TBEC_RACER_MASTER    B												
					,TBEC_RACER_DETAIL    C												
					,VWEA_USER            D												
		WHERE		TRIM(A.RACER_NO)      = B.RACER_NO									
		AND			TRIM(A.RACER_NO)      = C.RACER_NO									
		AND			A.DISPOSAL_ID         = D.USER_ID(+)								
		AND 		TO_CHAR(A.INST_DT,'YYYYMMDD') BETWEEN ? AND ? 											
		ORDER BY 	INST_DT DESC 
        ]]>
    </query>
	<query id="tbeg_rcpt_issu_fu001" desc="사업소득원천징수영수증 발급신청 승인" fetchSize="10">
        <![CDATA[ 
        	UPDATE		TBEG_RCPT_ISSU
			SET			ISSU_SEQ			= (
												SELECT      NVL(MAX(ISSU_SEQ), 0) + 1
												FROM        TBEG_RCPT_ISSU
												WHERE       ISSU_YEAR = ?
											   )
						,PROG_STAT			= ?
						,DISPOSAL_ID		= ?
						,DISPOSAL_DT		= sysdate
						,PDF_FILE_NM		= ?
						,PDF_UPDT_DT		= sysdate
						,RJT_RS				= ''
						,UPDT_ID			= ?
						,UPDT_DT			= sysdate
			WHERE		SEQ					= ?
          ]]>        
    </query>
    
    <query id="tbeg_rcpt_issu_fu002" desc="사업소득원천징수영수증 발급신청 반려" fetchSize="10">
        <![CDATA[ 
        	UPDATE		TBEG_RCPT_ISSU
			SET			PROG_STAT			= ?
						,DISPOSAL_ID		= ?
						,DISPOSAL_DT		= sysdate
						,RJT_RS				= ?
						,UPDT_ID			= ?
						,UPDT_DT			= sysdate
			WHERE		SEQ					= ?
          ]]>        
    </query>
</queryMap>