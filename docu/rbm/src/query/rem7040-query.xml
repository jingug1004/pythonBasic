<?xml version="1.0" encoding='EUC-KR'?>

<queryMap desc="rem7040 매출현황(발매기별)">
  
    <query id="rem7040_s01" desc="지정좌석실 매출현황(발매기별)" fetchSize="10">
      <![CDATA[
            WITH SEAT_NUM AS (	--발매기수 /*rem7040_s01 */
				SELECT
					COMM_NO, COUNT(DISTINCT WIN_NO) WIN_CNT
				FROM TBJI_PC_TELMP_FIXEDSEAT
				WHERE 1=1
				AND RACE_DAY BETWEEN ? AND ?
				AND GRN_ZN_CD IN ('002','003')
				GROUP BY COMM_NO
				ORDER BY COMM_NO
			),
			SALES_FIXED AS (	--지정좌석실 매출액
				SELECT
					RACE_DAY, COMM_NO,
					SUM(DECODE(WIN_TYPE,'1',AMT,0)) CASH_MAN_AMT_FIXED,
					SUM(DECODE(WIN_TYPE,'3',AMT,0)) CASH_MCN_AMT_FIXED,
					SUM(DECODE(WIN_TYPE,'14',AMT,0)) GREEN_AMT_FIXED,
					SUM(AMT) TOT_AMT_FIXED
				FROM TBJI_PC_TELMP_FIXEDSEAT
				WHERE 1=1
				AND RACE_DAY BETWEEN ? AND ?
				AND GRN_ZN_CD IN ('002','003')
				GROUP BY RACE_DAY, COMM_NO
			)
			
			
			SELECT
				DECODE(COMM_NO, '98', '09', COMM_NO) ORD_NO,
				COMM_NO,
				FC_CODE_NM('018',COMM_NO) COMM_NM,
				WIN_CNT,
			
				ROUND(TOT_AMT_FIXED_TOT/SALES_DAY_CNT,0) TOT_AMT_FIXED_AVG,
				ROUND(CASH_MAN_AMT_FIXED_TOT/SALES_DAY_CNT,0) CASH_MAN_AMT_FIXED_AVG,
				ROUND(CASH_MCN_AMT_FIXED_TOT/SALES_DAY_CNT,0) CASH_MCN_AMT_FIXED_AVG,
				ROUND(GREEN_AMT_FIXED_TOT/SALES_DAY_CNT,0) GREEN_AMT_FIXED_AVG,
				SALES_DAY_CNT,
			
				CASH_MAN_AMT_FIXED_TOT,
				CASH_MAN_AMT_FIXED_WED,
				CASH_MAN_AMT_FIXED_THU,
				CASH_MAN_AMT_FIXED_FRI,
				CASH_MAN_AMT_FIXED_SAT,
				CASH_MAN_AMT_FIXED_SUN,
			
				CASH_MCN_AMT_FIXED_TOT,
				CASH_MCN_AMT_FIXED_WED,
				CASH_MCN_AMT_FIXED_THU,
				CASH_MCN_AMT_FIXED_FRI,
				CASH_MCN_AMT_FIXED_SAT,
				CASH_MCN_AMT_FIXED_SUN,
			
				GREEN_AMT_FIXED_TOT,
				GREEN_AMT_FIXED_WED,
				GREEN_AMT_FIXED_THU,
				GREEN_AMT_FIXED_FRI,
				GREEN_AMT_FIXED_SAT,
				GREEN_AMT_FIXED_SUN,
			
				TOT_AMT_FIXED_TOT,
				TOT_AMT_FIXED_WED,
				TOT_AMT_FIXED_THU,
				TOT_AMT_FIXED_FRI,
				TOT_AMT_FIXED_SAT,
				TOT_AMT_FIXED_SUN
			
			FROM (
				SELECT T1.COMM_NO,
					MAX(WIN_CNT) WIN_CNT,
			
					NVL(SUM(CASH_MAN_AMT_FIXED),0.001) CASH_MAN_AMT_FIXED_TOT,
					NVL(SUM(DECODE(RACE_YOIL, 'WED', CASH_MAN_AMT_FIXED)),0) CASH_MAN_AMT_FIXED_WED,
					NVL(SUM(DECODE(RACE_YOIL, 'THU', CASH_MAN_AMT_FIXED)),0) CASH_MAN_AMT_FIXED_THU,
					NVL(SUM(DECODE(RACE_YOIL, 'FRI', CASH_MAN_AMT_FIXED)),0) CASH_MAN_AMT_FIXED_FRI,
					NVL(SUM(DECODE(RACE_YOIL, 'SAT', CASH_MAN_AMT_FIXED)),0) CASH_MAN_AMT_FIXED_SAT,
					NVL(SUM(DECODE(RACE_YOIL, 'SUN', CASH_MAN_AMT_FIXED)),0) CASH_MAN_AMT_FIXED_SUN,
			
					NVL(SUM(CASH_MCN_AMT_FIXED),0.001) CASH_MCN_AMT_FIXED_TOT,
					NVL(SUM(DECODE(RACE_YOIL, 'WED', CASH_MCN_AMT_FIXED)),0) CASH_MCN_AMT_FIXED_WED,
					NVL(SUM(DECODE(RACE_YOIL, 'THU', CASH_MCN_AMT_FIXED)),0) CASH_MCN_AMT_FIXED_THU,
					NVL(SUM(DECODE(RACE_YOIL, 'FRI', CASH_MCN_AMT_FIXED)),0) CASH_MCN_AMT_FIXED_FRI,
					NVL(SUM(DECODE(RACE_YOIL, 'SAT', CASH_MCN_AMT_FIXED)),0) CASH_MCN_AMT_FIXED_SAT,
					NVL(SUM(DECODE(RACE_YOIL, 'SUN', CASH_MCN_AMT_FIXED)),0) CASH_MCN_AMT_FIXED_SUN,
			
					NVL(SUM(GREEN_AMT_FIXED),0) GREEN_AMT_FIXED_TOT,
					NVL(SUM(DECODE(RACE_YOIL, 'WED', GREEN_AMT_FIXED)),0) GREEN_AMT_FIXED_WED,
					NVL(SUM(DECODE(RACE_YOIL, 'THU', GREEN_AMT_FIXED)),0) GREEN_AMT_FIXED_THU,
					NVL(SUM(DECODE(RACE_YOIL, 'FRI', GREEN_AMT_FIXED)),0) GREEN_AMT_FIXED_FRI,
					NVL(SUM(DECODE(RACE_YOIL, 'SAT', GREEN_AMT_FIXED)),0) GREEN_AMT_FIXED_SAT,
					NVL(SUM(DECODE(RACE_YOIL, 'SUN', GREEN_AMT_FIXED)),0) GREEN_AMT_FIXED_SUN,
			
					NVL(SUM(TOT_AMT_FIXED),0) TOT_AMT_FIXED_TOT,
					NVL(SUM(DECODE(RACE_YOIL, 'WED', TOT_AMT_FIXED)),0) TOT_AMT_FIXED_WED,
					NVL(SUM(DECODE(RACE_YOIL, 'THU', TOT_AMT_FIXED)),0) TOT_AMT_FIXED_THU,
					NVL(SUM(DECODE(RACE_YOIL, 'FRI', TOT_AMT_FIXED)),0) TOT_AMT_FIXED_FRI,
					NVL(SUM(DECODE(RACE_YOIL, 'SAT', TOT_AMT_FIXED)),0) TOT_AMT_FIXED_SAT,
					NVL(SUM(DECODE(RACE_YOIL, 'SUN', TOT_AMT_FIXED)),0) TOT_AMT_FIXED_SUN,
					
					SUM(DECODE(TOT_AMT_FIXED,0,0,1)) SALES_DAY_CNT
			
				FROM SEAT_NUM T1, SALES_FIXED T5, VW_SDL_INFO T6
				WHERE 1=1
				AND T6.RACE_DAY = T5.RACE_DAY
				AND T1.COMM_NO = T5.COMM_NO(+)   
				AND T6.MEET_CD IN ('001','003')
				AND LENGTH(ROUND(TO_NUMBER(SUBSTR(T6.MEET_CD,3,1))/3,5)) =
					( CASE WHEN ? = '003' THEN 1 --경정
						   WHEN ? = '001' THEN 6 --경륜
						   ELSE LENGTH(ROUND(TO_NUMBER(SUBSTR(T6.MEET_CD,3,1))/3,5)) --전체
						   END
					)
				GROUP BY T1.COMM_NO
			)
			ORDER BY 1
        ]]>
    </query> 
    
</queryMap>