<?xml version="1.0" encoding='EUC-KR'?>


<queryMap desc="REV1040(평가배분표생성)">
    
    <query id="rev1040_s01" desc="그리드조회" fetchSize="10">
        <![CDATA[			
			SELECT   /* rev1040_s01 */  
			         A.ESTM_YEAR,      -- 평가년도
	                 A.ESTM_NUM,       -- 평가회차
			         A.DISTR_CD,      -- 배분표 코드
			         A.ESTM_OBJ_NUM,  -- 평가대상인원수 
			         A.S_GRD_NUM,	  -- S인원수 		 		         
			         A.A_GRD_NUM,     -- A인원수
			         A.B_GRD_NUM,     -- B인원수
			         A.C_GRD_NUM,     -- C인원수
			         A.D_GRD_NUM,      -- D인원수
			         '0' AS RIDX,
			         '0' AS CHK
			FROM     TBRF_EV_DISTR A
			WHERE    A.ESTM_YEAR = ?
			AND      A.ESTM_NUM = ?         -- 1.년도/회차    
			ORDER BY A.ESTM_YEAR, A.ESTM_NUM, A.DISTR_CD    
        ]]>
    </query>    
    
    
    <query id="rev1040_i01" desc="평가배분표입력" fetchSize="10">
        <![CDATA[
        
	        INSERT   /* rev1040_i01  */ 
	        INTO     TBRF_EV_DISTR A
	        (	         
	         A.ESTM_YEAR,      -- 평가년도
	         A.ESTM_NUM,       -- 평가회차
	         A.DISTR_CD,       -- 배분표코드
	         A.ESTM_OBJ_NUM,   -- 평가대상인원수
	         A.S_GRD_NUM,	   -- S인원수      
	         A.A_GRD_NUM,      -- A인원수
	         A.B_GRD_NUM,      -- B인원수
	         A.C_GRD_NUM,      -- C인원수
	         A.D_GRD_NUM,      -- D인원수
	         A.INST_ID,	       -- 작성자 ID   
	         A.INST_DT         -- 작성일시
	        ) VALUES (
			      ?,             -- 1.현재평가년도
			      ?,             -- 2.현재평가회차
			      (
			       SELECT   NVL(
			                    LPAD(MAX(TO_NUMBER(A.DISTR_CD)) + 1, 4, '0'), 
			                    LPAD(?, 3, '0') ||'1'   -- 3.평가대상인원수
			                   )  
				   FROM     TBRF_EV_DISTR A
				   WHERE    A.ESTM_YEAR    = ?   -- 4.평가년도
				   AND      A.ESTM_NUM     = ?   -- 5.평가회차
				   AND      A.ESTM_OBJ_NUM = ?   -- 6.평가대상인원수 
				  ),				
			      ?,         -- 7.평가대상인원수  	
			      NVL(?, 0), -- 8. S인원수 				    	
			      NVL(?, 0), -- 9. A인원수
			      NVL(?, 0), -- 10.B인원수		    
			      NVL(?, 0), -- 11.C인원수			    
			      NVL(?, 0), -- 12.D인원수		    
			      ?,         -- 13. 사용자 ID
			      SYSDATE
			)
        ]]>
    </query>       

    <query id="rev1040_u01" desc="평가배분표수정" fetchSize="10">
        <![CDATA[
			UPDATE   /* rev1030_upt */
			         TBRF_EV_DISTR A
			SET      A.S_GRD_NUM = ?,	    -- 1. S인원수 		  
				     A.A_GRD_NUM = ?,       -- 2. A인원수
				     A.B_GRD_NUM = ?,       -- 3. B인원수		
				     A.C_GRD_NUM = ?,       -- 4. C인원수	
				     A.D_GRD_NUM = ?,       -- 5. D인원수	
					 A.UPDT_ID   = ?,		-- 6. 사용자 ID		
					 A.UPDT_DT   = SYSDATE
			WHERE    A.ESTM_YEAR    = ?     -- 7. 평가년도
			AND      A.ESTM_NUM     = ?     -- 8. 평가회차
			AND      A.DISTR_CD     = ?     -- 9. 배분표코드
			AND      A.ESTM_OBJ_NUM = ?     -- 10.평가대상인원수 
        ]]>
    </query>       

    <query id="rev1040_d01" desc="평가배분표삭제" fetchSize="10">
        <![CDATA[
			DELETE   /* rev1040_d01 */ 
			         TBRF_EV_DISTR A
			WHERE    A.ESTM_YEAR    = ?   -- 1.평가년도
			AND      A.ESTM_NUM     = ?   -- 2.평가회차
			AND      A.DISTR_CD     = ?   -- 3.배분표코드
			AND      A.ESTM_OBJ_NUM = ?   -- 4.평가대상인원수     
        ]]>
    </query>    
    
    <query id="rev1040_delete" desc="평가배분표삭제" fetchSize="10">
        <![CDATA[
			DELETE   /* rev1040_delete */ 
			         TBRF_EV_DISTR A
			WHERE    A.ESTM_YEAR    = ?   -- 1.평가년도
			AND      A.ESTM_NUM     = ?   -- 2.평가회차
        ]]>
    </query> 
</queryMap>