<?xml version="1.0" encoding='EUC-KR'?>


<queryMap desc="REV3110(서비스평가)">
    
    <query id="rev3110_s01" desc="서비스 평가 조회" fetchSize="10">
        <![CDATA[		
            SELECT   /* rev3110_s01 */
                     A.ESTM_YEAR,
                     A.ESTM_NUM,
                     D.DEPT_NM ESTM_DEPT_NM,
                     C.ESTM_SCR AS SRV_SCR,
                     A.EMP_NO,
                     E.EMP_NM AS EMP_NM, 
                     E.ESTM_WK_JOB, 
                     (SELECT WK_JOB_NM FROM TBRF_EV_WORK_JOB WHERE ESTM_YEAR = E.ESTM_YEAR AND ESTM_NUM = E.ESTM_NUM AND WK_JOB_CD = E.ESTM_WK_JOB) AS WK_JOB_NM,
                     A.ESTM_EMP,
                     (SELECT EMP_NM FROM TBRF_EV_EMP F WHERE F.ESTM_YEAR = A.ESTM_YEAR AND F.ESTM_NUM = A.ESTM_NUM AND F.ESTM_DEPT = A.ESTM_DEPT AND E.EMP_NO = A.ESTM_EMP) AS ESTM_EMP_NM,
                     B.ESTM_LITEM_NM,
                     B.ESTM_SCR,
                     B.FST_SND_GBN,
                     A.CNT,
                     B.HI_CNT,
                     B.BEST_SCR,
                     B.STND_SCR,
                     A.ATT_FILE_KEY,
                     DECODE(SIGN((SELECT COUNT(*) FROM TBRK_FILE_MANA WHERE ATT_FILE_KEY = A.ATT_FILE_KEY)),1,'유','') AS FILE_CNT
            FROM     TBRF_EV_WK_SRV_DT A,
                     TBRF_EV_LARGE_ITEM B,
                     TBRF_EV_WK_SRV C,
                     TBRF_EV_DEPT D,
                     TBRF_EV_EMP E
            WHERE    A.ESTM_YEAR = B.ESTM_YEAR 
            AND      A.ESTM_NUM  = B.ESTM_NUM
            AND      A.ESTM_LITEM_CD = B.ESTM_LITEM_CD
            AND      A.ESTM_YEAR = C.ESTM_YEAR
            AND      A.ESTM_NUM  = C.ESTM_NUM
            AND      A.ESTM_DEPT = C.ESTM_DEPT
            AND      A.EMP_NO    = C.EMP_NO
            AND      A.ESTM_YEAR = D.ESTM_YEAR
            AND      A.ESTM_NUM  = D.ESTM_NUM
            AND      A.ESTM_DEPT = D.DEPT_CD
            AND      A.ESTM_YEAR = E.ESTM_YEAR 
            AND      A.ESTM_NUM  = E.ESTM_NUM 
            AND      A.ESTM_DEPT = E.ESTM_DEPT 
            AND      A.EMP_NO    = E.EMP_NO 
            AND      B.ESTM_ITEM_CD = '3'    
            AND      A.ESTM_YEAR = ?
            AND      A.ESTM_NUM  = ?
            AND      A.ESTM_DEPT LIKE ?||'%'
            AND      E.EMP_NM    LIKE ?||'%'
            AND      NVL(A.CNT,0) > DECODE(?, '0', -1, '1', 0)
            ORDER BY A.ESTM_DEPT, A.EMP_NO, A.ESTM_LITEM_CD
        ]]>
    </query>
    
</queryMap>