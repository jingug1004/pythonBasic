<?xml version="1.0" encoding='EUC-KR'?>

<queryMap desc="rbs4010(보고서 관리 )">
    <query id="rbs4010_s01" desc="보고서 조회" fetchSize="10">
      <![CDATA[
            SELECT /* rbs4010_s01 */
                 '0' AS CHK
                 
                ,DEPT_CD         --부서코드
                ,STND_YEAR       --년도
                ,SEQ             --순번
                ,REQ_DT          --요청일자
                ,SUBM_LIMIT_DT   --제출기한일자
                
                ,REPORT_NM       --보고서명칭
                ,INST_GUIDE      --작성지침
                ,SAMP_YN         --양식여부
                ,ATT_FILE_KEY    --첨부파일키
                ,RMK             --비고
                
                
                ,INST_ID         --작성자
                ,INST_DT         --작성일시
                ,UPDT_ID         --수정자
                ,UPDT_DT         --수정일시

            FROM  TBRE_REPORT_MANA      --보고서  

            WHERE 1 = 1
                AND DEL_YN = 'N'
                AND DEPT_CD = ?                                         --부서코드
                AND REQ_DT >= NVL(? , '19000101')                       --요청일자(시작)
                AND REQ_DT <= NVL(? , '99991231')                       --요청일자(종료)
                AND REPORT_NM LIKE  '%' || NVL(? , REPORT_NM) || '%'    --보고서명
                AND SEQ LIKE  '%' || NVL(? , SEQ) || '%'                --보고서순번
            ORDER BY REQ_DT DESC

        ]]>
    </query>       
    
   <query id="rbs4010_s02" desc="보고서담당자  조회" fetchSize="10">
      <![CDATA[
            SELECT /* rbs4010_s02 */
                 '0' AS CHK
                 
                ,A.DEPT_CD                  --부서코드
                ,A.STND_YEAR                --년도
                ,A.SEQ                      --순번
                
                ,A.MNG_ID                   --담당자ID
                ,B.USER_NM MNG_NM           --담당자명
                ,A.MNG_DEPT_CD              --담당자부서코드
                ,B.TEAM_NM MNG_DEPT_NM      --담당자부서명
                
                ,A.SUBM_DT                  --제출일자
                ,A.ATT_FILE_KEY             --첨부파일키
                ,A.REPORT_CONT              --보고내용
                ,A.UPDT_ID                  --수정자
                ,A.UPDT_DT                  --수정일시



            FROM  TBRE_REPORT_MNG A      --보고서담당자
                  ,TBRK_USER B             --사용자
            WHERE A.MNG_ID = B.USER_ID
                AND A.DEL_YN = 'N'
                AND A.DEPT_CD = ?         --부서코드
                AND A.STND_YEAR = ?       --년도
                AND A.SEQ = ?             --순번 
            
        ]]>
    </query>
    
    <query id="rbs4010_s03" desc="보고서 MAXID 조회 " fetchSize="10">
        <![CDATA[
            SELECT  NVL(MAX(SEQ),0) + 1  SEQ /* rbs4010_s03 */ 
              FROM  TBRE_REPORT_MANA  
             WHERE  DEPT_CD = ?         --부서코드
                AND STND_YEAR = ?       --년도
        ]]>
    </query>
    
    
    <query id="rbs4010_s04" desc="보고서샘플 조회" fetchSize="10">
      <![CDATA[
            SELECT /* rbs4010_s04 */
                 '0' AS CHK
                 
                ,DEPT_CD         --부서코드
                ,STND_YEAR       --년도
                ,SEQ             --순번
                ,REQ_DT          --요청일자
                ,SUBM_LIMIT_DT   --제출기한일자
                
                ,REPORT_NM       --보고서명칭
                ,INST_GUIDE      --작성지침
                ,SAMP_YN         --양식여부
                ,ATT_FILE_KEY    --첨부파일키
                ,RMK             --비고
                
                
                ,INST_ID         --작성자
                ,INST_DT         --작성일시
                ,UPDT_ID         --수정자
                ,UPDT_DT         --수정일시

            FROM  TBRE_REPORT_MANA      --첨부파일관리 

            WHERE 1 = 1
                AND DEL_YN = 'N'
                AND DEPT_CD = ?                                         --부서코드
                AND REQ_DT >= NVL(? , '19000101')                       --요청일자(시작)
                AND REQ_DT <= NVL(? , '99991231')                       --요청일자(종료)
                AND REPORT_NM LIKE  '%' || NVL(? , REPORT_NM) || '%'    --보고서명
                AND SAMP_YN = 'Y'        --양식여부 

        ]]>
    </query>  
    
   <query id="rbs4010_s05" desc="보고서 조회" fetchSize="10">
      <![CDATA[
            SELECT /* rbs4010_s01 */
                 '0' AS CHK
                 
                ,DEPT_CD         --부서코드
                ,STND_YEAR       --년도
                ,SEQ             --순번
                ,REQ_DT          --요청일자
                ,SUBM_LIMIT_DT   --제출기한일자
                
                ,REPORT_NM       --보고서명칭
                ,INST_GUIDE      --작성지침
                ,SAMP_YN         --양식여부
                ,ATT_FILE_KEY    --첨부파일키
                ,RMK             --비고
                
                
                ,INST_ID         --작성자
                ,INST_DT         --작성일시
                ,UPDT_ID         --수정자
                ,UPDT_DT         --수정일시

            FROM  TBRE_REPORT_MANA      --첨부파일관리 

            WHERE 1 = 1
                AND DEL_YN = 'N'
                AND DEPT_CD = ?    --부서코드
                AND STND_YEAR = ?  --년도
                AND SEQ = ?        --순번 


        ]]>
    </query>         
    <query id="rbs4010_i01" desc="보고서 입력" fetchSize="10">

            INSERT INTO TBRE_REPORT_MANA (  /* rbs4010_i01 */   -- 보고서관리 

                 DEPT_CD         --부서코드
                ,STND_YEAR       --년도
                ,SEQ             --순번
                ,REQ_DT          --요청일자
                ,SUBM_LIMIT_DT   --제출기한일자
                
                ,REPORT_NM       --보고서명칭
                ,INST_GUIDE      --작성지침
                ,SAMP_YN         --양식여부
                ,ATT_FILE_KEY    --첨부파일키
                ,RMK             --비고
                
                
                ,DEL_YN          --삭제여부
                ,INST_ID         --작성자
                ,INST_DT         --작성일시

            ) VALUES (

                  ?             -- DEPT_CD
                , ?             -- STND_YEAR
                , ?             -- SEQ
                , ?             -- REQ_DT
                , ?             -- SUBM_LIMIT_DT

                , ?             -- REPORT_NM
                , ?             -- INST_GUIDE               
                , ?             -- SAMP_YN  
                , ?             -- ATT_FILE_KEY               
                , ?             -- RMK                 
                           
                ,'N'            -- DEL_YN           
                , ?             -- INST_ID              
                , SYSDATE       -- INST_DT

            )

    </query> 
    
    <query id="rbs4010_u01" desc="보고서 수정" fetchSize="10">

        <![CDATA[

            UPDATE TBRE_REPORT_MANA SET  /* rbs4010_u01 */


                 REQ_DT = ?          --요청일자
                ,SUBM_LIMIT_DT = ?   --제출기한일자
                ,REPORT_NM = ?       --보고서명칭
                ,INST_GUIDE = ?      --작성지침
                ,SAMP_YN = ?         --양식여부
                
                ,ATT_FILE_KEY = ?    --첨부파일키
                ,RMK = ?             --비고               
                ,UPDT_ID = ?         --수정자
                ,UPDT_DT = SYSDATE   --수정일시

            WHERE DEPT_CD = ?           --부서코드
                AND STND_YEAR = ?       --년도
                AND SEQ = ?             --순번
        ]]>

    </query>    

    <query id="rbs4010_d01" desc="보고서 삭제" fetchSize="10">

        <![CDATA[

            UPDATE TBRE_REPORT_MANA SET   /* rbs4010_d01 */
                    DEL_YN = 'Y' 
            WHERE DEPT_CD = ?           --부서코드
                AND STND_YEAR = ?       --년도
                AND SEQ = ?             --순번

        ]]>

    </query>      
    
 

    <query id="rbs4010_m01" desc="보고서담당자  입력" fetchSize="10"> 
          MERGE INTO TBRE_REPORT_MNG  A /* rbs4010_i02 */
            USING   
                    (SELECT
                         ? AS DEPT_CD           --부서코드
                        ,? AS STND_YEAR         --년도
                        ,? AS SEQ               --순번
                        ,? AS MNG_ID            --담당자ID              
                        ,? AS MNG_DEPT_CD       --담당자부서코드
                    FROM    DUAL ) B  
                
            ON (    
                         A.DEPT_CD = B.DEPT_CD          -- 부서코드
                    AND  A.STND_YEAR = B.STND_YEAR      -- 년도
                    AND  A.SEQ = B.SEQ                  -- 순번
                    AND  A.MNG_ID = B.MNG_ID            -- 담당자ID                    
            )           
            
            WHEN MATCHED THEN
                UPDATE SET
                      A.MNG_DEPT_CD    = B.MNG_DEPT_CD  --담당자부서코드         
                     ,A.DEL_YN         = 'N'            --삭제여부 
            WHEN NOT MATCHED THEN 
                INSERT (
                     A.DEPT_CD       --부서코드
                    ,A.STND_YEAR     --년도
                    ,A.SEQ           --순번
                    ,A.MNG_ID        --담당자ID
                    ,A.MNG_DEPT_CD   --담당자부서코드
                    ,A.DEL_YN        --삭제여부
                ) VALUES (
                     B.DEPT_CD       --부서코드
                    ,B.STND_YEAR     --년도
                    ,B.SEQ           --순번
                    ,B.MNG_ID        --담당자ID
                    ,B.MNG_DEPT_CD   --담당자부서코드
                    ,'N'             --삭제여부
                )
    </query> 

    <query id="rbs4010_d02" desc="보고서담당자  삭제" fetchSize="10">

        <![CDATA[

            UPDATE TBRE_REPORT_MNG SET  /* rbs4010_d02  */
                DEL_YN = 'Y'
            WHERE DEPT_CD = ?           --부서코드
                AND STND_YEAR = ?       --년도
                AND SEQ = ?             --순번
                AND MNG_ID = ?          --담당자ID
        ]]>

    </query>    
    
    <query id="rbs4010_u03" desc=" 보고서  첨부파일  정보 수정" fetchSize="10">

        <![CDATA[
            UPDATE TBRE_REPORT_MANA SET  /* rbs4010_u03 */
                 
                 ATT_FILE_KEY = ?       --첨부파일키             
                ,UPDT_ID = ?            --수정자
                ,UPDT_DT = SYSDATE      --수정일시
                
            WHERE DEPT_CD = ?           --부서코드
                AND STND_YEAR = ?       --년도
                AND SEQ = ?             --순번
        ]]>

    </query>     
    

</queryMap>