<?xml version="1.0" encoding='EUC-KR'?>

<queryMap desc="rsy5010(게시판)">

    <query id="rsy5010_s01" desc="LIST쿼리" fetchSize="10">

        <![CDATA[

            SELECT 	/* rsy5010_s01 */
                  ROW_ID
                , CLS_CD
                , SEQ_NO
                , GRP_NO
                , GRP_RANK_NO
                , GRP_LOW_NO 
                , MAKE_MAN   
                , TITLE      
                , SHOWTITLE  
                , BORD_DESC  
                , SRCH_CNT   
                , PROG_STAT  
                , DEL_YN     
                , INST_ID    
                , INST_DT
                , UPDT_ID
                , UPDT_DT
            FROM (SELECT 
                         ROW_ID
                        , ROWNUM RN
                        , CLS_CD
                        , SEQ_NO                              
                        , GRP_NO
                        , GRP_RANK_NO
                        , GRP_LOW_NO 
                        , MAKE_MAN   
                        , TITLE
                        , LPAD('  ',GRP_RANK_NO *2,'  ')||TITLE SHOWTITLE                         
                        , BORD_DESC                            
                        , SRCH_CNT                             
                        , PROG_STAT                            
                        , DEL_YN                                                    
                        , INST_ID                                                   
                        , TO_CHAR(INST_DT,'YYYYMMDD') INST_DT                       
                        , UPDT_ID                                                   
                        , TO_CHAR(UPDT_DT,'YYYYMMDD') UPDT_DT                       
                    FROM (SELECT 
                                   ROW_NUMBER() OVER(ORDER BY GRP_NO , GRP_LOW_NO DESC) ROW_ID
                                ,  CLS_CD
                                , SEQ_NO
                                , GRP_NO
                                , GRP_RANK_NO
                                , GRP_LOW_NO
                                , MAKE_MAN
                                , TITLE
                                , BORD_DESC
                                , SRCH_CNT
                                , PROG_STAT
                                , DEL_YN
                                , INST_ID
                                , INST_DT
                                , UPDT_ID
                                , UPDT_DT
                            FROM TBRK_BORD
                            WHERE DEL_YN    = ?
                            AND CLS_CD      = ?
                            AND TITLE        LIKE NVL('%' || ? || '%', TITLE)
                            AND BORD_DESC   LIKE NVL('%' || ? || '%', BORD_DESC)
                            AND MAKE_MAN    LIKE NVL('%' || ? || '%', MAKE_MAN)
                            AND SEQ_NO      =    NVL(?              , SEQ_NO)
                            ORDER BY GRP_NO DESC, GRP_LOW_NO ASC)
                    )                           
            WHERE RN BETWEEN (? - 1) * ? + 1 AND ? * ?
        ]]>

    </query>     

    

    <query id="rsy5010_s02" desc="카운트쿼리" fetchSize="10">

        <![CDATA[

            SELECT /* rsy5010_s02 */
                   COUNT(SEQ_NO) TOTCOUNT FROM TBRK_BORD

            WHERE   DEL_YN = ?

            AND     CLS_CD = ?

            AND     TITLE        LIKE NVL('%' || ? || '%', TITLE)

            AND     BORD_DESC   LIKE NVL('%' || ? || '%', BORD_DESC)

            AND     MAKE_MAN    LIKE NVL('%' || ? || '%', MAKE_MAN)

        ]]>

    </query>     

               

    <query id="rsy5010_s03" desc="SEQNOGET쿼리" fetchSize="10">

        <![CDATA[

            SELECT  /* rsy5010_s03 */

                  (SELECT NVL(MAX(SEQ_NO),0) + 1 FROM TBRK_BORD) NEXTSEQNO

                ,  NEXTFILESEQNO

            FROM DUAL

        ]]>

    </query> 

    

    <query id="rsy5010_s04" desc="파일정보가져오기쿼리" fetchSize="10">

        <![CDATA[

            SELECT /* rsy5010_s04 */
                  CLS_CD
                , SEQ_NO
                , FILE_SEQ
                , FILE_SIZE
                , FILE_NAME
                , FILE_URL
                , FILE_SIZE
                , INST_ID
                , INST_DT
                , UPDT_ID
                , UPDT_DT
                , 0 AS CHK
            FROM TBRK_BORD_ATMNT
            WHERE   CLS_CD      = ?
            AND     SEQ_NO      = ?
        ]]>

    </query>   

    

    <query id="rsy5010_i01" desc="답변쿼리" fetchSize="10">

        <![CDATA[

            INSERT INTO TBRK_BORD (

                  CLS_CD

                , SEQ_NO

                , GRP_NO

                , GRP_RANK_NO

                , GRP_LOW_NO

                , MAKE_MAN

                , TITLE

                , BORD_DESC

                , SRCH_CNT

                , PROG_STAT

                , DEL_YN

                , INST_ID

                , INST_DT

                , UPDT_ID

                , UPDT_DT

            ) VALUES (

                ?

                , (SELECT NVL(MAX(SEQ_NO),0) + 1 FROM TBRK_BORD)

                , ?

                , ?

                , ?

                , ?

                , ?

                , ?

                , ?

                , ?

                , ?

                , ?

                , SYSDATE

                , ?

                , SYSDATE

            )

        ]]>

    </query>   

    

     <query id="rsy5010_i02" desc="입력쿼리" fetchSize="10">

        <![CDATA[

            INSERT INTO TBRK_BORD (

                  CLS_CD

                , SEQ_NO

                , GRP_NO

                , GRP_RANK_NO

                , GRP_LOW_NO

                , MAKE_MAN

                , TITLE

                , BORD_DESC

                , SRCH_CNT

                , PROG_STAT

                , DEL_YN

                , INST_ID

                , INST_DT

                , UPDT_ID

                , UPDT_DT

            ) VALUES (

                ?

                , (SELECT NVL(MAX(SEQ_NO),0) + 1 FROM TBRK_BORD)

                , (SELECT NVL(MAX(SEQ_NO),0) + 1 FROM TBRK_BORD)

                , 0

                , 0

                , ?

                , ?

                , ?

                , ?

                , ?

                , ?

                , ?

                , SYSDATE

                , ?

                , SYSDATE

            )

        ]]>

    </query> 

    

    

    <query id="rsy5010_u01" desc="답변선작업쿼리" fetchSize="10">

        <![CDATA[

            UPDATE TBRK_BORD 

                SET GRP_LOW_NO = GRP_LOW_NO + 1 

            WHERE GRP_NO = ? 

            AND GRP_LOW_NO >= ? 

            AND GRP_RANK_NO != 0

        ]]>

    </query> 

    

    <query id="rsy5010_i04" desc="파일입력" fetchSize="10">

        <![CDATA[

            INSERT INTO TBRK_BORD_ATMNT (

                  CLS_CD

                , SEQ_NO

                , FILE_SEQ

                , FILE_NAME

                , FILE_URL

                , FILE_SIZE

                , INST_ID

                , INST_DT

                , UPDT_ID

                , UPDT_DT

            ) VALUES (

                  ?                 -- cls_cd

                , (SELECT NVL(MAX(SEQ_NO),0) FROM TBRK_BORD)                -- seq_no

                , (SELECT NVL(MAX(FILE_SEQ),0) + 1 FROM TBRK_BORD_ATMNT)    -- file_seq

                , ?                 -- file_name

                , ?                 -- file_url

                , ?                 -- file_size

                , ?                 -- inst_id

                , SYSDATE           -- inst_dtm

                , ?                 -- updt_id

                , SYSDATE           -- updt_dtm

            )

        ]]>

    </query>     

    

    <query id="rsy5010_i05" desc="파일입력" fetchSize="10">

        <![CDATA[

            INSERT INTO TBRK_BORD_ATMNT (

                  CLS_CD

                , SEQ_NO

                , FILE_SEQ

                , FILE_NAME

                , FILE_URL

                , FILE_SIZE

                , INST_ID

                , INST_DT

                , UPDT_ID

                , UPDT_DT

            ) VALUES (

                  ?                 -- cls_cd

                , ?             -- seq_no

                , (SELECT NVL(MAX(FILE_SEQ),0) + 1 FROM TBRK_BORD_ATMNT)    -- file_seq

                , ?                 -- file_name

                , ?                 -- file_url

                , ?                 -- file_size

                , ?                 -- inst_id

                , SYSDATE           -- inst_dtm

                , ?                 -- updt_id

                , SYSDATE           -- updt_dtm

            )

        ]]>

    </query> 

  

        

    <query id="rsy5010_u02" desc="수정쿼리" fetchSize="10">

        <![CDATA[

            UPDATE TBRK_BORD 

            SET TITLE = ?

                , BORD_DESC = ?

                , UPDT_ID = ?

                , UPDT_DT = SYSDATE

            WHERE SEQ_NO = ?    

        ]]>

    </query> 



    <query id="rsy5010_u03" desc="조회수증가쿼리" fetchSize="10">

        <![CDATA[

            UPDATE TBRK_BORD 

                SET SRCH_CNT = SRCH_CNT + 1

            WHERE SEQ_NO = ?

        ]]>

    </query> 

        

    <query id="rsy5010_d01" desc="삭제쿼리" fetchSize="10">

        <![CDATA[

            UPDATE TBRK_BORD 

                SET DEL_YN = 'Y'

            WHERE SEQ_NO = ?

        ]]>

    </query> 

    

    <query id="rsy5010_d02" desc="삭제쿼리" fetchSize="10">

        <![CDATA[

            DELETE FROM TBRK_BORD_ATMNT

            WHERE CLS_CD        =    ?

            AND   SEQ_NO        =    ?

            AND   FILE_SEQ      =    NVL(?, FILE_SEQ)

        ]]>

    </query> 


    <query id="rsy5010_s05" desc="오늘 날짜의 회차일차정보 조회" fetchSize="10">
        <![CDATA[
            SELECT  DECODE(A.STND_YEAR, NULL, SUBSTR(B.CALDATE, 0, 4), A.STND_YEAR)             STND_YEAR,
                    DECODE(A.TMS, NULL, 
                        (SELECT DISTINCT C.TMS 
                           FROM VW_RACE_SCHE C
                          WHERE C.RACE_DT = to_char(to_date(B.START_DT)+7,'yyyymmdd')), A.TMS)  TMS,
                    A.DAY_ORD                                                                   DAY_ORD,
                    DECODE(A.RACE_DT, NULL, B.CALDATE, A.RACE_DT)                               RACE_DT,
                    B.CALDATE, B.HANDAY, B.START_DT, B.WEEKS ,
                    (SELECT  MAX(DAY_ORD) MAXDAY
                      FROM  VW_RACE_SCHE A,
                            (SELECT  TMS
                              FROM  VW_RACE_SCHE
                             WHERE  RACE_DT = TO_CHAR(SYSDATE, 'yyyymmdd')    --TO_CHAR(SYSDATE, 'yyyymmdd')
                            ) B
                     WHERE  A.TMS   = B.TMS
                    ) MAXDAY,
                    A.SPEC_RACE_NM
              FROM  VW_RACE_SCHE    A,
                    VW_CALENDER     B        
             WHERE  A.RACE_DT   (+)= B.CALDATE  
               AND  B.CALDATE      = TO_CHAR(SYSDATE, 'yyyymmdd')             --TO_CHAR(SYSDATE, 'yyyymmdd')  
            ORDER BY B.CALDATE
        ]]>
    </query>
    
    

</queryMap>