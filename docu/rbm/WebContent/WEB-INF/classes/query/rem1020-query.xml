<?xml version="1.0" encoding='EUC-KR'?>

<queryMap desc="REM1020(입장거부자 현황)">
    <query id="rem1020_s01" desc="입장거부자 현황조회" fetchSize="10">
      <![CDATA[
            SELECT  /* rem1020_s01 */
		         BRNC_CD                                                                                  --지점코드
		        ,RACE_DT                                                                                  --경주일(YYYYMM)
		        ,NVL(DECODE(ENT_REFU_CD, '001', DECODE(ENT_REFU_TY_CD, '001', CNT)),0) AS REFU_SICK       --입장거부_환자
		        ,NVL(DECODE(ENT_REFU_CD, '001', DECODE(ENT_REFU_TY_CD, '002', CNT)),0) AS REFU_SELF       --입장거부_자발적
		        ,NVL(DECODE(ENT_REFU_CD, '001', DECODE(ENT_REFU_TY_CD, '003', CNT)),0) AS REFU_ETC        --입장거부_기타
		        
		        ,NVL(DECODE(ENT_REFU_CD, '002', DECODE(ENT_REFU_TY_CD, '001', CNT)),0) AS PUB_SICK        --공공노조_환자
		        ,NVL(DECODE(ENT_REFU_CD, '002', DECODE(ENT_REFU_TY_CD, '002', CNT)),0) AS PUB_SELF        --공공노조_자발적
		        ,NVL(DECODE(ENT_REFU_CD, '002', DECODE(ENT_REFU_TY_CD, '003', CNT)),0) AS PUB_ETC         --공공노조_기타
		        ,NVL(DECODE(ENT_REFU_CD, '003', DECODE(ENT_REFU_TY_CD, '001', CNT)),0) AS OUT_SICK        --삼진아웃_환자
		        ,NVL(DECODE(ENT_REFU_CD, '003', DECODE(ENT_REFU_TY_CD, '002', CNT)),0) AS OUT_SELF        --삼진아웃_자발적
		        
		        ,NVL(DECODE(ENT_REFU_CD, '003', DECODE(ENT_REFU_TY_CD, '003', CNT)),0) AS OUT_ETC         --삼진아웃_기타

              FROM  
				     (SELECT
				                 BRNC_CD
				                ,SUBSTR(RACE_DT, 0,6) AS RACE_DT
				                ,ENT_REFU_CD
				                ,ENT_REFU_TY_CD
				                ,COUNT(ENT_REFU_TY_CD) AS CNT            
				        FROM    TBRC_ENT_REFU_MANA  --입장거부현황
				       WHERE    1=1
				         AND    BRNC_CD LIKE  '%' || NVL(? , BRNC_CD) || '%'  --지점코드
				         AND    RACE_DT BETWEEN ? AND ?
				    GROUP BY    BRNC_CD, SUBSTR(RACE_DT, 0,6), ENT_REFU_CD, ENT_REFU_TY_CD) A
			    
          ORDER BY  BRNC_CD, RACE_DT 
        ]]>
    </query>
</queryMap>