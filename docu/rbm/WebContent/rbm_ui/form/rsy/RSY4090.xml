<?xml version="1.0" encoding="euc-kr"?>
<Window>
	<Form Height="576" Id="RSY4090" Left="8" OnLoadCompleted="form_OnLoadCompleted" OnUnloadCompleted="form_OnUnloadCompleted" PidAttrib="7" Title="경주동영상&#32;Upload" Top="8" Ver="1.0" Width="816" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_file" OnLoadCompleted="ds_file_OnLoadCompleted">
				<Contents>
					<colinfo Id="FILE_NAME" Size="260" Type="STRING"/>
					<colinfo Id="SHORT_FILE_NAME" Size="14" Type="STRING"/>
					<colinfo Id="FILE_SIZE" Size="4" Type="INT"/>
					<colinfo Id="CREATE_DATE" Size="4" Type="DATE"/>
					<colinfo Id="UPDATE_DATE" Size="4" Type="DATE"/>
					<colinfo Id="ACCESS_DATE" Size="4" Type="DATE"/>
					<colinfo Id="ATTR_ARCHIVE" Size="4" Type="INT"/>
					<colinfo Id="ATTR_SYSTEM" Size="4" Type="INT"/>
					<colinfo Id="ATTR_HIDDEN" Size="4" Type="INT"/>
					<colinfo Id="ATTR_READONLY" Size="4" Type="INT"/>
					<colinfo Id="ATTR_DIRECTORY" Size="4" Type="INT"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_sfile_0" OnLoadCompleted="ds_sfile_OnLoadCompleted">
				<Contents>
					<colinfo Id="NAME" Size="255" Type="STRING"/>
					<colinfo Id="SIZE" Size="8" Type="INT"/>
					<colinfo Id="FULLPATH" Size="512" Type="STRING"/>
					<colinfo Id="DIRGBN" Size="1" Type="STRING"/>
					<colinfo Id="ACCESSTIME" Size="255" Type="DATE"/>
					<colinfo Id="WRITETIME" Size="255" Type="DATE"/>
					<colinfo Id="CREATETIME" Size="255" Type="DATE"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_sfile_1" OnLoadCompleted="ds_sfile_OnLoadCompleted">
				<Contents>
					<colinfo Id="NAME" Size="255" Type="STRING"/>
					<colinfo Id="SIZE" Size="8" Type="INT"/>
					<colinfo Id="FULLPATH" Size="512" Type="STRING"/>
					<colinfo Id="DIRGBN" Size="1" Type="STRING"/>
					<colinfo Id="ACCESSTIME" Size="255" Type="DATE"/>
					<colinfo Id="WRITETIME" Size="255" Type="DATE"/>
					<colinfo Id="CREATETIME" Size="255" Type="DATE"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_sfile_2" OnLoadCompleted="ds_sfile_OnLoadCompleted">
				<Contents>
					<colinfo Id="NAME" Size="255" Type="STRING"/>
					<colinfo Id="SIZE" Size="8" Type="INT"/>
					<colinfo Id="FULLPATH" Size="512" Type="STRING"/>
					<colinfo Id="DIRGBN" Size="1" Type="STRING"/>
					<colinfo Id="ACCESSTIME" Size="255" Type="DATE"/>
					<colinfo Id="WRITETIME" Size="255" Type="DATE"/>
					<colinfo Id="CREATETIME" Size="255" Type="DATE"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="dsRaceTimeInfo"></Dataset>
			<Dataset DataSetType="Dataset" Id="dsEnd">
				<Contents>
					<colinfo id="CD" size="256" summ="default" type="STRING"/>
					<colinfo id="CD_NM" size="256" summ="default" type="STRING"/>
					<record>
						<CD>Y</CD>
						<CD_NM>마감</CD_NM>
					</record>
					<record>
						<CD>N</CD>
						<CD_NM>발매중</CD_NM>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="dsRaceInfo"></Dataset>
		</Datasets>
		<Grid AutoEnter="TRUE" AutoFit="TRUE" BindDataset="ds_file" BkColor2="default" BoldHead="true" Border="Flat" BorderColor="#d0d0d0" Bottom="561" CellMoving="TRUE" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" FixedColSizing="TRUE" HeadBorder="Flat" HeadHeight="24" Height="215" Id="Grid_detail" InputPanel="FALSE" Left="6" LineColor="silver" MinWidth="100" OnCellDBLClick="Grid_detail_OnCellDblClick" OnHeadClick="fcGridSort" Right="577" RowHeight="20" SelColor="black" TabOrder="1" TabStop="true" Top="346" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="571">
			<contents>
				<format id="Default">
					<columns>
						<col width="40"/>
						<col width="223"/>
						<col width="80"/>
						<col width="133"/>
						<col width="116"/>
						<col width="80"/>
					</columns>
					<head>
						<cell bkcolor="user20" col="0" color="user21" display="text" text="구분"/>
						<cell bkcolor="user20" col="1" color="user21" display="text" text="파일이름"/>
						<cell bkcolor="user20" col="2" color="user21" display="text" text="크기"/>
						<cell bkcolor="user20" col="3" color="user21" display="text" text="생성일시"/>
						<cell bkcolor="user20" col="4" color="user21" display="text" text="수정일시"/>
						<cell bkcolor="user20" col="5" color="user21" display="text" text="읽기전용"/>
					</head>
					<body>
						<cell align="center" bkcolor2="#f7f6f6" col="0" colid="ATTR_DIRECTORY" display="image" expr="iif(&#32;ATTR_DIRECTORY&#32;==&#32;&apos;1&apos;,&#32;&apos;icon_folder&apos;,&#32;&apos;icon_post&apos;)"/>
						<cell bkcolor2="#f7f6f6" col="1" colid="FILE_NAME" display="text"/>
						<cell align="center" bkcolor2="#f7f6f6" col="2" colid="FILE_SIZE" display="number"/>
						<cell bkcolor2="#f7f6f6" col="3" colid="CREATE_DATE" display="text" Mask="&#32;yyyy/MM/dd&#32;hh:mm:ss&#32;"/>
						<cell bkcolor2="#f7f6f6" col="4" colid="UPDATE_DATE" display="text" Mask="&#32;yyyy/MM/dd&#32;hh:mm:ss&#32;"/>
						<cell bkcolor2="#f7f6f6" col="5" colid="ATTR_READONLY" display="checkbox"/>
					</body>
				</format>
			</contents>
		</Grid>
		<FileDialog Bottom="26" Height="24" Id="FileDialog0" Left="616" MultiSelect="TRUE" Right="640" TabOrder="13" Top="2" Type="Dir" Width="24"></FileDialog>
		<Button Appearance="FLAT" BorderColor="user3" ButtonStyle="TRUE" Cursor="HAND" Height="27" Id="btn_conn" Left="652" OnClick="btn_conn_OnClick" TabOrder="2" Text="ftp&#32;conn" Top="50" Width="65"></Button>
		<Button Appearance="FLAT" BorderColor="user3" ButtonStyle="TRUE" Cursor="HAND" Height="27" Id="btn_close" Left="722" OnClick="btn_close_OnClick" TabOrder="3" Text="ftp&#32;close" Top="50" Width="65"></Button>
		<Edit Border="Flat" BorderColor="#c3c3c3" Column="m_word" Height="20" Id="ed_path" Left="75" TabOrder="4" Top="321" Width="355"></Edit>
		<Static Color="user5" Font="굴림,9,Bold" Height="20" Id="Static16" Left="8" TabOrder="6" Text="현재&#32;경로" Top="321" VAlign="Middle" Width="58"></Static>
		<Button Appearance="FLAT" BorderColor="user3" ButtonStyle="TRUE" Height="27" Id="btn_dir" Left="433" OnClick="btn_dir_OnClick" TabOrder="6" Text="Direct" Top="316" Width="45"></Button>
		<Button Appearance="FLAT" BorderColor="user3" ButtonStyle="TRUE" Height="27" Id="btn_dirup" Left="479" OnClick="btn_dirup_OnClick" TabOrder="7" Text="상위" Top="316" Width="45"></Button>
		<Button Appearance="FLAT" BorderColor="user3" ButtonStyle="TRUE" Cursor="HAND" Height="27" Id="ed_fileup" Left="330" OnClick="ed_fileup_OnClick" TabOrder="8" Text="Up(▲)" Top="281" Visible="FALSE" Width="65"></Button>
		<Button Appearance="FLAT" BorderColor="user3" ButtonStyle="TRUE" Cursor="HAND" Height="27" Id="ed_filedn" Left="430" OnClick="ed_filedn_OnClick" TabOrder="9" Text="Down(▼)" Top="281" Visible="FALSE" Width="65"></Button>
		<ftp Height="24" Id="ftp2" Left="592" Top="4" Width="24"></ftp>
		<Div Height="20" Id="divBtnLst" Left="641" Style="snis_txt" TabOrder="10" Text="Div0" Top="8" Url="common::comButtonCode.xml" Visible="FALSE" Width="154">
			<Contents></Contents>
		</Div>
		<ftp Height="24" Id="ftp0" Left="522" Top="-4" Width="24"></ftp>
		<ftp Height="24" Id="ftp1" Left="552" Top="2" Width="24"></ftp>
		<Tab Border="Flat" BorderColor="user3" Height="198" Id="Tab0" Left="5" TabOrder="11" Top="74" Width="571">
			<Contents>
				<TabPage BorderColor="black" Height="174" Id="tab1" ImageID="m_tab_08" Left="2" TabOrder="22" Text="tab1" Top="22" Width="567">
					<Grid AutoEnter="TRUE" AutoFit="TRUE" BindDataset="ds_sfile_0" BkColor2="default" BoldHead="true" Border="Flat" BorderColor="user3" Bottom="173" CellMoving="TRUE" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" FixedColSizing="TRUE" HeadBorder="Flat" HeadHeight="24" Height="171" Id="Grid_ftp" InputPanel="FALSE" Left="2" LineColor="silver" MinWidth="100" OnCellDBLClick="Grid_ftp_OnCellDblClick" OnHeadClick="fcGridSort" Right="565" RowHeight="20" SelColor="black" TabOrder="1" TabStop="true" Top="2" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="563">
						<contents>
							<format id="Default">
								<columns>
									<col width="40"/>
									<col width="165"/>
									<col width="65"/>
									<col width="252"/>
									<col width="125"/>
								</columns>
								<head>
									<cell bkcolor="user20" col="0" color="user21" display="text" text="구분"/>
									<cell bkcolor="user20" col="1" color="user21" display="text" text="파일명"/>
									<cell bkcolor="user20" col="2" color="user21" display="text" text="크기"/>
									<cell bkcolor="user20" col="3" color="user21" display="text" text="절대경로"/>
									<cell bkcolor="user20" col="4" color="user21" display="text" text="수정일시"/>
								</head>
								<body>
									<cell align="center" bkcolor2="#f7f6f6" col="0" colid="DIRGBN" display="image" expr="iif(&#32;DIRGBN&#32;==&#32;&apos;D&apos;,&#32;&apos;icon_folder&apos;,&#32;&#32;&apos;icon_post&apos;&#32;)"/>
									<cell bkcolor2="#f7f6f6" col="1" colid="NAME" display="text"/>
									<cell align="center" bkcolor2="#f7f6f6" col="2" colid="SIZE" display="number"/>
									<cell bkcolor2="#f7f6f6" col="3" colid="FULLPATH" display="text"/>
									<cell col="4" colid="WRITETIME" display="text" Mask="&#32;yyyy/MM/dd&#32;hh:mm:ss&#32;"/>
								</body>
							</format>
						</contents>
					</Grid>
				</TabPage>
				<TabPage BorderColor="black" Height="174" Id="tab2" ImageID="m_tab_08" Left="2" TabOrder="22" Text="tab2" Top="22" Width="567">
					<Grid AutoEnter="TRUE" AutoFit="TRUE" BindDataset="ds_sfile_1" BkColor2="default" BoldHead="true" Border="Flat" BorderColor="user3" Bottom="173" CellMoving="TRUE" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" FixedColSizing="TRUE" HeadBorder="Flat" HeadHeight="24" Height="171" Id="Grid_ftp" InputPanel="FALSE" Left="2" LineColor="silver" MinWidth="100" OnCellDBLClick="Grid_ftp_OnCellDblClick" OnHeadClick="fcGridSort" Right="565" RowHeight="20" SelColor="black" TabOrder="1" TabStop="true" Top="2" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="563">
						<contents>
							<format id="Default">
								<columns>
									<col width="40"/>
									<col width="165"/>
									<col width="65"/>
									<col width="252"/>
									<col width="180"/>
								</columns>
								<head>
									<cell bkcolor="user20" col="0" color="user21" display="text" text="구분"/>
									<cell bkcolor="user20" col="1" color="user21" display="text" text="파일명"/>
									<cell bkcolor="user20" col="2" color="user21" display="text" text="크기"/>
									<cell bkcolor="user20" col="3" color="user21" display="text" text="절대경로"/>
									<cell bkcolor="user20" col="4" color="user21" display="text" text="수정일시"/>
								</head>
								<body>
									<cell align="center" bkcolor2="#f7f6f6" col="0" colid="DIRGBN" display="image" expr="iif(&#32;DIRGBN&#32;==&#32;&apos;D&apos;,&#32;&apos;icon_folder&apos;,&#32;&#32;&apos;icon_post&apos;&#32;)"/>
									<cell bkcolor2="#f7f6f6" col="1" colid="NAME" display="text"/>
									<cell align="center" bkcolor2="#f7f6f6" col="2" colid="SIZE" display="number"/>
									<cell bkcolor2="#f7f6f6" col="3" colid="FULLPATH" display="text"/>
									<cell col="4" colid="WRITETIME" display="text" Mask="&#32;yyyy/MM/dd&#32;hh:mm:ss&#32;"/>
								</body>
							</format>
						</contents>
					</Grid>
				</TabPage>
				<TabPage BorderColor="black" Height="174" Id="tab3" ImageID="m_tab_08" Left="2" TabOrder="22" Text="tab3" Top="22" Width="567">
					<Grid AutoEnter="TRUE" AutoFit="TRUE" BindDataset="ds_sfile_2" BkColor2="default" BoldHead="true" Border="Flat" BorderColor="user3" Bottom="173" CellMoving="TRUE" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" FixedColSizing="TRUE" HeadBorder="Flat" HeadHeight="24" Height="171" Id="Grid_ftp" InputPanel="FALSE" Left="2" LineColor="silver" MinWidth="100" OnCellDBLClick="Grid_ftp_OnCellDblClick" OnHeadClick="fcGridSort" Right="565" RowHeight="20" SelColor="black" TabOrder="1" TabStop="true" Top="2" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="563">
						<contents>
							<format id="Default">
								<columns>
									<col width="40"/>
									<col width="165"/>
									<col width="65"/>
									<col width="252"/>
									<col width="180"/>
								</columns>
								<head>
									<cell bkcolor="user20" col="0" color="user21" display="text" text="구분"/>
									<cell bkcolor="user20" col="1" color="user21" display="text" text="파일명"/>
									<cell bkcolor="user20" col="2" color="user21" display="text" text="크기"/>
									<cell bkcolor="user20" col="3" color="user21" display="text" text="절대경로"/>
									<cell bkcolor="user20" col="4" color="user21" display="text" text="수정일시"/>
								</head>
								<body>
									<cell align="center" bkcolor2="#f7f6f6" col="0" colid="DIRGBN" display="image" expr="iif(&#32;DIRGBN&#32;==&#32;&apos;D&apos;,&#32;&apos;icon_folder&apos;,&#32;&#32;&apos;icon_post&apos;&#32;)"/>
									<cell bkcolor2="#f7f6f6" col="1" colid="NAME" display="text"/>
									<cell align="center" bkcolor2="#f7f6f6" col="2" colid="SIZE" display="number"/>
									<cell bkcolor2="#f7f6f6" col="3" colid="FULLPATH" display="text"/>
									<cell col="4" colid="WRITETIME" display="text" Mask="&#32;yyyy/MM/dd&#32;hh:mm:ss&#32;"/>
								</body>
							</format>
						</contents>
					</Grid>
				</TabPage>
			</Contents>
		</Tab>
		<Static Align="Right" Border="None" Height="22" Id="Static3" Left="4" Style="snis_if_lable" TabOrder="13" Text="서버&#32;경로" Top="48" VAlign="Middle" Width="76"></Static>
		<Edit AutoSelect="TRUE" Border="Flat" Height="20" Id="edServerDir" ImeMode="native" Left="88" LeftMargin="5" OnKeyDown="fcEdsearch_OnKeyDown" Style="snis_if_input01" TabOrder="12" Top="48" Width="466"></Edit>
		<Static Align="Right" Border="None" Height="22" Id="Static0" Left="6" Style="snis_if_lable" TabOrder="15" Text="로컬&#32;경로" Top="24" VAlign="Middle" Width="76"></Static>
		<Edit AutoSelect="TRUE" Border="Flat" Height="20" Id="edLocalDir" ImeMode="native" Left="88" LeftMargin="5" OnKeyDown="fcEdsearch_OnKeyDown" Style="snis_if_input01" TabOrder="14" Top="24" Width="466"></Edit>
		<Button Appearance="FLAT" BorderColor="user3" ButtonStyle="TRUE" Cursor="HAND" Height="27" Id="btnServerFileRefresh" Left="580" OnClick="fcbtnOnClick" TabOrder="16" Text="refresh" Top="50" Width="65"></Button>
		<Button Appearance="FLAT" BorderColor="user3" ButtonStyle="TRUE" Cursor="HAND" Height="27" Id="btnLocalFileRefresh" Left="526" OnClick="fcbtnOnClick" TabOrder="17" Text="refresh" Top="316" Width="45"></Button>
		<Grid AutoEnter="TRUE" AutoFit="TRUE" AutoFitEndLine="Hide" BindDataset="dsRaceTimeInfo" BKColor="user15" BkColor2="user16" BkSelColor="user17" BoldHead="true" Border="Flat" BorderColor="user22" Bottom="562" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="20" Height="474" Id="grdList" InputPanel="FALSE" Left="580" LineColor="user18" MinWidth="100" OnHeadClick="fcGridSort" OnLButtonUp="fcgrdOnLButtonUp" Right="810" SelColor="user19" Style="snis_grid" TabOrder="18" TabStop="true" Top="88" UseDBuff="true" UseExprCache="Row" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="230">
			<contents>
				<format id="Default">
					<columns>
						<col width="60"/>
						<col width="50"/>
						<col width="40"/>
						<col width="40"/>
						<col width="40"/>
						<col width="50"/>
					</columns>
					<head>
						<cell bkcolor="user20" col="0" color="user21" display="text" font="굴림,9,Bold" text="경주"/>
						<cell bkcolor="user20" col="1" color="user21" display="text" font="굴림,9,Bold" text="상태"/>
						<cell bkcolor="user20" col="2" color="user21" display="text" font="굴림,9,Bold" text="서버1"/>
						<cell bkcolor="user20" col="3" color="user21" display="text" font="굴림,9,Bold" text="서버2"/>
						<cell bkcolor="user20" col="4" color="user21" display="text" font="굴림,9,Bold" text="서버3"/>
						<cell bkcolor="user20" col="5" color="user21" display="text" font="굴림,9,Bold" text="전송"/>
					</head>
					<body>
						<cell align="center" col="0" colid="RACE_NO" display="text" suppress="1"/>
						<cell align="center" col="1" colid="RACE_END_YN" combocol="CD" combodataset="dsEnd" combotext="CD_NM" display="combo" suppress="1"/>
						<cell align="center" col="2" colid="SVR1" display="checkbox" suppress="1"/>
						<cell align="center" col="3" colid="SVR2" display="checkbox" suppress="1"/>
						<cell align="center" col="4" colid="SVR3" display="checkbox" suppress="1"/>
						<cell col="5" display="expr:iif(SVR_OK=&apos;1&apos;,&apos;null&apos;,&apos;button&apos;)"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Static Color="user4" Height="20" Id="stRaceInfo" Left="24" Style="snis_m_stitle" TabOrder="19" Text="경주정보" Top="6" VAlign="Middle" Width="264"></Static>
		<Image Height="20" Id="Image2" ImageID="m_titleblet2" Left="8" TabOrder="20" Top="6" Width="17"></Image>
		<Button Height="26" Id="Button0" Left="561" OnClick="Button0_OnClick" TabOrder="21" Text="Button0" Top="38" Width="78"></Button>
		<Progressbar Height="19" Id="Progressbar0" Left="5" Max="100" Origin="Horizontal" Step="10" TabOrder="22" Top="279" Width="566"></Progressbar>
		<File Bottom="47" Height="24" Id="File0" Left="631" Right="655" TabOrder="23" Top="23" Width="24"></File>
	</Form>
	<Script><![CDATA[/***************************************************************************************************
*   Form Common Script                                                                             *
*     현재 총 100 컬럼임 되도록 100 컬럼 안으로 코딩을 하세요                                      *
123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 1234567890
***************************************************************************************************/

/***************************************************************************************************
*                                         공통 Script Include                                      *
***************************************************************************************************/

#include "lib::rbm_common_script.js";
#include "lib::rbm_app_script.js";

/***************************************************************************************************
*                                          화면 변수 선언부                                        *
***************************************************************************************************/
var sFormId       = this.GetForm().id;
var sBUTTONLIST   = 'FFFFTFT';                          //공통기능정의(버튼순으로 T or F)
var sUSERAUTH     = '';                                //사용자별 프로그램 사용 권한
var sFORMCAPTION  = '';                                //Form의 Title 정보
var sFORMLOCATION = '';                                //Form의 Location 정보
var sUSERLAVEL    = '';                                //Form의 사용  Level
var vREVOBJ       = Array(9);                          //결과값 처리를 위한 오브젝트 
var sGRDTIT       = "";                                //그리드 제목
var sCUROBJ       ;                                    //현재 LOST FOCUS 오브젝트

var sMenuGrpNum     = "0";                         	   // 메뉴그룹의 갯수보관
var sMenuListNum    = "0";                             // 메뉴리스트의 갯수보관
var sMenuUpId       = "";
var sMenuUpNm       = "";
var sPAGENUM        = "20";


var arrSvrIp = ["211.234.117.173", "211.234.117.174","211.234.117.175"];
var sUserId = "administrator";
var sPasswd = "seoulcycle%%@!";

var nFileTotCnt = 4;
var sMeetCd     = "001";
var sCurTms     = "";
var sCurDayOrd  = "";

/***************************************************************************************************
*                                         공통 Event 처리 부분                                     *
***************************************************************************************************/
/*-------------------------------------------------------------------------------------------------+
>>  최초 화면 Load時 처리 할 사항
+-------------------------------------------------------------------------------------------------*/
function form_OnLoadCompleted(obj)
{
    sBUTTONLIST   = 'FFFFFFF';
  
 	//화면환경 설정
	sFORMCAPTION  = obj.Title;
	sFORMLOCATION = "";

	tab0.tab1.text = arrSvrIp[0];
	tab0.tab2.text = arrSvrIp[1];
	tab0.tab3.text = arrSvrIp[2];
	
	FileDialog0.FilePath = "C:\\";
	FileDialog0.GetFileList(ds_file,FileDialog0.FilePath);
	
	ed_path.Text = FileDialog0.FilePath;	
	
	settingFolder();
	fcSearchRaceInfo(obj);
}

// 현재 경주진행상태를 가져온다.(30초에 한번씩?)
function fcSearch(obj)
{
	var	sServiceName = "rsy4090-service:searchRaceTimeInfo";
	var	sInDataSet   = "";
	var	sOutDataSet  = "dsRaceTimeInfo=dsRaceTimeInfo";    
	
	fcd_SendTransaction(sServiceName, sInDataSet, sOutDataSet, "fcCallBack", true);
}

// 현재 경주진행상태를 가져온다.(30초에 한번씩?)
function fcSearchRaceInfo(obj)
{
	var	sServiceName = "rsy4090-service:searchRaceInfo";
	var	sInDataSet   = "";
	var	sOutDataSet  = "dsRaceInfo=dsRaceInfo";    
	
	fcd_AddParam("RACE_DAY", today());  
	
	fcd_SendTransaction(sServiceName, sInDataSet, sOutDataSet, "fcCallBack", false);
}

/***************************************************************************************************
*                                      사용자 정의  처리 부분                                      *
***************************************************************************************************/
/*-------------------------------------------------------------------------------------------------+
>>  Transaction 후 처리 해야 할 내용!
+-------------------------------------------------------------------------------------------------*/
function fcCallBack(sServiceName, ErrorCode, ErrorMSG) {
	if ( !fnc_result(ErrorCode, ErrorMSG) ) return;

	// 조회 완료 후
	if ( sServiceName == "rsy4090-service:searchRaceTimeInfo" ) {
		fcCheckUpload();	// 파일업로드 여부 체크
		
		
	} else if( sServiceName == "rsy4090-service:searchRaceInfo" ) {
		stRaceInfo.Text = dsRaceInfo.GetColumn(0,"RACE_INFO");
		sMeetCd     = dsRaceInfo.GetColumn(0, "MEET_CD");
		sCurTms     = dsRaceInfo.GetColumn(0, "TMS");
		sCurDayOrd  = dsRaceInfo.GetColumn(0, "DAY_ORD");
		if (sMeetCd == "001") nFileTotCnt = 4; 	//경륜일 경우
		else                  nFileTotCnt = 3;	//경정인 경우
	} 

}


function form_OnUnloadCompleted(obj)
{
	Ftp0.Close();
	Ftp1.Close();
	Ftp2.Close();
}

function btn_dirup_OnClick(obj)
{
	var str_path = FileDialog0.FilePath;
	var npos, noldpos, nlen;
	
	nlen = length(str_path);
	str_path = mid(str_path,0,nlen-2);
	
	noldpos = npos = -1;
	
	while(1)
	{	
		npos = IndexOf(str_path,"\\",npos);
		if ( npos > -1 )
			noldpos = npos;
		else
			break;			
		npos += 1;
	}	
	
	if ( noldpos > 0 )
	{
		FileDialog0.FilePath = Left( str_path, noldpos + 1);
		//trace("str_path : " + FileDialog0.FilePath);
		FileDialog0.GetFileList(ds_file,FileDialog0.FilePath);
		ed_path.Text = FileDialog0.FilePath;
	}
}


function btn_dir_OnClick(obj)
{
	FileDialog0.Type = "Dir";
	if ( FileDialog0.Open() );
	{
		FileDialog0.FilePath = FileDialog0.FilePath + "\\";
		FileDialog0.GetFileList(ds_file,FileDialog0.FilePath);
		ed_path.Text = FileDialog0.FilePath;
	}
}


function Grid_detail_OnCellDblClick(obj,nRow,nCell,nX,nY)
{
	var str_path, str_file;
	
	if( ds_file.GetColumn(nRow,"ATTR_DIRECTORY") == "1" )
	{
		str_path = FileDialog0.FilePath;
		str_file = ds_file.GetColumn(nRow,"FILE_NAME");
		
		FileDialog0.FilePath = str_path + str_file + "\\";
		FileDialog0.GetFileList(ds_file,FileDialog0.FilePath);
		ed_path.Text = FileDialog0.FilePath;
	}	
}

function Grid_ftp_OnCellDblClick(obj,nRow,nCell,nX,nY)
{
	var ftpObj;
	var dsObj;
	var curSvrDir = "";
	ftpObj = Object("ftp"+tab0.TabIndex);
	dsObj = Object("ds_sfile_"+tab0.TabIndex);
	if( dsObj.GetColumn(nRow,"DIRGBN") == "D" )
	{
		curSvrDir = dsObj.GetColumn(nRow,"FULLPATH");
		ftpObj.ChangeDir(curSvrDir);
		ftpObj.GetList(dsObj.id);		
		edServerDir.text = curSvrDir;
	}
}

function btn_close_OnClick(obj)
{
	Ftp0.Close();
	Ftp1.Close();
	Ftp2.Close();
	ds_sfile_0.ClearData();
	ds_sfile_1.ClearData();
	ds_sfile_2.ClearData();
}

function btn_conn_OnClick(obj)
{
	var ftpObj;
	var dsObj;
	
	for(var i=0;i<3;i++) {
		ftpObj = object("ftp"+i);
		dsObj  = object("ds_sfile_"+i);
		ftpObj.Open(arrSvrIp[i],sUserId,sPasswd);
		ftpObj.ChangeDir(edServerDir.text);
		ftpObj.GetList(dsObj.id);
	}
	
	//
	FileDialog0.FilePath = edLocalDir.text + "\\";
	FileDialog0.GetFileList(ds_file,FileDialog0.FilePath);
	ed_path.Text = FileDialog0.FilePath;
	
	fcSearch();	
}



function fn_getlist()
{
	// 서버 파일 목록 조회...
	Ftp0.GetList("ds_sfile_0");	
	Ftp1.GetList("ds_sfile_1");	
	Ftp2.GetList("ds_sfile_2");	
}

function ds_sfile_OnLoadCompleted(obj,nErrorCode,strErrorMsg,nReason)
{
	if ( nReason == 0 )
	{
		obj.Sort("DIRGBN:A,FULLPATH:A");
	}
}

function ds_file_OnLoadCompleted(obj,nErrorCode,strErrorMsg,nReason)
{
	if ( nReason == 0 )
	{
		obj.Sort("ATTR_DIRECTORY:D,FILE_NAME:A");
	}
	
}

function ed_filedn_OnClick(obj)
{
	var remote_file, local_file, file_name;
	var result, nRow;
	
	var dsObj = obj;
	var ftpObj;
	if (obj.id == "ds_sfile_0") fptObj = ftp0;
	else if (obj.id == "ds_sfile_1") fptObj = ftp1;
	else if (obj.id == "ds_sfile_2") fptObj = ftp2;
	
	nRow = dsObj.row;
	
	if( dsObj.GetColumn(nRow,"DIRGBN") == "F" )
	{
		SetWaitCursor(true);
		remote_file = dsObj.GetColumn(nRow,"FULLPATH");
		file_name  = dsObj.GetColumn(nRow,"NAME");		
		local_file = FileDialog0.FilePath + file_name;
		
		trace("local_file : " + local_file);
		
		fptObj.SetMode("BINARY");
		result = fptObj.GetFile(remote_file, local_file);
		
		SetWaitCursor(false);
		
		if( result == 0 ) 
		{
			FileDialog0.GetFileList(dsObj,FileDialog0.FilePath);
			ed_path.Text = FileDialog0.FilePath;
		}
		else
			alert("Error...");
	} else
	{
		alert("디렉토리 입니다.\n아직 지원하지 않습니다.");
	}
}

function ed_fileup_OnClick(obj)
{	
	var remote_file, local_file, file_name;
	var result, nRow;
	
	nRow = ds_file.row;
	file_name = ds_file.GetColumn(nRow,"FILE_NAME");
	
	if( ds_file.GetColumn(nRow,"ATTR_DIRECTORY") == "0" )
	{
		SetWaitCursor(true);
		remote_file = FtpEx0.GetCurrentDir() + "/" + file_name;
		local_file = FileDialog0.FilePath + file_name;
		
		FtpEx0.SetMode("BINARY");
		
		result = FtpEx0.PutFile(local_file, remote_file);
		
		SetWaitCursor(false);
		
		if( result == 0 ) {
			Ftp0.GetList("ds_sfile");
			Ftp1.GetList("ds_sfile");
			Ftp2.GetList("ds_sfile");
		} else
			alert("Error...");
		
		//trace( FtpEx0.GetCurrentDir() );
	} else
	{
		alert("디렉토리 입니다.\n아직 지원하지 않습니다.");
	}
}

function fcClose()
{
	if (ftp0.IsConnected()) Ftp0.Close();
	if (ftp1.IsConnected()) Ftp1.Close();
	if (ftp2.IsConnected()) Ftp2.Close();
	
	close();
}

function settingFolder()
{
	//서버는 날짜별로 만들어져 있다.
	var sSvrFolder = "/vod/pds";
	sSvrFolder += "/" + substr(today(),0,4) + "/" + toNumber(substr(today(),4,2)) + "/" + toNumber(substr(today(),6,2));
	edServerDir.text = sSvrFolder;
	
	edLocalDir.text = "D:\\My Documents\\04. 용역사업\\2013년_동영상서버호스팅\\경주동영상\\경륜";
}
function fcbtnOnClick(obj)
{
	if (obj.id == "btnServerFileRefresh") {
		fn_getlist();
	} else if (obj.id == "btnLocalFileRefresh") {
		FileDialog0.FilePath = ed_path.Text + "\\";
		FileDialog0.GetFileList(ds_file,FileDialog0.FilePath);
	}
}

function fcGridSort(obj,nCell,nX,nY,nPivotIndex)
{
	//특정 Head 클릭 시 해당 항목으로 Sort(만약 특정 컬럼을 누를때만 소트하고자 한다면 nCell로 조건)
	if ( nCell != 0 ) {
		fnc_GridSort(obj, object(obj.BindDataset), nCell);
	}
}

function fcCheckUpload()
{
	if (!ftp0.IsConnected()) return;
	if (dsRaceTimeInfo.RowCount() == 0) return;
	
	dsRaceTimeInfo.fireEvent = false;
	var fileCnt = 0;
	for (var iCnt=0;iCnt<dsRaceTimeInfo.RowCount();iCnt++) {
		if (dsRaceTimeInfo.GetColumn(iCnt, "RACE_END_YN") == "Y") {
			fileCnt = 0;
			for (var sCnt=0;sCnt<3;sCnt++) {	// 서버별로 체크
				if (fcGrdFileCheck(sCnt, toNumber(dsRaceTimeInfo.GetColumn(iCnt, "RACE_NO"))) == nFileTotCnt) {
					dsRaceTimeInfo.SetColumn(iCnt, "SVR" + toString(sCnt + 1), "1");					
					fileCnt ++;
				}
			}	
			if (fileCnt == 3) dsRaceTimeInfo.SetColumn(iCnt, "SVR_OK", "1");					
		}
	}
	dsRaceTimeInfo.fireEvent = true;
}

function fcGrdFileCheck(SvrNo, RaceNo)
{
	var arrFileNm = array(4);
	var dsObj;
	var fileCnt = 0;
	dsObj = Object("ds_sfile_"+ SvrNo);
	
	if (sMeetCd == "001") {	//경륜인 경우
		arrFileNm[0] = sCurTms + Lpad(sCurDayOrd, "0", 2) + Lpad(RaceNo, "0", 2) + ".wmv";
		arrFileNm[1] = sCurTms + Lpad(sCurDayOrd, "0", 2) + Lpad(RaceNo, "0", 2) + "_mobile.mp4";
		arrFileNm[2] = "s" + sCurTms + Lpad(sCurDayOrd, "0", 2) + Lpad(RaceNo, "0", 2) + ".wmv";
		arrFileNm[3] = "m" + sCurTms + Lpad(sCurDayOrd, "0", 2) + Lpad(RaceNo, "0", 2) + ".wmv";
	}
	
	fileCnt = 0;
	for (var i=0;i<length(arrFileNm);i++) {
		if (dsObj.FindRow("NAME", arrFileNm[i]) >= 0) fileCnt++;
	}
	return fileCnt;
}


function fcgrdOnLButtonUp(obj,nPosX,nPosY,nRow,nCell,nPivotIndex)
{
	if (!ftp0.IsConnected()) return;
	if (dsRaceTimeInfo.GetColumn(nRow, "SVR_OK") == "1") return;	//이미 올린 경우 다시 올릴 필요 없음
	var nRaceNo = dsRaceTimeInfo.GetColumn(nRow, "RACE_NO");
	var arrFileNm = array(4);
	
	//fnc_ProgressPop(); 	
	if (sMeetCd == "001") {	//경륜인 경우
		arrFileNm[0] = sCurTms + Lpad(sCurDayOrd, "0", 2) + Lpad(RaceNo, "0", 2) + ".wmv";
		arrFileNm[1] = sCurTms + Lpad(sCurDayOrd, "0", 2) + Lpad(RaceNo, "0", 2) + "_mobile.mp4";
		arrFileNm[2] = "s" + sCurTms + Lpad(sCurDayOrd, "0", 2) + Lpad(RaceNo, "0", 2) + ".wmv";
		arrFileNm[3] = "m" + sCurTms + Lpad(sCurDayOrd, "0", 2) + Lpad(RaceNo, "0", 2) + ".wmv";
	}
	fileCnt = 0;
	Progressbar0.Visible = true;
	Progressbar0.Min = 0;
	Progressbar0.step = 1;
	Progressbar0.Max = 9;
	Progressbar0.Pos = 0;
	for (var i=0;i<length(arrFileNm);i++) {
		for (var j=0;j<3;j++) {	//서버별 
			if (uploadfile(object("ftp"+tostring(j)), arrFileNm[i]) >= 0) fileCnt++;
			Progressbar0.pos = Progressbar0 + 1;
		}
	}
	Progressbar0.Visible = false;
	//fnc_ProgressClose();
}

function uploadfile(ftpObj, file_name)
{
	var remote_file, local_file;
	var result;
	// Trace("uploadfile===========================");
	// Trace("ftp:"+ftpobj.id);
	// Trace("file_name"+file_name);
	if (!ftpObj.IsConnected()) return;
	if (fnc_IsNull(file_name)) return;
		
	SetWaitCursor(true);
	remote_file = ftpObj.GetCurrentDir() + "/" + file_name;
	local_file = FileDialog0.FilePath + file_name;
	
	// Trace("remote_file:"+remote_file);
	// Trace("local_file:"+local_file);
	
	ftpObj.SetMode("BINARY");
	idle();
		result = ftpObj.PutFile(local_file, remote_file);
	idle();
	SetWaitCursor(false);
	
	if( result == 0 ) {
		ftpObj.GetList("ds_sfile");
	} else
		alert("Error...");

}
function Button0_OnClick(obj)
{
	var nRaceNo = "01";
	sCurTms = "41";
	sCurDayOrd = "3";
	var arrFileNm = array(4);
	var filecommon = "";
	var nTime = 0;
	//fnc_ProgressPop(); 	
	if (sMeetCd == "001") {	//경륜인 경우
		filecommon = sCurTms + Lpad(sCurDayOrd, "0", 2) + Lpad(nRaceNo, "0", 2);
		arrFileNm[0] = filecommon + ".wmv";
		arrFileNm[1] = filecommon + "_mobile.mp4";
		arrFileNm[2] = "s" + filecommon + ".wmv";
		arrFileNm[3] = "m" + filecommon + ".wmv";
	}
	fileCnt = 0;
	Progressbar0.Visible = true;
	Progressbar0.Min = 0;
	Progressbar0.step = 1;
	Progressbar0.Max = 11;
	Progressbar0.Pos = 0;
	nTime = time();
	for (var j=0;j<3;j++) {	//서버별 
		for (var i=0;i<length(arrFileNm);i++) {
			Progressbar0.pos = Progressbar0 + 1;
			if (uploadfile(object("ftp"+tostring(j)), arrFileNm[i]) >= 0) fileCnt++;
		}		
		//fcExecCmdFtp(arrSvrIp[j], arrFileNm);
	}
	Progressbar0.Visible = false;
	nTime = time() - nTime;
	Trace("소요시간 = "+toString(nTime));
	//fnc_ProgressClose();
	fcSearch();
	fn_getlist();
}

function fcExecCmdFtp(svrIp, arrFileNm) {
	if (fnc_isnull(filecommon)) return;
	
	var scfile = "c:\\temprbm\\ftp.scr";
	file0.filename = scfile;
	file0.open("wt");
//	file0.write("open "+svrIp + "\n");
	file0.write("administrator\n");
	file0.write("seoulcycle%%@!\n");
	file0.write("cd "+edServerDir.text+"\n");
	file0.write("lcd "+quote(edLocalDir.text)+"\n");
	file0.write("binary"+"\n");
	for (var i=0;i<Length(arrFileNm);i++) {
		file0.write("put " + arrFileNm[i] + "\n");	
	}
	file0.write("disconnect"+"\n");
	file0.write("bye"+"\n");		
	file0.close();
	if (!file0.isexistfile(scfile)) Trace("error : file not found!!");
	
	ExecProc("ftp.exe -v -i -s:" +scfile + " " + svrIp);
}]]></Script>
</Window>