<?xml version="1.0" encoding='EUC-KR'?>

<queryMap desc="RSM0000(매출현황공통코드)">
    <query id="rsm0000_s01" desc="경주일정보" fetchSize="10">
        <![CDATA[
	        SELECT /* rsm0000_s01 */
	                MAX(A.MEET_CD) AS MEET_CD,   -- 가까운 경주일의 경주 지점 코드
	        		MAX(B.MEET_CD) AS CUR_MEET_CD,   -- 현재 경주일의 경주 지점 코드
	        		DECODE(MAX(A.MEET_CD),'003','003','001') AS MEET_GUBUN,	-- 가까운 경주일의 경륜, 경정 구분
	        		MAX(A.STND_YEAR) AS MAX_STND_YEAR,   -- 기준년도 최대값
				       MIN(A.STND_YEAR) AS MIN_STND_YEAR,	-- 기준년도 최소값
				       MAX(A.TMS) AS MAX_TMS,               -- 회차 최대값
				       MAX(B.STND_YEAR) AS STND_YEAR,       -- 현재 기준년도
				       MAX(B.TMS) AS TMS,                   -- 가까운 회차
				       MAX(B.TMS)||'회' AS TMS_NM,                   -- 가까운 회차
				       MAX(B.DAY_ORD) AS DAY_ORD,			-- 가까운 경주 일차
				       MAX(B.RACE_DAY) AS RACE_DAY,			-- 가까운 경주일				       
				       MAX(TO_CHAR(TO_DATE(B.RACE_DAY,'YYYYMMDD'),'YYYY-MM-DD')) AS RACE_DAY_INFO,			-- 가까운 경주일 정보
				       MAX(RACE_YOIL_KOR) AS RACE_YOIL_KOR -- 요일
				FROM VW_SDL_INFO A,                       -- 경주일 정보
				(
				    SELECT MEET_CD, STND_YEAR,TMS,DAY_ORD, 
					    RACE_DAY,TO_CHAR(TO_DATE(RACE_DAY,'YYYYMMDD'),'YYYY-MM-DD') AS RACE_DAY_INFO,
					    RACE_YOIL,DECODE(RACE_YOIL,'MON','월','TUE','화','WED','수','THU','목','FRI','금','SAT','토','SUN','일','일') AS RACE_YOIL_KOR
				    FROM( 
				    	SELECT MEET_CD, STND_YEAR,TMS, DAY_ORD ,RACE_DAY, RACE_YOIL, row_number() OVER(ORDER BY ABS(RACE_DAY - TO_CHAR(SYSDATE,'YYYYMMDD'))) AS rn 
				    	FROM( 
				        	SELECT MEET_CD, STND_YEAR,TMS,RACE_DAY,DAY_ORD,RACE_YOIL  FROM VW_SDL_INFO WHERE MEET_CD IN ('001','003') 
				    		) A 
				    	) 
				    WHERE rn = 1 
				
				)B            
            
        ]]>

    </query>
     <query id="rsm0000_s02" desc="경주일정보" fetchSize="10">
        <![CDATA[
	        SELECT /* rsm0000_s01 */
	                MAX(A.MEET_CD) AS MEET_CD,   -- 가까운 경주일의 경주 지점 코드
	        		MAX(B.MEET_CD) AS CUR_MEET_CD,   -- 현재 경주일의 경주 지점 코드
	        		DECODE(MAX(A.MEET_CD),'003','003','001') AS MEET_GUBUN,	-- 가까운 경주일의 경륜, 경정 구분
	        		MAX(A.STND_YEAR) AS MAX_STND_YEAR,   -- 기준년도 최대값
				       MIN(A.STND_YEAR) AS MIN_STND_YEAR,	-- 기준년도 최소값
				       MAX(A.TMS) AS MAX_TMS,               -- 회차 최대값
				       MAX(B.STND_YEAR) AS STND_YEAR,       -- 현재 기준년도
				       MAX(B.TMS) AS TMS,                   -- 가까운 회차
				       MAX(B.TMS)||'회' AS TMS_NM,                   -- 가까운 회차
				       MAX(B.DAY_ORD) AS DAY_ORD,			-- 가까운 경주 일차
				       MAX(B.RACE_DAY) AS RACE_DAY,			-- 가까운 경주일				       
				       MAX(TO_CHAR(TO_DATE(B.RACE_DAY,'YYYYMMDD'),'YYYY-MM-DD')) AS RACE_DAY_INFO,			-- 가까운 경주일 정보
				       MAX(RACE_YOIL_KOR) AS RACE_YOIL_KOR -- 요일
				FROM VW_SDL_INFO A,                       -- 경주일 정보
				(
				    SELECT MEET_CD, STND_YEAR,TMS,DAY_ORD, 
					    RACE_DAY,TO_CHAR(TO_DATE(RACE_DAY,'YYYYMMDD'),'YYYY-MM-DD') AS RACE_DAY_INFO,
					    RACE_YOIL,DECODE(RACE_YOIL,'MON','월','TUE','화','WED','수','THU','목','FRI','금','SAT','토','SUN','일','일') AS RACE_YOIL_KOR
				    FROM( 
				    SELECT MEET_CD, STND_YEAR,TMS, DAY_ORD ,RACE_DAY, RACE_YOIL, row_number() OVER(ORDER BY ABS(RACE_DAY - TO_CHAR(SYSDATE,'YYYYMMDD'))) AS rn 
				    FROM( 
				        SELECT MEET_CD, STND_YEAR,TMS,RACE_DAY,DAY_ORD,RACE_YOIL  FROM VW_SDL_INFO 
				    ) a 
				    ) 
				    WHERE rn = 1 
				
				)B            
            
        ]]>

    </query>
    
</queryMap>