<?xml version="1.0" encoding='EUC-KR'?>

<queryMap desc="RBS1010(사업계획등록)">
    
    
    <query id="rbs1010_s01" desc="사업계획등록 조회" fetchSize="10">
        <![CDATA[
                   
			SELECT   /* rbs1010_s01 */
			         A.PREP_AMT_CD,   -- 시개금코드
			         A.BUSI_YEAR,     -- 년도
			         A.CONFIRM_TMS,   -- 승인차수
			         A.ACC_BGN_CD,    -- 회계구분코드
			         A.BUSI_NM,       -- 사업명
			         
			         A.CONFIRM_AMT,   -- 승인금액 
			         A.DPRT_CD,       -- 부서코드
			         A.MNG_ID,        -- 담당자ID
			                 
			         (
			          SELECT   GROUP_NAME
			          FROM     V_GROUP DEPT
			          WHERE    GROUP_ID = A.DPRT_CD
			         )  AS DPRT_NAME,  -- 부서명
			         
			         (
			          SELECT   USER_NM
			          FROM     TBRK_USER
			          WHERE    USER_ID = A.MNG_ID 
			         ) AS MNG_NAME, -- 담당자 이름
			         
			         A.BUSI_CNTNT_PRPS,  -- 사업내용목적
			         A.BUSI_CNTNT_SMRY,  -- 사업내용개요
			         
			         '0' CHK   -- CHECKBOX 0, 1
			         
			FROM     TBRE_BUSI_PLAN A 
			
			WHERE    A.BUSI_YEAR    = ?                                       -- 1. 년도			
			AND 	 A.ACC_BGN_CD LIKE '%' || NVL(?, A.ACC_BGN_CD) || '%'     -- 2.회계구분			
			AND 	 A.CONFIRM_TMS LIKE '%' || NVL(?, A.CONFIRM_TMS) || '%'   -- 3.승인차수
			
			ORDER BY A.PREP_AMT_CD
			
        ]]>
    </query>       

	
      
	
	<query id="rbs1010_i01" desc="사업계획등록 등록" fetchSize="10">
        <![CDATA[
        
			INSERT   /* rbs1010_i01 */			   
			INTO      TBRE_BUSI_PLAN A
			
			          (   
			           A.PREP_AMT_CD,   -- 시개금코드
			           A.BUSI_YEAR,     -- 년도
			           A.CONFIRM_TMS,   -- 승인차수
			           A.ACC_BGN_CD,    -- 회계구분코드
			           A.BUSI_NM,       -- 사업명
			           
			           A.CONFIRM_AMT,   -- 승인금액 
			           A.DPRT_CD,       -- 부서코드
			           A.MNG_ID,        -- 담당자ID
			                                                   
			           A.INST_ID,       -- 등록자ID    
			           A.INST_DT        -- 등록일자
			           
			          ) 
			          VALUES 
			          (
			           (
			             SELECT   NVL(LPAD(MAX(TO_NUMBER(PREP_AMT_CD)) + 1, 8, '0'), '00000001')  
			             FROM     TBRE_BUSI_PLAN 
			           ),             
			           ?,       -- 1. 년도
			           ?,       -- 2. 승인차수 
			           ?,       -- 3. 회계구분코드
			           ?,       -- 4. 사업명           
			           ?,       -- 5. 승인금액 
			           
			           ?,       -- 6. 부서코드           
			           ?,       -- 7. 담당자ID
			                
			           ?,       -- 8. 사용자 ID
			           SYSDATE
			      )

        ]]>
    </query>      
    
    <query id="rbs1010_u01" desc="사업계획등록 수정" fetchSize="10">
        <![CDATA[
			UPDATE   /* rbs1010_u01 */
			         TBRE_BUSI_PLAN A
			
			SET      A.BUSI_YEAR    = ?,         -- 1.년도
			         A.CONFIRM_TMS  = ?,         -- 2.승인차수
			         A.ACC_BGN_CD       = ?,     -- 3.회계구분코드
			         A.BUSI_NM      = ?,         -- 4.사업명           
			         A.CONFIRM_AMT  = ?,         -- 5.승인금액 
			         
			         A.DPRT_CD      = ?,         -- 6.부서코드
			         A.MNG_ID       = ?,         -- 7.담당자ID
			           
			         A.UPDT_ID      = ?,         -- 8. 사용자 ID    
			         A.UPDT_DT      = SYSDATE
			        
			WHERE    A.PREP_AMT_CD = ?           -- 9. 시개금코드

        ]]>
    </query>


<!-- 사업계획등록 정보 삭제시 Relation 되어 있는 자식 테이블부터 삭제 후 마스터 정보를 삭제 한다. (무결성 제약조건 위배 이유) -->

    <query id="rbs1010_d_exec" desc="집행내역 삭제" fetchSize="10">
        <![CDATA[
        
			DELETE   /* rbs1040_d01 */
			         TBRE_BUSI_EXEC A      
			         
			WHERE 	 A.PREP_AMT_CD = ?	  -- 2. 시개금코드
			
        ]]>
    </query> 
    
	<query id="rbs1010_d_file" desc="첨부파일  삭제" fetchSize="10">
        <![CDATA[

			DELETE TBRK_FILE_MANA   /* rsy4011_d02 */	

			WHERE ATT_FILE_KEY = ?		-- 1. 첨부파일
        ]]>
    </query>

    <query id="rbs1010_d01" desc="사업계획등록 삭제" fetchSize="10">
        <![CDATA[
			DELETE   /* rbs1010_d01 */
			         TBRE_BUSI_PLAN			
			
			WHERE    PREP_AMT_CD = ?  -- 1. 시개금코드    
        ]]>
    </query>    
        
</queryMap>