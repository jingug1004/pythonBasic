<?xml version="1.0" encoding='EUC-KR'?>

<queryMap desc="rsm6060(만기만료 조회)">
    
    <query id="rsm6060_s01" desc="만기도래" fetchSize="10">
      <![CDATA[
          SELECT  /* rsm6060_s01 */
		          MISS_REPO_NO 
		        , ACDNT_TY_CD  
		        , REFUND_TY_CD 
		        , RCPT_DT      
		        , PUBL_DT
		        , BRNC_CD      
		        , DIV_NO       
		        , PLC_NO       
		        , RACE_NO      
		        , SALES_AMT     
		        , REFUND_AMT   
		        , RMK
		        , CUST_NM  
		        , BIRTH_DAY    
		        , CUST_PHONE_NO
		        , CUST_ADDR
		        , TIC_CONT    
		        , TSN_NO
		        , TIC_TYPE_CD
		        , STOPPAY_DT
		        , TIC_STAS
		        , CNCL_REQ_DEPT
		        , CNCL_REQ_ID              
		  FROM  TBRD_STOPPAY_CNCL_CNTNT   
		 WHERE  1=1
		   AND  TIC_STAS != '005' -- 티켓상태가 환급이 아닌경우만
		   AND  TSN_NO	LIKE  '%' || NVL(? , TSN_NO)  || '%'
		   AND  REGEXP_LIKE (DECODE(?, '', '1',BRNC_CD),DECODE(?,'','1',?) )
           AND  DECODE(?,'','1',CUST_NM)  = DECODE(?,'','1',?) 
		   AND  PUBL_DT	BETWEEN ? AND ?
		   AND  TIC_STAS > ?
		   ORDER BY PUBL_DT DESC
		
        ]]>
   </query>
   <query id="rsm6060_s02" desc="만기후" fetchSize="10">
      <![CDATA[
          SELECT
		            MISS_REPO_NO 
		        , ACDNT_TY_CD  
		        , REFUND_TY_CD 
		        , RCPT_DT      
		        , PUBL_DT
		        , BRNC_CD      
		        , DIV_NO       
		        , PLC_NO       
		        , RACE_NO      
		        , SALES_AMT     
		        , REFUND_AMT   
		        , RMK
		        , CUST_NM  
		        , BIRTH_DAY    
		        , CUST_PHONE_NO
		        , CUST_ADDR
		        , TIC_CONT    
		        , TSN_NO
		        , TIC_TYPE_CD
		        , STOPPAY_DT
		        , TIC_STAS
		        , CNCL_REQ_DEPT
                , CNCL_REQ_ID                
		  FROM  TBRD_STOPPAY_CNCL_CNTNT   
		 WHERE  1=1
		   AND  TIC_STAS != '005' -- 티켓상태가 환급이 아닌경우만
		   AND  TSN_NO	LIKE  '%' || NVL(? , TSN_NO)  || '%'
		   --AND  BRNC_CD	LIKE  '%' || NVL(? , BRNC_CD)  || '%'
		   AND  REGEXP_LIKE (DECODE(?, '', '1',BRNC_CD),DECODE(?,'','1',?) )
		   
		   AND  DECODE(?,'',1,CUST_NM)  = DECODE(?,'',1,?) 
		   AND  PUBL_DT  BETWEEN ? AND ?
		   ORDER BY PUBL_DT DESC	
		   
        ]]>
   </query>
  
  
     <query id="rsm6060_u01" desc="분실신고서 해지요청" fetchSize="10">
      <![CDATA[
               
            UPDATE TBRD_STOPPAY_CNCL_CNTNT 
                SET 
                       
                        TIC_STAS        = ?     -- 티켓상태 (해지요청)
                    ,   CNCL_REQ_DEPT   = ?     -- 해지요청자부서명
                    ,   CNCL_REQ_ID     = ?     -- 해지요청자ID      
                    ,   UPDT_ID         = ?     -- 처리
                    ,   UPDT_DT         = SYSDATE                   
             WHERE  MISS_REPO_NO                = ?
               AND  TSN_NO              = ?
        
        ]]>
    </query>
</queryMap>