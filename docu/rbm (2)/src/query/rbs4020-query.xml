<?xml version="1.0" encoding='EUC-KR'?>

<queryMap desc="rbs4020(보고서제출  관리 )">
    <query id="rbs4020_s01" desc="보고서담당자 제출  조회" fetchSize="10">
      <![CDATA[
            SELECT /* rbs4020_s01 */
                 '0' AS CHK
                 
                ,A.DEPT_CD                  --부서코드
                ,A.STND_YEAR                --년도
                ,A.SEQ                      --순번
                
                ,A.MNG_ID                   --담당자ID
                ,C.USER_NM MNG_NM           --담당자명
                ,A.MNG_DEPT_CD              --담당자부서코드
                ,C.TEAM_NM MNG_DEPT_NM      --담당자부서명
                
                ,A.SUBM_DT                  --제출일자
                ,A.ATT_FILE_KEY             --첨부파일키
                ,A.REPORT_CONT              --보고내용
                ,A.UPDT_ID                  --수정자
                ,A.UPDT_DT                  --수정일시               

                ,B.REQ_DT                               --요청일자
                ,B.SUBM_LIMIT_DT                        --제출기한일자
                
                ,B.REPORT_NM                            --보고서명칭
                ,B.INST_GUIDE                           --작성지침
                ,B.SAMP_YN                              --양식여부
                ,B.ATT_FILE_KEY  REPORT_ATT_FILE_KEY    --양식 첨부파일키
                ,B.RMK                                  --비고
                ,C2.TEAM_NM AS REQ_TEAM_NM
                ,C2.USER_NM AS REQ_USER_NM
                

            FROM  TBRE_REPORT_MNG A      --보고서담당자
                ,TBRE_REPORT_MANA B
                ,TBRK_USER C
                ,TBRK_USER C2

            WHERE 1 = 1
                AND A.DEPT_CD = B.DEPT_CD
                AND A.STND_YEAR = B.STND_YEAR
                AND A.SEQ = B.SEQ
                AND A.MNG_ID =  C.USER_ID
                AND A.DEL_YN = 'N'
                AND B.DEL_YN = 'N'
                AND C2.USER_ID = NVL(B.UPDT_ID, B.INST_ID)
                
                AND A.MNG_DEPT_CD = ?                                           --부서코드
                AND B.SUBM_LIMIT_DT >= NVL(? , '19000101')                        --요청일자(시작)
                AND B.SUBM_LIMIT_DT <= NVL(? , '99991231')                        --요청일자(종료)
                AND B.REPORT_NM LIKE  '%' || NVL(? , B.REPORT_NM) || '%'            --보고서명
            ORDER BY B.REQ_DT DESC    

        ]]>
    </query>       
    
    <query id="rbs4020_u01" desc="보고서담당자 제출 수정" fetchSize="10">

       <![CDATA[

            UPDATE TBRE_REPORT_MNG SET  /* rbs4020_u01 */


                 SUBM_DT = TO_CHAR(SYSDATE,'YYYYMMDD')  --제출일자
                ,ATT_FILE_KEY = ?                       --첨부파일key
                ,REPORT_CONT = ?                        --보고내용
              
                ,UPDT_ID = ?            --수정자
                ,UPDT_DT = SYSDATE      --수정일시

            WHERE DEPT_CD = ?           --부서코드
                AND STND_YEAR = ?       --년도
                AND SEQ = ?             --순번
                AND MNG_ID = ?          --담당자ID
        ]]>

    </query>    
    
    
    <query id="rbs4020_u02" desc=" 보고서담당자  첨부파일  정보 수정" fetchSize="10">

        <![CDATA[
            UPDATE TBRE_REPORT_MNG SET  /* rbs4020_u02 */
                 
                 ATT_FILE_KEY = ?       --첨부파일키             
                ,UPDT_ID = ?            --수정자
                ,UPDT_DT = SYSDATE      --수정일시
                
            WHERE DEPT_CD = ?           --부서코드
                AND STND_YEAR = ?       --년도
                AND SEQ = ?             --순번
                AND MNG_ID = ?          --담당자ID
        ]]>

    </query>     
</queryMap>