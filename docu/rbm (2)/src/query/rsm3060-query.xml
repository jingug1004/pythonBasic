<?xml version="1.0" encoding='EUC-KR'?>

<queryMap desc="RSM3060(지점별 매출건수)">
   
    <query id="rsm3060_select01" desc="지점별 매출건수(SELECT)" fetchSize="10">
        <![CDATA[
                SELECT	/* rsm3060_select01 */                                                                                             
				        /*+ rule */
				    TMS, -- 회차            
				    SUM(COUNT8) CNT_TOTAL,	-- 건수총계			     
					SUM(CASE WHEN SELL_CD = DECODE(?,'003','03','01') AND COMM_NO IN ('01','02','03','04','07','08') THEN COUNT8 END) BONGJANG,	-- 0:MEET_CD 경륜 구분 코드)  -- 본장							
				    SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '11' THEN COUNT8 END) JANG01,	-- 수원   	
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '12' THEN COUNT8 END) JANG02,	-- 상봉   
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '13' THEN COUNT8 END) JANG03,	-- 일산   
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '15' THEN COUNT8 END) JANG04,	-- 동대문 
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '14' THEN COUNT8 END) JANG05,	-- 분당   
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '16' THEN COUNT8 END) JANG06,	-- 장안   
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '17' THEN COUNT8 END) JANG07,	-- 산본   
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '18' THEN COUNT8 END) JANG08,	-- 부천   
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '19' THEN COUNT8 END) JANG09,	-- 관악   
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '20' THEN COUNT8 END) JANG10,	-- 길음   
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '21' THEN COUNT8 END) JANG11,	-- 당산   
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '22' THEN COUNT8 END) JANG12,	-- 유성   
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '23' THEN COUNT8 END) JANG13,	-- 인천   
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '24' THEN COUNT8 END) JANG14,	-- 시흥   
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '25' THEN COUNT8 END) JANG15,	-- 논현   
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '26' THEN COUNT8 END) JANG16,	-- 천안   
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '27' THEN COUNT8 END) JANG17,	-- 올림픽 
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '28' THEN COUNT8 END) JANG18,	-- 의정부 
					SUM(CASE WHEN MEET_CD||SELL_CD IN ('00103','00203','00301','00403') AND COMM_NO IN ('01','02','03','04','07','08') THEN COUNT8 END) JANG99,	 -- 공동활용본장
				    SUM(CASE WHEN MEET_CD||SELL_CD IN ('00101','00201','00303','00401') AND COMM_NO = '06' AND DIV_NO = '00' THEN COUNT8 END) GYEJWA00,	-- 계좌(본장) 
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '06' AND DIV_NO = '01' THEN COUNT8 END) GYEJWA01, 		-- 계좌(수원)
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '06' AND DIV_NO = '02' THEN COUNT8 END) GYEJWA02, 		-- 계좌(상봉)
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '06' AND DIV_NO = '03' THEN COUNT8 END) GYEJWA03, 		-- 계좌(일산)
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '06' AND DIV_NO = '04' THEN COUNT8 END) GYEJWA04, 		-- 계좌(동대문)
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '06' AND DIV_NO = '05' THEN COUNT8 END) GYEJWA05, 		-- 계좌(분당)
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '06' AND DIV_NO = '06' THEN COUNT8 END) GYEJWA06, 		-- 계좌(장안)
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '06' AND DIV_NO = '07' THEN COUNT8 END) GYEJWA07, 		-- 계좌(산본)
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '06' AND DIV_NO = '08' THEN COUNT8 END) GYEJWA08, 		-- 계좌(부천)
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '06' AND DIV_NO = '09' THEN COUNT8 END) GYEJWA09, 		-- 계좌(관악)
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '06' AND DIV_NO = '10' THEN COUNT8 END) GYEJWA10, 		-- 계좌(길음)
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '06' AND DIV_NO = '11' THEN COUNT8 END) GYEJWA11, 		-- 계좌(당산)
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '06' AND DIV_NO = '12' THEN COUNT8 END) GYEJWA12, 		-- 계좌(유성)
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '06' AND DIV_NO = '13' THEN COUNT8 END) GYEJWA13, 		-- 계좌(인천)
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '06' AND DIV_NO = '14' THEN COUNT8 END) GYEJWA14, 		-- 계좌(시흥)
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '06' AND DIV_NO = '15' THEN COUNT8 END) GYEJWA15, 		-- 계좌(논현)
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '06' AND DIV_NO = '16' THEN COUNT8 END) GYEJWA16, 		-- 계좌(천안)
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '06' AND DIV_NO = '17' THEN COUNT8 END) GYEJWA17, 		-- 계좌(올림픽)
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '06' AND DIV_NO = '18' THEN COUNT8 END) GYEJWA18, 		-- 계좌(의정부)
					SUM(CASE WHEN MEET_CD||SELL_CD IN ('00103','00203','00301','00403') AND COMM_NO = '06' AND DIV_NO = '00' THEN COUNT8 END) GYEJWA99,	-- 계좌(공동활용본장)
					SUM(CASE WHEN SELL_CD NOT IN('01','03') THEN COUNT8 END) GYOCHA	-- 교차                           
			 FROM
                (
                    SELECT B.MEET_CD
                         , B.TMS
                         , A.SELL_CD
                         , A.COMM_NO
                         , A.DIV_NO
                         , A.GREEN_YN
                         , SUM(A.COUNT8) COUNT8
                    FROM 
                          VW_PC_SELLST A, --구간별매출액                                                                          
			              VW_SDL_INFO B   -- 경주일 정보                                                                              
			        WHERE 1 = 1                               
			        AND A.MEET_CD = B.MEET_CD                                                        
			        AND A.STND_YEAR = B.STND_YEAR
			        AND A.TMS = B.TMS
			        AND A.DAY_ORD = B.DAY_ORD
			        AND B.MEET_CD = ?	-- 1:MEET_CD 개최지 코드                                                                   
					AND B.RACE_DAY >= ?	-- 2:RACE_DAY_ST 검색 기간 시작 일                                                                
					AND B.RACE_DAY <= ?	-- 3:RACE_DAY_END 검색 기간 마지막 일
			        
			]]>
	    </query>
		
    	<query id="rsm3060_groupby01" desc="지점별 매출건수(전체)" fetchSize="10">
           <![CDATA[
			        
        			GROUP BY B.MEET_CD, B.TMS, A.SELL_CD, A.COMM_NO, A.DIV_NO, A.GREEN_YN				
			        -- , ROLLUP(B.TMS)	-- 최종 레코드의  TOTAL, SUM 생성용                                                     
			        ORDER BY B.TMS
                )
            GROUP BY TMS        
            ORDER BY TO_NUMBER(TMS)
        ]]>
    </query>
    
    <query id="rsm3060_select02" desc="지점별 유인발매 건수(SELECT)" fetchSize="10">
        <![CDATA[
                SELECT	/* rsm3060_select02 */                                                                                             
				        /*+ rule */
				    TMS, -- 회차            
				    SUM(AMT) AMT_TOTAL,	-- 건수총계			     
					SUM(CASE WHEN SELL_CD = DECODE(?,'003','03','01') AND COMM_NO IN ('01','02','03','04','07','08') THEN AMT END) BONGJANG,	-- 0:MEET_CD 경륜 구분 코드)  -- 본장							
				    SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '11' THEN AMT END) JANG01,	-- 수원   	
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '12' THEN AMT END) JANG02,	-- 상봉   
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '13' THEN AMT END) JANG03,	-- 일산   
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '15' THEN AMT END) JANG04,	-- 동대문 
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '14' THEN AMT END) JANG05,	-- 분당   
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '16' THEN AMT END) JANG06,	-- 장안   
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '17' THEN AMT END) JANG07,	-- 산본   
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '18' THEN AMT END) JANG08,	-- 부천   
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '19' THEN AMT END) JANG09,	-- 관악   
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '20' THEN AMT END) JANG10,	-- 길음   
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '21' THEN AMT END) JANG11,	-- 당산   
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '22' THEN AMT END) JANG12,	-- 유성   
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '23' THEN AMT END) JANG13,	-- 인천   
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '24' THEN AMT END) JANG14,	-- 시흥   
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '25' THEN AMT END) JANG15,	-- 논현   
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '26' THEN AMT END) JANG16,	-- 천안   
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '27' THEN AMT END) JANG17,	-- 올림픽 
					SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '28' THEN AMT END) JANG18,	-- 의정부 
					SUM(CASE WHEN MEET_CD||SELL_CD IN ('00103','00203','00301','00403') AND COMM_NO IN ('01','02','03','04','07','08') THEN AMT END) JANG99,	 -- 공동활용본장
                    SUM(CNT) CNT_TOTAL,    -- 건수총계                 
                    SUM(CASE WHEN SELL_CD = DECODE(?,'003','03','01') AND COMM_NO IN ('01','02','03','04','07','08') THEN CNT END) BONGJANG_CNT,    -- 0:MEET_CD 경륜 구분 코드)  -- 본장                            
                    SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '11' THEN CNT END) JANG01_CNT,    -- 수원       
                    SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '12' THEN CNT END) JANG02_CNT,    -- 상봉   
                    SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '13' THEN CNT END) JANG03_CNT,    -- 일산   
                    SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '15' THEN CNT END) JANG04_CNT,    -- 동대문 
                    SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '14' THEN CNT END) JANG05_CNT,    -- 분당   
                    SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '16' THEN CNT END) JANG06_CNT,    -- 장안   
                    SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '17' THEN CNT END) JANG07_CNT,    -- 산본   
                    SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '18' THEN CNT END) JANG08_CNT,    -- 부천   
                    SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '19' THEN CNT END) JANG09_CNT,    -- 관악   
                    SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '20' THEN CNT END) JANG10_CNT,    -- 길음   
                    SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '21' THEN CNT END) JANG11_CNT,    -- 당산   
                    SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '22' THEN CNT END) JANG12_CNT,    -- 유성   
                    SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '23' THEN CNT END) JANG13_CNT,    -- 인천   
                    SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '24' THEN CNT END) JANG14_CNT,    -- 시흥   
                    SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '25' THEN CNT END) JANG15_CNT,    -- 논현   
                    SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '26' THEN CNT END) JANG16_CNT,    -- 천안   
                    SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '27' THEN CNT END) JANG17_CNT,    -- 올림픽 
                    SUM(CASE WHEN SELL_CD = '01' AND COMM_NO = '28' THEN CNT END) JANG18_CNT,    -- 의정부 
                    SUM(CASE WHEN MEET_CD||SELL_CD IN ('00103','00203','00301','00403') AND COMM_NO IN ('01','02','03','04','07','08') THEN CNT END) JANG99_CNT     -- 공동활용본장
			 FROM
                (
                   SELECT T.MEET_CD, T.STND_YEAR, T.TMS, SELL_CD, COMM_NO,  COUNT(*) AS CNT, SUM(SOLD_NUM) AS AMT 
                    FROM VW_PC_TELMP T, VW_SDL_INFO V
                    WHERE WIN_TYPE    = '1'
                    AND   T.MEET_CD   = ?
					AND   V.RACE_DAY >= ?	-- 2:RACE_DAY_ST 검색 기간 시작 일                                                                
					AND   V.RACE_DAY <= ?	-- 3:RACE_DAY_END 검색 기간 마지막 일
                    AND   SOLD_NUM    > 0
                    AND   T.STND_YEAR = V.STND_YEAR
                    AND   T.MEET_CD   = V.MEET_CD
                    AND   T.TMS       = V.TMS
                    AND   T.DAY_ORD   = V.DAY_ORD
                    
			]]>
	    </query>
		
    	<query id="rsm3060_groupby02" desc="지점별 유인발매 건수(전체)" fetchSize="10">
           <![CDATA[
			        
        			GROUP BY T.MEET_CD, T.STND_YEAR, T.TMS, SELL_CD, COMM_NO
                )
            GROUP BY TMS        
            ORDER BY TO_NUMBER(TMS)
        ]]>
    </query>
    
    
</queryMap>