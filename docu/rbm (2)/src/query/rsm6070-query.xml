<?xml version="1.0" encoding='EUC-KR'?>

<queryMap desc="rsm6070(환급대상 조회)">
    
    <query id="rsm6070_s01" desc="환급대상조회" fetchSize="10">
      <![CDATA[
          SELECT
         		 	PUBL_DT          
				, 	TSN_NO           
				, 	BRNC_CD          
				, 	DIV_NO           
				, 	PLC_NO           
				, 	RACE_NO          
				, 	CNCL_CD          
				, 	TIC_TYPE_CD      
				, 	TIC_STAS         
				, 	TIC_CONT         
				, 	STOPPAY_REQ_DEPT 
				, 	STOPPAY_REQ_NM   
				, 	STOPPAY_ID   
				,(SELECT USER_NM FROM TBRK_USER WHERE USER_ID=TBRD_STOPPAY_CNCL_CNTNT.STOPPAY_ID) STOPPAY_NM 	--지급정지 요청자명
				,(SELECT HP_NO FROM TBRK_USER WHERE USER_ID=TBRD_STOPPAY_CNCL_CNTNT.STOPPAY_ID) HP_NO 			--지급정지 요청자 핸드폰번호         
				, 	STOPPAY_DT       
				, 	RCPT_DT
				,	RCPT_DEPT_NM																				-- 분실신고서 접수자부서
				,	RCPT_ID
				,(SELECT USER_NM FROM TBRK_USER WHERE USER_ID=TBRD_STOPPAY_CNCL_CNTNT.RCPT_ID) RCPT_NM 			-- 분실신고서접수자명          
				, 	CNCL_REQ_DEPT    
				, 	CNCL_REQ_ID
				,(SELECT USER_NM FROM TBRK_USER WHERE USER_ID=TBRD_STOPPAY_CNCL_CNTNT.CNCL_REQ_ID) CNCL_REQ_NM 	-- 지급정지 해지요청자자명      
				, 	CNCL_ID
				,(SELECT USER_NM FROM TBRK_USER WHERE USER_ID=TBRD_STOPPAY_CNCL_CNTNT.CNCL_ID) CNCL_NM 			-- 지급정지 해지자명   
				, 	CNCL_DT          
				, 	VERI_RSLT_CD     
				, 	VERI_RSLT_DT     
				, 	MISS_REPO_NO     
				, 	MISS_REPO_CD     
				, 	ACDNT_TY_CD      
				, 	SALES_AMT        
				, 	REFUND_TY_CD     
				, 	REFUND_AMT   
				,	REFUND_DEPT_NM
				,	REFUND_ID
				,(SELECT USER_NM FROM TBRK_USER WHERE USER_ID=TBRD_STOPPAY_CNCL_CNTNT.REFUND_ID) REFUND_NM 			-- 환급자명
				,	REFUND_DT
				, 	CUST_NM          
				, 	CUST_PHONE_NO    
				, 	CUST_ADDR 
				,	BIRTH_DAY       
				, 	RMK              
				, 	INST_ID          
				, 	INST_DT          
				,	UPDT_ID          
				, 	UPDT_DT
		 FROM   TBRD_STOPPAY_CNCL_CNTNT		 
		 WHERE  1=1		   		
		   AND  REGEXP_LIKE (DECODE(?, '', '1',TIC_STAS),DECODE(?,'','1',?) )	-- 티켓타입   
		   AND  TSN_NO	LIKE  '%' || NVL(? , TSN_NO)  || '%'
		   --AND  BRNC_CD	LIKE  '%' || NVL(? , BRNC_CD)  || '%'
		   AND  REGEXP_LIKE (DECODE(?, '', '1',BRNC_CD),DECODE(?,'','1',?) )
		   --AND  CUST_NM	LIKE  '%' || NVL(? , CUST_NM)  || '%'
		   AND  DECODE(?,'',1,CUST_NM)  = DECODE(?,'',1,?) 
		   AND	PUBL_DT	BETWEEN ? AND ? 		   
		   ORDER BY MISS_REPO_NO DESC
		
        ]]>
   </query> 

   <query id="rsm6070_u01" desc="환급처리 정보 변경" fetchSize="10">
      <![CDATA[
                 
          UPDATE  TBRD_STOPPAY_CNCL_CNTNT SET		
          		   TIC_STAS 		= ?
          		 , REFUND_DEPT_NM 	= ?
          		 , REFUND_ID 		= ?
		         , REFUND_DT 		= ?		               	
		         , UPDT_ID 			= ?
		         , UPDT_DT 			= SYSDATE		         
		   WHERE  MISS_REPO_NO = ?
		     AND  TSN_NO  = ?
		]]>
   </query>


</queryMap>