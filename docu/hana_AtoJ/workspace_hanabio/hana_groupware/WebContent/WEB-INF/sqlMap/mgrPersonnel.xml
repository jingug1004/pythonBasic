<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 
  * @파일명 : mgrPersonnel.xml
  * @메뉴명 : 부서정보
  * @최초작성일 : 2015/01/28            
  * @author : CHOIILJI                  
  * @수정내역 :	
-->
<mapper namespace="mgrPersonnel"> 
	<!-- 조직 START -->
	<select id="getDepartmentList" parameterType="hashmap" resultType="com.hanaph.gw.co.personnel.vo.DepartmentVO">
		SELECT     TC.DEPT_CD, TC.DEPT_KO_NM, TC.UP_DEPT_CD, TC.SORT_NO,
		           CONNECT_BY_ISLEAF UP_DEPT_GBN 
		      FROM HANAHR.HR_CO_DEPART_0 TC
		START WITH TC.UP_DEPT_CD = '9999' AND TC.USE_YN = 'Y'
		CONNECT BY PRIOR TC.DEPT_CD = TC.UP_DEPT_CD AND TC.USE_YN = 'Y'
		  ORDER SIBLINGS BY TC.SORT_NO
	</select>
	
	<select id="getDepartmentDetail" parameterType="hashmap" resultType="com.hanaph.gw.co.personnel.vo.DepartmentVO">
		SELECT DEPT0.DEPT_CD, DEPT_KO_NM, DEPT_EN_NM, DEPT_NM1, DEPT_AMT, MEDIA_CD,
		       USE_YN, DEPT_OWNER, OLD_DEPT_CD, UP_DEPT_CD,
		       (SELECT DEPT_KO_NM
		          FROM HANAHR.HR_CO_DEPART_0
		         WHERE DEPT_CD = DEPT0.UP_DEPT_CD) UP_DEPT_NM, OPRT_CD, LEVEL_CD,
		       SORT_NO, FIRST_EMP_NO,
		       TO_CHAR (FIRST_REGDATE, 'yyyy-mm-dd hh24:mi:ss') FIRST_REGDATE,
		       LAST_EMP_NO,
		       TO_CHAR (LAST_REGDATE, 'yyyy-mm-dd hh24:mi:ss') LAST_REGDATE, LAST_IP,
		       HIST_REASON_NM, DEPT3.HIST_REASON_CD SALE_DEPT_CD, DEPT3.HIST_FRDT,
		       DEPT3.HIST_TODT
		  FROM HANAHR.HR_CO_DEPART_0 DEPT0,
		       (SELECT DEPT_CD, HIST_FRDT, HIST_TODT, HIST_REASON_CD, HIST_REASON_NM
		          FROM (SELECT   DEPT1.DEPT_CD,
		                         TO_CHAR (TO_DATE (DEPT1.HIST_FRDT, 'yyyymmdd'),
		                                  'yyyy-mm-dd'
		                                 ) HIST_FRDT,
		                         TO_CHAR (TO_DATE (DEPT1.HIST_TODT, 'yyyymmdd'),
		                                  'yyyy-mm-dd'
		                                 ) HIST_TODT,
		                         DEPT1.HIST_REASON_CD, CO.COMN_NM HIST_REASON_NM,
		                         ROWNUM RNUM
		                    FROM HANAHR.HR_CO_DEPART_1 DEPT1,
		                         HANAHR.HR_CO_COMMON_0 CO
		                   WHERE DEPT1.DEPT_CD = #{dept_cd}
		                     AND DEPT1.USE_YN = 'Y'
		                     AND CO.COMN_CD(+) = DEPT1.HIST_REASON_CD
		                ORDER BY SEQ DESC)
		         WHERE RNUM = 1) DEPT3
		 WHERE DEPT3.DEPT_CD = DEPT0.DEPT_CD
	 </select>
	 
	<select id="getDepartmentSubList" parameterType="hashmap" resultType="com.hanaph.gw.co.personnel.vo.DepartmentVO">
		SELECT   DEPT_CD, DEPT_KO_NM, DEPT_EN_NM, SORT_NO
		    FROM HANAHR.HR_CO_DEPART_0 
		   WHERE UP_DEPT_CD = #{dept_cd} AND USE_YN = 'Y'
		ORDER BY SORT_NO
	</select>
	
	<select id="getDepartmentTerminalList" parameterType="hashmap" resultType="com.hanaph.gw.co.personnel.vo.DepartmentVO">
		 SELECT DEPT_CD, DEPT_KO_NM, UP_DEPT_CD, SORT_NO, UP_DEPT_GBN
		  FROM (SELECT     TC.DEPT_CD, TC.DEPT_KO_NM, TC.UP_DEPT_CD, TC.SORT_NO,
		                   CONNECT_BY_ISLEAF UP_DEPT_GBN
		              FROM HANAHR.HR_CO_DEPART_0 TC
		<if test="dept_ko_nm != null and dept_ko_nm !=''">		              
		             WHERE DEPT_KO_NM LIKE '%' || #{dept_ko_nm} || '%'
		</if>
		        START WITH TC.DEPT_CD = #{up_dept_cd} AND TC.USE_YN = 'Y'
		        CONNECT BY PRIOR TC.DEPT_CD = TC.UP_DEPT_CD AND TC.USE_YN = 'Y'
		          ORDER SIBLINGS BY TC.SORT_NO)
		 WHERE UP_DEPT_GBN = '1'
	</select>
	<!-- 조직 END -->
</mapper>
	
