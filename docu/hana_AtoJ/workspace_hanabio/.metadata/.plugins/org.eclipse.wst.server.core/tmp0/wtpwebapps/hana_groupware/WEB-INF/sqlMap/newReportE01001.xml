<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 
  * @파일명 : newReportE01001.xml
  * @메뉴명 : 휴가신청서
  * @최초작성일 : 2015/02/10            
  * @author : Jung.Jin.Muk(pc123pc@irush.co.kr)                  
  * @수정내역 :	
-->
<mapper namespace="newReportE01001">

 	<select id="vacationDetail" parameterType="string" resultType="com.hanaph.gw.ea.newReport.vo.VacationVO">
		SELECT APPROVAL_SEQ, F_GW_GET_CD_NM(VACATION_KIND) VACATION_KIND, VACATION_KIND CD, TO_CHAR(TO_DATE(START_YMD,'yyyymmdd'),'yyyy-mm-dd') START_YMD,
		       TO_CHAR(TO_DATE(END_YMD,'yyyymmdd'),'yyyy-mm-dd') END_YMD, REASON,
		       CONTACT_NUMBER
		       ,( 
		       	SELECT COUNT(*) 
             	FROM HANAHR.HR_CO_HOLIDA_0 B
             	WHERE TO_DATE(B.HOLI_DT ,'YYYYMMDD') <![CDATA[>=]]> TO_DATE(START_YMD ,'YYYYMMDD')
                AND TO_DATE(B.HOLI_DT ,'YYYYMMDD') <![CDATA[<=]]> TO_DATE(END_YMD ,'YYYYMMDD')
             	) AS HOLIDAY_CNT        
		  FROM GW_EA_VACATION
		 WHERE APPROVAL_SEQ = #{approval_seq}
	</select>
	
	<update id="updateVacation" parameterType="com.hanaph.gw.ea.newReport.vo.VacationVO">
		UPDATE GW_EA_VACATION 
		   SET VACATION_KIND = #{vacation_kind}, START_YMD = TO_CHAR(TO_DATE(#{start_ymd},'yyyy-mm-dd'),'yyyymmdd'), 
			   END_YMD = TO_CHAR(TO_DATE(#{end_ymd},'yyyy-mm-dd'),'yyyymmdd'), REASON = #{reason}, CONTACT_NUMBER = #{contact_number}
		 WHERE APPROVAL_SEQ = #{approval_seq}	
	</update>
		
	<insert id="insertVacation" parameterType="com.hanaph.gw.ea.newReport.vo.VacationVO" >
		INSERT INTO GW_EA_VACATION
        (
			APPROVAL_SEQ, VACATION_KIND, START_YMD, END_YMD, REASON, CONTACT_NUMBER
        )
    	VALUES
    	(
        	#{approval_seq}, #{vacation_kind}, TO_CHAR(TO_DATE(#{start_ymd},'yyyy-mm-dd'),'yyyymmdd'), TO_CHAR(TO_DATE(#{end_ymd},'yyyy-mm-dd'),'yyyymmdd'),
        	#{reason}, #{contact_number}
    	)
	</insert>
	
</mapper>