<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 
  * @파일명 : person.xml
  * @메뉴명 : 개인결재라인
  * @최초작성일 : 2015/01/28            
  * @author : CHOIILJI                  
  * @수정내역 :	
-->
<mapper namespace="person"> 
	<select id="getPersonLineList" parameterType="hashmap" resultType="com.hanaph.gw.ea.person.vo.PersonLineVO">
		-- 개인결재라인 Master 리스트를 가져온다 / getPersonLineList / @ person.xml / 전자결재-신규문서작성-스텝1-스텝2
		SELECT   PERSON_SEQ, EMP_NO, CREATE_DT, CREATE_NO, SUBJECT
		    FROM GW_EA_PERSON_LINE
		   WHERE EMP_NO = #{emp_no}
		ORDER BY PERSON_SEQ DESC 
	</select>
	
	<select id="getPersonSeq" resultType="int">
		-- 결재라인 시퀀스 가져온다 / getPersonSeq / @ person.xml / 전자결재-신규문서작성-스텝1-스텝2
		SELECT SEQ_GW_EA_PERSON_LINE.NEXTVAL FROM DUAL
	</select>

	<insert id="insertPersonLine" parameterType="com.hanaph.gw.ea.person.vo.PersonLineVO">
		INSERT INTO GW_EA_PERSON_LINE
				(PERSON_SEQ, EMP_NO, CREATE_DT, CREATE_NO, SUBJECT
	            )
	     VALUES (#{person_seq} , #{emp_no}, SYSDATE, #{create_no}, #{subject}
	            )
	</insert>
	
	<delete id="deletePersonLine"  parameterType="hashmap">
		DELETE FROM GW_EA_PERSON_LINE WHERE PERSON_SEQ = #{person_seq}
	</delete>
	
	<select id="getPersonApprovalDetailList" parameterType="hashmap" resultType="com.hanaph.gw.ea.person.vo.PersonApprovalVO">
		-- 개인결재라인 가져온다 / getPersonApprovalDetailList / @ person.xml /
		SELECT PERSON.EMP_NO
		,PERSON_SEQ
		,ORDERING
		,CREATE_DT
		,CREATE_NO
		,EMP.EMPNAME AS EMP_KO_NM
		FROM GW_EA_PERSON_APPROVAL PERSON
		,ORAGMP.CMEMPM EMP
		WHERE PERSON.EMP_NO = EMP.EMPCODE
		AND EMP.RETIREDT IS NULL
		AND PERSON_SEQ = #{person_seq}
		ORDER BY ORDERING ASC
	</select>
	
	<insert id="insertPersonApproval" parameterType="com.hanaph.gw.ea.person.vo.PersonApprovalVO">
		INSERT INTO GW_EA_PERSON_APPROVAL
	            (EMP_NO, PERSON_SEQ, ORDERING, CREATE_DT, CREATE_NO
	            )
	     VALUES (#{emp_no} , #{person_seq} , #{ordering} ,SYSDATE, #{create_no} 
	            )
	</insert>
	
	<delete id="deletePersonApproval" parameterType="hashmap">
		DELETE FROM GW_EA_PERSON_APPROVAL WHERE PERSON_SEQ = #{person_seq}
	</delete>

	<select id="getPersonImplDeptDetailList" parameterType="hashmap" resultType="com.hanaph.gw.ea.person.vo.PersonImplDeptVO">
		-- 개인시행부서 가져온다 / getPersonImplDeptDetailList / @ person.xml /
		SELECT DISTINCT IMPL.DEPT_CD
		,IMPL.PERSON_SEQ
		,IMPL.ORDERING
		,IMPL.CREATE_DT
		,IMPL.CREATE_NO
		,DECODE(LENGTH(IMPL.DEPT_CD), 4 ,ORAGMP.F_GET_DEPT_NM(IMPL.DEPT_CD), ORAGMP.F_GET_EMP_KO_NM(IMPL.DEPT_CD)) DEPT_KO_NM
		FROM GW_EA_PERSON_IMPL_DEPT IMPL
		        ,(                   
		                SELECT EMP.EMPCODE AS EMP_NO
                        ,DEPT.DEPTCODE AS DEPT_CD
                        FROM ORAGMP.CMEMPM EMP
                        ,ORAGMP.CMDEPTM DEPT
                        WHERE EMP.DEPTCODE = DEPT.DEPTCODE
                        AND EMP.RETIREDT IS NULL
                        AND DEPT.USEYN = 'Y'                           
        		) B
		WHERE (IMPL.DEPT_CD = B.DEPT_CD OR IMPL.DEPT_CD = B.EMP_NO) 
		AND PERSON_SEQ = #{person_seq}
		ORDER BY ORDERING ASC 
	</select>
	
	<insert id="insertPersonImplDept" parameterType="com.hanaph.gw.ea.person.vo.PersonImplDeptVO">
		INSERT INTO GW_EA_PERSON_IMPL_DEPT
	            (DEPT_CD, PERSON_SEQ, ORDERING, CREATE_DT, CREATE_NO
	            )
	     VALUES (#{dept_cd}, #{person_seq}, #{ordering}, SYSDATE, #{create_no}
	            )
	</insert>
	
	<delete id="deletePersonImplDept" parameterType="hashmap">
		DELETE FROM GW_EA_PERSON_IMPL_DEPT WHERE PERSON_SEQ = #{person_seq}
	</delete>
</mapper>