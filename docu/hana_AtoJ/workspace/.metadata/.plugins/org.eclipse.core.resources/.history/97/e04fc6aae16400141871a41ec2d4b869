<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ include file ="/common/path.jsp" %>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>하나제약 온라인 주문 index</title>
<script type="text/javascript" src="<%=ONLINE_WEB_ROOT%>/js/jquery-1.11.1.min.js"></script>
<script type="text/javascript">
	function goLogin(){
		
		var empCode = $("#empCode").val();
		var password = $("#password").val();
		
		if(empCode == ""){
			alert("아이디를 입력 하세요.");
			$("#empCode").focus();
			return;
		}
		
		if(password == ""){
			alert("비밀번호를 입력 하세요.");
			$("#password").focus();
			return;
		}
		
		$.ajax({
	           type:"POST",
	           data : "empCode="+empCode+"&password="+password,
	           url:"<%=ONLINE_ROOT%>/member/getLogin.do",
	           dataType:"json",
	           
	           success : function(data) {
	        	   console.log(data.resultcode);
	        	   if(data.resultcode != 1){
	        		  if(data.resultcode == 2){
	        			alert("비밀번호 오류!"); 
	        			$("#password").val() == "";
	        		  }else{
	        			alert("사원번호 오류!");  
	        			$("#empCode").val() == "";
	        		  }
	        	   }else{
	        		   location.href = "<%=ONLINE_ROOT%>/main.do"; 
	        	   }
	           },
// 	           complete : function(data) {
// 	                 // 통신이 실패했어도 완료가 되었을 때 이 함수를 타게 된다.
// 	                 // TODO
// 	           },
	           error : function(xhr, status, error) {
	                 alert("장애가 발생하였습니다.\n잠시 후 다시 시도해주세요.");
	           }
	     });

	}
	
	function setCookie(name, value, expires) {
		document.cookie = name + "=" + escape(value) + "; path=/; expires="
				+ expires.toGMTString();
	}

	function getCookie() {
		var search = "saveid=";
		if (document.cookie.length > 0) { // 쿠키가 설정되어 있다면
			offset = document.cookie.indexOf(search);
			if (offset != -1) { // 쿠키가 존재하면
				offset += search.length;
				// set index of beginning of value
				end = document.cookie.indexOf(";", offset);
				// 쿠키 값의 마지막 위치 인덱스 번호 설정
				if (end == -1)
					end = document.cookie.length;
				return unescape(document.cookie.substring(offset, end));
			}
		}
		return "";
	}
	
	function saveid() {
		var expdate = new Date();
		// 기본적으로 1일동안 기억하게 함. 일수를 조절하려면 * 1에서 숫자를 조절하면 됨
		if ($("input:checkbox[id='checksaveid']").is(":checked"))
			expdate.setTime(expdate.getTime() + 1000 * 3600 * 24 * 1); // 1일
		else
			expdate.setTime(expdate.getTime() - 1); // 쿠키 삭제조건
		setCookie("saveid", $("#empCode").val(), expdate);
	}
	
	$(window).load(function() { 
		
		var idCookie = getCookie("saveid");
		
		if(idCookie.trim() != ""){
			$("#empCode").val(idCookie);
			$("#checksaveid").attr('checked',true);
		}
		
	});
	
</script>
</head>
<body>
	<form name="loginFrm">
		아이디 : <input type="text" name="empCode" id="empCode" /><br />
		비밀번호 : <input type="password" name="password" id="password" />
		아이디 저장<input type="checkbox" name="checksaveid" id="checksaveid" onClick="javascript:saveid();" />
		<input type="button" value="login" onclick="javascript:goLogin();"/>
	</form>
</body>
</html>