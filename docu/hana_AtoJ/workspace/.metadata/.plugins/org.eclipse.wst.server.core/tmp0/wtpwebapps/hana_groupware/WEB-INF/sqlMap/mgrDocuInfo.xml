<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 
  * @파일명 : mgrDocuInfo.xml
  * @메뉴명 : 양식정보관리, 기본 결재라인
  * @최초작성일 : 2015/01/28            
  * @author : CHOIILJI                  
  * @수정내역 :	
-->
<mapper namespace="mgrDocuInfo"> 
	<!-- 양식정보관리 START-->
	<select id="getDocumentInfoList" parameterType="hashmap" resultType="com.hanaph.gw.ea.mgrDocuInfo.vo.DocumentInfoVO">
		-- 양식정보 리스트 가져온다 / getDocumentInfoList / @ mgrDocuInfo.xml / 메인 헤더 - 전자결재 클릭
		SELECT ROWNUM RNUM, DOCU_SEQ, DEPT_CD, ORAGMP.F_GET_DEPT_NM (DEPT_CD) DEPT_KO_NM, 
			   DOCU_NM, DOCU_CD, DECIDE_YN, SECURITY_YN, CONTENTS, CREATE_DT, CREATE_NO, MODIFY_DT, MODIFY_NO, USE_YN, ORDERING
			   FROM
			   (
				SELECT   DOCU.DOCU_SEQ, DOCU.DEPT_CD,
					     ORAGMP.F_GET_DEPT_NM(DOCU.DEPT_CD) DEPT_KO_NM, DOCU.DOCU_NM,
				         DOCU.DOCU_CD, DOCU.DECIDE_YN, DOCU.SECURITY_YN, DOCU.CONTENTS, DOCU.CREATE_DT,
				         DOCU.CREATE_NO, DOCU.MODIFY_DT, DOCU.MODIFY_NO, DOCU.USE_YN, CODE.ORDERING
				    FROM GW_EA_DOCU DOCU, GW_CO_CODE CODE
				   WHERE DOCU.DOCU_CD = CODE.CD
				     AND DEPT_CD = #{search_dept_cd}
				     AND CODE.USE_YN = 'Y'
		           	<if test="use_yn != null and use_yn !=''">  
				     AND DOCU.USE_YN = #{use_yn}
		           	</if>    
					<if test="search_docu_nm != null and search_docu_nm !=''">  
				     AND DOCU.DOCU_NM LIKE '%' || #{search_docu_nm} || '%'
					</if>
					<if test="menu != null and menu !=''">
					<if test="menu eq '0201'">
					 AND DOCU.DOCU_CD <![CDATA[ <> ]]> 'E01012'
					</if>
					</if>
				ORDER BY CODE.ORDERING ASC
			)		
	</select>
	
	<select id="getDocumentInfoCount" parameterType="hashmap" resultType="int">
		-- 양식정보 리스트 전체 카운트 카운트를 가져온다 / getDocumentInfoCount / @ mgrDocuInfo.xml / 메인 헤더 - 전자결재 클릭
		SELECT COUNT(*) 
		  FROM GW_EA_DOCU DOCU, GW_CO_CODE CODE
	     WHERE DOCU.DOCU_CD = CODE.CD
		   AND DEPT_CD = #{search_dept_cd}
		   AND CODE.USE_YN = 'Y'
		<if test="use_yn != null and use_yn !=''">  
           AND DOCU.USE_YN = #{use_yn}
        </if>
		<if test="search_docu_nm != null and search_docu_nm !=''">  
		   AND DOCU.DOCU_NM LIKE '%' || #{search_docu_nm} || '%'
		</if>		
		<if test="menu != null and menu !=''">
		<if test="menu eq '0201'">
		  AND DOCU.DOCU_CD <![CDATA[ <> ]]> 'E01012'
		</if>
		</if> 
	</select>
	
	<select id="getDocumentInfoDetail" parameterType="hashmap" resultType="com.hanaph.gw.ea.mgrDocuInfo.vo.DocumentInfoVO">
		-- 문서(양식) 정보 상세 가져온다 / getDocumentInfoDetail / @ mgrDocuInfo.xml / 시행문서조회 - 결재중 - 문서 상세 페이지
		SELECT DOCU_SEQ, DEPT_CD, ORAGMP.F_GET_DEPT_NM (DEPT_CD) DEPT_KO_NM, DOCU_NM,
		       DOCU_CD, DECIDE_YN, SECURITY_YN, CONTENTS, TO_CHAR(CREATE_DT, 'yyyy-mm-dd') CREATE_DT, 
		       CREATE_NO, MODIFY_DT, MODIFY_NO, USE_YN
		  FROM GW_EA_DOCU
		 WHERE DOCU_SEQ = #{docu_seq} 
	</select>
	
	<update id="updateDocumentInfo" parameterType="com.hanaph.gw.ea.mgrDocuInfo.vo.DocumentInfoVO">
		UPDATE GW_EA_DOCU
		   SET DECIDE_YN = #{decide_yn},
		       SECURITY_YN = #{security_yn},
		       CONTENTS = #{contents},
		       MODIFY_DT = SYSDATE,
		       MODIFY_NO = #{modify_no},
		       USE_YN = #{use_yn}
		 WHERE DOCU_SEQ = #{docu_seq} 
	</update>
	
	<select id="selectDocuSeq" parameterType="hashmap" resultType="String">
		-- 시간외 근무 내역서만 예외로 자동 생성으로 키값이 필요하기 때문에 가져온다 / selectDocuSeq / @ mgrDocuInfo.xml / 시행문서조회 - 결재중 - 문서 상세 페이지
		SELECT DOCU_SEQ
		  FROM GW_EA_DOCU
		 WHERE DEPT_CD = #{dept_cd} AND DOCU_CD = #{docu_cd} 
	</select>
	<!-- 양식정보관리 END-->
	
	<!-- 문서별 기본 결재 라인 START-->
	<select id="getBasicApprovalDetailList" parameterType="hashmap" resultType="com.hanaph.gw.ea.mgrDocuInfo.vo.BasicApprovalVO">
		-- [문서별 기본 결재 라인] 1/3 START 문서별 기본결재라인 가져온다 / getBasicApprovalDetailList / @ mgrDocuInfo.xml / 전자결재-신규문서작성-샘플신청서-Step1
		SELECT DOCU_SEQ
		,BASIC.EMP_NO
		,ORDERING
		,CREATE_DT
		,CREATE_NO
		,EMP.EMPNAME AS EMP_KO_NM
		FROM GW_EA_BASIC_APPROVAL BASIC
		,ORAGMP.CMEMPM EMP
		WHERE BASIC.EMP_NO = EMP.EMPCODE
		AND EMP.RETIREDT IS NULL
		AND DOCU_SEQ = #{docu_seq}
		ORDER BY ORDERING ASC
	</select>
	
	<insert id="insertBasicApproval" parameterType="com.hanaph.gw.ea.mgrDocuInfo.vo.BasicApprovalVO">
		-- [문서별 기본 결재 라인] 2/3 START / insertBasicApproval
		INSERT INTO GW_EA_BASIC_APPROVAL
	            (DOCU_SEQ, EMP_NO, ORDERING, CREATE_DT, CREATE_NO
	            )
	     VALUES (#{docu_seq} , #{emp_no} , #{ordering} , SYSDATE, #{create_no} 
	            )
	</insert>
	
	<delete id="deleteBasicApproval" parameterType="hashmap">
		-- [문서별 기본 결재 라인] 3/3 END / deleteBasicApproval
		DELETE FROM GW_EA_BASIC_APPROVAL WHERE DOCU_SEQ = #{docu_seq}
	</delete>
	<!-- 문서별 기본 결재 라인 END-->
	
	<!-- 문서별 기본 시행 라인 START-->
	<select id="getBasicImplDeptDetailList" parameterType="hashmap" resultType="com.hanaph.gw.ea.mgrDocuInfo.vo.BasicImplDeptVO">
		-- [문서별 기본 시행 라인] 1/3 START / getBasicImplDeptDetailList / @ mgrDocuInfo.xml /
		SELECT IMPL.DOCU_SEQ
		,IMPL.DEPT_CD
		,IMPL.ORDERING
		,IMPL.CREATE_DT
		,IMPL.CREATE_NO
		,DEPT.DEPTNAME AS DEPT_KO_NM
		FROM GW_EA_BASIC_IMPL_DEPT IMPL
		,ORAGMP.CMDEPTM DEPT
		WHERE IMPL.DEPT_CD = DEPT.DEPTCODE
		AND IMPL.DOCU_SEQ = #{docu_seq} 
		AND DEPT.USEYN = 'Y' 
		ORDER BY ORDERING ASC
	</select>
	
	<insert id="insertBasicImplDept" parameterType="com.hanaph.gw.ea.mgrDocuInfo.vo.BasicImplDeptVO">
		-- [문서별 기본 시행 라인] 2/3 START / insertBasicImplDept
		INSERT INTO GW_EA_BASIC_IMPL_DEPT
	            (DOCU_SEQ, DEPT_CD, ORDERING, CREATE_DT, CREATE_NO
	            )
	     VALUES (#{docu_seq} , #{dept_cd}, #{ordering}, SYSDATE, #{create_no}
	            )
	</insert>
	
	<delete id="deleteBasicImplDept" parameterType="hashmap">
		-- [문서별 기본 시행 라인] 3/3 END / deleteBasicImplDept
		DELETE FROM GW_EA_BASIC_IMPL_DEPT WHERE DOCU_SEQ = #{docu_seq}
	</delete>
	<!-- 문서별 기본 시행 라인 END-->
	
</mapper>