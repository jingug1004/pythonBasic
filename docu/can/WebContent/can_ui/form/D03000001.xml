<?xml version="1.0" encoding="euc-kr"?>
<Window>
	<Form Height="590" Id="D03000001" Left="8" OnLoadCompleted="fcFormLoadSetting" OnUnloadCompleted="fcFormUnloadProcess" PidAttrib="7" Title="기숙사배정" Top="8" Ver="1.0" Width="1014" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="dsPerioNo" OnLoadCompleted="dsPerioNo_OnLoadCompleted">
				<Contents>
					<colinfo id="RACER_PERIO_NO" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="dsCandDormAssign" OnColumnChanged="dsCandDormAssign_OnColumnChanged" OnLoadCompleted="dsCandDormAssign_OnLoadComleted" OnRowPosChanged="dsCandDormAssign_OnRowPosChanged">
				<Contents>
					<colinfo id="CHK" size="256" type="STRING"/>
					<colinfo id="RACER_PERIO_NO" size="256" type="STRING"/>
					<colinfo id="BUILD" size="256" type="STRING"/>
					<colinfo id="ROOM_NO" size="256" type="STRING"/>
					<colinfo id="CAND_NO" size="256" type="STRING"/>
					<colinfo id="ROOM_CHIEF_YN" size="256" type="STRING"/>
					<colinfo id="NM_KOR" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="dsCandIdent">
				<Contents>
					<colinfo id="CHK" size="256" type="STRING"/>
					<colinfo id="RACER_PERIO_NO" size="256" type="STRING"/>
					<colinfo id="CAND_NO" size="256" type="STRING"/>
					<colinfo id="NM_KOR" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="dsSearchBuild">
				<Contents>
					<colinfo id="GRP_CD" size="256" type="STRING"/>
					<colinfo id="CD" size="256" type="STRING"/>
					<colinfo id="CD_NM" size="256" type="STRING"/>
					<record>
						<CD></CD>
						<CD_NM></CD_NM>
						<GRP_CD></GRP_CD>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="dsSearchRoomNo">
				<Contents>
					<colinfo id="GRP_CD" size="256" type="STRING"/>
					<colinfo id="CD" size="256" type="STRING"/>
					<colinfo id="CD_NM" size="256" type="STRING"/>
					<record>
						<CD></CD>
						<CD_NM></CD_NM>
						<GRP_CD></GRP_CD>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="dsCandNo">
				<Contents>
					<colinfo id="NM_KOR" size="256" type="STRING"/>
					<colinfo id="CAND_NO" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="dsPK">
				<Contents>
					<colinfo id="RACER_PERIO_NO" size="256" type="STRING"/>
					<colinfo id="CAND_NO" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="dsInComCd">
				<Contents>
					<colinfo id="DSNAME" size="20" type="STRING"/>
					<colinfo id="CD_GRP_ID" size="6" type="STRING"/>
					<colinfo id="QUERY_ID" size="256" type="STRING"/>
					<colinfo id="DESCRIPTION" size="256" type="STRING"/>
					<colinfo id="ALL_YN" size="1" type="STRING"/>
					<record>
						<ALL_YN></ALL_YN>
						<CD_GRP_ID>D30001</CD_GRP_ID>
						<DESCRIPTION>기숙사배정(동)</DESCRIPTION>
						<DSNAME>dsSearchBuild</DSNAME>
						<QUERY_ID></QUERY_ID>
					</record>
					<record>
						<ALL_YN></ALL_YN>
						<CD_GRP_ID></CD_GRP_ID>
						<DESCRIPTION>기숙사배정(호)</DESCRIPTION>
						<DSNAME>dsSearchRoomNo</DSNAME>
						<QUERY_ID>item_code_d03000001</QUERY_ID>
					</record>
					<record>
						<ALL_YN></ALL_YN>
						<CD_GRP_ID>D30001</CD_GRP_ID>
						<DESCRIPTION>기숙사배정(동)</DESCRIPTION>
						<DSNAME>dsComboBuild</DSNAME>
						<QUERY_ID></QUERY_ID>
					</record>
					<record>
						<ALL_YN></ALL_YN>
						<CD_GRP_ID></CD_GRP_ID>
						<DESCRIPTION>기숙사배정(호)</DESCRIPTION>
						<DSNAME>dsComboRoomNo</DSNAME>
						<QUERY_ID>item_code_d03000001</QUERY_ID>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="dsComboBuild">
				<Contents>
					<colinfo id="GRP_CD" size="256" type="STRING"/>
					<colinfo id="CD" size="256" type="STRING"/>
					<colinfo id="CD_NM" size="256" type="STRING"/>
					<record>
						<CD></CD>
						<CD_NM></CD_NM>
						<GRP_CD></GRP_CD>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="dsComboRoomNo">
				<Contents>
					<colinfo id="GRP_CD" size="256" type="STRING"/>
					<colinfo id="CD" size="256" type="STRING"/>
					<colinfo id="CD_NM" size="256" type="STRING"/>
					<record>
						<CD></CD>
						<CD_NM></CD_NM>
						<GRP_CD></GRP_CD>
					</record>
				</Contents>
			</Dataset>
		</Datasets>
		<Edit Height="21" Id="edRoomNo" Left="595" MaxLength="8" TabOrder="21" Top="68" UpperOnly="TRUE" Visible="FALSE" Width="65"></Edit>
		<Edit Height="21" Id="edBuid" Left="448" MaxLength="8" TabOrder="20" Top="68" UpperOnly="TRUE" Visible="FALSE" Width="65"></Edit>
		<Shape BKColor="user0" Bottom="58" Height="28" Id="Shape0" Left="6" LineColor="user1" Right="1008" RoundHeight="5" RoundUnit="Pixel" RoundWidth="5" TabOrder="1" Top="30" Type="RoundRect" Width="1002"></Shape>
		<Static Align="Right" Height="20" Id="Static6" Left="12" Style="snis_if_lable" TabOrder="3" Text="기수" Top="34" VAlign="Middle" Width="36"></Static>
		<Combo Border="Flat" CodeColumn="RACER_PERIO_NO" DataColumn="RACER_PERIO_NO" Height="20" Id="cbPerioNo" INDEX="0" InnerDataset="dsPerioNo" Left="48" OnChanged="inputCombo_OnChanged" Style="snis_if_input01" TabOrder="5" Top="32" Width="127"></Combo>
		<Static Height="22" Id="stFormTitle" Left="30" Style="snis_m_title" TabOrder="2" Text="조회조건" Top="6" VAlign="Middle" Width="132"></Static>
		<Image Height="20" Id="imgFormTitle" ImageID="m_titleblet" Left="8" TabOrder="4" Top="8" Width="17"></Image>
		<Div Height="20" Id="divBtnLst" Left="678" TabOrder="6" Text="Div0" Top="6" Url="common::comButtonType.xml" Width="330">
			<Contents></Contents>
		</Div>
		<Static Align="Right" Height="20" Id="Static0" Left="179" Style="snis_if_lable" TabOrder="7" Text="동" Top="34" VAlign="Middle" Width="36"></Static>
		<Combo Border="Flat" CodeColumn="CD" DataColumn="CD_NM" Height="20" Id="cbSearchBuild" ImeMode="none" InnerDataset="dsSearchBuild" Left="217" OnChanged="inputCombo_OnChanged" Style="snis_if_input01" TabOrder="8" Top="33" Width="127"></Combo>
		<Static Align="Right" Height="20" Id="Static1" Left="346" Style="snis_if_lable" TabOrder="9" Text="호실" Top="34" VAlign="Middle" Width="36"></Static>
		<Combo Border="Flat" CodeColumn="CD" DataColumn="CD_NM" Height="20" Id="cbSearchRoomNo" InnerDataset="dsSearchRoomNo" Left="384" OnChanged="inputRoomCombo_OnChanged" Style="snis_if_input01" TabOrder="10" Top="33" Width="127"></Combo>
		<Grid AutoFit="TRUE" AutoFitEndLine="Hide" BindDataset="dsCandIdent" BKColor="user15" BkColor2="user16" BkSelColor="user17" BoldHead="true" Border="Flat" BorderColor="user22" Bottom="576" Editable="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="20" Height="512" Id="grdCandIdent" InputPanel="FALSE" Left="8" LineColor="user18" MinWidth="100" OnHeadClick="fcGridSort" Right="308" SelColor="user19" Style="snis_grid" TabOrder="11" TabStop="true" Top="64" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="FALSE" VLineColor="default" WheelScrollRow="1" Width="300">
			<contents>
				<format id="Default">
					<columns>
						<col width="38"/>
						<col width="54"/>
						<col width="100"/>
						<col width="100"/>
					</columns>
					<head>
						<cell bkcolor="user20" col="0" color="user21" display="text" font="굴림,9"/>
						<cell bkcolor="user20" col="1" color="user21" display="text" font="굴림,9" text="순번"/>
						<cell bkcolor="user20" col="2" color="user21" display="text" font="굴림,9" text="후보생번호"/>
						<cell bkcolor="user20" col="3" color="user21" display="text" font="굴림,9" text="성명"/>
					</head>
					<body>
						<cell align="center" celltype="body" col="0" colid="CHK" display="checkbox" edit="checkbox"/>
						<cell align="center" col="1" display="text" expr="currow+1"/>
						<cell align="center" col="2" colid="CAND_NO" display="text"/>
						<cell align="center" col="3" colid="NM_KOR" display="text"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Button Height="37" Id="btAdd" Left="336" OnClick="btAdd_OnClick" TabOrder="12" Text="▶" Top="280" Visible="FALSE" Width="56"></Button>
		<Button Height="40" Id="btDel" Left="336" OnClick="btDel_OnClick" TabOrder="13" Text="◀" Top="328" Visible="FALSE" Width="56"></Button>
		<Grid AutoEnter="TRUE" AutoFit="TRUE" AutoFitEndLine="Hide" BindDataset="dsCandDormAssign" BKColor="user15" BkColor2="user16" BkSelColor="user17" BoldHead="true" Border="Flat" BorderColor="user22" Bottom="576" Editable="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="20" Height="512" Id="grdCandDormAssign" InputPanel="FALSE" Left="8" LineColor="user18" MinWidth="100" OnCellClick="dsCandDormAssign_OnCellClick" OnHeadClick="fcGridSort" Right="712" SelColor="user19" Style="snis_grid" TabOrder="14" TabStop="true" Top="64" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="704">
			<contents>
				<format id="Default">
					<columns>
						<col width="0"/>
						<col width="65"/>
						<col width="114"/>
						<col width="100"/>
						<col width="65"/>
						<col width="61"/>
						<col width="61"/>
					</columns>
					<head>
						<cell bkcolor="user20" celltype="body" col="0" color="user21" display="text"/>
						<cell bkcolor="user20" col="1" color="user21" display="text" font="굴림,9" text="순번"/>
						<cell bkcolor="user20" col="2" color="user21" display="text" font="굴림,9" text="후보생번호"/>
						<cell bkcolor="user20" col="3" color="user21" display="text" font="굴림,9" text="성명"/>
						<cell bkcolor="user20" col="4" color="user21" display="text" font="굴림,9" text="기숙사동"/>
						<cell bkcolor="user20" col="5" color="user21" display="text" font="굴림,9" text="기숙사호"/>
						<cell bkcolor="user20" col="6" color="user21" display="text" font="굴림,9" text="실장여부"/>
					</head>
					<body>
						<cell align="center" col="0" colid="CHK" display="checkbox" edit="checkbox"/>
						<cell align="center" col="1" display="text" expr="currow+1"/>
						<cell align="center" col="2" colid="CAND_NO" display="text"/>
						<cell align="center" col="3" colid="NM_KOR" display="text"/>
						<cell col="4" colid="BUILD" combocol="CD" combodataset="dsComboBuild" combotext="CD_NM" display="combo" edit="combo"/>
						<cell col="5" colid="ROOM_NO" combocol="CD" combodataset="dsComboRoomNo" combotext="CD_NM" display="combo" edit="combo"/>
						<cell align="center" col="6" colid="ROOM_CHIEF_YN" display="checkbox" edit="checkbox" expr='iif&#32;(ROOM_CHIEF_YN&#32;=&#32;&quot;1&quot;,&#32;&quot;1&quot;,&#32;&quot;0&quot;)'/>
					</body>
				</format>
			</contents>
		</Grid>
		<Shape BKColor="user20" Bottom="92" Height="28" Id="Shape1" Left="423" LineColor="user1" Right="712" RoundHeight="5" RoundUnit="Pixel" RoundWidth="5" TabOrder="15" Top="64" Type="RoundRect" Visible="FALSE" Width="289"></Shape>
		<Static Border="None" Font="굴림,9,Bold" Height="20" Id="Static3" Left="431" TabOrder="16" Text="동" Top="72" Visible="FALSE" Width="25"></Static>
		<Static Border="None" Font="굴림,9,Bold" Height="17" Id="Static2" Left="568" TabOrder="17" Text="호실" Top="73" Visible="FALSE" Width="40"></Static>
		<Static Align="Right" Height="20" Id="Static5" Left="656" Style="snis_if_lable" TabOrder="18" Text="성명" Top="32" VAlign="Middle" Visible="FALSE" Width="36"></Static>
		<Combo Border="Flat" CodeColumn="CAND_NO" DataColumn="NM_KOR" Height="20" Id="cbCandNo" InnerDataset="dsCandNo" Left="696" Style="snis_if_input01" TabOrder="19" Top="33" Visible="FALSE" Width="127"></Combo>
		<Div BKColor="user0" Height="23" Id="divSearch" Left="522" TabOrder="22" Text="Div0" Top="34" Url="common::comButtonSearch.xml" Width="60">
			<Contents></Contents>
		</Div>
	</Form>
	<Script><![CDATA[/***************************************************************************************************
*   Form Common Script                                                                             *
*     현재 총 100 컬럼임 되도록 100 컬럼 안으로 코딩을 하세요                                      *
123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 1234567890
***************************************************************************************************/

/***************************************************************************************************
*                                         공통 Script Include                                      *
***************************************************************************************************/
#include "lib::can_common_script.js";
#include "lib::can_app_script.js";

/***************************************************************************************************
*                                          화면 변수 선언부                                        *
***************************************************************************************************/
var sFormId       = 'D03000001';
var sBUTTONLIST   = 'TTFFFT';                          //공통기능정의(버튼순으로 T or F)

var sUSERAUTH     = '';                                //사용자별 프로그램 사용 권한
var sFORMCAPTION  = '';                                //Form의 Title 정보
var sFORMLOCATION = '';                                //Form의 Location 정보
var sUSERLAVEL    = '';                                //Form의 사용  Level
var vREVOBJ       = Array(9);                          //결과값 처리를 위한 오브젝트 
var sGRDTIT       = "";                                //그리드 제목
var sCUROBJ       ;                                    //현재 LOST FOCUS 오브젝트

var sLastPeriodNo = "";                         // 현재의 최종기수보관
//var sMenuListNum    = "0";                          // 메뉴리스트의 갯수보관
//var sMenuUpId       = "";
//var sMenuUpNm       = "";

/***************************************************************************************************
*                                         공통 Event 처리 부분                                     *
***************************************************************************************************/
/*-------------------------------------------------------------------------------------------------+
>>  최초 화면 Load時 처리 할 사항
+-------------------------------------------------------------------------------------------------*/
function fcFormLoadSetting(obj) {  
//	http.sync = true;
    sBUTTONLIST   = 'F'+sInpt+'FTFT';
    
 	//화면환경 설정
	sFORMCAPTION  = obj.Title;
	sFORMLOCATION = "";

	//화면 정보 Display 및 Button 권한 설정
	fnc_FormLoadSetting(obj, sFORMCAPTION, sFORMLOCATION, sBUTTONLIST, sUSERAUTH);
	
	//초기 화면 BK Color설정 
	fnc_SetBKColor(this);
	
	//공통코드 조회
	fcd_GetComboDs(dsInComCd);
	
	// 화면 초기화
	fcInit();
	//기수
	fcPerioNo();	
	//후보생조회(콤보)
	fcCandIdentComBo();
	//동 콤보
	//fcBuild();	
	//호 콤보
	//fcRoomNo();	
}

/*-------------------------------------------------------------------------------------------------+
>>  최초 화면 UNLoad時 처리 할 사항
+-------------------------------------------------------------------------------------------------*/

function fcFormUnloadProcess(obj) {
	//자료 변경 여부를 체크하고자 하는  DataSet Object를 넘긴다.
	var sDataset = "";
	if ( !fnc_FormUnloadCheck(sDataset , sFormId) ) return false;
}

/*-------------------------------------------------------------------------------------------------+
>>  단축키 처리(Form KeyDown)
+-------------------------------------------------------------------------------------------------*/
function fcHotKey(obj,objSenderObj,nChar,bShift,bControl,bAlt,nLLParam,nHLParam) {

	//Return Key Press時 Next Component focus
	if ( nChar == 13 ) {
		var oFocusComponent = GetNextComponent(true);
		oFocusComponent.setfocus();
		return;
	}

	//Control Key가 눌려져 있다면 단축키 처리
	//if (bControl) fnc_HotKey(this, nChar);
}

/***************************************************************************************************
*                                      공통 버튼 Event 처리 부분                                   *
***************************************************************************************************/
/*-------------------------------------------------------------------------------------------------+
>>  취소 버튼 클릭 時 처리
+-------------------------------------------------------------------------------------------------*/
function fcInit(obj) {
    if ( obj.id == "btnCancel" || obj.id == "btnSearch" ) {
		dsCandDormAssign.ClearData();
       //dsDetlEduAssign.ClearSelect();
       //dsDetlEduAssign.Clear();
    }    
}

/*-------------------------------------------------------------------------------------------------+
>>  조회 버튼 클릭 時 처리
+-------------------------------------------------------------------------------------------------*/

function fcSearchCheck() {
//    edSCfrntCd.Text = Trim(edSCfrntCd.Text);
	if(length(cbSearchBuild.Value) <= 0 && length(cbSearchRoomNo.value) <= 0){	
		//검색할 자료가 없음
		//fnc_Message(SNIS_CAN_A008, "N");
		return false;
	}else{
		return true;
	}

//	fcInit(obj);	
	
}

function fcSearch(obj) {
    var sServiceName = "d03000001-service:searchCandDormAssign";
    var sInDataSet   = "";
    var sOutDataSet  = " dsCandDormAssign=dsCandDormAssign ";
    
//	if ( fcSearchCheck() == 0 || fcSearchCheck() == ""){
//		fcCandIdent();
//    }else{
		fcd_AddParam("racerPerioNo", Trim(cbPerioNo.Value));
		fcd_AddParam("build", Trim(cbSearchBuild.Value));
		fcd_AddParam("roomNo", Trim(cbSearchRoomNo.Value));
		fcd_AddParam("candNo", Trim(cbCandNo.Value));
		fcd_SendTransaction(sServiceName, sInDataSet, sOutDataSet, "fcCallBack",false);
//	}

}

    
//기수콤보
function fcPerioNo() {
	var racerPerioNo = null;
	var sServiceName = "d03000001-service:searchPerioNo";
    var sInDataSet   = "";
    var sOutDataSet  = " dsPerioNo=dsPerioNo "; 
//    fcd_AddParam("", racerPerioNo);
    fcd_SendTransaction(sServiceName, sInDataSet, sOutDataSet, "fcCallBack",false);
}

//후보생조회
function fcCandIdent() {
	var racerPerioNo = null;
	var sServiceName = "d03000001-service:searchCandIdent";
    var sInDataSet   = "";
    var sOutDataSet  = " dsCandIdent=dsCandIdent ";
	fcd_AddParam("racerPerioNo", Trim(cbPerioNo.Value));
    fcd_SendTransaction(sServiceName, sInDataSet, sOutDataSet, "fcCallBack",false);
}

//후보생콤보
function fcCandIdentComBo() {
	var sServiceName = "d03000001-service:searchCandIdentComBo";
    var sInDataSet   = "";
    var sOutDataSet  = " dsCandNo=dsCandNo "; 
    fcd_SendTransaction(sServiceName, sInDataSet, sOutDataSet, "fcCallBack",false);
}
//동 콤보
function fcBuild() {
	var sServiceName = "";
    var sInDataSet   = "";
    var sOutDataSet  = ""; 
    
	sServiceName = "d03000001-service:searchBuildS";
    sInDataSet   = "";
    sOutDataSet  = " dsSearchBuild=dsSearchBuild "; 
    fcd_SendTransaction(sServiceName, sInDataSet, sOutDataSet, "fcCallBack",false);    
}

//호 콤보
function fcRoomNo() {
	var sServiceName = "";
    var sInDataSet   = "";
    var sOutDataSet  = ""; 
    
	sServiceName = "d03000001-service:searchRoomNoS";
    sInDataSet   = "";
    sOutDataSet  = " dsSearchRoomNo=dsSearchRoomNo "; 
    fcd_SendTransaction(sServiceName, sInDataSet, sOutDataSet, "fcCallBack",false);
}

//동호 조회
function fcSearchPK() {
	var racerPerioNo = null;
	var sServiceName = "d03000001-service:searchPK";
    var sInDataSet   = "";
    var sOutDataSet  = " dsPK=dsPK "; 
    
	fcd_AddParam("racerPerioNo", Trim(cbPerioNo.Value));    
    fcd_SendTransaction(sServiceName, sInDataSet, sOutDataSet, "fcCallBack",false);
}


/*-------------------------------------------------------------------------------------------------+
>>  저장 버튼 클릭 時 처리
+-------------------------------------------------------------------------------------------------*/

function fcSaveCheck(obj) {

	//변경된 자료가 있는지 체크
 
	if ( !fnc_DatasetChangeCheck(dsCandDormAssign) ) 
	{
		//저장 할 자료가 없음
		fnc_Message(SNIS_COM_1006, "N");	
		return;
	}
	
	var sCount = 0;
	var sRoomChiefYn= "";
	var sYnCnt 		= 0;
	var dsRecCnt	= dsCandDormAssign.rowcount();
	for(var i=0; i<dsRecCnt; i++) {    
		sRoomChiefYn = dsCandDormAssign.GetColumn(i, "ROOM_CHIEF_YN");
		if(sRoomChiefYn == "1") sYnCnt++;
	}	
	
	if(dsRecCnt > 0){ //모두 삭제시에는 실장여부 체크 안함
		if(sYnCnt == 0){ //실장여부 체크
			fnc_Message(SNIS_CAN_A007, "N");	
			return;
		}
	}
	
	for(var i=0; i<dsRecCnt; i++) {    
		if(dsCandDormAssign.GetColumn(i, "ROOM_CHIEF_YN") == "1") 
		{
			for(var j=0; j<dsRecCnt; j++) {  
				if((i<>j) && (dsCandDormAssign.GetColumn(j, "ROOM_CHIEF_YN") == "1")) 
				{
					if(dsCandDormAssign.GetColumn(i, "BUILD") == dsCandDormAssign.GetColumn(j, "BUILD"))
					{
						if(dsCandDormAssign.GetColumn(i, "ROOM_NO") == dsCandDormAssign.GetColumn(j, "ROOM_NO"))
						{
							fnc_Message("1방에 1명만 실장으로 등록가능합니다.", "N");
							return;
						}
					}
				}
			}
		}
	}	
						
//    edSCfrntCd.Text = Trim(edSCfrntCd.Text);
	if(length(Trim(edBuid.Value)) <= 0 && length(Trim(edRoomNo.value)) <= 0){	
		//검색할 자료가 없음
		fnc_Message(SNIS_CAN_A005, "N");
		return;
	}	
		
	// 필수항목체크
	oDataSetCandDormAssign = dsCandDormAssign;

	sMandatoryColID   	= null;
	sMandatoryColName 	= null;
	oGrid             	= null;
	
	sMandatoryColID   	= "CAND_NO";
	sMandatoryColName 	= "성명";
	oGrid             	= grdCandDormAssign;
	if ( fnc_GetMandatoryViolateRow(oDataSetCandDormAssign, sMandatoryColID, sMandatoryColName, oGrid) > -1 ) {
	   return false;
	}
	
	return true;
}


function fcSave() {
//   alert("fcSaveCheck()===>"+fcSaveCheck()); 
   if ( !fcSaveCheck() ) return;
    
//    fcSaveSetting();
           
    var sServiceName = "";
    var sInDataSet   = "";
    var sOutDataSet  = "";
    var sInputYN = "N";    
		
	//INSERT
	var pkCheckCnt = 0;
	if(length(Trim(edBuid.Value)) > 0 && length(Trim(edRoomNo.Value)) > 0){
		for(var i=0; i<dsCandDormAssign.rowcount; i++) {   		
		//	dsCandDormAssign.SetColumn(i, "BUILD", Trim(toupper(edBuid.Value)));	
		//	dsCandDormAssign.SetColumn(i, "ROOM_NO", Trim(toupper(edRoomNo.Value)));	
		}	
	}else if(length(Trim(edBuid.Value)) > 0 && length(Trim(edRoomNo.Value)) <= 0){
		fnc_Message(SNIS_CAN_A006, "N");
		return;
	}else if(length(Trim(edBuid.Value)) <= 0 && length(Trim(edRoomNo.Value)) > 0){
		fnc_Message(SNIS_CAN_A006, "N");
		return;
	}		

    sServiceName  = "d03000001-service:saveCandDormAssign";
    sInDataSet    = "dsCandDormAssign=dsCandDormAssign:u ";
    sOutDataSet   = "dsCandDormAssign=dsCandDormAssign ";  
    
	fcd_SendTransaction(sServiceName, sInDataSet, sOutDataSet, "fcCallBack",false);	
}


/*-------------------------------------------------------------------------------------------------+
>>  엑셀 버튼 클릭 時 처리
+-------------------------------------------------------------------------------------------------*/
function fcToExcel(obj) {
	fnc_OpenExcelExport("grdCandDormAssign");
}

/*-------------------------------------------------------------------------------------------------+
>>  화면 종료(닫기) 버튼 클릭 時 처리
+-------------------------------------------------------------------------------------------------*/
function fcEnd(obj) {
	//화면 종료
	Close();	
}


/***************************************************************************************************
*                                      공통 Function 처리 부분                                     *
***************************************************************************************************/
/*-------------------------------------------------------------------------------------------------+
>>  Text Box가 Focus를 받을 때
+-------------------------------------------------------------------------------------------------*/
function fcEditFocus(obj) {
	fnc_EditFocus(obj);
}

/*-------------------------------------------------------------------------------------------------+
>>  그리드 정렬
+-------------------------------------------------------------------------------------------------*/
function fcGridSort(obj,nCell,nX,nY) {
    fnc_GridSort(obj, object(obj.BindDataset), nCell);
}

/*-------------------------------------------------------------------------------------------------+
>>  Help Popup Open
+-------------------------------------------------------------------------------------------------*/
function fcHelpDialoge(obj,nX,nY) {

}

/*-------------------------------------------------------------------------------------------------+
>>  그리드에서 팝업 처리 
+-------------------------------------------------------------------------------------------------*/
function fcGrdOnExpandEdit(objGrd, nRow, nCell, strVal, nPivotIndex){
	fnc_SetPopupDivCalendar(objGrd, nRow, nCell);
}


/***************************************************************************************************
*                                      사용자 정의  처리 부분                                      *
***************************************************************************************************/
/*-------------------------------------------------------------------------------------------------+
>>  Transaction 후 처리 해야 할 내용!
+-------------------------------------------------------------------------------------------------*/

function fcCallBack(sServiceName, ErrorCode, ErrorMSG) {
    if ( !fnc_result(ErrorCode, ErrorMSG) ) return;
  
		switch(sServiceName) {
		    case "common-service:searchCode" :

				dsComboBuild.InsertRow(0);
				dsComboBuild.SetColumn(0, "CD_NM", "선택");
				dsComboBuild.SetColumn(0, "CD", "-1"); 
								
				dsComboRoomNo.InsertRow(0);
				dsComboRoomNo.SetColumn(0, "CD_NM", "선택");
				dsComboRoomNo.SetColumn(0, "CD", "-1"); 	
					    
				dsSearchBuild.InsertRow(0);
				dsSearchBuild.SetColumn(0, "CD_NM", "전체");
				dsSearchBuild.SetColumn(0, "CD", ""); 
								
				dsSearchRoomNo.InsertRow(0);
				dsSearchRoomNo.SetColumn(0, "CD_NM", "전체");
				dsSearchRoomNo.SetColumn(0, "CD", ""); 	
 
				cbSearchBuild.Index = 0;
				cbSearchRoomNo.Index = 0;		    
				break;
				
			case "d03000001-service:saveCandDormAssign" :				
				//동 콤보
				//fcBuild();	
				//호 콤보
				//fcRoomNo();				
				fcSearchPK();
				break;		
				
			case "d03000001-service:saveCandDormAssign" :	
				//동 콤보
				//fcBuild();	
				//호 콤보
				//fcRoomNo();				
				fcSearchPK();
				break;								
			default :
				break;
		}				
			
	//trace(dsSearchBuild.SaveXML());
    //오류가 없이 정상 처리되었다면...
	fcPostProcess(sServiceName);
}

/*-------------------------------------------------------------------------------------------------+
>>  Transaction 후 Post Process!
+-------------------------------------------------------------------------------------------------*/
function fcPostProcess(sServiceName) {

}

/*-------------------------------------------------------------------------------------------------+
>>  기수콤보  설정
+-------------------------------------------------------------------------------------------------*/
function fcGetPerioNo() {
    var sServiceName = "d03000001-service:searchPerioNo";
    var sInDataSet   = "";
    var sOutDataSet  = "dsPerioNo=dsPerioNo "; 
	fcd_SendTransaction(sServiceName, sInDataSet, sOutDataSet, "fcCallBack",false);        
}

/*-------------------------------------------------------------------------------------------------+
>>  초기화면 설정 
+-------------------------------------------------------------------------------------------------*/

function fcFormSetting(obj)
{
    // 기수콤보 설정
	fcGetPerioNo();
}

function dsCandNo_OnLoadComleted(obj,nErrorCode,strErrorMsg,nReason)
{
	dsCandNo.InsertRow(0);
	dsCandNo.SetColumn(0, "NM_KOR", "전체");	
}

//후보생 반편성 추가
function btAdd_OnClick(obj)
{
	var nRecordCount = dsCandIdent.RowCount();
	var nAddRow;
	
	//선택한 후보생 추가
	for (var i = 0; i < nRecordCount; i++)
	{
		if (ToString(dsCandIdent.GetColumn(i, "CHK")) == "1")
		{
			nAddRow = dsCandDormAssign.AddRow();
			dsCandDormAssign.SetColumn(nAddRow, "RACER_PERIO_NO", dsCandIdent.GetColumn(i, "RACER_PERIO_NO"));		
			dsCandDormAssign.SetColumn(nAddRow, "NM_KOR", dsCandIdent.GetColumn(i, "NM_KOR"));
			dsCandDormAssign.SetColumn(nAddRow, "CAND_NO", dsCandIdent.GetColumn(i, "CAND_NO"));
			dsCandDormAssign.SetColumn(nAddRow, "ROOM_CHIEF_YN", "0");			
		}
	}
						
	//추가한 후보생 그리드에서 삭제 
	for (var i = nRecordCount; i >= 0; i--)
	{
		if (ToString(dsCandIdent.GetColumn(i, "CHK")) == "1")
		{
			dsCandIdent.DeleteRow(i);
		}
	}
//	fcSave();
	
}

//후보생 반편성 삭제
function btDel_OnClick(obj)
{
	var nRecordCount = dsCandDormAssign.RowCount();
	//선택한 후보생 추가
	for (var i = 0; i < nRecordCount; i++)
	{
		if (ToString(dsCandDormAssign.GetColumn(i, "CHK")) == "1")
		{
			nAddRow = dsCandIdent.AddRow();
			dsCandIdent.SetColumn(nAddRow, "RACER_PERIO_NO", dsCandDormAssign.GetColumn(i, "RACER_PERIO_NO"));		
			dsCandIdent.SetColumn(nAddRow, "NM_KOR", dsCandDormAssign.GetColumn(i, "NM_KOR"));
			dsCandIdent.SetColumn(nAddRow, "CAND_NO", dsCandDormAssign.GetColumn(i, "CAND_NO"));
		}
	}
			
	//추가한 후보생 그리드에서 삭제 
	for (var i = nRecordCount; i >= 0; i--)
	{
		if (ToString(dsCandDormAssign.GetColumn(i, "CHK")) == "1")
		{
			dsCandDormAssign.DeleteRow(i);
		}
	}	
//	fcSave();
}

function dsCandDormAssign_OnLoadComleted(obj,nErrorCode,strErrorMsg,nReason)
{
	var sQueryBuild		= "";
	var sQueryRoomNo	= "";

	if ( ToNumber(dsCandDormAssign.GetRowCount()) == 0 ){
		edBuid.value 	= "";
		edRoomNo.value 	= "";	
		return;
	}

	for(var i=0; i<dsCandDormAssign.rowcount; i++) {    
		sQueryBuild	= dsCandDormAssign.GetColumn(i,"BUILD");
		sQueryRoomNo= dsCandDormAssign.GetColumn(i,"ROOM_NO");
		break;
	}	

	edBuid.value 	= sQueryBuild;
	edRoomNo.value = sQueryRoomNo;
}

function dsCandDormAssign_OnCellClick(obj,nRow,nCell,nX,nY,nPivotIndex)
{
	//trace("nCell===========>"+nCell);
	if(nCell == 6){/*
		if( ToNumber(dsCandDormAssign.GetColumn(nRow, "ROOM_CHIEF_YN")) == 0)
		{
			dsCandDormAssign.SetColumn(nRow, "ROOM_CHIEF_YN","1");
			alert("0->" + dsCandDormAssign.GetColumn(nRow, "ROOM_CHIEF_YN"));
		}
		else if(ToNumber(dsCandDormAssign.GetColumn(nRow, "ROOM_CHIEF_YN")) == 1)
		{
			dsCandDormAssign.SetColumn(nRow, "ROOM_CHIEF_YN","0");
			alert("1->" + dsCandDormAssign.GetColumn(nRow, "ROOM_CHIEF_YN"));
		}*/
		
		//for (var i = 0; i < dsCandDormAssign.RowCount(); i++){
		//	if(i != nRow){
			//	dsCandDormAssign.SetColumn(i, "ROOM_CHIEF_YN","0");
		//	}
		//}
	}	
//alert(nCell+'/'+dsCandDormAssign.GetColumn(nRow,"BUILD"));
   if (nCell == 5){
		if (dsCandDormAssign.GetColumn(nRow,"BUILD") == -1){
			fnc_Message(SNIS_CAN_J003, "N", "");
			grdCandDormAssign.SetCellPos(4);
		    return false;
		}
	}
}
function cbPerioNo_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
	fcSearchPK();
}

function dsPerioNo_OnLoadCompleted(obj,nErrorCode,strErrorMsg,nReason)
{
	fcSearchPK();
}

function inputCombo_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{	
	switch(cbSearchBuild.Value){
			case "A" : dsSearchRoomNo.Filter("GRP_CD='D30002'");  	 
				break;		
			case "B" : dsSearchRoomNo.Filter("GRP_CD='D30003'");		
				break;			
			case "C" : dsSearchRoomNo.Filter("GRP_CD='D30004'");		
				break;
			default : 
				dsSearchRoomNo.UnFilter(); 
				for(var i=0;i<dsSearchRoomNo.rowcount;i++){
					if( dsSearchRoomNo.GetColumn(i, "CD_NM") == "전체")
					{
						dsSearchRoomNo.DeleteRow(i);
					}
				}
				break;
	}
	
	if( dsSearchRoomNo.GetColumn(0, "CD_NM") != "전체")
	{
		dsSearchRoomNo.InsertRow(0);
		dsSearchRoomNo.SetColumn(0, "CD_NM", "전체");
		dsSearchRoomNo.SetColumn(0, "CD", ""); 
	}
	cbSearchRoomNo.Index = 0;
	
	var sServiceName = "d03000001-service:searchCandDormAssign";
    var sInDataSet   = "";
    var sOutDataSet  = " dsCandDormAssign=dsCandDormAssign ";
	
	fcd_AddParam("racerPerioNo", Trim(cbPerioNo.Value));
	fcd_AddParam("build", Trim(cbSearchBuild.Value));
	fcd_AddParam("roomNo", Trim(cbSearchRoomNo.Value));
	fcd_AddParam("candNo", Trim(cbCandNo.Value));
	fcd_SendTransaction(sServiceName, sInDataSet, sOutDataSet, "fcCallBack",false);
}

function dsCandDormAssign_OnColumnChanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
{
		if (strColumnID == "BUILD"){	 
		var sectnCd = dsCandDormAssign.GetColumn(nRow,"BUILD");

		switch(sectnCd){
			case "A" : dsComboRoomNo.Filter("GRP_CD='D30002'");  break;		
			case "B" : dsComboRoomNo.Filter("GRP_CD='D30003'");	 break;			
			case "C" : dsComboRoomNo.Filter("GRP_CD='D30004'");	 break;
		}

	}
}

function dsCandDormAssign_OnRowPosChanged(obj,nOldRow,nRow)
{
		var sectnCd = dsCandDormAssign.GetColumn(nRow,"BUILD"); 

		switch(sectnCd){
			case "A" : dsComboRoomNo.Filter("GRP_CD='D30002'"); break;		
			case "B" : dsComboRoomNo.Filter("GRP_CD='D30003'");	break;			
			case "C" : dsComboRoomNo.Filter("GRP_CD='D30004'");	break;
		}	

		dsComboRoomNo.Filter("GRP_CD='D30002'");
}

function inputRoomCombo_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
	var sServiceName = "d03000001-service:searchCandDormAssign";
    var sInDataSet   = "";
    var sOutDataSet  = " dsCandDormAssign=dsCandDormAssign ";
	
	fcd_AddParam("racerPerioNo", Trim(cbPerioNo.Value));
	fcd_AddParam("build", Trim(cbSearchBuild.Value));
	fcd_AddParam("roomNo", Trim(cbSearchRoomNo.Value));
	fcd_AddParam("candNo", Trim(cbCandNo.Value));
	fcd_SendTransaction(sServiceName, sInDataSet, sOutDataSet, "fcCallBack",false);		
}
]]></Script>
</Window>