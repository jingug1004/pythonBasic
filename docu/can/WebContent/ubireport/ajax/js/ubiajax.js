var UbiDaemon_Validation=false;var _isFF=false;var _isIE=false;var _isOpera=false;var _isKHTML=false;var _isMacOS=false;var _isIE6=false;var _isIE7=false;var _isMobile=false;var mobileKeyWords=new Array('iPhone', 'iPod', 'BlackBerry', 'Android', 'Windows CE', 'LG', 'MOT', 'SAMSUNG', 'SonyEricsson');for (var word in mobileKeyWords) { if( navigator.userAgent.match(mobileKeyWords[word]) != null ) { _isMobile=true; break; }};if (navigator.userAgent.indexOf('Macintosh')!= -1) _isMacOS=true;if ((navigator.userAgent.indexOf('Safari')!= -1)||(navigator.userAgent.indexOf('Konqueror') != -1)){ var _KHTMLrv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf('Safari')+7, 5)); if (_KHTMLrv > 525){ _isFF=true; var _FFrv=1.9; }else _isKHTML=true;}else if (navigator.userAgent.indexOf('Opera')!= -1){ _isOpera=true; _OperaRv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf('Opera')+6, 3));}else if (navigator.appName.indexOf("Microsoft")!= -1){ _isIE=true; if (navigator.appVersion.indexOf("MSIE 8.0")!= -1 && document.compatMode != "BackCompat") _isIE=8; if (navigator.appVersion.indexOf("MSIE 7.0")!= -1) _isIE7=true;}else { _isFF=true; var _FFrv=parseFloat(navigator.userAgent.split("rv:")[1]);};if (_isIE){ _isIE6=(window.XMLHttpRequest==null?true:false);};function checkPdfReader() { var obj=null; if( window.ActiveXObject ) { try { obj=new ActiveXObject("AcroPDF.PDF"); if( obj != null ) return true; } catch(e){ try { obj=new ActiveXObject("PDF.PdfCtrl"); if( obj != null ) return true; } catch(e1) { } } } else { var nav=navigator.plugins; for ( var i=0; i < nav.length; i++) { var name=nav[i].name; if( name.indexOf("Adobe Reader") != -1 || name.indexOf("Adobe PDF") != -1 || name.indexOf("Acrobat") != -1 || name.indexOf("Chrome PDF") != -1 ) { return true; } } } return false;}var UbiViewer=Base.extend({ key: "", page: 0, totalpage: 0, constructor: function(params) { function createKey(key) { return params.jrffile.split('.')[0] + "_" + key; }; function printHTML(viewer) { viewer.divPrint.innerHTML="<iframe id='printFrame'><html><body>"+ viewer.divPreviewPage.innerHTML +"</body></html></ifrmae>"; }; this.params={ reqtype: "0", imageid: "", div: params.div || document.getElementById(params.divid), key: params.key || "", gatewayurl: params.gatewayurl || "", timeout: params.timeout || "60000", jrffile: params.jrffile || "", resid: params.resid || "", arg: params.arg || "", toolbar: params.toolbar || "true", resource: params.resource || "", divid: params.divid || params.div.id, skin: params.skin || "ubi_standard", scale: params.scale || "100" }; page=1; totalpage=0; var params=this.params; this.divMain=null; this.divPreview=null; this.divPreviewPage=null; this.divCanvas=null; this.divPrint=null; this.divLoading=null; this.toolbar=null; this.ubidocument=null; this.divMsg=null; this.divMain=params.div; var divMain=this.divMain; var divMainWidth= divMain.style.width; var divMainHeight=divMain.style.height; if( divMain.style.width.indexOf("%") != -1 ) { divMain.style.width=(parseInt(windowWidth() * parseInt(divMain.style.width) / 100)) + "px"; } if( divMain.style.height.indexOf("%") != -1 ) { divMain.style.height=(parseInt(windowHeight() * parseInt(divMain.style.height) / 100)) + "px"; } if( divMainWidth.length == 0 ) divMain.style.width=(windowWidth() - 2 ) + "px"; if( divMain.style.marginLeft != "" ) divMain.style.width=parseInt(divMain.style.width) - parseInt(divMain.style.marginLeft) + "px"; if( divMainHeight.length == 0 ) { if( params.toolbar == "true" ) divMain.style.height=(windowHeight() - 31) + "px"; else divMain.style.height=(windowHeight() - 0) + "px"; } if( divMain.style.marginTop != "" ) divMain.style.height=parseInt(divMain.style.height) - parseInt(divMain.style.marginTop) + "px"; divMain.style.textAlign="center"; var divPreviewFrame=document.createElement("div"); divPreviewFrame.style.backgroundColor="#f3f3f3"; divPreviewFrame.style.position="relative"; divPreviewFrame.style.margin="0px"; divPreviewFrame.style.padding="0px"; divPreviewFrame.style.width="100%"; divPreviewFrame.style.height=divMain.style.height; divPreviewFrame.style.overflow="auto"; var divToolbar=null; var divIdToolbar=params.divid + "_toolbar"; if( params.toolbar == "true" ) { divToolbar=document.createElement("div"); divToolbar.id=divIdToolbar; divMain.appendChild(divToolbar); this.toolbar=new PreviewToolbar({viewer:this, divid:divIdToolbar, skin:params.skin, scale:params.scale}); divMain.style.height=(parseInt(divMain.style.height) + 31) + "px"; } divMain.appendChild(divPreviewFrame); this.divPreview=document.createElement("div"); var divPreview=this.divPreview; divPreview.style.borderTop="1px solid #ccc"; divPreview.style.borderLeft="1px solid #ccc"; divPreview.style.borderRight="2px solid #bbb"; divPreview.style.borderBottom="2px solid #bbb"; divPreview.style.backgroundColor="#ffffff"; divPreview.style.marginTop="10px"; divPreview.style.marginRight="auto"; divPreview.style.marginBottom="10px"; divPreview.style.marginLeft="auto"; divPreview.style.position="relative"; divPreview.style.width="595px"; divPreview.style.height="842px"; divPreview.style.overflow="hidden"; divPreviewFrame.appendChild(divPreview); this.divPreviewPage=document.createElement("div"); var divPreviewPage=this.divPreviewPage; divPreviewPage.setAttribute("id", params.divid+"_previewPage"); divPreviewPage.style.position="relative"; divPreviewPage.style.marginLeft="58px"; divPreviewPage.style.marginRight="58px"; divPreviewPage.style.marginTop="58px"; divPreviewPage.style.marginBottom="58px"; divPreviewPage.style.width=(595-58*2)+"px"; divPreviewPage.style.height=(842-58*2)+"px"; divPreview.appendChild(divPreviewPage); this.divPrint=document.createElement("div"); var divPrint=this.divPrint; divPrint.setAttribute("id", params.divid+"_print"); divPrint.style.display="none"; divMain.appendChild(divPrint); this.divLoading=document.createElement("div"); var divLoading=this.divLoading; divLoading.style.top="50%"; divLoading.style.left="48%"; divLoading.style.margin="0 auto"; divLoading.style.fontFamily="Tahoma"; divLoading.style.fontSize="11px"; divLoading.style.display="none"; divLoading.style.position="absolute"; divLoading.innerHTML="<table cellspacing='0'><tr><td align='absmiddle'><center><img src='"+params.resource+"/images/loading.gif' width='20' height='20'></center></td><td align='absmiddle'><center><img src='"+params.resource+"/images/loading2.gif' height='30'></center></td></tr></table>"; divMain.appendChild(divLoading); if( params.toolbar == "true" ) { this.divMsg=document.createElement("div"); var divMsg=this.divMsg; divMsg.id="divMsg"; divMsg.style.left=(parseInt(this.divMain.style.width) - 350) / 2 + "px"; divMsg.style.top=(parseInt(this.divMain.style.height) - 122) / 2 + "px"; divMsg.style.width="350px"; divMsg.style.height="122px"; divMsg.style.margin="0 auto"; divMsg.style.fontFamily="Tahoma"; divMsg.style.fontSize="11px"; divMsg.style.display="none"; divMsg.style.position="absolute"; divMsg.style.backgroundColor="#f3f3f3"; divMsg.style.borderTop="2px solid #000000"; divMsg.style.borderLeft="2px solid #000000"; divMsg.style.borderRight="2px solid #000000"; divMsg.style.borderBottom="2px solid #000000"; var msg=("<table cellspacing='0' width='350px' height='122px' style='margin:0; padding:0px; border;1px solid #000000' background='" + viewer.params.resource + "/images/background.png'>"); msg += ("<tr><td height='14px' align='right' colspan='2'><img src='"+viewer.params.resource+"/images/close.gif' width='13' height='13' onclick='viewer.divMsg.style.display=&quot;none&quot;'></td></tr>"); msg += ("<tr><td align='center' width='40' valign='top' style='padding-top:10px'><img src='"+viewer.params.resource+"/images/pdf.gif' width='32' height='32'></td>"); msg += ("<td style='padding:10px;' align='left' valign='top'>Adobe Reader 6 이하이거나 설치되어있지 않습니다.<br><br><a href='http:/"); msg += ("/get.adobe.com/kr/reader/' target='_blank' style='text-decoration:none; color:red;'><b>어도비 홈페이지</b></a>에서 최신 Adobe Reader를<br><br> 설치하시기 바랍니다.</td></tr>"); msg += "</table>"; divMsg.innerHTML=msg; divMain.appendChild(divMsg); } }, printPDF: function(viewer, tp) { var url=viewer.params.gatewayurl + "?reqtype=2&jrffile="+viewer.params.jrffile+"&resid="+viewer.params.resid+"&key="+viewer.params.key+"&arg=&pagenum=&imageid="; viewer.divPrint.style.display=""; if( _isIE ) { if( checkPdfReader() ) { viewer.divPrint.innerHTML="<object id='UbiPdfDoc' type='application/pdf' style='width:0px;height:0px'></object>"; document.getElementById('UbiPdfDoc').src=url; if( tp == 'Y' ) document.getElementById('UbiPdfDoc').printAll(); else document.getElementById('UbiPdfDoc').printWithDialog(); } else { viewer.divMsg.style.display=""; } } else { if( !_isMobile ) { if( checkPdfReader() ) { window.open('', 'Ubi_PDF','menubar=no,toolbar=no,status=no,scrollbars=no'); var postUrl="<form name='pdfForm' method='post' action='" + viewer.params.gatewayurl + "#toolbar=1' target='Ubi_PDF'>"; postUrl += "<input type='hidden' name='reqtype' value='2'>"; postUrl += "<input type='hidden' name='jrffile' value='" + viewer.params.jrffile + "'>"; postUrl += "<input type='hidden' name='resid' value='" + viewer.params.resid + "'>"; postUrl += "<input type='hidden' name='key' value='" + viewer.params.key + "'>"; postUrl += "<input type='hidden' name='daemonid' value='" + viewer.ubidocument.doc.daemonid + "'>"; postUrl += "</form>"; viewer.divPrint.innerHTML=postUrl; document.pdfForm.submit(); } else { viewer.divMsg.style.display=""; } } else { window.open('', 'Ubi_PDF','menubar=no,toolbar=no,status=no,scrollbars=no'); var postUrl="<form name='pdfForm' method='post' action='" + viewer.params.gatewayurl + "'#toolbar=1' target='Ubi_PDF'>"; postUrl += "<input type='hidden' name='reqtype' value='2'>"; postUrl += "<input type='hidden' name='jrffile' value='" + viewer.params.jrffile + "'>"; postUrl += "<input type='hidden' name='resid' value='" + viewer.params.resid + "'>"; postUrl += "<input type='hidden' name='key' value='" + viewer.params.key + "'>"; postUrl += "<input type='hidden' name='daemonid' value='" + viewer.ubidocument.doc.daemonid + "'>"; postUrl += "</form>"; viewer.divPrint.innerHTML=postUrl; document.pdfForm.submit(); } } }, exportPDF: function(viewer) { var innerHtml="<iframe name='UbiExportFrame' width='1' height='1' frameborder='0' scrolling='no'></iframe>"; innerHtml += "<form name='UbiExprotForm' method='post' action='" + viewer.params.gatewayurl + "' target='UbiExportFrame'>"; innerHtml += "<input type='hidden' name='reqtype' value='11'>"; innerHtml += "<input type='hidden' name='jrffile' value='" + viewer.params.jrffile + "'>"; innerHtml += "<input type='hidden' name='resid' value='" + viewer.params.resid + "'>"; innerHtml += "<input type='hidden' name='key' value='" + viewer.params.key + "'>"; innerHtml += "<input type='hidden' name='daemonid' value='" + viewer.ubidocument.doc.daemonid + "'>"; innerHtml += "</form>"; viewer.divPrint.innerHTML=innerHtml; document.UbiExprotForm.submit(); }, exportExcel1: function(viewer) { var innerHtml="<iframe name='UbiExportFrame' width='1' height='1' frameborder='0' scrolling='no'></iframe>"; innerHtml += "<form name='UbiExprotForm' method='post' action='" + viewer.params.gatewayurl + "' target='UbiExportFrame'>"; innerHtml += "<input type='hidden' name='reqtype' value='12'>"; innerHtml += "<input type='hidden' name='jrffile' value='" + viewer.params.jrffile + "'>"; innerHtml += "<input type='hidden' name='resid' value='" + viewer.params.resid + "'>"; innerHtml += "<input type='hidden' name='key' value='" + viewer.params.key + "'>"; innerHtml += "<input type='hidden' name='daemonid' value='" + viewer.ubidocument.doc.daemonid + "'>"; innerHtml += "</form>"; viewer.divPrint.innerHTML=innerHtml; document.UbiExprotForm.submit(); }, exportExcel2: function(viewer) { var innerHtml="<iframe name='UbiExportFrame' width='1' height='1' frameborder='0' scrolling='no'></iframe>"; innerHtml += "<form name='UbiExprotForm' method='post' action='" + viewer.params.gatewayurl + "' target='UbiExportFrame'>"; innerHtml += "<input type='hidden' name='reqtype' value='13'>"; innerHtml += "<input type='hidden' name='jrffile' value='" + viewer.params.jrffile + "'>"; innerHtml += "<input type='hidden' name='resid' value='" + viewer.params.resid + "'>"; innerHtml += "<input type='hidden' name='key' value='" + viewer.params.key + "'>"; innerHtml += "<input type='hidden' name='arg' value='" + viewer.params.arg + "'>"; innerHtml += "<input type='hidden' name='daemonid' value='" + viewer.ubidocument.doc.daemonid + "'>"; innerHtml += "</form>"; viewer.divPrint.innerHTML=innerHtml; document.UbiExprotForm.submit(); }, drawPage: function(page) { this.page=page; var divPreviewPage=this.divPreviewPage; divPreviewPage.innerHTML=""; var doc=this.ubidocument.doc; this.divCanvas=document.createElement("canvas"); var divCanvas=this.divCanvas; divCanvas.id=this.params.divid+"_previewPagecv"; divCanvas.style.position="relative"; divCanvas.width=(doc.docprop.width - doc.docprop.marginleft - doc.docprop.marginright); divCanvas.height=(doc.docprop.height - doc.docprop.margintop - doc.docprop.marginbottom); divPreviewPage.appendChild(divCanvas); if( !this.divCanvas.getContext ) { G_vmlCanvasManager.initElement(this.divCanvas); divCanvas=document.getElementById(this.divCanvas.id); } this.ubidocument.Draw(divPreviewPage, this.page); }, changeScale: function(viewer) { var scale=viewer.params.scale; var exists=false; for( var j=60; j<=300; j+=20 ) { if( scale == j ) { exists=true; break; } } if( !exists ) scale=100; viewer.divPreview.style.zoom=(scale/100); }, showReport: function() { function createControl(xml, viewer) { var doc=UbiDoc.CreateInstance(xml); viewer.ubidocument=new UbiDocument(doc, viewer.params.jrffile, viewer.params.key, viewer.params.resid, viewer.params.gatewayurl); viewer.divPreview.style.width=doc.docprop.width +"px"; viewer.divPreview.style.height=doc.docprop.height +"px"; viewer.divPreviewPage.style.width=(doc.docprop.width - doc.docprop.marginleft - doc.docprop.marginright) +"px"; viewer.divPreviewPage.style.height=(doc.docprop.height - doc.docprop.margintop - doc.docprop.marginbottom) +"px"; viewer.divPreviewPage.style.marginLeft=doc.docprop.marginleft + "px"; viewer.divPreviewPage.style.marginRight=doc.docprop.marginright + "px"; viewer.divPreviewPage.style.marginTop=doc.docprop.margintop + "px"; viewer.divPreviewPage.style.marginBottom=doc.docprop.marginbottom + "px"; viewer.totalpage=doc.pagecount; if( viewer.params.toolbar == "true" ) { viewer.toolbar.setTotalPage(viewer.totalpage); toolbarobj.setTabIndex("save", "1"); toolbarobj.setTabIndex("print", "2"); toolbarobj.setTabIndex("printset", "3"); toolbarobj.setTabIndex("first", "4"); toolbarobj.setTabIndex("previous", "5"); toolbarobj.setTabIndex("pages", "6"); toolbarobj.setTabIndex("next", "7"); toolbarobj.setTabIndex("last", "8"); toolbarobj.setTabIndex("zoomout", "9"); toolbarobj.setTabIndex("zoom", "10"); toolbarobj.setTabIndex("zoomin", "11"); toolbarobj.setTabIndex("refresh", "12"); if( !_isIE ) toolbarobj.hideItem("printset"); } viewer.drawPage(1); if( viewer.params.toolbar ) viewer.changeScale(viewer); else viewer.toolbar.changeScale(); }; function requestReport(viewer) { ajax({ type: "POST", datatype: "xml", timeout: viewer.params.timeout, url: viewer.params.gatewayurl, reqdata: viewer.params, onSuccess: function(xml) { UbiDaemon_Validation=true; createControl(xml, viewer); }, onComplete: function() { viewer.divLoading.style.display="none"; }, onError: function(msg) { UbiDaemon_Validation=false; viewer.divLoading.style.display="none"; if( msg.indexOf("ER0") == -1 ) { msg="ER0901#Unknown error. Check UbiGateway URL."; } msg=msg.split("#")[0] + " : " + msg.split("#")[1]; alert(msg); } }); }; this.divLoading.style.display=""; requestReport(this); }});var PreviewToolbar=Base.extend({ viewer: null, toolbar: null, toolbarobj: null, divid: "", skin: "", scale: 100, page: 1, totalpage: 1, scaleCount: 0, constructor: function(params) { viewer=params.viewer; divid=params.divid; skin=params.skin; scale=params.scale; toolbar=this; toolbarobj=new dhtmlXToolbarObject(divid, skin); toolbarobj.setIconsPath(viewer.params.resource + "/images/toolbar/"); toolbarobj.loadXML(viewer.params.resource + "/css/toolbar.xml", onLoadFunction); function onLoadFunction() { var scaleIndex=0; for( var j=60; j<=300; j+=20 ) { if( scale == j ) scale=scaleIndex; scaleIndex++; toolbarobj.appendOption("zoom", j); } if( scale < 0 || scale > 12 ) scale=2; toolbarobj.setSelectedIndex("zoom", scale); scaleCount=toolbarobj.getCount("zoom"); }; toolbarobj.attachEvent("onClick", function(id) { switch (id) { case "save": break; case "exp_1": if( UbiDaemon_Validation ) viewer.exportPDF(viewer); break; case "exp_2": if( UbiDaemon_Validation ) viewer.exportExcel1(viewer); break; case "exp_3": break; case "print": if( UbiDaemon_Validation ) viewer.printPDF(viewer, 'Y'); break; case "printset": if( UbiDaemon_Validation ) viewer.printPDF(viewer, 'N'); break; case "first": toolbar.start(); break; case "previous": toolbar.back(); break; case "next": toolbar.forward(); break; case "last": toolbar.end(); break; case "zoomout": toolbar.zoomout(); break; case "zoomin": toolbar.zoomin(); break; case "refresh": toolbar.refresh(); break; default: return false; } }); toolbarobj.attachEvent("onChange", function(id, value) { switch (id) { case "pages": toolbar.changePage(); break; case "zoom": toolbar.changeScale(); break; default: return false; } }); }, initScale: function(scale) { var scaleIndex=0; for( var j=60; j<=300; j+=20 ) { if( scale == j ) scale=scaleIndex; scaleIndex++; } if( scale < 0 || scale > 12 ) scale=2; toolbarobj.setSelectedIndex("zoom", scale); scaleCount=toolbarobj.getCount("zoom"); }, setNaviState: function() { if( page == totalpage ) { toolbarobj.disableItem("next"); toolbarobj.disableItem("last"); } else { toolbarobj.enableItem("next"); toolbarobj.enableItem("last"); } if( page == 1 ) { toolbarobj.disableItem("previous"); toolbarobj.disableItem("first"); } else { toolbarobj.enableItem("previous"); toolbarobj.enableItem("first"); } }, setNaviStateInit: function() { page=1; this.setNaviState(); }, setScaleState: function() { var scaleindex=toolbarobj.getSelectedIndex("zoom"); if( scaleindex == 0 ) { toolbarobj.disableItem("zoomout"); } else { toolbarobj.enableItem("zoomout"); } if( scaleindex == (scaleCount-1) ) { toolbarobj.disableItem("zoomin"); } else { toolbarobj.enableItem("zoomin"); } }, setTotalPage: function(totPage) { totalpage=totPage; this.setNaviState(); for (var i=1; i<=totPage; i++) { toolbarobj.appendOption("pages", i); } }, changeScale: function() { var scale=toolbarobj.getSelectedText("zoom"); viewer.divPreview.style.zoom=(scale/100); this.setScaleState(); }, zoomin: function() { var index=toolbarobj.getSelectedIndex("zoom"); toolbarobj.setSelectedIndex("zoom", ++index); this.changeScale(); }, zoomout: function() { var index=toolbarobj.getSelectedIndex("zoom"); toolbarobj.setSelectedIndex("zoom", --index); this.changeScale(); }, start: function() { page=1; this.movePage(page); }, back: function() { if( page > 1 ) { page--; this.movePage(page); } }, forward: function() { if( page < totalpage ) { page++; this.movePage(page); } }, end: function() { if( page < totalpage ) { page=totalpage; this.movePage(page); } }, changePage: function() { var selpage=toolbarobj.getSelectedText("pages"); if( page != selpage ) { page=selpage; this.movePage(page); } }, movePage: function(page) { viewer.drawPage(page); toolbarobj.setSelectedIndex("pages", page-1); this.setNaviState(); }, refresh: function(page) { toolbarobj.removeOption("pages"); viewer.divPreviewPage.innerHTML=""; viewer.divPrint.innerHTML=""; viewer.showReport(); this.setNaviStateInit(); this.initScale(viewer.params.scale); }});