<?xml version="1.0" encoding='EUC-KR'?>
<queryMap desc="tbdb_strt_time_dist(기록조회)">
    <query id="tbec_cert_issu_history_fb001" desc="조회" fetchSize="10">
        <![CDATA[
	        SELECT	'0'	CHK,
					TRT.RACE_YY, 			  						--년도
                    TCI.RACER_PERIO_NO,								--기수
					TRT.CAND_NO,              						--후보생번호
					TRT.CAND_NM,              						--성명
                    CASE 
                    	WHEN TO_NUMBER(SUBSTR(FC_DEC(TCI.RES_NO), 1, 2)) > 0 THEN
                    		100 + TO_NUMBER(TO_CHAR(SYSDATE, 'YY')) - 
                    		TO_NUMBER(SUBSTR(FC_DEC(TCI.RES_NO), 1, 2)) + 1
                    END		CAND_AGE,								--나이
					TRT.GRD,                  						--등급
                    TSC.CD_NM	AS CD_NM_GRD,
					TRT.STRATEGY,             						--전법
                    TSC1.CD_NM	AS CD_NM_STG,
					TRT.LEG_TPE,              						--각질
                    TSC2.CD_NM	AS CD_NM_LT,
					TRT.WIN_RATE,             						--승률
					TRT.HIGH_RANK_RATE,       						--연대율
					TRT.RACE_CNT,             						--출주회수
					NVL(TRT.LEAD_INDUCE_CNT, 0)	LEAD_INDUCE_CNT,	--선두유도회수
					TRT.PRE1_CNT,             						--선행1착회수
					TRT.PRE2_CNT,             						--선행2착회수
					TRT.PRE3_CNT,             						--선행3착회수
					TRT.BRK1_CNT,             						--추입1착회수
					TRT.BRK2_CNT,             						--추입2착회수
					TRT.BRK3_CNT,             						--추입3착회수
					TRT.PAS1_CNT,             						--젖히기1착회수
					TRT.PAS2_CNT,             						--젖히기2착회수
					TRT.PAS3_CNT,             						--젖히기3착회수
					TRT.MRK1_CNT,             						--마크1착회수
					TRT.MRK2_CNT,             						--마크2착회수
					TRT.MRK3_CNT,             						--마크3착회수
					TRT.ELIM2_CNT,            						--경고회수
					TRT.ELIM3_CNT,            						--주의회수
					TRT.ELIM1_CNT,            						--실격회수
					TRT.DOWN_CNT,             						--낙차포기회수
					TRT.DOWN_GOLIN_CNT,       						--낙차골인회수
					TRT.WRONG_GOLIN_CNT,      						--고장골인회수
					TRT.WRONG_CNT,            						--고장포기회수
					TRT.ESTM_SCR,             						--평가점
					TRT.YY_AVG_RACE_SCR ,      						--년도평균경주득점
					TRT.PRZ_SCR,              						--입상점
					TRT.VIOL_SCR,             						--위반점
					TRT.RANK1_CNT,            						--1착회수
					TRT.RANK2_CNT,            						--2착회수
					TRT.RANK3_CNT,            						--3착회수
					TRT.RANK4_CNT,            						--4착회수
					TRT.RANK5_CNT,            						--5착회수
					TRT.RANK6_CNT,            						--6착회수
					TRT.RANK7_CNT,            						--7착회수
					TO_CHAR(TRT.GEAR_RATE,'0.00') AS GEAR_RATE,     	--마지막기어배수
					TRT.TOT_RANK,             						--총순위
					TRT.GRD_TOT_RANK,         						--등급총순위
					TRT.TRNG_MAN,             						--훈련자
					TRT.TEMP_ESTM_SCR,        						--임시평가점
					TRT.BF_GRD,               						--전등급
					TRT.BF1_GRD,              						--전전등급
					TRT.BF2_GRD,              						--전전전등급
					TRT.BF_ROUND              						--전회차
					--CASE WHEN TCI.GRDU_GBN ='004' OR TCI.GRDU_GBN ='005' THEN 1 ELSE 0 END AS GRDU_GBN
			FROM	TBDB_REC_TOT	TRT
            LEFT JOIN
            		TBDB_CAND_IDENT	TCI
			ON		TRT.CAND_NO = TCI.CAND_NO
            LEFT JOIN
            		TBDA_SPEC_CD	TSC
			ON		TRT.GRD = TSC.CD
            AND		TSC.GRP_CD = 'D10032'
            LEFT JOIN
            		TBDA_SPEC_CD	TSC1
			ON		TRT.STRATEGY = TSC1.CD
            AND		TSC1.GRP_CD = 'D10033'
            LEFT JOIN
            		TBDA_SPEC_CD	TSC2
			ON		TRT.LEG_TPE = TSC2.CD
            AND		TSC2.GRP_CD = 'D10034'
			WHERE	TRT.RACE_YY = ?
			AND     TCI.GRDU_GBN NOT IN('004','005')
			AND		(TRT.CAND_NM LIKE ? || '%' OR ? IS NULL)
			AND		(TRT.GRD = ? OR ? IS NULL)
		]]>
    </query>
    <query id="tbec_cert_issu_history_ib001" desc="등록" fetchSize="10">
        <![CDATA[
			INSERT 
				INTO TBDB_REC_TOT
				(
					RACE_YY,					--년도
					CAND_NO,					--후보생번호
					CAND_NM,					--성명
					GRD,						--등급
					STRATEGY,					--전법
					LEG_TPE,					--각질
					WIN_RATE,					--승률
					HIGH_RANK_RATE,				--연대율
					ESTM_SCR,					--평가점
					INST_ID,
					INST_DTM
				)
				VALUES
				(
					?,
					?,
					?,
					?,
					?,
					?,
					?,
					?, 
					?,
					?, 
					SYSDATE
				)
		]]>
    </query>
    <query id="tbec_cert_issu_history_ub001" desc="수정" fetchSize="10">
        <![CDATA[
			UPDATE	TBDB_REC_TOT
			SET		GRD				= ?,		--등급
					STRATEGY		= ?,		--전법
					LEG_TPE			= ?,		--각질
					WIN_RATE		= ?,		--승률
					HIGH_RANK_RATE	= ?,		--연대율
					ESTM_SCR		= ?,		--평가점
					UPDT_ID			= ?,
					UPDT_DTM		= SYSDATE
			WHERE	RACE_YY			= ?
			AND		CAND_NO			= ?
		]]>
    </query>
    <query id="tbec_cert_issu_history_db001" desc="삭제" fetchSize="10">
        <![CDATA[
			DELETE
			FROM	TBDB_REC_TOT
			WHERE	RACE_YY			= ?
			AND		CAND_NO			= ?
		]]>
    </query>
</queryMap>