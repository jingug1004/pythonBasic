<?xml version="1.0" encoding='EUC-KR'?>
<queryMap desc="tbdb_cls_organ_detl(경륜반편성)"> 

    <query id="tbdb_cls_organ_detl_fb000" desc="경륜반편성 조회" fetchSize="10">
		<![CDATA[
			SELECT
					'0' CHK				
					,RACER_PERIO_NO
					,'선택' CLS
					,'-1' AS CLS_CD 
					,CAND_NO
					,'-1' GUD_LECTR_ID
					,'선택' LECTR_NM
					,NM_KOR
			FROM	TBDB_CAND_IDENT
			WHERE	CAND_NO NOT IN (SELECT CAND_NO FROM TBDB_CLS_ORGAN)	
			AND		RACER_PERIO_NO = NVL(?, RACER_PERIO_NO)	
			AND		DEL_YN='N'
			AND		GRDU_GBN NOT IN('004','005')
			   UNION ALL
			SELECT 
					'0' CHK
					,A.RACER_PERIO_NO
					,A.CLS
					,TRIM(A.CLS) AS CLS_CD
					,A.CAND_NO
					,A.GUD_LECTR_ID
					,(SELECT C.NM_KOR FROM TBDB_GUD_LECTR C WHERE A.GUD_LECTR_ID = C.GUD_LECTR_ID) AS LECTR_NM
					,B.NM_KOR
			FROM	TBDB_CLS_ORGAN A, TBDB_CAND_IDENT B
			WHERE	A.CAND_NO = B.CAND_NO
			AND		A.RACER_PERIO_NO = NVL(?, A.RACER_PERIO_NO)
			AND		TRIM(A.CLS) = NVL(?, TRIM(A.CLS))
			AND		A.CAND_NO = NVL(?, A.CAND_NO) 
			AND		DEL_YN='N'
			AND		GRDU_GBN NOT IN('004','005')
	    ]]>
    </query>
    
    <query id="tbdb_cls_organ_detl_fb001" desc="경륜반편성 조회" fetchSize="10">
		<![CDATA[
			SELECT 
					'0' CHK
					,A.RACER_PERIO_NO
					,A.CLS
					,A.CAND_NO
					,A.GUD_LECTR_ID
					,B.NM_KOR
			FROM	TBDB_CLS_ORGAN A, TBDB_CAND_IDENT B
			WHERE	A.CAND_NO = B.CAND_NO
			AND		A.RACER_PERIO_NO = NVL(?, A.RACER_PERIO_NO)
			AND		A.CLS = NVL(?, A.CLS)
			AND		A.CAND_NO = NVL(?, A.CAND_NO)
			ORDER BY A.RACER_PERIO_NO, A.CAND_NO
	    ]]>
    </query>
 
    <query id="tbdb_cls_organ_detl_fb002" desc="경륜호부생신상 조회" fetchSize="10">
        <![CDATA[
			SELECT
					'0' CHK				
					,RACER_PERIO_NO
					,CAND_NO
					,NM_KOR
			FROM	TBDB_CAND_IDENT
			WHERE	CAND_NO NOT IN (SELECT CAND_NO FROM TBDB_CLS_ORGAN)	
			AND		RACER_PERIO_NO = NVL(?, RACER_PERIO_NO)		
			ORDER BY RACER_PERIO_NO, CAND_NO
		]]>
    </query> 
    
    <query id="tbdb_cls_organ_detl_fb003" desc="경륜호부생신상 콤보 조회" fetchSize="10">
        <![CDATA[
			SELECT
					'0' CHK				
					,RACER_PERIO_NO
					,CAND_NO
					,NM_KOR
			FROM	TBDB_CAND_IDENT			
		]]>
    </query>    
       

    <query id="tbdb_PerioNo_fb001" desc="기수조회" fetchSize="10">
        <![CDATA[
			SELECT CD_NM AS RACER_PERIO_NO
			FROM TBDA_SPEC_CD	
			WHERE GRP_CD = 'A10001'
			ORDER BY CD DESC	
		]]>
    </query> 
    
    <query id="tbdb_GudLectr_d02000014_fb001" desc="지도교사 조회" fetchSize="10">
        <![CDATA[
			SELECT 
					RACER_PERIO_NO
					,GUD_LECTR_ID
					,NM_KOR AS LECTR_NM
			FROM	TBDB_GUD_LECTR
		]]>
    </query>        
    
    <query id="tbdb_cls_organ_detl_ib000" desc="경륜반편성 입력" fetchSize="10">
        <![CDATA[
   				   MERGE INTO TBDB_CLS_ORGAN TCO
			            USING   DUAL
			            ON        (     TCO.RACER_PERIO_NO  		= ?     	  
			            			AND TCO.CAND_NO      			= ?   	 	
			                      )
						WHEN MATCHED THEN
						 UPDATE  SET
 						      CLS                 = ?
							, GUD_LECTR_ID        = ?
						    , UPDT_ID             = ?
						    , UPDT_DTM            = SYSDATE
						 WHEN NOT MATCHED THEN
							INSERT (
									      RACER_PERIO_NO
									    , CLS
									    , CAND_NO
										, GUD_LECTR_ID	   
									    , INST_ID
									    , INST_DTM
										)VALUES (
											 ?
											,?
											,?
											,?
											,? 
											,SYSDATE								
										)	
		]]>
    </query>
            
    <query id="tbdb_cls_organ_detl_ib001" desc="경륜반편성 입력" fetchSize="10">
        <![CDATA[
			INSERT INTO TBDB_CLS_ORGAN (
				RACER_PERIO_NO
				,CLS
				,CAND_NO
				,GUD_LECTR_ID
				,INST_ID
				,INST_DTM
				,UPDT_ID
				,UPDT_DTM        
			)VALUES
			(			
				 ?
				,?
				,?
				,?
				,?
				,SYSDATE
				,?
				,SYSDATE
			)
		]]>
    </query>
    
         
    <query id="tbdb_cls_organ_detl_ub001" desc="경륜반편성 수정" fetchSize="10">
        <![CDATA[
			UPDATE TBDB_CLS_ORGAN 
			SET
					RACER_PERIO_NO		= ?
					,CLS				= ?
					,CAND_NO			= ?
					,GUD_LECTR_ID		= ?
					,UPDT_ID        	= ?
					,UPDT_DTM       	= SYSDATE
			WHERE	RACER_PERIO_NO		= ?
			AND		CLS					= ?
			AND		CAND_NO				= ?
		]]>
    </query>
          
    <query id="tbdb_cls_organ_detl_db001" desc="경륜반편성 삭제" fetchSize="10">
        <![CDATA[
			DELETE 
			FROM   	TBDB_CLS_ORGAN 
			WHERE	RACER_PERIO_NO		= ?
			AND		CLS					= ?
			AND		CAND_NO				= ?
		]]>
    </query>

    
</queryMap>