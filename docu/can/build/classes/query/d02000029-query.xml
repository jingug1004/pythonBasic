<?xml version="1.0" encoding='EUC-KR'?>
<queryMap desc="(경주급별배정)">


    <query id="tbdb_detl_mat001" desc="대진표 combo값  조회 " fetchSize="10">
        <![CDATA[
        
			SELECT B.MAT_CD MAT_CD
			       ,B.MAT_CD|| '- 대진표' MAT_NM
			FROM  TBDB_DETL_RACE_SCHE A, TBDB_DETL_MAT B
			WHERE A.RACE_YY  = ?
			  AND A.ROUND    = ?
			  AND A.RACE_YY = B.RACE_YY
			  AND A.ROUND   = B.ROUND  
            ORDER BY B.MAT_CD DESC 
        ]]>
    </query>  
    
    <query id="tbdb_grd_assign001" desc="진출경주 combo값  조회 " fetchSize="10">
        <![CDATA[
        
	
		  SELECT  STLT_RACE_GRD_CD
		       ,(SELECT CD_NM  FROM TBDA_SPEC_CD WHERE GRP_CD  ='D10042' AND CD = STLT_RACE_GRD_CD) STLT_RACE_GRD_NM
		       ,ADV_RACE_GRD_CD
		       ,(SELECT CD_NM  FROM TBDA_SPEC_CD WHERE GRP_CD  ='D10042' AND CD = ADV_RACE_GRD_CD) ADV_RACE_GRD_CD_NM
		   FROM TBDB_GRD_ASSIGN
		  WHERE MAT_CD = ?
		  --ORDER BY ADV_RACE_GRD_CD ASC
        ]]>
    </query>  
    
	<query id="tbdb_grd_assign002" desc="선발경주 combo값  조회 " fetchSize="10">
        <![CDATA[

			SELECT  STLT_RACE_GRD_CD
			       ,(SELECT CD_NM  FROM TBDA_SPEC_CD WHERE GRP_CD  ='D10042' AND CD = STLT_RACE_GRD_CD) STLT_RACE_GRD_NM
			       ,STR_RANK
				   ,END_RANK
				   ,RACE_NO
				   ,EQU_RANK
				   ,EQU_RANK_NO
				   ,EQU_RANK2
				   ,EQU_RANK_NO2
			FROM TBDB_GRD_ASSIGN
			WHERE MAT_CD = ? 
			  AND ADV_RACE_GRD_CD = ? 			  
  
        ]]>
    </query>  
    
	<query id="tbdb_race_rec_detl001" desc="경주급별 배정 조회1" fetchSize="10">
        <![CDATA[
  
		  SELECT A.RACE_NO 
		        ,DECODE(A.RANK,'NULL','99',RANK)  RANK
                ,A.BACK_NO
		        ,A.CAND_NO
		        ,C.TOT_AVG
		        ,(SELECT NM_KOR  FROM TBDB_CAND_IDENT WHERE CAND_NO  = A.CAND_NO ) NM_KOR
		        ,(SELECT POINT.POINT_MARKS FROM TBDB_RACE_POINT POINT  WHERE POINT.RACE_YY = A.RACE_YY AND POINT.ROUND = B.SELT_ROUND AND POINT.CAND_NO = A.CAND_NO ) AS POINT
		        ,race_grd_cd
		   FROM TBDB_RACE_REC_DETL A, TBDB_DETL_RACE_SCHE B ,TBDB_CAND_ASSIGN C
		  WHERE A.RACE_YY      = ? 
		  AND   A.RACE_YY  =  C.RACE_YY
		  AND   A.CAND_NO  =  C.CAND_NO
		  AND   B.ROUND = C.ROUND 
		  AND   A.ROUND        = B.SELT_ROUND 
		  AND   B.ROUND        = ?
		  AND   A.RACE_NO      = 1 
		  AND   A.ABS_GBN  IS NULL
		  AND   A.RACE_YY      = B.RACE_YY(+)
		  ORDER BY A.RACE_NO,A.RANK  
        ]]>
    </query>  
    
	<query id="tbdb_race_rec_detl002" desc="경주급별 배정 조회2" fetchSize="10">
        <![CDATA[
  
		  SELECT A.RACE_NO 
		        ,DECODE(A.RANK,'NULL','99',RANK)  RANK
                ,A.BACK_NO
		        ,A.CAND_NO
		        ,C.TOT_AVG
		        ,(SELECT NM_KOR  FROM TBDB_CAND_IDENT WHERE CAND_NO  = A.CAND_NO ) NM_KOR
		        ,(SELECT POINT.POINT_MARKS FROM TBDB_RACE_POINT POINT  WHERE POINT.RACE_YY = A.RACE_YY AND POINT.ROUND = B.SELT_ROUND AND POINT.CAND_NO = A.CAND_NO ) AS POINT
		        ,race_grd_cd
		   FROM TBDB_RACE_REC_DETL A, TBDB_DETL_RACE_SCHE B ,TBDB_CAND_ASSIGN C
		  WHERE A.RACE_YY      = ? 
		  AND   A.RACE_YY  =  C.RACE_YY
		  AND   A.CAND_NO  =  C.CAND_NO
		  AND   B.ROUND = C.ROUND 
		  AND   A.ROUND        = B.SELT_ROUND 
		  AND   B.ROUND        = ?
		  AND   A.RACE_NO      = 2 
		  AND   A.ABS_GBN  IS NULL
		  AND   A.RACE_YY      = B.RACE_YY(+)
		  ORDER BY A.RACE_NO,A.RANK
        ]]>
    </query>  
    
	<query id="tbdb_race_rec_detl003" desc="경주급별 배정 조회3" fetchSize="10">
        <![CDATA[
  
		  SELECT A.RACE_NO 
		        ,DECODE(A.RANK,'NULL','99',RANK)  RANK
                ,A.BACK_NO
		        ,A.CAND_NO
		        ,C.TOT_AVG
		        ,(SELECT NM_KOR  FROM TBDB_CAND_IDENT WHERE CAND_NO  = A.CAND_NO ) NM_KOR
		        ,(SELECT POINT.POINT_MARKS FROM TBDB_RACE_POINT POINT  WHERE POINT.RACE_YY = A.RACE_YY AND POINT.ROUND = B.SELT_ROUND AND POINT.CAND_NO = A.CAND_NO ) AS POINT
		        ,race_grd_cd
		   FROM TBDB_RACE_REC_DETL A, TBDB_DETL_RACE_SCHE B ,TBDB_CAND_ASSIGN C
		  WHERE A.RACE_YY      = ? 
		  AND   A.RACE_YY  =  C.RACE_YY
		  AND   A.CAND_NO  =  C.CAND_NO
		  AND   B.ROUND = C.ROUND 
		  AND   A.ROUND        = B.SELT_ROUND 
		  AND   B.ROUND        = ?
		  AND   A.RACE_NO      = 3 
		  AND   A.ABS_GBN  IS NULL
		  AND   A.RACE_YY      = B.RACE_YY(+)
		  ORDER BY A.RACE_NO,A.RANK
        ]]>
    </query>  
    
	<query id="tbdb_race_rec_detl004" desc="경주급별 배정 조회4" fetchSize="10">
        <![CDATA[
  
		  SELECT A.RACE_NO 
		        ,DECODE(A.RANK,'NULL','99',RANK)  RANK
                ,A.BACK_NO
		        ,A.CAND_NO
		        ,C.TOT_AVG
		        ,(SELECT NM_KOR  FROM TBDB_CAND_IDENT WHERE CAND_NO  = A.CAND_NO ) NM_KOR
		        ,(SELECT POINT.POINT_MARKS FROM TBDB_RACE_POINT POINT  WHERE POINT.RACE_YY = A.RACE_YY AND POINT.ROUND = B.SELT_ROUND AND POINT.CAND_NO = A.CAND_NO ) AS POINT
		        ,race_grd_cd
		   FROM TBDB_RACE_REC_DETL A, TBDB_DETL_RACE_SCHE B ,TBDB_CAND_ASSIGN C
		  WHERE A.RACE_YY      = ? 
		  AND   A.RACE_YY  =  C.RACE_YY
		  AND   A.CAND_NO  =  C.CAND_NO
		  AND   B.ROUND = C.ROUND 
		  AND   A.ROUND        = B.SELT_ROUND 
		  AND   B.ROUND        = ?
		  AND   A.RACE_NO      = 4 
		  AND   A.ABS_GBN  IS NULL
		  AND   A.RACE_YY      = B.RACE_YY(+)
		  ORDER BY A.RACE_NO,A.RANK 
        ]]>
    </query>  
    
	<query id="tbdb_race_rec_detl005" desc="경주급별 배정 조회5" fetchSize="10">
        <![CDATA[
  
		  SELECT A.RACE_NO 
		        ,DECODE(A.RANK,'NULL','99',RANK)  RANK
                ,A.BACK_NO
		        ,A.CAND_NO
		        ,C.TOT_AVG
		        ,(SELECT NM_KOR  FROM TBDB_CAND_IDENT WHERE CAND_NO  = A.CAND_NO ) NM_KOR
		        ,(SELECT POINT.POINT_MARKS FROM TBDB_RACE_POINT POINT  WHERE POINT.RACE_YY = A.RACE_YY AND POINT.ROUND = B.SELT_ROUND AND POINT.CAND_NO = A.CAND_NO ) AS POINT
		        ,race_grd_cd
		   FROM TBDB_RACE_REC_DETL A, TBDB_DETL_RACE_SCHE B ,TBDB_CAND_ASSIGN C
		  WHERE A.RACE_YY      = ? 
		  AND   A.RACE_YY  =  C.RACE_YY
		  AND   A.CAND_NO  =  C.CAND_NO
		  AND   B.ROUND = C.ROUND 
		  AND   A.ROUND        = B.SELT_ROUND 
		  AND   B.ROUND        = ?
		  AND   A.RACE_NO      = 5 
		  AND   A.ABS_GBN  IS NULL
		  AND   A.RACE_YY      = B.RACE_YY(+)
		  ORDER BY A.RACE_NO,A.RANK 
        ]]>
    </query>  
    
	<query id="tbdb_race_rec_detl006" desc="경주급별 배정 조회6" fetchSize="10">
        <![CDATA[
  
		  SELECT A.RACE_NO 
		        ,DECODE(A.RANK,'NULL','99',RANK)  RANK
                ,A.BACK_NO
		        ,A.CAND_NO
		        ,C.TOT_AVG
		        ,(SELECT NM_KOR  FROM TBDB_CAND_IDENT WHERE CAND_NO  = A.CAND_NO ) NM_KOR
		        ,(SELECT POINT.POINT_MARKS FROM TBDB_RACE_POINT POINT  WHERE POINT.RACE_YY = A.RACE_YY AND POINT.ROUND = B.SELT_ROUND AND POINT.CAND_NO = A.CAND_NO ) AS POINT
		        ,race_grd_cd
		   FROM TBDB_RACE_REC_DETL A, TBDB_DETL_RACE_SCHE B ,TBDB_CAND_ASSIGN C
		  WHERE A.RACE_YY      = ? 
		  AND   A.RACE_YY  =  C.RACE_YY
		  AND   A.CAND_NO  =  C.CAND_NO
		  AND   B.ROUND = C.ROUND 
		  AND   A.ROUND        = B.SELT_ROUND 
		  AND   B.ROUND        = ?
		  AND   A.RACE_NO      = 6 
		  AND   A.ABS_GBN  IS NULL
		  AND   A.RACE_YY      = B.RACE_YY(+)
		  ORDER BY A.RACE_NO,A.RANK
        ]]>
    </query>  
    
	<query id="tbdb_race_rec_detl007" desc="경주급별 배정 조회7" fetchSize="10">
        <![CDATA[
  
		  SELECT A.RACE_NO 
		        ,DECODE(A.RANK,'NULL','99',RANK)  RANK
                ,A.BACK_NO
		        ,A.CAND_NO
		        ,C.TOT_AVG
		        ,(SELECT NM_KOR  FROM TBDB_CAND_IDENT WHERE CAND_NO  = A.CAND_NO ) NM_KOR
		        ,(SELECT POINT.POINT_MARKS FROM TBDB_RACE_POINT POINT  WHERE POINT.RACE_YY = A.RACE_YY AND POINT.ROUND = B.SELT_ROUND AND POINT.CAND_NO = A.CAND_NO ) AS POINT
		        ,race_grd_cd
		   FROM TBDB_RACE_REC_DETL A, TBDB_DETL_RACE_SCHE B ,TBDB_CAND_ASSIGN C
		  WHERE A.RACE_YY      = ? 
		  AND   A.RACE_YY  =  C.RACE_YY
		  AND   A.CAND_NO  =  C.CAND_NO
		  AND   B.ROUND = C.ROUND 
		  AND   A.ROUND        = B.SELT_ROUND 
		  AND   B.ROUND        = ?
		  AND   A.RACE_NO      = 7 
		  AND   A.ABS_GBN  IS NULL
		  AND   A.RACE_YY      = B.RACE_YY(+)
		  ORDER BY A.RACE_NO,A.RANK
        ]]>
    </query>  
    
	<query id="tbdb_race_rec_detl008" desc="경주급별 배정 조회8" fetchSize="10">
        <![CDATA[
  
		  SELECT A.RACE_NO 
		        ,DECODE(A.RANK,'NULL','99',RANK)  RANK
                ,A.BACK_NO
		        ,A.CAND_NO
		        ,C.TOT_AVG
		        ,(SELECT NM_KOR  FROM TBDB_CAND_IDENT WHERE CAND_NO  = A.CAND_NO ) NM_KOR
		        ,(SELECT POINT.POINT_MARKS FROM TBDB_RACE_POINT POINT  WHERE POINT.RACE_YY = A.RACE_YY AND POINT.ROUND = B.SELT_ROUND AND POINT.CAND_NO = A.CAND_NO ) AS POINT
		        ,race_grd_cd
		   FROM TBDB_RACE_REC_DETL A, TBDB_DETL_RACE_SCHE B ,TBDB_CAND_ASSIGN C
		  WHERE A.RACE_YY      = ? 
		  AND   A.RACE_YY  =  C.RACE_YY
		  AND   A.CAND_NO  =  C.CAND_NO
		  AND   B.ROUND = C.ROUND 
		  AND   A.ROUND        = B.SELT_ROUND 
		  AND   B.ROUND        = ?
		  AND   A.RACE_NO      = 8 
		  AND   A.ABS_GBN  IS NULL
		  AND   A.RACE_YY      = B.RACE_YY(+)
		  ORDER BY A.RACE_NO,A.RANK
        ]]>
    </query>  
  
 <query id="tbdb_group_org_i001" desc="경륜조편성  입력" fetchSize="10">
 <![CDATA[ 
	 
	 BEGIN		         	 
		INSERT INTO TBDB_GROUP_ORG (
				    RACE_YY
				   ,ROUND
				   ,CAND_NO 
				   ,MAT_CD  	 
	   			   ,RACE_GRD_CD 
	   			   ,RACE_NO	 
	   			   ,BACK_NO 	 
	   			   ,GEAR_RATE 	 
	   			   ,TOT_AVG     
				   ,GRD  		
					,INST_ID
					,INST_DTM
					,UPDT_ID
					,UPDT_DTM
		          )
				VALUES ( ?,?,?,?,?
						,?,?,?,?,?
						,?
						,SYSDATE
						,?
						,SYSDATE 
					 );
					 
      UPDATE TBDB_GROUP_ORG SET (
			 DCSN_GBN																	 				 						 
			,MAT_CD 													 
			,GEAR_RATE											 			-- 기어배수 							 					 
			,GRD				-- 등급									 
			,STRATEGY			-- 전법									 
			,LEG_TPE           -- 각질 									 
			,WIN_RATE		-- 승률 									 
			,HIGH_RANK_RATE    -- 연대율    						 		
			,RANK1_CNT		-- 1착									 
			,RANK2_CNT			-- 2착 									
			,RANK3_CNT			-- 3착 	
			,RANK4_CNT			-- 4착 
			,RANK5_CNT			-- 5착 
			,RANK6_CNT			-- 6착 
			,RANK7_CNT			-- 7착 								
			,ELIM1_CNT	   	    -- 실격				 
			,ELIM2_CNT			-- 경고			 
			,ELIM3_CNT			-- 주의			 
			,TOT_RANK        	-- 총순위				 
			,ESTM_SCR			-- 평가점 	 		
			,BF_ROUND			-- 전회차	
			,BF_RACE 	
) = (			 
		 SELECT 
			'0' AS DCSN_GBN																	 				 			 
			,T0.MAT_CD 												 
			,TO_CHAR(T0.GEAR_RATE,'0.00')  AS GEAR_RATE											 			-- 기어배수 							 						 
			,T0.GRD				-- 등급									 
			,T0.STRATEGY			-- 전법									 
			,T0.LEG_TPE           -- 각질 									 
			,T0.WIN_RATE		-- 승률 									 
			,T0.HIGH_RANK_RATE    -- 연대율    						 		
			,T0.RANK1_CNT		-- 1착									 
			,T0.RANK2_CNT			-- 2착 									
			,T0.RANK3_CNT			-- 3착 	
			,T0.RANK4_CNT			-- 4착 
			,T0.RANK5_CNT			-- 5착 
			,T0.RANK6_CNT			-- 6착 
			,T0.RANK7_CNT			-- 7착 								
			,T0.ELIM1_CNT	   	    -- 실격				 
			,T0.ELIM2_CNT			-- 경고			 
			,T0.ELIM3_CNT			-- 주의			 
			,T0.TOT_RANK        	-- 총순위				 
			,T0.ESTM_SCR			-- 평가점 	 		
			,T0.BF_ROUND			-- 전회차	
			,T1.BF_RACE 
			   FROM
			   (
			   SELECT 	
			 A.RACE_YY				-- 년도								 
			,A.ROUND				-- 회차   						 		 
			,A.CAND_NO				-- 후보생 번호							 			
			,B.NM_KOR				-- 후보생 이름  	
			,B.LIFE_BASE			-- 출신지					 
			,B.RACER_PERIO_NO    	-- 기수 	
			,101+TO_CHAR(SYSDATE,'YY')-SUBSTR(FC_DEC(B.RES_NO),0,2) AS AGE							 
			,A.MAT_CD 													 
			,'' RACE_GRD_CD	 											 
			,C.GEAR_RATE			-- 기어배수 							 
			,NVL(C.YY_AVG_RACE_SCR,0) AS TOT_AVG  -- 총평균 						 
			,C.GRD				-- 등급									 
			,C.STRATEGY			-- 전법									 
			,C.LEG_TPE           -- 각질 									 
			,ROUND(C.WIN_RATE,3) AS WIN_RATE			-- 승률 									 
			,ROUND(C.HIGH_RANK_RATE,3) AS HIGH_RANK_RATE    -- 연대율   					 		
			,C.RANK1_CNT		-- 1착									 
			,C.RANK2_CNT			-- 2착 									
			,C.RANK3_CNT			-- 3착 	
			,C.RANK4_CNT			-- 4착 
			,C.RANK5_CNT			-- 5착 
			,C.RANK6_CNT			-- 6착 
			,C.RANK7_CNT			-- 7착 								
			,(C.RANK4_CNT + C.RANK5_CNT + C.RANK6_CNT + C.RANK7_CNT)AS RANK_OUT -- 착외 
			,C.ELIM1_CNT	   	    -- 실격				 
			,C.ELIM2_CNT			-- 경고			 
			,C.ELIM3_CNT			-- 주의			 
			,C.TOT_RANK			-- 총순위				 
			,C.ESTM_SCR			-- 평가점 	 		
			,C.BF_ROUND			-- 전회차				 					
			 FROM										 
			     TBDB_CAND_ASSIGN A						 
			    ,TBDB_CAND_IDENT B 						
			    ,TBDB_REC_TOT C							 					 		   						 
			 WHERE					  
			    A.CAND_NO = B.CAND_NO 			
			    AND A.CAND_NO = C.CAND_NO				 
			    AND A.RACE_YY = ?			
			    AND A.ROUND   = ? 					 
			    AND A.DCSN_GBN = '0' 				
			    AND A.GBN = '1'						 
			)T0	   
			,( SELECT 								 
			 			  RACE_YY 						
			 			 ,ROUND 						
			 			 ,CAND_NO 						
			 			 ,RANK							
			 			 ,SUBSTR((SELECT CD_NM FROM TBDA_SPEC_CD WHERE GRP_CD = 'D10042' AND T2.RACE_GRD_CD = CD),0,2)||T2.RACE_NO ||'-'||T2.RANK AS BF_RACE 	
			  FROM 								
			  TBDB_RACE_REC_DETL T2	
			  WHERE RACE_YY = ?
			  AND ROUND =  (SELECT BF_ROUND FROM TBDB_REC_TOT WHERE T2.CAND_NO = CAND_NO)		 			 
			 )T1
			 WHERE T0.CAND_NO = T1.CAND_NO(+)	
			 AND T0.CAND_NO = ?
	)
	WHERE 	
	RACE_YY = ?				
	AND ROUND   =  ? 
	AND CAND_NO = ?		;
		   END; 
 ]]> 
  </query>

 <query id="tbdb_group_org_d001" desc="경륜조편성  입력" fetchSize="10">
 <![CDATA[   
		        
			DELETE 
			FROM   
			      TBDB_GROUP_ORG
			WHERE RACE_YY  = ? 
			  AND ROUND    = ?
			  AND CAND_NO  = ?

  ]]> 
  </query>
  
  
    
</queryMap>