<?xml version="1.0" encoding="euc-kr"?>
<Window>
	<Form Height="856" Id="E02040040" Left="8" OnKeyDown="fcHotKey" OnLoadCompleted="fcFormLoadSetting" OnUnloadCompleted="fcFormUnloadProcess" PidAttrib="7" Title="경주편성" Top="8" Ver="1.0" Width="1270" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="dsInComCd">
				<Contents>
					<colinfo id="DSNAME" size="20" type="STRING"/>
					<colinfo id="CD_GRP_ID" size="6" type="STRING"/>
					<colinfo id="QUERY_ID" size="256" type="STRING"/>
					<colinfo id="DESCRIPTION" size="256" type="STRING"/>
					<colinfo id="ALL_YN" size="1" type="STRING"/>
					<record>
						<ALL_YN></ALL_YN>
						<CD_GRP_ID>E00006</CD_GRP_ID>
						<DESCRIPTION>경정장코드</DESCRIPTION>
						<DSNAME>dsOutSMbr</DSNAME>
						<QUERY_ID></QUERY_ID>
					</record>
					<record>
						<ALL_YN></ALL_YN>
						<CD_GRP_ID>E00119</CD_GRP_ID>
						<DESCRIPTION>편성상태코드</DESCRIPTION>
						<DSNAME>dsOutSOrganStat</DSNAME>
						<QUERY_ID></QUERY_ID>
					</record>
					<record>
						<ALL_YN></ALL_YN>
						<CD_GRP_ID>E00024</CD_GRP_ID>
						<DESCRIPTION>출신지</DESCRIPTION>
						<DSNAME>dsOutArea</DSNAME>
						<QUERY_ID></QUERY_ID>
					</record>
					<record>
						<ALL_YN></ALL_YN>
						<CD_GRP_ID></CD_GRP_ID>
						<DESCRIPTION>경주간격</DESCRIPTION>
						<DSNAME>dsOutSRaceGap</DSNAME>
						<QUERY_ID>tbeb_race_gap_fb001</QUERY_ID>
					</record>
					<record>
						<ALL_YN></ALL_YN>
						<CD_GRP_ID>E00127</CD_GRP_ID>
						<DESCRIPTION>특선코드</DESCRIPTION>
						<DSNAME>dsOutSSpec</DSNAME>
						<QUERY_ID></QUERY_ID>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="dsOutSStndYear">
				<Contents>
					<colinfo id="STND_YEAR" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="dsOutSMbr">
				<Contents>
					<colinfo id="GRP_CD" size="256" type="STRING"/>
					<colinfo id="GRP_NM" size="256" type="STRING"/>
					<colinfo id="CD" size="256" type="STRING"/>
					<colinfo id="CD_NM" size="256" type="STRING"/>
					<colinfo id="RMK" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="dsOutSRaceTms">
				<Contents>
					<colinfo id="Tms" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="dsOutSDayOrd">
				<Contents>
					<colinfo id="DAY_ORD" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="dsOutTemp">
				<Contents></Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="dsOutRacer"></Dataset>
			<Dataset DataSetType="Dataset" Id="dsOutRace">
				<Contents>
					<colinfo id="RACE_NO" size="256" summ="default" type="STRING"/>
					<colinfo id="RACE_REG_NO" size="256" summ="default" type="STRING"/>
					<colinfo id="RACER_NO" size="256" summ="default" type="STRING"/>
					<colinfo id="RACER_GRD_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="MOT_NO" size="256" summ="default" type="STRING"/>
					<colinfo id="BOAT_NO" size="256" summ="default" type="STRING"/>
					<colinfo id="ONLINE_YN" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="dsOutSOrganStat">
				<Contents>
					<colinfo id="GRP_CD" size="256" type="STRING"/>
					<colinfo id="GRP_NM" size="256" type="STRING"/>
					<colinfo id="CD" size="256" type="STRING"/>
					<colinfo id="CD_NM" size="256" type="STRING"/>
					<colinfo id="RMK" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="dsOutArea"></Dataset>
			<Dataset DataSetType="Dataset" Id="dsOutStrategy">
				<Contents>
					<colinfo id="GRP_CD" size="256" type="STRING"/>
					<colinfo id="GRP_NM" size="256" type="STRING"/>
					<colinfo id="CD" size="256" type="STRING"/>
					<colinfo id="CD_NM" size="256" type="STRING"/>
					<colinfo id="RMK" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="dsOutMotRecdDetailCp">
				<Contents>
					<colinfo id="STND_YEAR" size="256" type="STRING"/>
					<colinfo id="MBR_CD" size="256" type="STRING"/>
					<colinfo id="TMS" size="256" type="STRING"/>
					<colinfo id="DAY_ORD" size="256" type="STRING"/>
					<colinfo id="RACE_NO" size="256" type="STRING"/>
					<colinfo id="RACE_REG_NO" size="256" type="STRING"/>
					<colinfo id="RACER_NO" size="256" type="STRING"/>
					<colinfo id="ABSE_CD" size="256" type="STRING"/>
					<colinfo id="BOAT_NO" size="256" type="STRING"/>
					<colinfo id="MOT_NO" size="256" type="STRING"/>
					<colinfo id="RANK" size="256" type="STRING"/>
					<colinfo id="RACE_TM" size="256" type="STRING"/>
					<colinfo id="TIME_DIFF" size="256" type="STRING"/>
					<colinfo id="STRATEGY_CD" size="256" type="STRING"/>
					<colinfo id="ENTRY_COURSE" size="256" type="STRING"/>
					<colinfo id="STAR_TM" size="256" type="STRING"/>
					<colinfo id="RMK" size="256" type="STRING"/>
					<colinfo id="INTRO_RUN_TM" size="256" type="STRING"/>
					<colinfo id="FLYING_CNT" size="256" type="STRING"/>
					<colinfo id="LATE_CNT" size="256" type="STRING"/>
					<colinfo id="STR" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="dsOutSRace">
				<Contents>
					<colinfo id="Tms" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="dsOutSortTemp">
				<Contents></Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="dsOutSRaceGap">
				<Contents>
					<colinfo id="RACE_NO" size="256" type="STRING"/>
					<colinfo id="STR_RACE_NO" size="256" type="STRING"/>
					<colinfo id="END_RACE_NO" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="dsOutSSpec">
				<Contents>
					<colinfo id="GRP_CD" size="256" type="STRING"/>
					<colinfo id="GRP_NM" size="256" type="STRING"/>
					<colinfo id="CD" size="256" type="STRING"/>
					<colinfo id="CD_NM" size="256" type="STRING"/>
					<colinfo id="RMK" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="dsOutExcelExport"></Dataset>
			<Dataset DataSetType="Dataset" Id="dsOutExcelImport"></Dataset>
			<Dataset DataSetType="Dataset" Editable="True" Id="dsOutTempOrgan">
				<Contents>
					<colinfo id="STND_YEAR" size="256" type="STRING"/>
					<colinfo id="MBR_CD" size="256" type="STRING"/>
					<colinfo id="TMS" size="256" type="STRING"/>
					<colinfo id="DAY_ORD" size="256" type="STRING"/>
					<colinfo id="ORGAN_NM" size="256" type="STRING"/>
					<colinfo id="ORGAN_TYPE" size="256" type="STRING"/>
					<colinfo id="ORGAN_OWNER_ID" size="256" type="STRING"/>
					<colinfo id="ORGAN_SEQ" size="256" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Checkbox Height="11" Id="chkAll" Left="8" OnClick="chkAll_OnClick" TabOrder="28" Text="전체경주" Top="24" Value="FALSE" Width="70"></Checkbox>
		<Div Enable="FALSE" Height="20" Id="divBtnLst" Left="934" TabOrder="25" Text="Div0" Top="78" Url="common::comButtonType.xml" Visible="FALSE" Width="330">
			<Contents></Contents>
		</Div>
		<Image Height="20" Id="imgFormTitle" ImageID="m_titleblet" Left="8" TabOrder="2" Top="8" Width="17"></Image>
		<Static Height="22" Id="stFormTitle" Left="30" Style="snis_m_title" TabOrder="1" Text="조회조건" Top="6" VAlign="Middle" Width="132"></Static>
		<Button Align="Left" ButtonStyle="TRUE" Height="20" Id="btnRightView" ImageID="btn_txt_02" Left="1051" LeftMargin="15" OnClick="btnRightView_OnClick" Style="snis_btn" TabOrder="3" Text="확장" Top="6" Transparent="TRUE" Width="50"></Button>
		<Shape BKColor="user0" Bottom="32" Height="28" Id="Shape0" Left="92" LineColor="user1" Right="681" RoundHeight="5" RoundUnit="Pixel" RoundWidth="5" TabOrder="4" Top="4" Type="RoundRect" Width="589"></Shape>
		<Static Align="Right" Height="20" Id="Static1" Left="268" Style="snis_if_lable" TabOrder="6" Text="회차" Top="8" VAlign="Middle" Width="36"></Static>
		<Combo Border="Flat" CodeColumn="Tms" DataColumn="Tms" Height="20" Id="cboSRaceTms" InnerDataset="dsOutSRaceTms" Left="304" OnChanged="cboSRaceTms_OnChanged" Style="snis_if_input01" TabOrder="8" Top="7" Width="45"></Combo>
		<Combo Border="Flat" CodeColumn="CD" DataColumn="CD_NM" Height="20" Id="cboSMbr" InnerDataset="dsOutSMbr" Left="208" OnChanged="cboSStndYear_OnChanged" Style="snis_if_input01" TabOrder="11" Text="스타트방식" Top="7" Value="스타트방식" Width="70"></Combo>
		<Combo Border="Flat" BorderColor="user1" CodeColumn="STND_YEAR" DataColumn="STND_YEAR" Height="20" Id="cboSStndYear" InnerDataset="dsOutSStndYear" Left="120" OnChanged="cboSStndYear_OnChanged" Style="snis_m_input01" TabOrder="7" Top="7" Width="55"></Combo>
		<Static Align="Right" Height="20" Id="Static6" Left="94" Style="snis_if_lable" TabOrder="5" Text="년도" Top="8" VAlign="Middle" Width="26"></Static>
		<Static Align="Right" Height="20" Id="Static0" Left="174" Style="snis_if_lable" TabOrder="10" Text="스타트방식" Top="8" VAlign="Middle" Width="35"></Static>
		<Static Align="Right" Height="20" Id="Static4" Left="338" Style="snis_if_lable" TabOrder="12" Text="일차" Top="8" VAlign="Middle" Width="36"></Static>
		<Combo Border="Flat" CodeColumn="DAY_ORD" DataColumn="DAY_ORD" Height="20" Id="cboSDayOrd" InnerDataset="dsOutSDayOrd" Left="373" OnChanged="cboSDayOrd_OnChanged" Style="snis_if_input01" TabOrder="13" Top="7" Width="40"></Combo>
		<Combo BindDataset="dsOutSDayOrd" Border="Flat" CodeColumn="CD" Column="ORGAN_STAT_CD" DataColumn="CD_NM" Enable="FALSE" Height="20" Id="cboSOrganStat" InnerDataset="dsOutSOrganStat" Left="497" Style="snis_if_input01" TabOrder="14" Top="7" Width="62"></Combo>
		<Calendar BindDataset="dsOutSDayOrd" Border="Flat" Column="RACE_DAY" Enable="FALSE" Height="20" Id="calSRaceDay" Left="412" SaturdayTextColor="blue" Style="snis_if_input01" SundayTextColor="red" TabOrder="15" Top="8" Width="86"></Calendar>
		<Button Align="Left" ButtonStyle="TRUE" Height="20" Id="btnSpecialOrgan" ImageID="btn_txt_04" Left="976" LeftMargin="15" OnClick="btnSpecialOrgan_OnClick" Style="snis_btn" TabOrder="16" Text="전일성적" Top="6" Transparent="TRUE" Width="74"></Button>
		<Button Align="Left" ButtonStyle="TRUE" Height="20" Id="btnOrgan" ImageID="btn_txt_04" Left="901" LeftMargin="15" OnClick="btnOrgan_OnClick" Style="snis_btn" TabOrder="17" Text="선수추출" Top="6" Transparent="TRUE" Width="74"></Button>
		<Button Align="Left" ButtonStyle="TRUE" Height="20" Id="btnSort" ImageID="btn_txt_02" Left="850" LeftMargin="15" OnClick="btnSort_OnClick" Style="snis_btn" TabOrder="18" Text="정렬" Top="6" Transparent="TRUE" Width="50"></Button>
		<Button Align="Left" ButtonStyle="TRUE" Height="20" Id="btnRaceGap" ImageID="btn_txt_04" Left="775" LeftMargin="15" OnClick="btnRaceGap_OnClick" Style="snis_btn" TabOrder="19" Text="경주간격" Top="6" Transparent="TRUE" Width="74"></Button>
		<Button Align="Left" ButtonStyle="TRUE" Height="20" Id="btnResult" ImageID="btn_txt_02" Left="724" LeftMargin="15" OnClick="btnResult_OnClick" Style="snis_btn" TabOrder="20" Text="결과" Top="6" Transparent="TRUE" Width="50"></Button>
		<Button Cursor="HAND" Height="20" Id="btnEnd" ImageID="btn_close" Left="1216" OnClick="fcEnd" TabOrder="24" Text="종료" Top="6" Transparent="TRUE" Width="50"></Button>
		<Image Height="20" Id="ImgSpace" ImageID="m_vline" Left="1207" TabOrder="23" Top="6" Width="12"></Image>
		<Button Cursor="HAND" Height="20" Id="btnSave" ImageID="btn_Save" Left="1161" OnClick="fcSave" TabOrder="22" Text="저장" Top="6" Transparent="TRUE" Width="50"></Button>
		<Button Cursor="HAND" Height="20" Id="btnCancel" ImageID="btn_clear_c" Left="1102" OnClick="fcInit" TabOrder="21" Text="취소" Top="6" Transparent="TRUE" Width="58"></Button>
		<Button Align="Left" ButtonStyle="TRUE" Height="20" Id="btnExcelDownload" ImageID="grid_down" Left="682" LeftMargin="15" OnClick="btnExcelDownload_OnClick" Style="snis_btn" TabOrder="26" Top="6" Transparent="TRUE" Width="20"></Button>
		<Button Align="Left" ButtonStyle="TRUE" Height="20" Id="btnExcelUpload" ImageID="grid_up" Left="703" LeftMargin="15" OnClick="btnExcelUpload_OnClick" Style="snis_btn" TabOrder="27" Top="6" Transparent="TRUE" Width="20"></Button>
		<Combo Border="Flat" CodeColumn="ORGAN_NM" DataColumn="ORGAN_NM" Editable="TRUE" Height="20" Id="cboTempOrgan" InnerDataset="dsOutTempOrgan" Left="556" OnChanged="cboTempOrgan_OnChanged" Style="snis_if_input01" TabOrder="29" Top="7" Width="80"></Combo>
		<Div BKColor="user0" Height="22" Id="divSearch" Left="629" TabOrder="9" Text="Div0" Top="8" Url="common::comButtonSearch.xml" Width="50">
			<Contents></Contents>
		</Div>
	</Form>
	<Script><![CDATA[/***************************************************************************************************
*   Form Common Script                                                                             *
*     현재 총 100 컬럼임 되도록 100 컬럼 안으로 코딩을 하세요                                      *
123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 1234567890
***************************************************************************************************/

/***************************************************************************************************
*                                         공통 Script Include                                      *
***************************************************************************************************/
#include "lib::boa_common_script.js";
#include "lib::boa_app_script.js";

/***************************************************************************************************
*                                          화면 변수 선언부                                        *
***************************************************************************************************/
var sFormId       = 'E02040040';
var sBUTTONLIST   = 'TTFFFT';                          //공통기능정의(버튼순으로 T or F)
var sUSERAUTH     = '';                                //사용자별 프로그램 사용 권한
var sFORMCAPTION  = '';                                //Form의 Title 정보
var sFORMLOCATION = '';                                //Form의 Location 정보
var sUSERLAVEL    = '';                                //Form의 사용  Level
var vREVOBJ       = Array(9);                          //결과값 처리를 위한 오브젝트 
var sGRDTIT       = "";                                //그리드 제목
var sCUROBJ       ;                                    //현재 LOST FOCUS 오브젝트

var oLastDs       = null;
var oLastDsRow    = 0;

var maxRegNo      = 6;									// 해당일차의 최고정번수        						
var sOrganType = "";    // 저장편성타입 - NEW, REAL, TEMP
var sOrganId = ""; 		// NEW, TEMP 편성의 소유자정보                          

/***************************************************************************************************
*                                         공통 Event 처리 부분                                     *
***************************************************************************************************/
/*-------------------------------------------------------------------------------------------------+
>>  최초 화면 Load時 처리 할 사항
+-------------------------------------------------------------------------------------------------*/
function fcFormLoadSetting(obj) {
	//화면환경 설정
	sFORMCAPTION  = obj.Title;
	sFORMLOCATION = "";

	//화면 정보 Display 및 Button 권한 설정
	sBUTTONLIST   = 'T' + sInpt + 'FFFT';
	if ( sInpt == "T" ) {
        btnSave.Visible        = true;
	} else {
        btnSave.Visible        = false;
	}
	
	
	fnc_FormLoadSetting(obj, sFORMCAPTION, sFORMLOCATION, sBUTTONLIST, sUSERAUTH);
	
	//초기 화면 BK Color설정 
	fnc_SetBKColor(this);

    //년도조회
    fce_SetStndYear(dsOutSStndYear, toInteger(fce_GetSysdate("YYYY")));
    cboSStndYear.Index = 0;

    // 현재 회차 조회
    fce_GetCurTms();

	//공통코드 조회
	fce_GetComboDs(dsInComCd);
	
}

/*-------------------------------------------------------------------------------------------------+
>>  최초 화면 Load時 처리 할 사항
+-------------------------------------------------------------------------------------------------*/
function fcFormUnloadProcess(obj) {

	// 정번수에 따라 화면넗이를 변경한다.
	if(maxRegNo>6){	
		global.window.width = 1296;
		width = 1280;				
	}
	// 경주수에 따라 화면높이를 변경한다.
	if(dsOutSRace.GetRowCount()>15){	// 늘린다.
		global.window.height = 1021;
		height = 833;  
	}
        
	//자료 변경 여부를 체크하고자 하는  DataSet Object를 넘긴다.
	var sDataset = "";
	if ( !fnc_FormUnloadCheck(sDataset , sFormId) ) return false;
}

/*-------------------------------------------------------------------------------------------------+
>>  단축키 처리(Form KeyDown)
+-------------------------------------------------------------------------------------------------*/
function fcHotKey(obj,objSenderObj,nChar,bShift,bControl,bAlt,nLLParam,nHLParam) {

	//Return Key Press時 Next Component focus
	if ( nChar == 13 ) {
		var oFocusComponent = GetNextComponent(true);
		oFocusComponent.setfocus();
		return;
	}

	//Control Key가 눌려져 있다면 단축키 처리
	//if (bControl) fnc_HotKey(this, nChar);
}

/***************************************************************************************************
*                                      공통 버튼 Event 처리 부분                                   *
***************************************************************************************************/
/*-------------------------------------------------------------------------------------------------+
>>  취소 버튼 클릭 時 처리
+-------------------------------------------------------------------------------------------------*/
function fcInit(obj) {

	dsOutRacer.Clear();
	for(var j = 0; j < dsOutSRace.GetRowCount(); j++){
		for(var k = 1; k <= dsOutSRace.GetColumn(j, "RACE_REG_NO_CNT"); k++){
			dsObj = object("dsOutRacer_" + dsOutSRace.GetColumn(j, "RACE_NO") + "_" + k);
			if ( dsObj.GetRowCount() > 0 ) {
				dsObj.ClearData();
			}
		}
	}
	
    var objName = "chkRace";
	
	for ( var i = 1; i <= dsOutSRace.GetRowCount(); i++ ) {
        object(objName + i).Value = "0";
        fcRaceHold(object(objName + i),object(objName + i).Value);
	}
}


/*-------------------------------------------------------------------------------------------------+
>>  조회 버튼 클릭 時 처리
+-------------------------------------------------------------------------------------------------*/
function fcSearchCheck(obj) {

	
    var nTmsRow        = fnc_GetExistValue(dsOutSRaceTms, "TMS", cboSRaceTms.Value);  // 
    var sState         = dsOutSRaceTms.GetColumn(nTmsRow, "RACE_TMS_STAT_CD");           // 해당 회차 상태
	
    if ( sState < "020" ) {
		fnc_Message(SNIS_BOA_B008, "N", "장비배정작업");
		return false;
    }

	for(var j = 0; j < dsOutSRace.GetRowCount(); j++){
		for(var k = 1; k <= dsOutSRace.GetColumn(j, "RACE_REG_NO_CNT"); k++){
			dsObj = object("dsOutRacer_" + dsOutSRace.GetColumn(j, "RACE_NO") + "_" + k);
			if ( dsObj.GetRowCount() > 0 ) {
				dsObj.ClearData();
			}					
		}
	} 
	
	dsOutRace.ClearData();
	dsOutRacer.ClearData();

	return true;
}

function fcSearch(obj) {
    if ( !fcSearchCheck(obj) ) return;

	var sServiceName = "e02040040-service:searchRace";
    var sInDataSet   = "";
    var sOutDataSet  = "dsOutRace=dsOutRace "
                     + "dsOutRacer=dsOutRacer ";

	fce_AddParam(Trim("STND_YEAR"), cboSStndYear.Value);
	fce_AddParam(Trim("MBR_CD   "), cboSMbr.Value     );
	fce_AddParam(Trim("TMS      "), cboSRaceTms.Value );
	fce_AddParam(Trim("DAY_ORD  "), cboSDayOrd.Value  );
	
	var sOrganType = dsOutTempOrgan.GetColumn(cboTempOrgan.Index, "ORGAN_TYPE");
	fce_AddParam(Trim("ORGAN_TYPE"), sOrganType );   
	 
    if(sOrganType=="TEMP" || sOrganType=="NEW" ){
    
		var tempOrganInfo = Split(dsOutTempOrgan.GetColumn(cboTempOrgan.Index, "ORGAN_SEQ"), "-");

		fce_AddParam(Trim("ORGAN_OWNER_ID"), tempOrganInfo[0]);
		fce_AddParam(Trim("ORGAN_SEQ"),  tempOrganInfo[1]);
	}	 
	
	fce_SendTransaction(sServiceName, sInDataSet, sOutDataSet, "fcCallBack");
}

/*-------------------------------------------------------------------------------------------------+
>>  저장 버튼 클릭 時 처리
+-------------------------------------------------------------------------------------------------*/
function fcSaveCheck(obj) {

    if ( !fnc_message("저장 하시겠습니까?", "Y") ) {
        return false;
    }

    if ( !fnc_IsMandatory(cboSStndYear, "년도"  ) ) return false;
    if ( !fnc_IsMandatory(cboSMbr     , "경정장") ) return false;
    if ( !fnc_IsMandatory(cboSRaceTms , "회차"  ) ) return false;
    if ( !fnc_IsMandatory(cboSDayOrd  , "일차"  ) ) return false;
    
	// 경주간격 Check전 기준정보가 있는지 체크
    if(dsOutSRace.GetRowCount() > dsOutSRaceGap.GetRowCount()){		
		fnc_Message(SNIS_BOA_B017, "N");
		btnRaceGap_OnClick();
		return false;
    }    
    
    dsOutRace.ClearData();
    var dsName  = "dsOutRacer_";
    var nRow = 0;
	var sStMthdCd = "002";
	
	for(var i = 1; i <= dsOutSRace.GetRowCount(); i++){
	
		if(dsOutSRace.GetColumn(i-1, "ST_MTHD_CD") == "001") sStMthdCd = "001";
		else  sStMthdCd = "002";
		
		for(var j = 1; j <= toInteger(dsOutSRace.GetColumn(i-1, "RACE_REG_NO_CNT")); j++){
			
			obj = object(dsName + dsOutSRace.GetColumn(i-1, "RACE_NO") + "_" + j);
			
			if(fnc_IsNull(obj.GetColumn(0, "RACER_NO"))) continue;
			
            dsOutRace.AddRow();
            dsOutRace.SetColumn(nRow, "RACE_NO"     , i);
            dsOutRace.SetColumn(nRow, "RACE_REG_NO" , j);
            dsOutRace.SetColumn(nRow, "RACER_NO"    , obj.GetColumn(0, "RACER_NO"));
            dsOutRace.SetColumn(nRow, "RACER_GRD_CD", obj.GetColumn(2, "RACER_NO"));
            dsOutRace.SetColumn(nRow, "MOT_NO"      , obj.GetColumn(1, "EQUIP_NO"));
            dsOutRace.SetColumn(nRow, "BOAT_NO"     , obj.GetColumn(2, "EQUIP_NO"));
            dsOutRace.SetColumn(nRow, "ST_MTHD_CD"   , sStMthdCd);
            nRow++;			
		}
	}	

    var nRacerNo   = 0;
    var sRacerNo   = "";
    var nStrRaceNo = 0;
    var nEndRaceNo = 0;
    var nLocRaceNo = 0;
    var sRaceNo    = "";

	// 경주간격 Check
	for(var i = 1; i <= dsOutSRace.GetRowCount(); i++){
	
        sRaceNo = i;
        if ( i < 10 ) sRaceNo = "0" + i;	
	
		for(var j = 1; j <= toInteger(dsOutSRace.GetColumn(i-1, "RACE_REG_NO_CNT")); j++){
            
            var objDs = object(dsName + sRaceNo + "_" + j);
            if ( fnc_IsNull(objDs.GetColumn(0, "RACER_NO"       )) ) continue;
            if ( fnc_IsNull(objDs.GetColumn(2, "ENTRY_BODY_WGHT")) ) continue;
            
            // 경주간견 조회
            nRow = fnc_GetExistValue(dsOutSRaceGap, "RACE_NO", sRaceNo);
            if ( nRow < 0 ) continue;
            nStrRaceNo = toInteger(dsOutSRaceGap.GetColumn(nRow, "STR_RACE_NO"));
            nEndRaceNo = toInteger(dsOutSRaceGap.GetColumn(nRow, "END_RACE_NO"));
            
            // 선수 리스트에서 조회
            sRacerNo = objDs.GetColumn(0, "RACER_NO");
            
            nRow = fnc_GetExistValue(dsOutRace, "RACER_NO", sRacerNo);
            
            if ( dsOutRace.GetColumn(nRow, "RACE_NO"    ) == i && dsOutRace.GetColumn(nRow, "RACE_REG_NO") == j) {
                nRow = fnc_GetExistValue(dsOutRace, "RACER_NO", sRacerNo, nRow + 1);
            }
                           
            if ( nRow < 0 ) continue;
            
            nLocRaceNo = toInteger(dsOutRace.GetColumn(nRow, "RACE_NO"));
            
            if ( nStrRaceNo <= nLocRaceNo && nEndRaceNo >= nLocRaceNo ) {
                var sMessage = objDs.GetColumn(1, "RACER_NO") + "선수는 " + toInteger(sRaceNo) + "경주와 " 
                                                                          + nLocRaceNo         + "경주에 배정되어있습니다."
                             + "\n계속하시겠습니까?";
                if ( fnc_message(sMessage, "Y") ) {
                    break;
                } else {
                    return false;
                }
            }
        }
    }

	return true;
}

function fcSave(obj) {
    if ( !fcSaveCheck(obj) ) return;

	var sServiceName = "e02040040-service:saveRace";
    var sInDataSet   = "dsOutRace=dsOutRace ";
    var sOutDataSet  = "";
  
	fce_AddParam(Trim("STND_YEAR"), cboSStndYear.Value);
	fce_AddParam(Trim("MBR_CD   "), cboSMbr.Value     );
	fce_AddParam(Trim("TMS      "), cboSRaceTms.Value );
	fce_AddParam(Trim("DAY_ORD  "), cboSDayOrd.Value  );
	fce_AddParam(Trim("RACE_DAY "), dsOutSDayOrd.GetColumn(dsOutSDayOrd.row, "RACE_DAY") );
	
	fce_AddParam(Trim("ORGAN_TYPE"), dsOutTempOrgan.GetColumn(cboTempOrgan.Index, "ORGAN_TYPE") );    
	
    if(dsOutTempOrgan.GetColumn(cboTempOrgan.Index, "ORGAN_TYPE")=="TEMP" ||
		dsOutTempOrgan.GetColumn(cboTempOrgan.Index, "ORGAN_TYPE")=="NEW"
		){
		var tempOrganInfo = Split(dsOutTempOrgan.GetColumn(cboTempOrgan.Index, "ORGAN_SEQ"), "-");

		fce_AddParam(Trim("ORGAN_OWNER_ID"), tempOrganInfo[0]);
		fce_AddParam(Trim("ORGAN_SEQ"),  tempOrganInfo[1]);
		
		sOrganType = dsOutTempOrgan.GetColumn(cboTempOrgan.Index, "ORGAN_TYPE");    // 저장편성타입 - NEW, REAL, TEMP
		sOrganId = dsOutTempOrgan.GetColumn(cboTempOrgan.Index, "ORGAN_SEQ"); 		// NEW, TEMP 편성의 소유자정보	
			
	}	

	fce_SendTransaction(sServiceName, sInDataSet, sOutDataSet, "fcCallBack");
}

/*-------------------------------------------------------------------------------------------------+
>>  엑셀 버튼 클릭 時 처리
+-------------------------------------------------------------------------------------------------*/
function fcToExcel(obj) {

}

/*-------------------------------------------------------------------------------------------------+
>>  인쇄 버튼 클릭 時 처리
+-------------------------------------------------------------------------------------------------*/
function fcPrint(obj) {

}
/*-------------------------------------------------------------------------------------------------+
>>  화면 종료(닫기) 버튼 클릭 時 처리
+-------------------------------------------------------------------------------------------------*/
function fcEnd(obj) {
	//화면 종료
	Close();	
}

/*-------------------------------------------------------------------------------------------------+
>>  행추가 버튼 클릭 時 처리
+-------------------------------------------------------------------------------------------------*/
function fcAddRow(obj) {
	
}

/*-------------------------------------------------------------------------------------------------+
>>  행삭제 버튼 클릭 時 처리
+-------------------------------------------------------------------------------------------------*/
function fcDelRow(obj) {

}

/***************************************************************************************************
*                                      공통 Function 처리 부분                                     *
***************************************************************************************************/
/*-------------------------------------------------------------------------------------------------+
>>  Text Box가 Focus를 받을 때
+-------------------------------------------------------------------------------------------------*/
function fcEditFocus(obj) {
	fnc_EditFocus(obj);
}

/*-------------------------------------------------------------------------------------------------+
>>  그리드 정렬
+-------------------------------------------------------------------------------------------------*/
function fcGridSort(obj,nCell,nX,nY) {
	//특정 Head 클릭 시 해당 항목으로 Sort(만약 특정 컬럼을 누를때만 소트하고자 한다면 nCell로 조건)
	fnc_GridSort(obj, object(obj.BindDataset), nCell);	
}

/*-------------------------------------------------------------------------------------------------+
>>  Help Popup Open
+-------------------------------------------------------------------------------------------------*/
function fcHelpDialoge(obj,nX,nY) {

}

/*-------------------------------------------------------------------------------------------------+
>>  그리드에서 팝업 처리 
+-------------------------------------------------------------------------------------------------*/
function fcGrdOnExpandEdit(objGrd, nRow, nCell, strVal, nPivotIndex){
	
}

/***************************************************************************************************
*                                      사용자 정의  처리 부분                                      *
***************************************************************************************************/
/*-------------------------------------------------------------------------------------------------+
>>  Transaction 후 처리 해야 할 내용!
+-------------------------------------------------------------------------------------------------*/
function fcCallBack(sServiceName, ErrorCode, ErrorMSG) {

	if ( !fnc_Result(ErrorCode, ErrorMSG) ) return;

	// 공통코드 조회시
	if ( sServiceName == "common-service:searchCode" ) {
        cboSMbr.Index = 0;
        cboSMbr.Value = fce_GetUserInfo("MBR_CD");
   
        fce_GetRaceTms(cboSStndYear.Value, cboSMbr.Value, "", "dsOutSRaceTms");
		return;
	}

	// 회차 리스트 조회시
	if ( sServiceName == "common_race-service:searchRaceTms" ) {
        cboSRaceTms.Index = 0;
        if ( cboSStndYear.Value == fce_GetCurRaceInfo("STND_YEAR") ) {
            var nIndexRow = fnc_GetExistValue(dsOutSRaceTms, "TMS", fce_GetCurRaceInfo("TMS"));
            if ( nIndexRow > -1 ) cboSRaceTms.Index = nIndexRow;
        }

        fce_GetRaceDayOrd(cboSStndYear.Value, cboSMbr.Value, cboSRaceTms.Value, "dsOutSDayOrd");
		return;
	}

	// 일차 리스트 조회시
	if ( sServiceName == "common_race-service:searchRaceDayOrd" ) {
        cboSDayOrd.Index = 0;
        if ( cboSStndYear.Value == fce_GetCurRaceInfo("STND_YEAR") 
         && cboSRaceTms.Value == fce_GetCurRaceInfo("TMS") ) {
            var nIndexRow = fnc_GetExistValue(dsOutSDayOrd, "DAY_ORD", fce_GetCurRaceInfo("DAY_ORD"));
            if ( nIndexRow > -1 ) cboSDayOrd.Index = nIndexRow;
        }
        
        cboSDayOrd_OnChanged();
		return;
	}

	// 경주 리스트 조회시
	if ( sServiceName == "common_race-service:searchRace" ) {
		
		// 가편성 목록 조회
		fcSearchTempOrganList();
	
		// 경주수, 정번수에 따라 화면크기를 변경하고 스크롤을 생성한다.
		// 최고정번수 셋팅
		maxRegNo = 6;
		for(var i = 0; i < dsOutSRace.GetRowCount(); i++){
			if(maxRegNo < toInteger(dsOutSRace.GetColumn(i, "RACE_REG_NO_CNT"))) maxRegNo = toInteger(dsOutSRace.GetColumn(i, "RACE_REG_NO_CNT"));
		}	

	
		// 편성관련 obj를 모두 제거
		for(var i = this.Components.Count-1; i >= 0; i--){
			// grid제거
			if(this.Components[i].GetType()=="Grid" ){
				if(Left(this.Components[i].id, 9) == "grdRacer_"){
					Destroy(this.Components[i].id);
					continue;
				}
			}
			// dataset제거
			if(this.Components[i].GetType()=="Dataset" ){
				if(Left(this.Components[i].id, 11) == "dsOutRacer_"){
					Destroy(this.Components[i].id);
					continue;
				}
			}
			// 경주정보제거
			if((this.Components[i].GetType()=="Shape" && Left(this.Components[i].id, 6) == "spRace") ||
				(this.Components[i].GetType()=="Static" && (Left(this.Components[i].id, 6) == "stRace" || 
				                                            Left(this.Components[i].id, 10) == "stRaceDgre")) ||
				(this.Components[i].GetType()=="Checkbox" && Left(this.Components[i].id, 7) == "chkRace")
				){
				Destroy(this.Components[i].id);
				continue;
			}		
		}
		
		// 데이터셋 생성
		for(var j = 0; j < dsOutSRace.GetRowCount(); j++){
			for(var k = 1; k <= dsOutSRace.GetColumn(j, "RACE_REG_NO_CNT"); k++){
				CreateDataset(dsOutSRace.GetColumn(j, "RACE_NO") + "_" + k);
			}
		}
		
		// 그리드 생성
		for(var i = 0; i < dsOutSRace.GetRowCount(); i++){
			CreateGrid(dsOutSRace.GetColumn(i, "RACE_NO"), dsOutSRace.GetColumn(i, "RACE_REG_NO_CNT"), dsOutSRace.GetColumn(i, "ST_MTHD_CD"));
		}
		
		// 화면 컴포넌트 생성
		for(var i = 0; i < dsOutSRace.GetRowCount(); i++){
			CreateObject(i+1);
		}
    	
    	// 등급셋팅
        for(var i = 0; i < dsOutSRace.GetRowCount(); i++ ) {
            object("stRaceDgre" + (i + 1)).Value = dsOutSRace.GetColumn(i, "RACE_DGRE_NM");
        }
        
	
		// 정번수에 따라 화면넗이를 변경한다.
        if(maxRegNo>6){	// 늘린다.
			global.window.width = 1685;
			width = 1680;			
        }else{	// 줄인다.
        	global.window.width = 1296;
			width = 1280;	
        }
        // 경주수에 따라 화면높이를 변경한다.
        
        if(dsOutSRace.GetRowCount()==16){	// 늘린다.
			global.window.height = 1030;
			height = 1030;
        }else if(dsOutSRace.GetRowCount()==17){	// 늘린다.
			global.window.height = 1080;
			height = 1130;
        }else if(dsOutSRace.GetRowCount()==18){	// 늘린다.
			global.window.height = 1130;
			height = 1130;
        }else{	// 줄인다.
			global.window.height = 1021;
			height = 833;        
        }
             
        // 확장화면 닫기
        var nCount = global.AllWindows.count;
        for ( var i = 0; i < nCount; i++ ) {
            if ( global.AllWindows[i].id == "E02040041" ) {
                global.AllWindows[i].Close();
            }
        }

        Open("form::E02040041.xml", "", 300, 300, "WinLevel=-1 TaskBar=true", 100, 100);
        
		return;
	}

	// 조회 후
	if ( sServiceName == "e02040040-service:searchRace" ) {

        var nRacerNo = 1;
        var nRow     = 0;
        var dsObj;
        var dsSorObj = dsOutRace;
        
      	var boxCnt = 3;
		if(maxRegNo >= 7 ) boxCnt = 4;
        
        // 현재화면 그리기 멈춤
		for ( var i = 1; i <= dsOutSRace.GetRowCount(); i++ ) {
			for ( var j = 1; j <= boxCnt; j++ ) {
				dsObj = object("grdRacer_" + dsOutSRace.GetColumn(i-1, "RACE_NO") + "_" + j);
				dsObj.Redraw = false;
				
			}
		}
		
        // 확장화면 그리기 멈춤
        var nCount = global.AllWindows.count;
        for ( var i = 0; i < nCount; i++ ) {

            if ( global.AllWindows[i].id == "E02040041" ) {
                global.AllWindows[i].fcStopDraw();
                break;
            }
        }		

        // 편성이 이루어진 선수
        for ( var i = 0; i < dsOutRace.GetRowCount(); i++ ) {
            var nRaceNo    = dsSorObj.GetColumn(i, "RACE_NO");
            var nRaceRegNo = toInteger(dsSorObj.GetColumn(i, "RACE_REG_NO"));
            
            dsObj = object("dsOutRacer_" + nRaceNo + "_" + nRaceRegNo);

            nRow = 0;
            dsObj.AddRow();
            dsObj.SetColumn(nRow, "RACER_NO"               , dsSorObj.GetColumn(i, "RACER_NO"               )); // 선수번호
            dsObj.SetColumn(nRow, "ENTRY_BODY_WGHT"        , dsSorObj.GetColumn(i, "ENTRY_BODY_WGHT"        )); // 체중
            dsObj.SetColumn(nRow, "TRRAS_TMS_6_AVG_STRT_TM", dsSorObj.GetColumn(i, "TRRAS_TMS_6_AVG_STRT_TM")); // 6최차ST타임
            dsObj.SetColumn(nRow, "NATV_PLAC_CD"           , dsSorObj.GetColumn(i, "NATV_PLAC_CD"           )); // 연고지
            dsObj.SetColumn(nRow, "NATY_UNIV"              , dsSorObj.GetColumn(i, "NATY_UNIV"              )); // 대학명
            dsObj.SetColumn(nRow, "RACE_CNT_1"             , dsSorObj.GetColumn(i, "RACE_CNT_1"             )); // 1코스출주횟수
            dsObj.SetColumn(nRow, "RACE_CNT_2"             , dsSorObj.GetColumn(i, "RACE_CNT_2"             )); // 1코스출주횟수
            dsObj.SetColumn(nRow, "RACE_CNT_3"             , dsSorObj.GetColumn(i, "RACE_CNT_3"             )); // 1코스출주횟수
            dsObj.SetColumn(nRow, "RACE_CNT_4"             , dsSorObj.GetColumn(i, "RACE_CNT_4"             )); // 1코스출주횟수
            dsObj.SetColumn(nRow, "RACE_CNT_5"             , dsSorObj.GetColumn(i, "RACE_CNT_5"             )); // 1코스출주횟수
            dsObj.SetColumn(nRow, "RACE_CNT_6"             , dsSorObj.GetColumn(i, "RACE_CNT_6"             )); // 1코스출주횟수
            dsObj.SetColumn(nRow, "RACE_CNT_7"             , dsSorObj.GetColumn(i, "RACE_CNT_7"             )); // 1코스출주횟수
            dsObj.SetColumn(nRow, "RACE_CNT_8"             , dsSorObj.GetColumn(i, "RACE_CNT_8"             )); // 1코스출주횟수
            dsObj.SetColumn(nRow, "RACE_ALLOC_CNT"         , dsSorObj.GetColumn(i, "PRE_RACE_REG_NO"        )); // 전일출주정번
			
            dsObj.AddRow();
            nRow++;
            dsObj.SetColumn(nRow, "RACER_NO"               , dsSorObj.GetColumn(i, "NM_KOR"                       )); // 선수명
            dsObj.SetColumn(nRow, "ENTRY_BODY_WGHT"        , dsSorObj.GetColumn(i, "SCR"                          )); // 평가점
            dsObj.SetColumn(nRow, "TRRAS_TMS_6_AVG_STRT_TM", dsSorObj.GetColumn(i, "RANK"                         )); // 순위
            dsObj.SetColumn(nRow, "NATV_PLAC_CD"           , dsSorObj.GetColumn(i, "SPEC_CD"                      )); // 
            dsObj.SetColumn(nRow, "NATY_UNIV"              , dsSorObj.GetColumn(i, "TRRAS_TMS_6_AVG_RANK_SCR"     )); // 6회차평균착순점
            dsObj.SetColumn(nRow, "RACE_CNT_1"             , dsSorObj.GetColumn(i, "TRRAS_TMS_6_HIGH_RANK_RATIO"  )); // 6회차연대율
            dsObj.SetColumn(nRow, "RACE_CNT_2"             , dsSorObj.GetColumn(i, "TRRAS_TMS_6_HIGH_3_RANK_RATIO")); // 6회차3연대율
            dsObj.SetColumn(nRow, "RACE_CNT_3"             , dsSorObj.GetColumn(i, "VIEW_MOT_NO"                  )); // 모터번호
            dsObj.SetColumn(nRow, "RACE_CNT_4"             , dsSorObj.GetColumn(i, "TMRAS_AVG_RANK_SCR"           )); // 모터착순점
            dsObj.SetColumn(nRow, "RACE_CNT_5"             , dsSorObj.GetColumn(i, "TMRAS_HIGH_RANK_RATIO"        )); // 모터연대율
            dsObj.SetColumn(nRow, "RACE_CNT_6"             , dsSorObj.GetColumn(i, "TMRAS_AVG_ITRDT_RUN_TM"       )); // 모터평균소개항주
            dsObj.SetColumn(nRow, "RACE_CNT_7"             , ""); // 1코스출주횟수
            dsObj.SetColumn(nRow, "RACE_CNT_8"             , ""); // 1코스출주횟수
            dsObj.SetColumn(nRow, "EQUIP_NO"               , dsSorObj.GetColumn(i, "MOT_NO"                       )); // 모터번호
            dsObj.SetColumn(nRow, "RACE_ALLOC_CNT"         , dsSorObj.GetColumn(i, "RACE_ALLOC_CNT"               )); // 출주횟수
			
            dsObj.AddRow();
            nRow++;
            dsObj.SetColumn(nRow, "RACER_NO"               , dsSorObj.GetColumn(i, "RACER_GRD_CD"                 )); // 선수등급
            dsObj.SetColumn(nRow, "ENTRY_BODY_WGHT"        , dsSorObj.GetColumn(i, ""                             )); // 2회 출주시 경주/정번
            dsObj.SetColumn(nRow, "TRRAS_TMS_6_AVG_STRT_TM", dsSorObj.GetColumn(i, "RACE1"                        )); // 전일성적1
            dsObj.SetColumn(nRow, "NATV_PLAC_CD"           , dsSorObj.GetColumn(i, "RACE2"                        )); // 전일성적2
            dsObj.SetColumn(nRow, "NATY_UNIV"              , dsSorObj.GetColumn(i, "TRRAS_AVG_SCR"                )); // 평균득점
            dsObj.SetColumn(nRow, "RACE_CNT_1"             , dsSorObj.GetColumn(i, "TRRAS_HIGH_RANK_RATIO"        )); // 연간연대율
            dsObj.SetColumn(nRow, "RACE_CNT_2"             , dsSorObj.GetColumn(i, "TRRAS_HIGH_3_RANK_RATIO"      )); // 연간3연대율
            dsObj.SetColumn(nRow, "RACE_CNT_3"             , dsSorObj.GetColumn(i, "VIEW_BOAT_NO"                 )); // 보트번호
            dsObj.SetColumn(nRow, "RACE_CNT_4"             , dsSorObj.GetColumn(i, "TBRAS_AVG_RANK_SCR"           )); // 보트착순점
            dsObj.SetColumn(nRow, "RACE_CNT_5"             , dsSorObj.GetColumn(i, "TBRAS_HIGH_RANK_RATIO"        )); // 보트연대율
            dsObj.SetColumn(nRow, "RACE_CNT_6"             , dsSorObj.GetColumn(i, "TBRAS_AVG_ITRDT_RUN_TM"       )); // 보트평균소개항주
            dsObj.SetColumn(nRow, "RACE_CNT_7"             , ""); // 1코스출주횟수
            dsObj.SetColumn(nRow, "RACE_CNT_8"             , ""); // 1코스출주횟수
            dsObj.SetColumn(nRow, "EQUIP_NO"               , dsSorObj.GetColumn(i, "BOAT_NO"                      )); // 보트번호
            dsObj.SetColumn(nRow, "RACE_ALLOC_CNT"         , dsSorObj.GetColumn(i, "NEXT_RACE_ALLOC_CNT"          )); // 2일차출주횟수
            
            dsObj.row = 1;
            
        }

        dsSorObj = dsOutRacer;
        
        //신규편성(온라인스타트)
		dsSorObj.Filter("RACE_ONLINE_CNT = '1'"); 
		dsOutSRace.Filter("ST_MTHD_CD = '001' "); //온라인스타트
        createOgranDataset(dsSorObj, dsObj);

        // 신규편성(플라잉스타트)
        dsSorObj.Filter("RACE_ONLINE_CNT != '1'"); 
		dsOutSRace.Filter("ST_MTHD_CD != '001' "); //플라잉스타트
        createOgranDataset(dsSorObj, dsObj);
		
		dsSorObj.unFiler();
		dsOutSRace.UnFilter();

		for(var i = 0; i < dsOutSRace.GetRowCount(); i++){
			for(var j = 0; j < toInteger(dsOutSRace.GetColumn(i, "RACE_REG_NO_CNT")); j++){
				fcGetEtcRace(object("dsOutRacer_" + dsOutSRace.GetColumn(i, "RACE_NO") + "_" + (j+1)));
			}
		}

		// 현재화면 그리기 시작
		for ( var i = 1; i <= dsOutSRace.GetRowCount(); i++ ) {
			for ( var j = 1; j <= boxCnt; j++ ) {
				dsObj = object("grdRacer_" + dsOutSRace.GetColumn(i-1, "RACE_NO") + "_" + j);
				dsObj.Redraw = true;
			}
		}

        // 확장화면 그리기 시작
        var nCount = global.AllWindows.count;
        for ( var i = 0; i < nCount; i++ ) {
            if ( global.AllWindows[i].id == "E02040041" ) {
                global.AllWindows[i].fcStartDraw();
                break;
            }
        }		
	
		return;
	}
	
	// 가편성 목록 조회 후
	if ( sServiceName == "e02040040-service:searchTempOrgan" ) {
		var nRow = fnc_GetExistValue(dsOutSOrganStat, "CD", cboSOrganStat.Value);	
		if ( dsOutSOrganStat.GetColumn(nRow, "CD") == "002" ) {
			dsOutTempOrgan.DeleteRow(0);  // 신규삭제
		}
		//cboTempOrgan_OnChanged();
		
		// 저장 후 재조회시 처리
		if(sOrganType!=""){
				
			if(sOrganType=="NEW"){
				cboTempOrgan.Index = fnc_GetExistValue(dsOutTempOrgan, "ORGAN_SEQ", sOrganId);
			}
			
			sOrganType = "";
			sOrganId = "";
						
		}else if(cboTempOrgan.Index==-1){
			cboTempOrgan.Index = 0;
		}		
        
		return;
	}	

	// 모터그래프 조회
	if ( sServiceName == "e02040020-service:searchRecdDetail" ) {

        var logImgUrl = GBL_REPORT_URL + "log.jpg";
        var sSubUrl   = "";                     //레포트 파일이 있는 서브디렉토리
        var sRptNm    = "e02049020_race_grp.jrf";               //레포트 파일명
        var sDataSet  = "E02040020_RACE=dsOutMotRecdDetailCp";   //"UBI 쿼리명, MIP Dataset명"
        var sArg      = " IMG_URL="+logImgUrl; 
        var sRptDrct  = 1;                               //출력방향(0 : 수직, 1 : 수평)
        
        dsOutMotRecdDetailCp.AddColumn("STR");
        for ( var i = 0; i <= dsOutMotRecdDetailCp.rowcount; i++ ) {
            if ( dsOutMotRecdDetailCp.getColumn(i, "RANK"   ) == "0" ) {
                dsOutMotRecdDetailCp.SetColumn(i, "RANK"   , 0);
            } else {
                //dsOutMotRecdDetailCp.SetColumn(i, "RANK"   , toNumber(7 - dsOutMotRecdDetailCp.getColumn(i, "RANK"   )));
                dsOutMotRecdDetailCp.SetColumn(i, "RANK"   , dsOutMotRecdDetailCp.getColumn(i, "RANK"   ));
            }
            
            if ( toNumber(1 - dsOutMotRecdDetailCp.getColumn(i, "STAR_TM")) >= 1 ) {
                dsOutMotRecdDetailCp.SetColumn(i, "STAR_TM", 0);
            } else {
                //dsOutMotRecdDetailCp.SetColumn(i, "STAR_TM", toNumber(1 - dsOutMotRecdDetailCp.getColumn(i, "STAR_TM")));
                dsOutMotRecdDetailCp.SetColumn(i, "STAR_TM", dsOutMotRecdDetailCp.getColumn(i, "STAR_TM"));
            }
            dsOutMotRecdDetailCp.setColumn(i, "STR"    , i);
        }
    
        fnc_RPTPrint(sSubUrl, sRptNm, sDataSet, sArg, sRptDrct);

		return;
	}

	// 저장 후
	if ( sServiceName == "e02040040-service:saveRace" ) {
	
		// 가편성 목록 조회
		fcSearchTempOrganList();

		return;
	}
	
	//오류가 없이 정상 처리되었다면...
	fcPostProcess(sServiceName);
}

/*-------------------------------------------------------------------------------------------------+
>>  Transaction 후 Post Process!
+-------------------------------------------------------------------------------------------------*/
function fcPostProcess(sServiceName) {

}

/*-------------------------------------------------------------------------------------------------+
>>  코드나 명 입력 후 Lost Focus 시 해당 정보 Display
+-------------------------------------------------------------------------------------------------*/
function fcCodeNameDisplay(obj) {

}

/*-------------------------------------------------------------------------------------------------+
>>  회차변경시
+-------------------------------------------------------------------------------------------------*/
function cboSRaceTms_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
	fce_GetRaceDayOrd(cboSStndYear.Value, cboSMbr.Value, cboSRaceTms.Value, "dsOutSDayOrd");
}

/*-------------------------------------------------------------------------------------------------+
>>  년도변경시
+-------------------------------------------------------------------------------------------------*/
function cboSStndYear_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
    fce_GetRaceTms(cboSStndYear.Value, cboSMbr.Value, "", "dsOutSRaceTms");
}

/*-------------------------------------------------------------------------------------------------+
>>  분기변경시
+-------------------------------------------------------------------------------------------------*/
function cboSMbr_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
	fce_GetRaceTms(cboSStndYear.Value, cboSMbr.Value, "", "dsOutSRaceTms");
}

/*-------------------------------------------------------------------------------------------------+
>>  확장버튼 Click시
+-------------------------------------------------------------------------------------------------*/
function btnRightView_OnClick(obj)
{
    var nCount = global.AllWindows.count;

	for ( var i = 0; i < nCount; i++ ) {
		if ( global.AllWindows[i].id == "E02040041" ) {
            global.AllWindows[i].SetFocus();
            return;
		}
	}

	Open("form::E02040041.xml", , 300, 300, "WinLevel=-1 TaskBar=true", 100, 100);
}

/*-------------------------------------------------------------------------------------------------+
>>  선수 Drag
+-------------------------------------------------------------------------------------------------*/
function grdRace_OnDrag(obj,nPosX,nPosY,varKeyState,nRow,nCell,nPivotIndex)
{
    var dataObj = CreateDataObject();
	dataObj.SetData("CF_TEXT", obj.ID);
	
	if ( obj.IsAboveSel() ) return dataObj;	
}

/*-------------------------------------------------------------------------------------------------+
>>  선수 Drop
+-------------------------------------------------------------------------------------------------*/
function grdRace_OnDrop(obj,objDragObj,objDataObj,nPosX,nPosY,varKeyState,nRow,nCell,nPivotIndex)
{
    var objName       = "grdRacer_";
	var sTargetRaceNo = substr(obj.Id, length(objName));
    var objTargetDs   = Object("dsOutRacer_" + sTargetRaceNo);

	var sSourceRaceNo = substr(objDataObj.GetData("CF_TEXT"), length(objName));
    var objSourceDs   = Object("dsOutRacer_" + sSourceRaceNo);

    dsOutTemp.Copy(objTargetDs);
    objTargetDs.Copy(objSourceDs);
    objSourceDs.Copy(dsOutTemp);
    
    fcGetEtcRace(objSourceDs);
    fcGetEtcRace(objTargetDs);
}

/*-------------------------------------------------------------------------------------------------+
>>  Dataset생성
+-------------------------------------------------------------------------------------------------*/

function CreateDataset(race_no) {

	Create("Dataset", "dsOutRacer_" + race_no);		
	dsObj = Object("dsOutRacer_" + race_no);
	
	dsObj.AddColumn("RACER_NO"               );
	dsObj.AddColumn("ENTRY_BODY_WGHT"        );
	dsObj.AddColumn("TRRAS_TMS_6_AVG_STRT_TM");
	dsObj.AddColumn("NATV_PLAC_CD"           );
	dsObj.AddColumn("NATY_UNIV"              );
	dsObj.AddColumn("RACE_CNT_1"             );
	dsObj.AddColumn("RACE_CNT_2"             );
	dsObj.AddColumn("RACE_CNT_3"             );
	dsObj.AddColumn("RACE_CNT_4"             );
	dsObj.AddColumn("RACE_CNT_5"             );
	dsObj.AddColumn("RACE_CNT_6"             );
	dsObj.AddColumn("RACE_CNT_7"             );
	dsObj.AddColumn("RACE_CNT_8"             );
	dsObj.AddColumn("EQUIP_NO"               );
	dsObj.AddColumn("RACE_ALLOC_CNT"         );
	dsObj.AddColumn("SELECT_RACE_1"          );
	dsObj.AddColumn("SELECT_RACE_2"          );

}


/*-------------------------------------------------------------------------------------------------+
>>  Grid 생성
+-------------------------------------------------------------------------------------------------*/
function CreateGrid(race_no, racer_cnt, st_mthd_cd) {

	var sContents = "";
    var nHeight = 50;
    var nWidth  = 400;	
	var nLeft = 0;
	var nTop = 0;
	
	var boxCnt = 3;
	var borderColor = ""; 
	  
	if(maxRegNo >= 7 ) boxCnt = 4;
	
	if(st_mthd_cd == '001' ) borderColor = "blue";
	else borderColor = "user22";

	for ( var i = 1; i <= boxCnt; i++ ) {
	
		sContents = '      <contents>';
		sContents += fcGetColumn(race_no + "_" + i, racer_cnt) + fcGetBody(race_no + "_" + i, racer_cnt);
		sContents += '      </contents>';	
		
		nLeft = ((i - 1) * (nWidth  + 2)) + 60;
		nTop =  ((toInteger(race_no)-1) * (nHeight + 2)) + 36;
	
		sGridType = 'AutoFit="TRUE"            '
				  + 'AutoFitEndLine="Hide"     '
				  + 'BindDataset="dsOutRacer_' + race_no + '_' + i + '" '
				  + 'BKColor="user15"          '
				  + 'BkColor2="user16"         '
				  + 'BkSelColor="user17"       '
				  + 'BoldHead="true"           '
				  + 'Border="flat"             '
				  + 'BorderColor="'+borderColor+'"'
				  + 'Bottom="86"               '
				  + 'DragMode="TRUE"           '
				  + 'DropMode="TRUE"           '
				  + 'Enable="true"             '
				  + 'EndLineColor="default"    '
				  + 'FillArea="TRUE"           '
				  + 'HeadBorder="Flat"         '
				  + 'HeadHeight="20"           '
				  + 'Height="'+ nHeight + '"   '
				  + 'Id="grdRacer_' + race_no + '_' + i + '" '
				  + 'InputPanel="FALSE"        '
				  + 'Left="'+ nLeft + '"       '
				  + 'LineColor="user18"        '
				  + 'MinWidth="100"            '
//				  + 'OnCellDBLClick="grdRacer_OnCellDblClick" '
				  + 'OnCellDBLClick="grdRacerMotorBoatDblClick" '
				  + 'OnDrag="grdRace_OnDrag"   '
				  + 'OnDrop="grdRace_OnDrop"   '
				  + 'Right="460"               '
				  + 'RowHeight="16"            '
				  + 'SelColor="user19"         '
				  + 'Style="snis_grid"         '
				//  + 'TabOrder="'+ nGridNo + '" '
				  + 'TabStop="true"            '
				  + 'Top="'+ nTop + '"         '
				  + 'UseDBuff="true"           '
				  + 'UsePopupMenu="true"       '
				  + 'UseSelColor="False"       '
				  + 'Visible="true"            '
				  + 'VLineColor="default"      '
				  + 'WheelScrollRow="1"        '
				  + 'Width="'+ nWidth + '"     ';
				  
		create("Grid","grdRacer_" + race_no + "_" + i, sGridType);
		object("grdRacer_" + race_no + "_" + i).contents = sContents;		
	}
}

/*-------------------------------------------------------------------------------------------------+
>>  Grid Column 생성
+-------------------------------------------------------------------------------------------------*/
function fcGetColumn(nGridNo, racer_cnt) {
    var sColumn = "";
    sColumn += '					<columns>';
    sColumn += '						<col width="90"/>';
    sColumn += '						<col width="70"/>';
    sColumn += '						<col width="55"/>';
	sColumn += '						<col width="60"/>';
    sColumn += '						<col width="80"/>';
    sColumn += '						<col width="55"/>';
    sColumn += '						<col width="55"/>';
    sColumn += '						<col width="55"/>';
    sColumn += '						<col width="55"/>';
    sColumn += '						<col width="55"/>';
    sColumn += '						<col width="55"/>';
    if(racer_cnt >= 7){
		sColumn += '						<col width="55"/>';
    }
    if(racer_cnt == 8){
		sColumn += '						<col width="55"/>';
    }
	sColumn += '					</columns>';
    return sColumn;
}

/*-------------------------------------------------------------------------------------------------+
>>  Grid Body 생성
+-------------------------------------------------------------------------------------------------*/
function fcGetBody(nGridNo, racer_cnt) {
    
    var sBkColor   = fcGetBkColor("dsOutRacer_", nGridNo);
    var sRaceColor = "";
    var sBody = "";
    sBody   = '         <body>';
    sBody  += '           <cell col="0"  colid="RACER_NO"                align="center" display="text" font="expr:iif(row==1,&quot;굴림,9,Bold&quot;,&quot;&quot;)" bkcolor="' + sBkColor + '" />';
    sBody  += '           <cell col="1"  colid="ENTRY_BODY_WGHT"         align="center" display="text" font="expr:iif(row==2,&quot;굴림,9,Bold&quot;,&quot;&quot;)"/>';
    sBody  += '           <cell col="2"  colid="TRRAS_TMS_6_AVG_STRT_TM" align="center" display="text"/>';
    
    sBkColor = fcGetSpecRaceColor("dsOutRacer_", nGridNo);
    sBody  += '           <cell col="3"  colid="NATV_PLAC_CD"            align="center" display="text" bkcolor="' + sBkColor + '"/>';
    sBody  += '           <cell col="4"  colid="NATY_UNIV"               align="left"   display="text" font="expr:iif(row==1,&quot;굴림,9,Bold&quot;,&quot;&quot;)"/>';

    var n = 1;
    sRaceColor = fcGetRaceColor("dsOutRacer_", nGridNo, n);
    sBody  += '           <cell col="5"  colid="RACE_CNT_1"              align="center" display="text" bkcolor="' + sRaceColor + '" font="' + fcGetRaceRegFont(nGridNo, n++) + '"/>';
    sRaceColor = fcGetRaceColor("dsOutRacer_", nGridNo, n);
    sBody  += '           <cell col="6"  colid="RACE_CNT_2"              align="center" display="text" bkcolor="' + sRaceColor + '" font="' + fcGetRaceRegFont(nGridNo, n++) + '"/>';
    sRaceColor = fcGetRaceColor("dsOutRacer_", nGridNo, n);
    sBody  += '           <cell col="7"  colid="RACE_CNT_3"              align="center" display="text" bkcolor="' + sRaceColor + '" font="' + fcGetRaceRegFont(nGridNo, n++) + '"/>';
    sRaceColor = fcGetRaceColor("dsOutRacer_", nGridNo, n);
    sBody  += '           <cell col="8"  colid="RACE_CNT_4"              align="center" display="text" bkcolor="' + sRaceColor + '" font="' + fcGetRaceRegFont(nGridNo, n++) + '"/>';
    sRaceColor = fcGetRaceColor("dsOutRacer_", nGridNo, n);
    sBody  += '           <cell col="9"  colid="RACE_CNT_5"              align="center" display="text" bkcolor="' + sRaceColor + '" font="' + fcGetRaceRegFont(nGridNo, n++) + '"/>';
    sRaceColor = fcGetRaceColor("dsOutRacer_", nGridNo, n);
    sBody  += '           <cell col="10" colid="RACE_CNT_6"              align="center" display="text" bkcolor="' + sRaceColor + '" font="' + fcGetRaceRegFont(nGridNo, n++) + '"/>';
    
    if(racer_cnt >= 7){
		sRaceColor = fcGetRaceColor("dsOutRacer_", nGridNo, n);
		sBody  += '           <cell col="11" colid="RACE_CNT_7"              align="center" display="text" bkcolor="' + sRaceColor + '" font="' + fcGetRaceRegFont(nGridNo, n++) + '"/>';    
    }
    if(racer_cnt == 8){
		sRaceColor = fcGetRaceColor("dsOutRacer_", nGridNo, n);
		sBody  += '           <cell col="12" colid="RACE_CNT_8"              align="center" display="text" bkcolor="' + sRaceColor + '" font="' + fcGetRaceRegFont(nGridNo, n++) + '"/>';    
    }
    sBody  += '         </body>';
    return sBody;
}

/*-------------------------------------------------------------------------------------------------+
>>  경주 Hold
+-------------------------------------------------------------------------------------------------*/
function fcRaceHold(obj,strValue)
{
    var objName = "chkRace";
	var nRaceNo = toInteger(substr(obj.Id, length(objName)));
	
	var boxCnt = 3;
	if(maxRegNo >= 7 ) boxCnt = 4;
	
	if(nRaceNo < 10) nRaceNo = "0" + nRaceNo;
	
	for ( var i = 1; i <= boxCnt; i++ ) {
        var objGrid = object("grdRacer_" + nRaceNo + "_" + i);
        if ( obj.Value == "1" ) {
            objGrid.BkColor    = "#A5E3E6";
            objGrid.BkColor2   = "#A5E3E6";
            objGrid.BkSelColor = "#A5E3E6";
	        objGrid.OnDrag     = "";
	        objGrid.OnDrop     = "";
        } else {
            objGrid.BkColor    = "";
            objGrid.BkColor2   = "";
            objGrid.BKSelColor = "";
	        objGrid.OnDrag     = "grdRace_OnDrag";
	        objGrid.OnDrop     = "grdRace_OnDrop";
        }
	}
	
    fcSetRaceCnt(obj);
    

	for ( var i = 0; i < global.AllWindows.count; i++ ) {
		if ( global.AllWindows[i].id == "E02040041" ) {
			global.AllWindows[i].fcRaceHold2(obj, nRaceNo, dsOutSRace.GetColumn(toInteger(nRaceNo)-1, "RACE_REG_NO_CNT"));
		}
	}
}

/*-------------------------------------------------------------------------------------------------+
>>  선수의 다른 경주 조회
+-------------------------------------------------------------------------------------------------*/
function fcGetEtcRace(obj) {
    //if ( obj.GetColumn(0, "RACE_ALLOC_CNT") == "1" ) return;
    var sRacerNo = obj.GetColumn(0, "RACER_NO");

    if ( fnc_IsNull(sRacerNo) ) return;

	for(var i = 0; i < dsOutSRace.GetRowCount(); i++){
		for(var j = 0; j < toInteger(dsOutSRace.GetColumn(i, "RACE_REG_NO_CNT")); j++){
			var objDs = object("dsOutRacer_" + dsOutSRace.GetColumn(i, "RACE_NO") + "_" + (j+1));
			if(objDs.id = obj.id) continue;
			if(objDs.GetColumn(0, "RACER_NO")==sRacerNo){
				var aTemp = Split(objDs.id, "_");
				obj.SetColumn(2, "ENTRY_BODY_WGHT", aTemp[1] + "/" + aTemp[2]);
				obj.SetColumn(1, "RACE_ALLOC_CNT", 2);		
					
				aTemp = Split(obj.id, "_");	
				objDs.SetColumn(2, "ENTRY_BODY_WGHT", aTemp[1] + "/" + aTemp[2]);
				objDs.SetColumn(1, "RACE_ALLOC_CNT", 2);				
			}
		}
	}
}

/*-------------------------------------------------------------------------------------------------+
>>  경주일 변경시
+-------------------------------------------------------------------------------------------------*/
function cboSDayOrd_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
    //fcInit();
    dsOutSDayOrd.row = fnc_GetExistValue(dsOutSDayOrd, "DAY_ORD", cboSDayOrd.Value);

    fce_GetRace(cboSStndYear.Value, cboSMbr.Value, cboSRaceTms.Value, cboSDayOrd.Value, "dsOutSRace");
    var nRow = fnc_GetExistValue(dsOutSRaceTms, "TMS", cboSRaceTms.Value);
	if ( dsOutSRaceTms.GetColumn(nRow, "RACE_TMS_STAT_CD") > "050" ) {
        btnSave.Enable = false;
    } else {
        btnSave.Enable = true;
    }

    if ( btnSave.Enable ) {
        if ( dsOutSDayOrd.GetColumn(dsOutSDayOrd.row, "ORGAN_STAT_CD") == "002" ) {
            btnSave.Enable = false;
        } else {
            btnSave.Enable = true;
        }
    }
}

/*-------------------------------------------------------------------------------------------------+
>>  모터 그래프 조회
+-------------------------------------------------------------------------------------------------*/
function grdRacer_OnCellDblClick(obj,nRow,nCell,nX,nY,nPivotIndex) {
    var objName  = "grdRacer_";
	var nRacerNo = substr(obj.Id, length(objName));
    var objDs    = object("dsOutRacer_" + nRacerNo);
    
    if ( fnc_IsNull(objDs.GetColumn(1, "EQUIP_NO")) ) return;
    fcSearchRecd(objDs.GetColumn(1, "EQUIP_NO"));
}

/*-------------------------------------------------------------------------------------------------+
>>  모터 그래프 조회 버튼 클릭 時 처리
+-------------------------------------------------------------------------------------------------*/
function fcSearchRecdCheck() {
	return true;
}

function fcSearchRecd(sMotNo) {
    if ( !fcSearchRecdCheck() ) return;

	var sServiceName = "e02040020-service:searchRecdDetail";
    var sInDataSet   = "";
    var sOutDataSet  = "dsOutMotRecdDetailCp=dsOutRecdDetail ";

	fce_AddParam(Trim("STND_YEAR"), cboSStndYear.Value);
	fce_AddParam(Trim("MBR_CD   "), cboSMbr.Value     );
	fce_AddParam(Trim("TMS      "), cboSRaceTms.Value );
	fce_AddParam(Trim("MOT_NO   "), sMotNo            );
	
	fce_SendTransaction(sServiceName, sInDataSet, sOutDataSet, "fcCallBack");
}

/*-------------------------------------------------------------------------------------------------+
>>  전일성적버튼 Click시
+-------------------------------------------------------------------------------------------------*/
function btnSpecialOrgan_OnClick(obj)
{
    var sArg  = " Arg_sStndYear=" + quote(cboSStndYear.Value);
        sArg += " Arg_sMbrCd="    + quote(cboSMbr.Value     );
        sArg += " Arg_sTms="      + quote(cboSRaceTms.Value );
        sArg += " Arg_sDayOrd="   + quote(cboSDayOrd.Value  );

	var asReturn = Dialog("form::E02040045.xml", sArg, 700, 360, "");

	if ( asReturn == false ) return;
	
	fcGetSpecialRacer(asReturn[0], asReturn[1]);
}

/*-------------------------------------------------------------------------------------------------+
>>  전일성적화면의 선택된선수를 경주에 배정
+-------------------------------------------------------------------------------------------------*/
function fcGetSpecialRacer(nRaceNo, sRacerNos) {
    var asRacerNo = split(sRacerNos, "|");
    var nRacerNo  = 0;
    var sRacerNo  = "";
    var dsObj;
    var objTargetDs;
    
    if ( object( "chkRace" + toInteger(nRaceNo)).Value == "1" ) {
        fnc_message("고정된 경주 입니다. 확인 하시기 바랍니다.", "N");
        return false;
    }
    
    for ( var i = 1; i <= dsOutSRace.GetRowCount(); i++ ) {
        if ( i == toInteger(nRaceNo) ) continue;
        if ( object( "chkRace" + i).Value == "1" ) continue;

        for ( var j = 1; j <= dsOutSRace.GetColumn(i-1, "RACE_REG_NO_CNT"); j++ ) {
            dsObj = object("dsOutRacer_" + dsOutSRace.GetColumn(i-1, "RACE_NO") + "_" + j);
            sRacerNo = dsObj.GetColumn(0, "RACER_NO");
            for ( var k = 0; k < asRacerNo.length(); k++ ) {
                if ( fnc_IsNull(asRacerNo[k]) ) continue;
                if ( sRacerNo == asRacerNo[k] ) {
                    objTargetDs = object("dsOutRacer_" + nRaceNo + "_" + (k+1));
                    
                    dsOutTemp.Copy(objTargetDs);
                    objTargetDs.Copy(dsObj);
                    dsObj.Copy(dsOutTemp);
                    
                    fcGetEtcRace(dsObj);
                    fcGetEtcRace(objTargetDs);
                    asRacerNo[k] = "";
                }
            }
        }
    }
    
	for(var j = 0; j < dsOutSRace.GetRowCount(); j++){
		for(var k = 1; k <= dsOutSRace.GetColumn(j, "RACE_REG_NO_CNT"); k++){
			dsObj = object("dsOutRacer_" + dsOutSRace.GetColumn(j, "RACE_NO") + "_" + k);
			fcRacerBorderColor(dsOutSRace.GetColumn(j, "RACE_NO"), k, "user22");
		}
	}    
    
    return true;
}

/*-------------------------------------------------------------------------------------------------+
>>  화면에 사용되는 Object생성
+-------------------------------------------------------------------------------------------------*/
function CreateObject(nObjNo) {

    // 테두리 생성
    var nHeight = 50;
    var nWidth  = 54;
    var nLeft   = 4;
    var nTop    = ((nObjNo - 1) * 52) + 36;

    var sContents = "";
    sContents += ' BKColor="user2"   ';
    sContents += ' Bottom="86"       ';
    sContents += ' Height="'+ nHeight + '"';
    sContents += ' Id="spRace' + nObjNo + '"';
    sContents += ' Left="'+ nLeft + '"';
    sContents += ' LineColor="user3" ';
    sContents += ' Right="58"        ';
    sContents += ' RoundHeight="5"   ';
    sContents += ' RoundUnit="Pixel" ';
    sContents += ' RoundWidth="5"    ';
//    sContents += ' TabOrder="4"      ';
    sContents += ' Top="'+ nTop + '"';
    sContents += ' Type="RoundRect"  ';
    sContents += ' Width="'+ nWidth + '"';

    Create("Shape","spRace" + nObjNo, sContents);
    
    
    // 경주명 생성
    nHeight = 20;
    nWidth  = 48;
    nLeft   = 7;
    nTop    = ((nObjNo - 1) * 52) + 38;
    
    sContents = "";
    sContents += ' Align="Center"       ';
    sContents += ' Border="Flat"        ';
    sContents += ' Height="'+ nHeight + '"';
    sContents += ' Id="stRace' + nObjNo + '"';
    sContents += ' Left="'+ nLeft + '"';
    sContents += ' Style="snis_m_lable" ';
//    sContents += ' TabOrder="6"         ';
    sContents += ' Text="' + nObjNo + '경주"        ';
    sContents += ' Top="'+ nTop + '"';
    sContents += ' VAlign="Middle"      ';
    sContents += ' Width="'+ nWidth + '"';

    Create("Static","stRace" + nObjNo, sContents);

    // chkeckbox 생성
    nHeight = 20;
    nWidth  = 16;
    nLeft   = 7;
    nTop    = ((nObjNo - 1) * 52) + 62;

    sContents = "";
    sContents += ' Height="'+ nHeight + '"';
    sContents += ' Id="chkRace' + nObjNo + '"';
    sContents += ' Left="'+ nLeft + '"';
    sContents += ' OnClick="fcRaceHold" ';
    sContents += ' Style="snis_m_check" ';
//    sContents += ' TabOrder="5"         ';
    sContents += ' Top="'+ nTop + '"';
    sContents += ' Value="FALSE"        ';
    sContents += ' Width="'+ nWidth + '"';

    Create("Checkbox","chkRace" + nObjNo, sContents);
    
    // 경주등급 생성
    nHeight = 13;
    nWidth  = 28;
    nLeft   = 23;
    nTop    = ((nObjNo - 1) * 52) + 66;

    sContents = "";
    sContents += ' Height="'+ nHeight + '"';
    sContents += ' Id="stRaceDgre' + nObjNo + '"';
    sContents += ' Left="'+ nLeft + '"';
//    sContents += ' TabOrder="63"    ';
    sContents += ' Text=""  ';
    sContents += ' Top="'+ nTop + '"';
    sContents += ' Width="'+ nWidth + '"';

    Create("Static","stRaceDgre" + nObjNo, sContents);
    
/*
		<Checkbox Height="20" Id="chkRace1" Left="8" OnClick="fcRaceHold" Style="snis_m_check" TabOrder="5" Top="62" Value="FALSE" Width="16"></Checkbox>
		<Static Align="Center" Border="Flat" Height="20" Id="stRace" Left="7" Style="snis_m_lable" TabOrder="6" Text="01경주" Top="38" VAlign="Middle" Width="48"></Static>
		<Shape BKColor="user2" Bottom="86" Height="50" Id="spRace" Left="4" LineColor="user3" Right="58" RoundHeight="5" RoundUnit="Pixel" RoundWidth="5" TabOrder="4" Top="36" Type="RoundRect" Width="54"></Shape>
		<Static Height="13" Id="stRaceDgre1" Left="23" TabOrder="63" Text="Static19" Top="65" Width="28"></Static>
*/
}

/*-------------------------------------------------------------------------------------------------+
>>  선수추출버튼 Click시
+-------------------------------------------------------------------------------------------------*/
function btnOrgan_OnClick(obj)
{
    var nCount = global.AllWindows.count;

	for ( var i = 0; i < nCount; i++ ) {
		if ( global.AllWindows[i].id == "E02040046" ) {
            global.AllWindows[i].SetFocus();
            return;
		}
	}

    var sArg  = " Arg_sStndYear=" + quote(cboSStndYear.Value);
        sArg += " Arg_sMbrCd="    + quote(cboSMbr.Value     );
        sArg += " Arg_sTms="      + quote(cboSRaceTms.Value );
        sArg += " Arg_sDayOrd="   + quote(cboSDayOrd.Value  );
        
	var sOrganType = dsOutTempOrgan.GetColumn(cboTempOrgan.Index, "ORGAN_TYPE");
	
	var tempOrganInfo = Split(dsOutTempOrgan.GetColumn(cboTempOrgan.Index, "ORGAN_SEQ"), "-");

	sArg += " Arg_sOrganOwnerId="   + quote(tempOrganInfo[0]);
	sArg += " Arg_sOrganSeq="   + quote(tempOrganInfo[1]);

	/* 
    if(sOrganType=="TEMP" || sOrganType=="NEW" ){
    
		var tempOrganInfo = Split(dsOutTempOrgan.GetColumn(cboTempOrgan.Index, "ORGAN_SEQ"), "-");
		
		sArg += " Arg_sOrganOwnerId="   + quote(tempOrganInfo[0]);
		sArg += " Arg_sOrganSeq="   + quote(tempOrganInfo[1]);
		
	} 
	       */

	Open("form::E02040046.xml", sArg, 300, 300, "WinLevel=-1 TaskBar=true", 100, 100);
}

/*-------------------------------------------------------------------------------------------------+
>>  정렬버튼 Click시
+-------------------------------------------------------------------------------------------------*/
function btnSort_OnClick(obj)
{
    var sArg  = " Arg_sStndYear=" + quote(cboSStndYear.Value);
        sArg += " Arg_sMbrCd="    + quote(cboSMbr.Value     );
        sArg += " Arg_sTms="      + quote(cboSRaceTms.Value );
        sArg += " Arg_sDayOrd="   + quote(cboSDayOrd.Value  );
        sArg += " Arg_sMaxRegNo="   + quote(maxRegNo );
        sArg += " Arg_sRaceCnt="   + quote(dsOutSRace.GetRowCount() );
        
        

	var asReturn = Dialog("form::E02040047.xml", sArg, 700, 360, "");

	if ( asReturn == false ) return;
	fcSetSort(asReturn);
}

/*-------------------------------------------------------------------------------------------------+
>>  정렬조건에 따른 정렬
+-------------------------------------------------------------------------------------------------*/
function fcSetSort(asReturn) {
    dsOutSortTemp.Clear();
    dsOutSortTemp.AddColumn("RACER_NO");
    dsOutSortTemp.AddColumn("RACE_ALLOC_CNT");
    dsOutSortTemp.AddColumn("MOT_AVG_RANK_SCR");
    dsOutSortTemp.AddColumn("SCR");
    dsOutSortTemp.AddColumn("SPEC_CD");
    
    var nRow     = 0;
    var nRacerNo = 0;
    var sRacerNo = "";
    var objDs    ;

    var nStrCol = toInteger(asReturn[0]);
    var nEndCol = toInteger(asReturn[1]);
    var nStrRow = toInteger(asReturn[2]);
    var nEndRow = toInteger(asReturn[3]);
			    
	var sRaceNo = "";

    for ( var i = nStrCol; i <= nEndCol; i++ ) {  // 열
        for ( var j = nStrRow; j <= nEndRow; j++ ) { // 행
            if ( object("chkRace" + j).Value == 1 ) continue;
            if( toInteger(dsOutSRace.GetColumn(j-1, "RACE_REG_NO_CNT")) < i)  continue;
            
            sRaceNo = j;
            if(j < 10) sRaceNo = "0" + j;
            
            objDs = object("dsOutRacer_" + sRaceNo + "_" + i);
            
            dsOutSortTemp.AddRow();
            dsOutSortTemp.SetColumn(nRow  , "RACER_NO"        , objDs.GetColumn(0, "RACER_NO"      ));
            if ( fnc_IsNull(objDs.GetColumn(2, "ENTRY_BODY_WGHT")) ) {
                dsOutSortTemp.SetColumn(nRow  , "RACE_ALLOC_CNT"  , 1);
            } else {
                dsOutSortTemp.SetColumn(nRow  , "RACE_ALLOC_CNT"  , 2);
            }
            dsOutSortTemp.SetColumn(nRow  , "MOT_AVG_RANK_SCR", objDs.GetColumn(1, "RACE_CNT_4"     ));
            dsOutSortTemp.SetColumn(nRow  , "SCR"             , objDs.GetColumn(1, "ENTRY_BODY_WGHT"));
            dsOutSortTemp.SetColumn(nRow++, "SPEC_CD"         , objDs.GetColumn(1, "NATV_PLAC_CD"   ));
        }
    }

    dsOutSortTemp.Sort(asReturn[4], asReturn[5]);
    nRow = 0;
    for ( var i = nStrCol; i <= nEndCol; i++ ) {  // 열
        for ( var j = nStrRow; j <= nEndRow; j++ ) { // 행
            if ( object("chkRace" + j).Value == 1 ) continue;
            if( toInteger(dsOutSRace.GetColumn(j-1, "RACE_REG_NO_CNT")) < i)  continue;
            
            sRaceNo = j;
            if(j < 10) sRaceNo = "0" + j;

            sRacerNo = dsOutSortTemp.GetColumn(nRow++, "RACER_NO");
            fcChangeRacer(sRaceNo + "_" + i, sRacerNo, asReturn);
        }
    }
}

/*-------------------------------------------------------------------------------------------------+
>>  해당 선수를 찾아서 위치변경
+-------------------------------------------------------------------------------------------------*/
function fcChangeRacer(nLocRacerNo, sSearchRacerNo, asReturn) {
    var nRacerNo = 0;
    var sRacerNo = "";
    var sRaceNo = "";

    var nStrCol = toInteger(asReturn[0]);
    var nEndCol = toInteger(asReturn[1]);
    var nStrRow = toInteger(asReturn[2]);
    var nEndRow = toInteger(asReturn[3]);
    
    var tempArr = split(nLocRacerNo, "_");
    
    for ( var i = nStrCol; i <= nEndCol; i++ ) {  // 열
        for ( var j = nStrRow; j <= nEndRow; j++ ) { // 행
            if ( object("chkRace" + j).Value == 1 ) continue;
            if( toInteger(dsOutSRace.GetColumn(j-1, "RACE_REG_NO_CNT")) < i)  continue;

            //if ( nRacerNo < nLocRacerNo ) continue;
            if( toInteger(tempArr[0]) >= j  && tempArr[1] >= i) continue;

            sRaceNo = j;
            if(j < 10) sRaceNo = "0" + j;

            dsObj = object("dsOutRacer_" + sRaceNo + "_" + i);
            sRacerNo = dsObj.GetColumn(0, "RACER_NO");
            
            if ( sRacerNo == sSearchRacerNo ) {
                objTargetDs = object("dsOutRacer_" + nLocRacerNo);
                
                dsOutTemp.Copy(objTargetDs);
                objTargetDs.Copy(dsObj);
                dsObj.Copy(dsOutTemp);
                
                fcGetEtcRace(dsObj);
                fcGetEtcRace(objTargetDs);
            }
        }
    }
}

/*-------------------------------------------------------------------------------------------------+
>>  경주간격버튼 Click시
+-------------------------------------------------------------------------------------------------*/
function btnRaceGap_OnClick(obj)
{
    var sArg  = " Arg_sStndYear=" + quote(cboSStndYear.Value);
        sArg += " Arg_sMbrCd="    + quote(cboSMbr.Value     );
        sArg += " Arg_sTms="      + quote(cboSRaceTms.Value );
        sArg += " Arg_sDayOrd="   + quote(cboSDayOrd.Value  );

	var asReturn = Dialog("form::E02040048.xml", sArg, 700, 360, "");

	if ( asReturn == false ) return;
}

/*-------------------------------------------------------------------------------------------------+
>>  결과버튼 Click시
+-------------------------------------------------------------------------------------------------*/
function btnResult_OnClick(obj)
{
    var nCount = global.AllWindows.count;

	for ( var i = 0; i < nCount; i++ ) {
		if ( global.AllWindows[i].id == "E02040050" ) {
            global.AllWindows[i].SetFocus();
            return;
		}
	}

    var sArg  = " Arg_sStndYear=" + quote(cboSStndYear.Value);
        sArg += " Arg_sMbrCd="    + quote(cboSMbr.Value     );
        sArg += " Arg_sTms="      + quote(cboSRaceTms.Value );
        sArg += " Arg_sDayOrd="   + quote(cboSDayOrd.Value  );
        sArg += " Arg_isPop=Y";

	Open("form::E02040050.xml", sArg, 300, 300, "WinLevel=-1 TaskBar=true", 100, 100);

	for ( var i = 0; i < nCount; i++ ) {
		if ( global.AllWindows[i].id == "E02040055" ) {
            global.AllWindows[i].SetFocus();
            return;
		}
	}

    var sArg  = " Arg_sStndYear=" + quote(cboSStndYear.Value);
        sArg += " Arg_sMbrCd="    + quote(cboSMbr.Value     );
        sArg += " Arg_sTms="      + quote(cboSRaceTms.Value );
        sArg += " Arg_sDayOrd="   + quote(cboSDayOrd.Value  );

	Open("form::E02040055.xml", sArg, 300, 300, "WinLevel=-1 TaskBar=true", 100, 100);
}

/*-------------------------------------------------------------------------------------------------+
>>  Grid의 Border색상 변경
+-------------------------------------------------------------------------------------------------*/
function fcRacerBorderColor(nRaceNo, nRegNo, sColor) {

	var boxCnt = 3;
	if(maxRegNo >= 7 ) boxCnt = 4;

	if(nRegNo > boxCnt){
        var nCount = global.AllWindows.count;
    
        for ( var i = 0; i < nCount; i++ ) {
            if ( global.AllWindows[i].id == "E02040041" ) {
                global.AllWindows[i].fcRacerBorderColor2(nRaceNo, nRegNo, sColor);
                return;
            }
        }
        return;	
	}
    
    // 온라인 스타트 경주 색깔 표시
	for(var i = 0; i < dsOutSRace.GetRowCount(); i++){
		if ( nRaceNo == dsOutSRace.GetColumn(i, "RACE_NO")) 
			if( dsOutSRace.GetColumn(i, "ST_MTHD_CD") == "001") sColor = "blue";
	}
	
    object("grdRacer_" + nRaceNo + "_" + nRegNo).BorderColor = sColor;
}

/*-------------------------------------------------------------------------------------------------+
>>  일자별 2회 출주자에 색 적용
+-------------------------------------------------------------------------------------------------*/
function fcGetBkColor(objNm, nGridNo) {
    var sBkColor = "expr:iif(" + objNm + nGridNo + ".GetColumn(row,&apos;RACE_ALLOC_CNT&apos;)==2,iif(row==2,&apos;#FFDCFF&apos;,iif(row==1,&apos;#D2FFD2&apos;,&apos;&apos;)),&apos;&apos;)";
    return sBkColor;
}

/*-------------------------------------------------------------------------------------------------+
>>  선택된 정번에 색 적용
+-------------------------------------------------------------------------------------------------*/
function fcGetRaceColor(objNm, nGridNo, nRaceRegNo) {
    var sBkColor = "expr:iif(" + objNm + nGridNo + ".GetColumn(row,&apos;SELECT_RACE_1&apos;)==" + nRaceRegNo + "||" 
                               + objNm + nGridNo + ".GetColumn(row,&apos;SELECT_RACE_2&apos;)==" + nRaceRegNo 
                               + ",&apos;#A0A0FF&apos;,&apos;&apos;)";
    return sBkColor;
}

/*-------------------------------------------------------------------------------------------------+
>>  특별그룹에 색 적용
+-------------------------------------------------------------------------------------------------*/
function fcGetSpecRaceColor(objNm, nGridNo) {
    var sBkColor = "expr:dsOutSSpec.GetColumn(fnc_GetExistValue(dsOutSSpec,&apos;CD&apos;, " + objNm + nGridNo + ".GetColumn(row,&apos;NATV_PLAC_CD&apos;)), &apos;RMK&apos;)";
    return sBkColor;
}

/*-------------------------------------------------------------------------------------------------+
>>  전일정번에 Bold적용
+-------------------------------------------------------------------------------------------------*/
function fcGetRaceRegFont(nGridNo, nRaceRegNo, objNm) {
    if ( fnc_IsNull(objNm) ) objNm = "dsOutRacer_";
    var sFont = "";
    if ( nRaceRegNo == 3 || nRaceRegNo == 4 ) {
        sFont = "expr:iif(row==0&&IndexOf(" + objNm + nGridNo + ".GetColumn(row,&apos;RACE_ALLOC_CNT&apos;)," + nRaceRegNo + ")&gt;=0,&quot;굴림,9,Bold&quot;,iif(row==1,&quot;굴림,9,Bold&quot;,&quot;&quot;))";
    } else {
        sFont = "expr:iif(row==0&&IndexOf(" + objNm + nGridNo + ".GetColumn(row,&apos;RACE_ALLOC_CNT&apos;)," + nRaceRegNo + ")&gt;=0,&quot;굴림,9,Bold&quot;,&quot;&quot;)";
    }
    return sFont;
}

/*-------------------------------------------------------------------------------------------------+
>>  Hold되는 경주의 정번에 색표현
+-------------------------------------------------------------------------------------------------*/
function fcSetRaceCnt(obj) {
    var objName = "chkRace";
	var nRaceNo = toInteger(substr(obj.Id, length(objName)));
    var nAddCnt = -1;
    
    if ( obj.Value == "1" ) {
        nAddCnt = 1;
    }

	var nRaceCnt = 0;
	var sRaceCnt = "0/0";
	for ( var i = 1; i <= dsOutSRace.GetColumn(nRaceNo-1, "RACE_REG_NO_CNT"); i++ ) {
        var objDs    = object("dsOutRacer_" + dsOutSRace.GetColumn(nRaceNo-1, "RACE_NO") + "_" + i);
        var tmpRaceCnt = objDs.GetColumn(0, "RACE_CNT_" + i);
        
        var strRaceCnt = objDs.GetColumn(0, "RACE_CNT_" + i).split(":");
		var vArr = strRaceCnt.split("/");	        

		if(vArr.length() >= 2) {
			if(cboSDayOrd.Value == "1") {//1일차
				nRaceCnt = toInteger(replace(vArr[0],"[","")) + nAddCnt;
				sRaceCnt = nRaceCnt+ "/" + replace(vArr[1],"]","");
			}
			if(cboSDayOrd.Value == "2") {//2일차
				nRaceCnt = toInteger(replace(vArr[1],"]","")) + nAddCnt;
				sRaceCnt = replace(vArr[0],"[","") + "/" + nRaceCnt;
			}
			if(cboSDayOrd.Value == "3") {//3일차는 2일차로 통합
				nRaceCnt = toInteger(replace(vArr[2],"]","")) + nAddCnt;
				sRaceCnt = replace(vArr[0],"[","") + "/" + nRaceCnt;
			}
		}

		objDs.SetColumn(0, "RACE_CNT_" + i, sRaceCnt);	
	
        
        if ( obj.Value == "1" ) {
            objDs.SetColumn(0, "SELECT_RACE_1", i);
        } else {
            objDs.SetColumn(0, "SELECT_RACE_1", "");
        }
        
        var sEtcRace = objDs.GetColumn(2, "ENTRY_BODY_WGHT");
        if ( fnc_IsNull(sEtcRace) ) continue;
        
        var asRace   = split(sEtcRace, "/");
        var objDs2    = object("dsOutRacer_" + asRace[0] + "_" + asRace[1]);
        
        
        objDs2.SetColumn(0, "RACE_CNT_" + i, sRaceCnt);

        if ( obj.Value == "1" ) {
            objDs2.SetColumn(0, "SELECT_RACE_1", i);
        } else {
            objDs2.SetColumn(0, "SELECT_RACE_1", "");
        }

        if ( object("chkRace" + toInteger(asRace[0])).Value == 1 ) {
            objDs.SetColumn(0, "SELECT_RACE_2", asRace[1]);
            objDs2.SetColumn(0, "SELECT_RACE_2", asRace[1]);
        } else {
            objDs.SetColumn(0, "SELECT_RACE_2", "");
            objDs2.SetColumn(0, "SELECT_RACE_2", "");
        }
    }
}

/*-------------------------------------------------------------------------------------------------+
>>  출주표 Excel로 다운로드
+-------------------------------------------------------------------------------------------------*/
function btnExcelDownload_OnClick(obj)
{
    Destroy("grdExcelExport");
    CreateGridExcel();
    dsOutExcelExport.Clear();
    fcSetDataset(dsOutExcelExport);
    
    
    var objDs;
    var nRow = 0;
    
	for(var i = 1; i <= dsOutSRace.GetRowCount(); i++){
	
		for(var j = 1; j <= toInteger(dsOutSRace.GetColumn(i-1, "RACE_REG_NO_CNT")); j++){
			
			objDs = object("dsOutRacer_" + dsOutSRace.GetColumn(i-1, "RACE_NO") + "_" + j);
			
			if(fnc_IsNull(objDs.GetColumn(0, "RACER_NO"))) continue;
			
			dsOutExcelExport.AddRow();
			
			dsOutExcelExport.SetColumn(nRow, "RACE_NO"                      , i);
			dsOutExcelExport.SetColumn(nRow, "RACE_REG_NO"                  , j);
	
			var k = 0;
			dsOutExcelExport.SetColumn(nRow, "RACER_NO"                     , objDs.GetColumn(k, "RACER_NO"               ));
			dsOutExcelExport.SetColumn(nRow, "ENTRY_BODY_WGHT"              , objDs.GetColumn(k, "ENTRY_BODY_WGHT"        ));
			dsOutExcelExport.SetColumn(nRow, "TRRAS_TMS_6_AVG_STRT_TM"      , objDs.GetColumn(k, "TRRAS_TMS_6_AVG_STRT_TM"));
			dsOutExcelExport.SetColumn(nRow, "NATV_PLAC_CD"                 , objDs.GetColumn(k, "NATV_PLAC_CD"           ));
			dsOutExcelExport.SetColumn(nRow, "NATY_UNIV"                    , objDs.GetColumn(k, "NATY_UNIV"              ));
			dsOutExcelExport.SetColumn(nRow, "RACE_CNT_1"                   , objDs.GetColumn(k, "RACE_CNT_1"             ));
			dsOutExcelExport.SetColumn(nRow, "RACE_CNT_2"                   , objDs.GetColumn(k, "RACE_CNT_2"             ));
			dsOutExcelExport.SetColumn(nRow, "RACE_CNT_3"                   , objDs.GetColumn(k, "RACE_CNT_3"             ));
			dsOutExcelExport.SetColumn(nRow, "RACE_CNT_4"                   , objDs.GetColumn(k, "RACE_CNT_4"             ));
			dsOutExcelExport.SetColumn(nRow, "RACE_CNT_5"                   , objDs.GetColumn(k, "RACE_CNT_5"             ));
			dsOutExcelExport.SetColumn(nRow, "RACE_CNT_6"                   , objDs.GetColumn(k, "RACE_CNT_6"             ));
			if(maxRegNo >= 7) dsOutExcelExport.SetColumn(nRow, "RACE_CNT_7"                   , objDs.GetColumn(k, "RACE_CNT_7"             ));
			if(maxRegNo >= 8) dsOutExcelExport.SetColumn(nRow, "RACE_CNT_8"                   , objDs.GetColumn(k, "RACE_CNT_8"             ));
			
			dsOutExcelExport.SetColumn(nRow, "PRE_RACE_REG_NO"              , objDs.GetColumn(k, "RACE_ALLOC_CNT"         ));
	
			k++;
			dsOutExcelExport.SetColumn(nRow, "NM_KOR"                       , objDs.GetColumn(k, "RACER_NO"               ));
			dsOutExcelExport.SetColumn(nRow, "SCR"                          , objDs.GetColumn(k, "ENTRY_BODY_WGHT"        ));
			dsOutExcelExport.SetColumn(nRow, "RANK"                         , objDs.GetColumn(k, "TRRAS_TMS_6_AVG_STRT_TM"));
			dsOutExcelExport.SetColumn(nRow, "SPEC_CD"                      , objDs.GetColumn(k, "NATV_PLAC_CD"           ));
			dsOutExcelExport.SetColumn(nRow, "TRRAS_TMS_6_AVG_RANK_SCR"     , objDs.GetColumn(k, "NATY_UNIV"              ));
			dsOutExcelExport.SetColumn(nRow, "TRRAS_TMS_6_HIGH_RANK_RATIO"  , objDs.GetColumn(k, "RACE_CNT_1"             ));
			dsOutExcelExport.SetColumn(nRow, "TRRAS_TMS_6_HIGH_3_RANK_RATIO", objDs.GetColumn(k, "RACE_CNT_2"             ));
			dsOutExcelExport.SetColumn(nRow, "VIEW_MOT_NO"                  , objDs.GetColumn(k, "RACE_CNT_3"             ));
			dsOutExcelExport.SetColumn(nRow, "TMRAS_AVG_RANK_SCR"           , objDs.GetColumn(k, "RACE_CNT_4"             ));
			dsOutExcelExport.SetColumn(nRow, "TMRAS_HIGH_RANK_RATIO"        , objDs.GetColumn(k, "RACE_CNT_5"             ));
			dsOutExcelExport.SetColumn(nRow, "TMRAS_AVG_ITRDT_RUN_TM"       , objDs.GetColumn(k, "RACE_CNT_6"             ));
			dsOutExcelExport.SetColumn(nRow, "MOT_NO"                       , objDs.GetColumn(k, "EQUIP_NO"               ));
			dsOutExcelExport.SetColumn(nRow, "RACE_ALLOC_CNT"               , objDs.GetColumn(k, "RACE_ALLOC_CNT"         ));
	
			k++;
			dsOutExcelExport.SetColumn(nRow, "RACER_GRD_CD"                 , objDs.GetColumn(k, "RACER_NO"               ));
			dsOutExcelExport.SetColumn(nRow, "ETC_RACE"                     , objDs.GetColumn(k, "ENTRY_BODY_WGHT"        ));
			dsOutExcelExport.SetColumn(nRow, "RACE1"                        , objDs.GetColumn(k, "TRRAS_TMS_6_AVG_STRT_TM"));
			dsOutExcelExport.SetColumn(nRow, "RACE2"                        , objDs.GetColumn(k, "NATV_PLAC_CD"           ));
			dsOutExcelExport.SetColumn(nRow, "TRRAS_AVG_SCR"                , objDs.GetColumn(k, "NATY_UNIV"              ));
			dsOutExcelExport.SetColumn(nRow, "TRRAS_HIGH_RANK_RATIO"        , objDs.GetColumn(k, "RACE_CNT_1"             ));
			dsOutExcelExport.SetColumn(nRow, "TRRAS_HIGH_3_RANK_RATIO"      , objDs.GetColumn(k, "RACE_CNT_2"             ));
			dsOutExcelExport.SetColumn(nRow, "VIEW_BOAT_NO"                 , objDs.GetColumn(k, "RACE_CNT_3"             ));
			dsOutExcelExport.SetColumn(nRow, "TBRAS_AVG_RANK_SCR"           , objDs.GetColumn(k, "RACE_CNT_4"             ));
			dsOutExcelExport.SetColumn(nRow, "TBRAS_HIGH_RANK_RATIO"        , objDs.GetColumn(k, "RACE_CNT_5"             ));
			dsOutExcelExport.SetColumn(nRow, "TBRAS_AVG_ITRDT_RUN_TM"       , objDs.GetColumn(k, "RACE_CNT_6"             ));
			dsOutExcelExport.SetColumn(nRow, "BOAT_NO"                      , objDs.GetColumn(k, "EQUIP_NO"               ));
			dsOutExcelExport.SetColumn(nRow, "NEXT_RACE_ALLOC_CNT"          , objDs.GetColumn(k, "RACE_ALLOC_CNT"         ));
			nRow++;			

		}
	}	    
	
	dsOutExcelExport.Sort("RACE_NO,RACE_REG_NO");
	fnc_OpenExcelExport("grdExcelExport");
}

/*-------------------------------------------------------------------------------------------------+
>>  출주표 Excel로 업로드
+-------------------------------------------------------------------------------------------------*/
function btnExcelUpload_OnClick(obj)
{
    sResponse = fce_GetSelectFile();

    if ( !fnc_IsNull(sResponse) ) {
        ext_ExcelImportByIndex(sResponse[0] + "\\" + sResponse[1], 0, "dsOutExcelImport");
    } else {
        return;
    }
    
    var dsTempObj;
    
	for(var j = 0; j < dsOutSRace.GetRowCount(); j++){
		for(var k = 1; k <= dsOutSRace.GetColumn(j, "RACE_REG_NO_CNT"); k++){
			dsTempObj = object("dsOutRacer_" + dsOutSRace.GetColumn(j, "RACE_NO") + "_" + k);
			if ( dsTempObj.GetRowCount() > 0 ) {
				dsTempObj.ClearData();
			}
		}
	}
	
	var Col26 = "";
	var Col27 = "";
	var Col28 = "";
	var Col29 = "";
	var Col30 = "";
	var Col31 = "";
	var Col32 = "";
	var Col33 = "";
	var Col34 = "";
	
	if(maxRegNo <= 6){
		Col28 = "Col26";
		Col29 = "Col27";
		Col30 = "Col28";
		Col31 = "Col29";
		Col32 = "Col30";
		Col33 = "Col31";
		Col34 = "Col32";
	}else if(maxRegNo == 7){
		Col27 = "Col26";
		Col28 = "Col27";
		Col29 = "Col28";
		Col30 = "Col29";
		Col31 = "Col30";
		Col32 = "Col31";	
		Col33 = "Col32";
		Col34 = "Col33";
	}else if(maxRegNo == 8){
		Col26 = "Col26";
		Col27 = "Col27";
		Col28 = "Col26";
		Col29 = "Col29";
		Col30 = "Col30";
		Col31 = "Col31";
		Col32 = "Col32";	
		Col33 = "Col33";
		Col34 = "Col34";
	}	

    for ( var i = 0; i < dsOutExcelImport.GetRowCount(); i++ ) {
        var nRaceNo    = toInteger(dsOutExcelImport.GetColumn(i, "Col01"));
        if ( nRaceNo == 0 ) continue;
        if(nRaceNo < 10) nRaceNo = "0" + nRaceNo;
        
        var nRaceRegNo = toInteger(dsOutExcelImport.GetColumn(i, "Col02"));
        var objDs = object("dsOutRacer_" + nRaceNo + "_" + nRaceRegNo);

        var nRow = 0;
        objDs.AddRow();
        objDs.SetColumn(nRow, "RACER_NO"               , dsOutExcelImport.GetColumn(i, "Col03"));   
        objDs.SetColumn(nRow, "ENTRY_BODY_WGHT"        , dsOutExcelImport.GetColumn(i, "Col17"));   
        objDs.SetColumn(nRow, "TRRAS_TMS_6_AVG_STRT_TM", dsOutExcelImport.GetColumn(i, "Col13"));   
        objDs.SetColumn(nRow, "NATV_PLAC_CD"           , dsOutExcelImport.GetColumn(i, "Col10"));   
        objDs.SetColumn(nRow, "NATY_UNIV"              , dsOutExcelImport.GetColumn(i, "Col11"));
        objDs.SetColumn(nRow, "RACE_CNT_1"             , dsOutExcelImport.GetColumn(i, "Col20"));
        objDs.SetColumn(nRow, "RACE_CNT_2"             , dsOutExcelImport.GetColumn(i, "Col21"));
        objDs.SetColumn(nRow, "RACE_CNT_3"             , dsOutExcelImport.GetColumn(i, "Col22"));
        objDs.SetColumn(nRow, "RACE_CNT_4"             , dsOutExcelImport.GetColumn(i, "Col23"));
        objDs.SetColumn(nRow, "RACE_CNT_5"             , dsOutExcelImport.GetColumn(i, "Col24"));
        objDs.SetColumn(nRow, "RACE_CNT_6"             , dsOutExcelImport.GetColumn(i, "Col25"));
        if(maxRegNo >= 7)objDs.SetColumn(nRow, "RACE_CNT_7"             , dsOutExcelImport.GetColumn(i, Col26));
        if(maxRegNo >= 8)objDs.SetColumn(nRow, "RACE_CNT_8"             , dsOutExcelImport.GetColumn(i, Col27));
        objDs.SetColumn(nRow, "EQUIP_NO"               , dsOutExcelImport.GetColumn(i, ""     ));
        objDs.SetColumn(nRow, "RACE_ALLOC_CNT"         , dsOutExcelImport.GetColumn(i, "Col13"));
        
        nRow++;
        objDs.AddRow();
        objDs.SetColumn(nRow, "RACER_NO"               , dsOutExcelImport.GetColumn(i, "Col04"));
        objDs.SetColumn(nRow, "ENTRY_BODY_WGHT"        , dsOutExcelImport.GetColumn(i, "Col07"));
        objDs.SetColumn(nRow, "TRRAS_TMS_6_AVG_STRT_TM", dsOutExcelImport.GetColumn(i, "Col06"));
        objDs.SetColumn(nRow, "NATV_PLAC_CD"           , dsOutExcelImport.GetColumn(i, "Col35"));
        objDs.SetColumn(nRow, "NATY_UNIV"              , dsOutExcelImport.GetColumn(i, "Col12"));
        objDs.SetColumn(nRow, "RACE_CNT_1"             , dsOutExcelImport.GetColumn(i, "Col14"));
        objDs.SetColumn(nRow, "RACE_CNT_2"             , dsOutExcelImport.GetColumn(i, ""     ));
        objDs.SetColumn(nRow, "RACE_CNT_3"             , substr(dsOutExcelImport.GetColumn(i, Col28), 5));
        objDs.SetColumn(nRow, "RACE_CNT_4"             , dsOutExcelImport.GetColumn(i, Col29));	
        objDs.SetColumn(nRow, "RACE_CNT_5"             , dsOutExcelImport.GetColumn(i, Col30));
        objDs.SetColumn(nRow, "RACE_CNT_6"             , dsOutExcelImport.GetColumn(i, Col31));	
        objDs.SetColumn(nRow, "EQUIP_NO"               , dsOutExcelImport.GetColumn(i, Col28));	// 26   27    28
        objDs.SetColumn(nRow, "RACE_ALLOC_CNT"         , dsOutExcelImport.GetColumn(i, Col28));
        
        nRow++;
        objDs.AddRow();
        objDs.SetColumn(nRow, "RACER_NO"               , dsOutExcelImport.GetColumn(i, "Col05"));
        objDs.SetColumn(nRow, "ENTRY_BODY_WGHT"        , dsOutExcelImport.GetColumn(i, "Col09"));
        objDs.SetColumn(nRow, "TRRAS_TMS_6_AVG_STRT_TM", dsOutExcelImport.GetColumn(i, "Col18"));
        objDs.SetColumn(nRow, "NATV_PLAC_CD"           , dsOutExcelImport.GetColumn(i, "Col19"));
        objDs.SetColumn(nRow, "NATY_UNIV"              , dsOutExcelImport.GetColumn(i, "Col08"));
        objDs.SetColumn(nRow, "RACE_CNT_1"             , dsOutExcelImport.GetColumn(i, "Col15"));
        objDs.SetColumn(nRow, "RACE_CNT_2"             , dsOutExcelImport.GetColumn(i, "Col16"));
        objDs.SetColumn(nRow, "RACE_CNT_3"             , substr(dsOutExcelImport.GetColumn(i, Col32), 5));
        objDs.SetColumn(nRow, "RACE_CNT_4"             , dsOutExcelImport.GetColumn(i, Col33));
        objDs.SetColumn(nRow, "RACE_CNT_5"             , dsOutExcelImport.GetColumn(i, Col34));
        objDs.SetColumn(nRow, "RACE_CNT_6"             , dsOutExcelImport.GetColumn(i, ""));
        objDs.SetColumn(nRow, "EQUIP_NO"               , dsOutExcelImport.GetColumn(i, Col32));
        objDs.SetColumn(nRow, "RACE_ALLOC_CNT"         , dsOutExcelImport.GetColumn(i, ""));
    }
}

/*-------------------------------------------------------------------------------------------------+
>>  Grid생성
+-------------------------------------------------------------------------------------------------*/
function CreateGridExcel() {
    
    var sContents = "";
    sContents += '      <contents>';
    sContents += fcGetColumnExcel() + fcGetHeadExcel() + fcGetBodyExcel();
    sContents += '      </contents>';

	sGridType = 'AutoFit="false"           '
	          + 'AutoEnter="TRUE"          '
	          + 'AutoFitEndLine="Hide"     '
	          + 'BindDataset="dsOutExcelExport" '
	          + 'BKColor="user15"          '
	          + 'BkColor2="user16"         '
	          + 'BkSelColor="user17"       '
	          + 'BoldHead="true"           '
	          + 'Border="Flat"             '
	          + 'BorderColor="user22"      '
	          + 'Bottom="86"               '
	          + 'DragMode="TRUE"           '
	          + 'DropMode="TRUE"           '
	          + 'Enable="true"             '
	          + 'Editable="TRUE"           '
	          + 'EndLineColor="default"    '
	          + 'FillArea="TRUE"           '
	          + 'HeadBorder="Flat"         '
	          + 'HeadHeight="20"           '
	          + 'Height="100"              '
	          + 'Id="grdExcelExport"       '
	          + 'InputPanel="FALSE"        '
	          + 'Left="100"                '
	          + 'LineColor="user18"        '
	          + 'MinWidth="100"            '
	          + 'Right="460"               '
	          + 'RowHeight="18"            '
	          + 'SelColor="user19"         '
		      + 'Style="snis_grid"         '
		      + 'TabStop="true"            '
		      + 'Top="100"                 '
		      + 'UseDBuff="true"           '
		      + 'UsePopupMenu="true"       '
		      + 'UseSelColor="False"       '
		      + 'Visible="false"           '
		      + 'VLineColor="default"      '
		      + 'WheelScrollRow="1"        '
		      + 'Width="100"               ';

	create("Grid","grdExcelExport", sGridType);
	object("grdExcelExport").contents = sContents;
}

/*-------------------------------------------------------------------------------------------------+
>>  Grid Column 생성
+-------------------------------------------------------------------------------------------------*/
function fcGetColumnExcel() {
    
    var colCnt = 35;
    
    if(maxRegNo == 7) colCnt = 36;
    if(maxRegNo == 8) colCnt = 37;
    
    var sColumn = "";
    sColumn += '					<columns>';
   
    for ( var i = 0; i < colCnt; i++ ) {
        sColumn += '			            <col width="70"/>';
    }
    sColumn += '					</columns>';
    return sColumn;
}

/*-------------------------------------------------------------------------------------------------+
>>  Grid Head 생성
+-------------------------------------------------------------------------------------------------*/
function fcGetHeadExcel() {
	
	var idx = 0;

    var sHead = "";
    sHead   = '					<head>'
	        + '					    <cell bkcolor="user20" col="' + idx++ + '"  color="user21" display="text" font="굴림,9" text="경주번호"/>        '
			+ '			            <cell bkcolor="user20" col="' + idx++ + '"  color="user21" display="text" font="굴림,9" text="정번"/>            '
			+ '			            <cell bkcolor="user20" col="' + idx++ + '"  color="user21" display="text" font="굴림,9" text="등록번호"/>        '
			+ '			            <cell bkcolor="user20" col="' + idx++ + '"  color="user21" display="text" font="굴림,9" text="선수명"/>          '
			+ '			            <cell bkcolor="user20" col="' + idx++ + '"  color="user21" display="text" font="굴림,9" text="등급"/>            '
			+ '			            <cell bkcolor="user20" col="' + idx++ + '"  color="user21" display="text" font="굴림,9" text="순위"/>            '
			+ '			            <cell bkcolor="user20" col="' + idx++ + '"  color="user21" display="text" font="굴림,9" text="종합평가점"/>      '
			+ '			            <cell bkcolor="user20" col="' + idx++ + '"  color="user21" display="text" font="굴림,9" text="평균득점"/>        '
			+ '			            <cell bkcolor="user20" col="' + idx++ + '"  color="user21" display="text" font="굴림,9" text="다른경주"/>        '
			+ '			            <cell bkcolor="user20" col="' + idx++ + '"  color="user21" display="text" font="굴림,9" text="지역"/>            '
			+ '			            <cell bkcolor="user20" col="' + idx++ + '" color="user21" display="text" font="굴림,9" text="대학명"/>          '
			+ '			            <cell bkcolor="user20" col="' + idx++ + '" color="user21" display="text" font="굴림,9" text="평균착순점"/>      '
			+ '			            <cell bkcolor="user20" col="' + idx++ + '" color="user21" display="text" font="굴림,9" text="6회차ST타임"/>     '
			+ '			            <cell bkcolor="user20" col="' + idx++ + '" color="user21" display="text" font="굴림,9" text="6회차연대율"/>     '
			+ '			            <cell bkcolor="user20" col="' + idx++ + '" color="user21" display="text" font="굴림,9" text="연간연대율"/>      '
			+ '			            <cell bkcolor="user20" col="' + idx++ + '" color="user21" display="text" font="굴림,9" text="연간삼연대율"/>    '
			+ '			            <cell bkcolor="user20" col="' + idx++ + '" color="user21" display="text" font="굴림,9" text="전회차체중"/>      '
			+ '			            <cell bkcolor="user20" col="' + idx++ + '" color="user21" display="text" font="굴림,9" text="전일성적1"/>       '
			+ '			            <cell bkcolor="user20" col="' + idx++ + '" color="user21" display="text" font="굴림,9" text="전일성적2"/>       '
			+ '			            <cell bkcolor="user20" col="' + idx++ + '" color="user21" display="text" font="굴림,9" text="1번정출전횟수"/>   '
			+ '			            <cell bkcolor="user20" col="' + idx++ + '" color="user21" display="text" font="굴림,9" text="2번정출전횟수"/>   '
			+ '			            <cell bkcolor="user20" col="' + idx++ + '" color="user21" display="text" font="굴림,9" text="3번정출전횟수"/>   '
			+ '			            <cell bkcolor="user20" col="' + idx++ + '" color="user21" display="text" font="굴림,9" text="4번정출전횟수"/>   '
			+ '			            <cell bkcolor="user20" col="' + idx++ + '" color="user21" display="text" font="굴림,9" text="5번정출전횟수"/>   '
			+ '			            <cell bkcolor="user20" col="' + idx++ + '" color="user21" display="text" font="굴림,9" text="6번정출전횟수"/>   ';
	if(maxRegNo >= 7) sHead  += '			            <cell bkcolor="user20" col="' + idx++ + '" color="user21" display="text" font="굴림,9" text="7번정출전횟수"/>   ';
	if(maxRegNo >= 8) sHead  += '			            <cell bkcolor="user20" col="' + idx++ + '" color="user21" display="text" font="굴림,9" text="8번정출전횟수"/>   ';			
	sHead  += '			            <cell bkcolor="user20" col="' + idx++ + '" color="user21" display="text" font="굴림,9" text="모터번호"/>        '
			+ '			            <cell bkcolor="user20" col="' + idx++ + '" color="user21" display="text" font="굴림,9" text="모터착순점"/>      '
			+ '			            <cell bkcolor="user20" col="' + idx++ + '" color="user21" display="text" font="굴림,9" text="모터연대율"/>      '
			+ '			            <cell bkcolor="user20" col="' + idx++ + '" color="user21" display="text" font="굴림,9" text="모터소개항주타임"/>'
			+ '			            <cell bkcolor="user20" col="' + idx++ + '" color="user21" display="text" font="굴림,9" text="보트번호"/>        '
			+ '			            <cell bkcolor="user20" col="' + idx++ + '" color="user21" display="text" font="굴림,9" text="보트착순점"/>      '
			+ '			            <cell bkcolor="user20" col="' + idx++ + '" color="user21" display="text" font="굴림,9" text="보트연대율"/>      '
			+ '			            <cell bkcolor="user20" col="' + idx++ + '" color="user21" display="text" font="굴림,9" text="출전"/>            '
			+ '			            <cell bkcolor="user20" col="' + idx++ + '" color="user21" display="text" font="굴림,9" text="특이사항"/>        '
			+ '			            <cell bkcolor="user20" col="' + idx++ + '" color="user21" display="text" font="굴림,9" text="특선그룹"/>        ';
    sHead  += '				      </head>';
    return sHead;
}

/*-------------------------------------------------------------------------------------------------+
>>  Grid Body 생성
+-------------------------------------------------------------------------------------------------*/
function fcGetBodyExcel() {
    
    var idx = 0;
    
    var sBody = "";

    sBody   = '         <body>'
			+ '			  <cell col="' + idx++ + '"  colid="RACE_NO"                       align="center"  display="text"/>'
			+ '			  <cell col="' + idx++ + '"  colid="RACE_REG_NO"                   align="center"  display="text"/>'
			+ '			  <cell col="' + idx++ + '"  colid="RACER_NO"                      align="center"  display="text"/>'
			+ '			  <cell col="' + idx++ + '"  colid="NM_KOR"                        align="center"  display="text"/>'
			+ '			  <cell col="' + idx++ + '"  colid="RACER_GRD_CD"                  align="center"  display="text"/>'
			+ '			  <cell col="' + idx++ + '"  colid="RANK"                          align="center"  display="text"/>'
			+ '			  <cell col="' + idx++ + '"  colid="SCR"                           align="center"  display="text"/>'
			+ '			  <cell col="' + idx++ + '"  colid="TRRAS_AVG_SCR"                 align="center"  display="text"/>'
			+ '			  <cell col="' + idx++ + '"  colid="ETC_RACE"                      align="center"  display="text"/>'
			+ '			  <cell col="' + idx++ + '"  colid="NATV_PLAC_CD"                  align="center"  display="text"/>'
			+ '			  <cell col="' + idx++ + '" colid="NATY_UNIV"                     align="left"    display="text"/>'
			+ '			  <cell col="' + idx++ + '" colid="TRRAS_TMS_6_AVG_RANK_SCR"      align="center"  display="text"/>'
			+ '			  <cell col="' + idx++ + '" colid="TRRAS_TMS_6_AVG_STRT_TM"       align="center"  display="text"/>'
			+ '			  <cell col="' + idx++ + '" colid="TRRAS_TMS_6_HIGH_RANK_RATIO"   align="center"  display="text"/>'
			+ '			  <cell col="' + idx++ + '" colid="TRRAS_HIGH_RANK_RATIO"         align="center"  display="text"/>'
			+ '			  <cell col="' + idx++ + '" colid="TRRAS_HIGH_3_RANK_RATIO"       align="center"  display="text"/>'
			+ '			  <cell col="' + idx++ + '" colid="ENTRY_BODY_WGHT"               align="center"  display="text"/>'
			+ '			  <cell col="' + idx++ + '" colid="RACE1"                         align="center"  display="text"/>'
			+ '			  <cell col="' + idx++ + '" colid="RACE2"                         align="center"  display="text"/>'
			+ '			  <cell col="' + idx++ + '" colid="RACE_CNT_1"                    align="center"  display="text"/>'
			+ '			  <cell col="' + idx++ + '" colid="RACE_CNT_2"                    align="center"  display="text"/>'
			+ '			  <cell col="' + idx++ + '" colid="RACE_CNT_3"                    align="center"  display="text"/>'
			+ '			  <cell col="' + idx++ + '" colid="RACE_CNT_4"                    align="center"  display="text"/>'
			+ '			  <cell col="' + idx++ + '" colid="RACE_CNT_5"                    align="center"  display="text"/>'
			+ '			  <cell col="' + idx++ + '" colid="RACE_CNT_6"                    align="center"  display="text"/>';
	if(maxRegNo >= 7) sBody  += '			  <cell col="' + idx++ + '" colid="RACE_CNT_7"                    align="center"  display="text"/>';
	if(maxRegNo >= 8) sBody  += '			  <cell col="' + idx++ + '" colid="RACE_CNT_8"                    align="center"  display="text"/>';
	sBody  += '			  <cell col="' + idx++ + '" colid="MOT_NO"                        align="center"  display="text"/>'
			+ '			  <cell col="' + idx++ + '" colid="TMRAS_AVG_RANK_SCR"            align="center"  display="text"/>'
			+ '			  <cell col="' + idx++ + '" colid="TMRAS_HIGH_RANK_RATIO"         align="center"  display="text"/>'
			+ '			  <cell col="' + idx++ + '" colid="TMRAS_AVG_ITRDT_RUN_TM"        align="center"  display="text"/>'
			+ '			  <cell col="' + idx++ + '" colid="BOAT_NO"                       align="center"  display="text"/>'
			+ '			  <cell col="' + idx++ + '" colid="TBRAS_AVG_RANK_SCR"            align="center"  display="text"/>'
			+ '			  <cell col="' + idx++ + '" colid="TBRAS_HIGH_RANK_RATIO"         align="center"  display="text"/>'
			+ '			  <cell col="' + idx++ + '" colid="ABSE_CD"                       align="center"  display="text"/>'
			+ '			  <cell col="' + idx++ + '" colid="RMK"                           align="center"  display="text"/>'
			+ '			  <cell col="' + idx++ + '" colid="SPEC_CD"                       align="center"  display="text"/>';
    sBody  += '			</body>';
    return sBody;
}

/*-------------------------------------------------------------------------------------------------+
>>  Excel Dataset 생성
+-------------------------------------------------------------------------------------------------*/
function fcSetDataset(ds) {
    var objDs = ds;

    objDs.AddColumn("RACE_NO"                    , "String");
    objDs.AddColumn("RACE_REG_NO"                , "String");
    objDs.AddColumn("RACER_NO"                   , "String");
    objDs.AddColumn("NM_KOR"                     , "String");
    objDs.AddColumn("RACER_GRD_CD"               , "String");
    objDs.AddColumn("RANK"                       , "DECIMAL");
    objDs.AddColumn("SCR"                        , "DECIMAL");
    objDs.AddColumn("TRRAS_AVG_SCR"              , "DECIMAL");
    objDs.AddColumn("ETC_RACE"                   , "String");
    objDs.AddColumn("NATV_PLAC_CD"               , "String");
    objDs.AddColumn("NATY_UNIV"                  , "String");
    objDs.AddColumn("TRRAS_TMS_6_AVG_RANK_SCR"   , "DECIMAL");
    objDs.AddColumn("TRRAS_TMS_6_AVG_STRT_TM"    , "DECIMAL");
    objDs.AddColumn("TRRAS_TMS_6_HIGH_RANK_RATIO", "DECIMAL");
    objDs.AddColumn("TRRAS_HIGH_RANK_RATIO"      , "DECIMAL");
    objDs.AddColumn("TRRAS_HIGH_3_RANK_RATIO"    , "DECIMAL");
    objDs.AddColumn("ENTRY_BODY_WGHT"            , "DECIMAL");
    objDs.AddColumn("RACE1"                      , "String");
    objDs.AddColumn("RACE2"                      , "String");
    objDs.AddColumn("RACE_CNT_1"                 , "String");
    objDs.AddColumn("RACE_CNT_2"                 , "String");
    objDs.AddColumn("RACE_CNT_3"                 , "String");
    objDs.AddColumn("RACE_CNT_4"                 , "String");
    objDs.AddColumn("RACE_CNT_5"                 , "String");
    objDs.AddColumn("RACE_CNT_6"                 , "String");
    if(maxRegNo >= 7) objDs.AddColumn("RACE_CNT_7"                 , "String");
    if(maxRegNo >= 8) objDs.AddColumn("RACE_CNT_8"                 , "String");
    objDs.AddColumn("MOT_NO"                     , "String");
    objDs.AddColumn("VIEW_MOT_NO"                , "String");
    objDs.AddColumn("TMRAS_AVG_RANK_SCR"         , "DECIMAL");
    objDs.AddColumn("TMRAS_HIGH_RANK_RATIO"      , "DECIMAL");
    objDs.AddColumn("TMRAS_AVG_ITRDT_RUN_TM"     , "DECIMAL");
    objDs.AddColumn("BOAT_NO"                    , "String");
    objDs.AddColumn("VIEW_BOAT_NO"               , "String");
    objDs.AddColumn("TBRAS_AVG_RANK_SCR"         , "DECIMAL");
    objDs.AddColumn("TBRAS_HIGH_RANK_RATIO"      , "DECIMAL");
    objDs.AddColumn("ABSE_CD"                    , "String");
    objDs.AddColumn("RMK"                        , "String");
    objDs.AddColumn("SPEC_CD"                    , "String");
}

function chkAll_OnClick(obj)
{
    var objName = "chkRace";

	if ( chkAll.Value == "1" ) {			
		for ( var i = 1; i <= dsOutSRace.GetRowCount(); i++ ) {
			object(objName + i).Value = "True";
			fcRaceHold(object(objName + i), object(objName + i).Value);
		}
	} else {
		for ( var i = 1; i <= dsOutSRace.GetRowCount(); i++ ) {
			object(objName + i).Value = "False";
			fcRaceHold(object(objName + i), object(objName + i).Value);
		}
	}
}


/*-------------------------------------------------------------------------------------------------+
>>  가편성 목록 조회
+-------------------------------------------------------------------------------------------------*/
function fcSearchTempOrganList(obj) {
	
    var nTmsRow        = fnc_GetExistValue(dsOutSRaceTms, "TMS", cboSRaceTms.Value);  // 
    var sState         = dsOutSRaceTms.GetColumn(nTmsRow, "RACE_TMS_STAT_CD");           // 해당 회차 상태
	
	if ( sState < "020" ) {
		fnc_Message(SNIS_BOA_B008, "N", "장비배정작업");
		return false;
    }

	var sServiceName = "e02040040-service:searchTempOrgan";
    var sInDataSet   = "";
    var sOutDataSet  = "dsOutTempOrgan=dsOutTempOrgan ";
    
	fce_AddParam(Trim("STND_YEAR"), cboSStndYear.Value);
	fce_AddParam(Trim("MBR_CD   "), cboSMbr.Value     );
	fce_AddParam(Trim("TMS      "), cboSRaceTms.Value );
	fce_AddParam(Trim("DAY_ORD  "), cboSDayOrd.Value  );
	fce_AddParam("USER_ID", gdsUser.getColumn(0, "USER_ID"));

	fce_SendTransaction(sServiceName, sInDataSet, sOutDataSet, "fcCallBack");
}

/*-------------------------------------------------------------------------------------------------+
>>  가편성목록 콤보값 변경시
+-------------------------------------------------------------------------------------------------*/
function cboTempOrgan_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
	fcInit();
    var nRow = fnc_GetExistValue(dsOutSRaceTms, "TMS", cboSRaceTms.Value);
	if ( dsOutSRaceTms.GetColumn(nRow, "RACE_TMS_STAT_CD") > "050" ) {
        btnSave.Enable = false;
    } 
}


//  출주표 더블클릭시 팝업창 표시
function grdRacerMotorBoatDblClick(obj,nRow,nCell,nX,nY,nPivotIndex) {

    var objName  = "grdRacer_";
	var nRacerNo = substr(obj.Id, length(objName));
    var objDs    = object("dsOutRacer_" + nRacerNo);
   	var nRaceNo = substr(obj.Id,9,2); //grdRacer_02_2
	var sStMthdCd = dsOutSRace.getColumn(dsOutSRace.FindRow("RACE_NO",nRaceNo),"ST_MTHD_CD"); //


	var sStndYear = cboSStndYear.Text;
	var sMbrcd 	  = cboSMbr.Value;
//	var sTms 	  = cboSRaceTms.Text;
//	var sDayOrd   = cboSDayOrd.Text;
	var nRacerNo  = objDs.GetColumn(0, "RACER_NO");
	var nRacerNm  = objDs.GetColumn(1, "RACER_NO");
	var nMotorNo  = objDs.GetColumn(1, "EQUIP_NO");
	var nBoatNo   = objDs.GetColumn(2, "EQUIP_NO");

	var sArg  = "Arg_sStndYear=" + quote(sStndYear);
		sArg += " Arg_sMbrcd=" + quote(sMbrcd); 
//		sArg += " Arg_sTms=" + quote(sTms);
//		sArg += " Arg_sDayOrd=" + quote(sDayOrd);
		sArg += " Arg_sRacerNo=" + quote(nRacerNo);
		sArg += " Arg_sRacerNm=" + quote(nRacerNm);
		sArg += " Arg_sMotorNo=" + quote(nMotorNo);
		sArg += " Arg_sBoatNo=" + quote(nBoatNo);
		sArg += " Arg_sStMthdCd=" + quote(sStMthdCd);
	
    Dialog("form::E02040040_1.xml", sArg, 1024, 752 , "");	
}

function createOgranDataset(ds1, ds2) {
	dsSorObj = ds1;
	dsObj = ds2;
	for ( var i = 0; i < dsSorObj.GetRowCount(); i++ ) {

		emptyRacerNo = 0;
		for(var k = 1; k <= maxRegNo; k++){
		
			for(var j = 0; j < dsOutSRace.GetRowCount(); j++){
			
				if( toInteger(dsOutSRace.GetColumn(j, "RACE_REG_NO_CNT")) >= k){
			
					dsObj = object("dsOutRacer_" + dsOutSRace.GetColumn(j, "RACE_NO") + "_" + k);
					if ( dsObj.GetRowCount() == 0 ) {
						emptyRacerNo = k;
						break;
					}					
				}
				
			}
			if(emptyRacerNo>0){
				break;
			}
		}
		
		nRow = 0;
		dsObj.AddRow();
		dsObj.SetColumn(nRow, "RACER_NO"               , dsSorObj.GetColumn(i, "RACER_NO"               )); // 선수번호
		dsObj.SetColumn(nRow, "ENTRY_BODY_WGHT"        , dsSorObj.GetColumn(i, "ENTRY_BODY_WGHT"        )); // 체중
		dsObj.SetColumn(nRow, "TRRAS_TMS_6_AVG_STRT_TM", dsSorObj.GetColumn(i, "TRRAS_TMS_6_AVG_STRT_TM")); // 6최차ST타임
		dsObj.SetColumn(nRow, "NATV_PLAC_CD"           , dsSorObj.GetColumn(i, "NATV_PLAC_CD"           )); // 연고지
		dsObj.SetColumn(nRow, "NATY_UNIV"              , dsSorObj.GetColumn(i, "NATY_UNIV"              )); // 대학명
		dsObj.SetColumn(nRow, "RACE_CNT_1"             , dsSorObj.GetColumn(i, "RACE_CNT_1"             )); // 1코스출주횟수
		dsObj.SetColumn(nRow, "RACE_CNT_2"             , dsSorObj.GetColumn(i, "RACE_CNT_2"             )); // 2코스출주횟수
		dsObj.SetColumn(nRow, "RACE_CNT_3"             , dsSorObj.GetColumn(i, "RACE_CNT_3"             )); // 3코스출주횟수
		dsObj.SetColumn(nRow, "RACE_CNT_4"             , dsSorObj.GetColumn(i, "RACE_CNT_4"             )); // 4코스출주횟수
		dsObj.SetColumn(nRow, "RACE_CNT_5"             , dsSorObj.GetColumn(i, "RACE_CNT_5"             )); // 5코스출주횟수
		dsObj.SetColumn(nRow, "RACE_CNT_6"             , dsSorObj.GetColumn(i, "RACE_CNT_6"             )); // 6코스출주횟수
		dsObj.SetColumn(nRow, "RACE_CNT_7"             , dsSorObj.GetColumn(i, "RACE_CNT_7"             )); // 7코스출주횟수
		dsObj.SetColumn(nRow, "RACE_CNT_8"             , dsSorObj.GetColumn(i, "RACE_CNT_8"             )); // 8코스출주횟수
		dsObj.SetColumn(nRow, "RACE_ALLOC_CNT"         , dsSorObj.GetColumn(i, "PRE_RACE_REG_NO"        )); // 전일출주정번

		dsObj.AddRow();
		nRow++;
		dsObj.SetColumn(nRow, "RACER_NO"               , dsSorObj.GetColumn(i, "NM_KOR"                       )); // 선수명
		dsObj.SetColumn(nRow, "ENTRY_BODY_WGHT"        , dsSorObj.GetColumn(i, "SCR"                          )); // 평가점
		dsObj.SetColumn(nRow, "TRRAS_TMS_6_AVG_STRT_TM", dsSorObj.GetColumn(i, "RANK"                         )); // 순위
		dsObj.SetColumn(nRow, "NATV_PLAC_CD"           , dsSorObj.GetColumn(i, "SPEC_CD"                      )); // 
		dsObj.SetColumn(nRow, "NATY_UNIV"              , dsSorObj.GetColumn(i, "TRRAS_TMS_6_AVG_RANK_SCR"     )); // 6회차평균착순점
		dsObj.SetColumn(nRow, "RACE_CNT_1"             , dsSorObj.GetColumn(i, "TRRAS_TMS_6_HIGH_RANK_RATIO"  )); // 6회차연대율
		dsObj.SetColumn(nRow, "RACE_CNT_2"             , dsSorObj.GetColumn(i, "TRRAS_TMS_6_HIGH_3_RANK_RATIO")); // 6회차3연대율
		dsObj.SetColumn(nRow, "RACE_CNT_3"             , dsSorObj.GetColumn(i, "VIEW_MOT_NO"                  )); // 모터번호
		dsObj.SetColumn(nRow, "RACE_CNT_4"             , dsSorObj.GetColumn(i, "TMRAS_AVG_RANK_SCR"           )); // 모터착순점
		dsObj.SetColumn(nRow, "RACE_CNT_5"             , dsSorObj.GetColumn(i, "TMRAS_HIGH_RANK_RATIO"        )); // 모터연대율
		dsObj.SetColumn(nRow, "RACE_CNT_6"             , dsSorObj.GetColumn(i, "TMRAS_AVG_ITRDT_RUN_TM"       )); // 모터평균소개항주
		dsObj.SetColumn(nRow, "RACE_CNT_7"             , ""); // 1코스출주횟수
		dsObj.SetColumn(nRow, "RACE_CNT_8"             , ""); // 1코스출주횟수
		dsObj.SetColumn(nRow, "EQUIP_NO"               , dsSorObj.GetColumn(i, "MOT_NO"                       )); // 모터번호
		dsObj.SetColumn(nRow, "RACE_ALLOC_CNT"         , dsSorObj.GetColumn(i, "RACE_ALLOC_CNT"               )); // 출주횟수

		dsObj.AddRow();
		nRow++;
		dsObj.SetColumn(nRow, "RACER_NO"               , dsSorObj.GetColumn(i, "RACER_GRD_CD"                 ));
		dsObj.SetColumn(nRow, "ENTRY_BODY_WGHT"        , dsSorObj.GetColumn(i, ""                             )); // 2회 출주시 경주/정번
		dsObj.SetColumn(nRow, "TRRAS_TMS_6_AVG_STRT_TM", dsSorObj.GetColumn(i, "RACE1"                        )); // 전일성적1
		dsObj.SetColumn(nRow, "NATV_PLAC_CD"           , dsSorObj.GetColumn(i, "RACE2"                        )); // 전일성적2
		dsObj.SetColumn(nRow, "NATY_UNIV"              , dsSorObj.GetColumn(i, "TRRAS_AVG_SCR"                )); // 연간착순점
		dsObj.SetColumn(nRow, "RACE_CNT_1"             , dsSorObj.GetColumn(i, "TRRAS_HIGH_RANK_RATIO"        )); // 연간연대율
		dsObj.SetColumn(nRow, "RACE_CNT_2"             , dsSorObj.GetColumn(i, "TRRAS_HIGH_3_RANK_RATIO"      )); // 연간3연대율
		dsObj.SetColumn(nRow, "RACE_CNT_3"             , dsSorObj.GetColumn(i, "VIEW_BOAT_NO"                 )); // 보트번호
		dsObj.SetColumn(nRow, "RACE_CNT_4"             , dsSorObj.GetColumn(i, "TBRAS_AVG_RANK_SCR"           )); // 보트착순점
		dsObj.SetColumn(nRow, "RACE_CNT_5"             , dsSorObj.GetColumn(i, "TBRAS_HIGH_RANK_RATIO"        )); // 보트연대율
		dsObj.SetColumn(nRow, "RACE_CNT_6"             , dsSorObj.GetColumn(i, "TBRAS_AVG_ITRDT_RUN_TM"       )); // 보트평균소개항주
		dsObj.SetColumn(nRow, "RACE_CNT_7"             , ""); // 1코스출주횟수
		dsObj.SetColumn(nRow, "RACE_CNT_8"             , ""); // 1코스출주횟수
		dsObj.SetColumn(nRow, "EQUIP_NO"               , dsSorObj.GetColumn(i, "BOAT_NO"                      )); // 보트번호
		dsObj.SetColumn(nRow, "RACE_ALLOC_CNT"         , dsSorObj.GetColumn(i, "NEXT_RACE_ALLOC_CNT"          )); // 출주횟수

	}
}]]></Script>
</Window>