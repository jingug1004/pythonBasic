<?xml version="1.0" encoding='EUC-KR'?>
<queryMap desc="tbed_race_voil_analysis(사고상황분석)">
    <query id="tbed_race_voil_analysis_s01" desc="사고상황분석 내용조회" fetchSize="10">
        <![CDATA[
            SELECT 
				STND_YEAR, MBR_CD, TMS, DAY_ORD, RACE_NO, 
				ANALYSIS_CONT_001, ANALYSIS_CONT_002, ANALYSIS_CONT_003 
			FROM TBED_RACE_VOIL_ANALYSIS                        
			WHERE 1=1
			AND STND_YEAR = ?
			AND MBR_CD = ?
			AND TMS = ? 
			AND DAY_ORD = ? 
			AND RACE_NO = ?
        ]]>
    </query> 
    
    <query id="tbed_race_voil_analysis_m01" desc="사고상황분석 내용 등록" fetchSize="10">
        <![CDATA[
			MERGE INTO TBED_RACE_VOIL_ANALYSIS TEP
				USING (
				    SELECT
				        ? AS STND_YEAR,
				        ? AS MBR_CD,
				        ? AS TMS,
				        ? AS DAY_ORD,
				        ? AS RACE_NO,
				        ? AS ANALYSIS_CONT_001,
				        ? AS ANALYSIS_CONT_002,
				        ? AS ANALYSIS_CONT_003,                    
				        ? AS USER_ID
				    FROM DUAL ) TP
				ON (
				        TEP.STND_YEAR = TP.STND_YEAR
						AND TEP.MBR_CD = TP.MBR_CD
						AND TEP.TMS = TP.TMS
						AND TEP.DAY_ORD = TP.DAY_ORD
						AND TEP.RACE_NO = TP.RACE_NO
				)
				WHEN MATCHED THEN
				UPDATE 
				SET
				  TEP.ANALYSIS_CONT_001 = TP.ANALYSIS_CONT_001,
				  TEP.ANALYSIS_CONT_002 = TP.ANALYSIS_CONT_002, 
				  TEP.ANALYSIS_CONT_003 = TP.ANALYSIS_CONT_003, 
				  TEP.UPDT_ID = TP.USER_ID,
				  TEP.UPDT_DTM = SYSDATE
				WHEN NOT MATCHED THEN
				INSERT (
				  TEP.STND_YEAR,
				  TEP.MBR_CD,
				  TEP.TMS,
				  TEP.DAY_ORD,
					TEP.RACE_NO,
					TEP.ANALYSIS_CONT_001,
					TEP.ANALYSIS_CONT_002,
					TEP.ANALYSIS_CONT_003,
				  TEP.INST_ID,
					TEP.INST_DTM
				)			    
				VALUES
				(
					TP.STND_YEAR,
					TP.MBR_CD,
					TP.TMS,
					TP.DAY_ORD,
					TP.RACE_NO,
					TP.ANALYSIS_CONT_001,
					TP.ANALYSIS_CONT_002,
					TP.ANALYSIS_CONT_003,
					TP.USER_ID,
					SYSDATE
				)
	    ]]>
    </query>    
</queryMap>