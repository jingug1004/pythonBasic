<?xml version="1.0" encoding='EUC-KR'?>
<queryMap desc="tbeb_race_day_ord(경주일차)">
    <query id="tbef_equip_lot_fc901" desc="조회" fetchSize="10">
        <![CDATA[
			SELECT
			         ROWNUM SEQ
			       , SUBSTR(EQUIP_NO, 6, 3) EQUIP_NO
			       , AVG_RANK_SCR
			       , HIGH_RANK_RATIO
			       , SUBSTR(CHG_BF_NO, 6, 3) CHG_BF_NO
			       , RSN RMK
			FROM   (
			            SELECT
			                     TEL  .EQUIP_NO
			                   , TMRAS.AVG_RANK_SCR
			                   , TMRAS.HIGH_RANK_RATIO
			                   , TAC  .CHG_BF_NO
			                   , TAC  .RSN
			            FROM     TBEF_EQUIP_LOT TEL
			                   , (
			                        SELECT *
			                        FROM   (
			                                  SELECT   RANK() OVER (PARTITION BY TMRAS.MOT_NO 
			                                                            ORDER BY TMRAS.STND_YEAR DESC
			                                                                   , TMRAS.TMS DESC 
			                                                       ) RANK
			                                         , TMRAS.*
			                                  FROM   TBEB_MOT_RECD_ACCU_SUM TMRAS
			                                  WHERE  TMRAS.MBR_CD = ?
			                                  AND    TMRAS.STND_YEAR || LPAD(TMRAS.TMS, 3, '0') <= ? || LPAD(?, 3, '0')
			                               )
			                        WHERE  RANK = 1
			                     ) TMRAS
			                   , (
			                        SELECT   DISTINCT(CHG_AF_NO) EQUIP_NO
			                               , CHG_BF_NO
			                               , RSN
			                        FROM   TBEB_ARRANGE_CHG TAC
			                        WHERE  TAC  .STND_YEAR    = ?
			                        AND    TAC  .MBR_CD       = ?
			                        AND    TAC  .TMS          = ?
			                        AND    TAC  .CHG_CLS_CD   = 'M'
			                     ) TAC
			            WHERE  TEL  .EQUIP_NO     = TMRAS.MOT_NO(+)
			            AND    TEL  .EQUIP_NO     = TAC  .EQUIP_NO (+)
			            AND    TEL  .STND_YEAR    = ?
			            AND    TEL  .MBR_CD       = ?
			            AND    TEL  .TMS          = ?
			            AND    TEL  .EQUIP_TPE_CD = 'M'
			            AND    TEL  .PREPAR_YN    = 'Y'
			            ORDER BY TEL  .EQUIP_NO
			       )
        ]]>
    </query> 
    <query id="tbef_equip_lot_fc902" desc="조회" fetchSize="10">
        <![CDATA[
			SELECT
			         ROWNUM SEQ
			       , SUBSTR(EQUIP_NO, 6, 3) EQUIP_NO
			       , AVG_RANK_SCR
			       , HIGH_RANK_RATIO
			       , SUBSTR(CHG_BF_NO, 6, 3) CHG_BF_NO
			       , RSN RMK
			FROM   (
			            SELECT
			                     TEL  .EQUIP_NO
			                   , TBRAS.AVG_RANK_SCR
			                   , TBRAS.HIGH_RANK_RATIO
			                   , TAC  .CHG_BF_NO
			                   , TAC  .RSN
			            FROM     TBEF_EQUIP_LOT TEL
			                   , (
			                        SELECT *
			                        FROM   (
			                                  SELECT   RANK() OVER (PARTITION BY TBRAS.BOAT_NO 
			                                                            ORDER BY TBRAS.STND_YEAR DESC
			                                                                   , TBRAS.TMS DESC 
			                                                       ) RANK
			                                         , TBRAS.*
			                                  FROM   TBEB_BOAT_RECD_ACCU_SUM TBRAS
			                                  WHERE  TBRAS.MBR_CD = ?
			                                  AND    TBRAS.STND_YEAR || LPAD(TBRAS.TMS, 3, '0') <= ? || LPAD(?, 3, '0')
			                               )
			                        WHERE  RANK = 1
			                     ) TBRAS
			                   , (
			                        SELECT   DISTINCT(CHG_AF_NO) EQUIP_NO
			                               , CHG_BF_NO
			                               , RSN
			                        FROM   TBEB_ARRANGE_CHG TAC
			                        WHERE  TAC  .STND_YEAR    = ?
			                        AND    TAC  .MBR_CD       = ?
			                        AND    TAC  .TMS          = ?
			                        AND    TAC  .CHG_CLS_CD   = 'B'
			                     ) TAC
			            WHERE  TEL  .EQUIP_NO     = TBRAS.BOAT_NO(+)
			            AND    TEL  .EQUIP_NO     = TAC  .EQUIP_NO (+)
			            AND    TEL  .STND_YEAR    = ?
			            AND    TEL  .MBR_CD       = ?
			            AND    TEL  .TMS          = ?
			            AND    TEL  .EQUIP_TPE_CD = 'B'
			            AND    TEL  .PREPAR_YN    = 'Y'
			            ORDER BY TEL  .EQUIP_NO
			       )
        ]]>
    </query> 
</queryMap>