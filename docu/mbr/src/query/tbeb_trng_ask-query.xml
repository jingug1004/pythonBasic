<?xml version="1.0" encoding='EUC-KR'?>
<queryMap desc="tbeb_trng_expt_racer(훈련요청)">
    <query id="tbeb_trng_ask_fb001" desc="훈련요청일련번호조회" fetchSize="10">
        <![CDATA[
			SELECT /* tbeb_trng_ask_fb001 */
			       NVL(MAX(TRNG_ASK_SEQ), TO_CHAR(SYSDATE, 'YY') || '-' || '0000') TRNG_ASK_SEQ
			FROM   TBEB_TRNG_ASK
			WHERE  TRNG_ASK_SEQ LIKE TO_CHAR(SYSDATE, 'YY') || '%'			
        ]]>
    </query> 
    
    <query id="tbeb_trng_ask_fb002" desc="훈련요청조회" fetchSize="10">
        <![CDATA[
			SELECT /* tbeb_trng_ask_fb002 */
			         '' AS CHK
			       , TRNG_ASK_SEQ
			       , TRNG_PLC_CD
			       , TRNG_ASK_STR_DT
			       , TRNG_ASK_END_DT
			       , TRNG_ASK_DD_NUM
			       , TRNG_ASK_STAT_CD
			       , RMK
			       , (
						SELECT COUNT(*) RACER_CNT
						FROM   TBEB_TRNG_ASK_RACER TTAR
						WHERE  TTAR.TRNG_ASK_SEQ = TTA.TRNG_ASK_SEQ
			         ) RACER_CNT
			       , INST_ID
			       , INST_DTM
			       , UPDT_ID
			       , UPDT_DTM
			FROM   TBEB_TRNG_ASK TTA
			WHERE  TRNG_ASK_END_DT >= NVL(?, TRNG_ASK_END_DT)
			AND    TRNG_ASK_STR_DT <= NVL(?, TRNG_ASK_STR_DT)
			AND    TRNG_ASK_STAT_CD = NVL(?, TRNG_ASK_STAT_CD)
			AND    TRNG_ASK_SEQ    IN ( 
			                            SELECT
			                                   TRNG_ASK_SEQ
			                            FROM     TBEB_TRNG_ASK_RACER TTAR
			                                   , TBEC_RACER_MASTER   TRM
			                            WHERE  TTAR.RACER_NO    = TRM.RACER_NO
			                            AND    TRM .NM_KOR   LIKE '%' || NVL(?, TRM .NM_KOR) || '%'
			                          )
			AND    TRNG_ASK_SEQ    = NVL(?, TRNG_ASK_SEQ)
        ]]>
    </query> 
    
    <query id="tbeb_trng_ask_fb003" desc="훈련요청 상태조회" fetchSize="10">
        <![CDATA[
			SELECT /* tbeb_trng_ask_fb003 */
			       TRNG_ASK_STAT_CD
			FROM   TBEB_TRNG_ASK
			WHERE  TRNG_ASK_SEQ = ?			
        ]]>
    </query> 
    
    <query id="tbeb_trng_ask_ib001" desc="훈련요청저장" fetchSize="10">
        <![CDATA[
			INSERT INTO TBEB_TRNG_ASK
			(
			         TRNG_ASK_SEQ       -- 훈련요청일련번호
			       , TRNG_PLC_CD        -- 훈련장소코드    
			       , TRNG_ASK_STR_DT    -- 훈련요청시작일  
			       , TRNG_ASK_END_DT    -- 훈련요청종료일  
			       , TRNG_ASK_DD_NUM    -- 훈련요청일수
			       , TRNG_ASK_STAT_CD   -- 훈련요청상태코드
			       , RMK                -- 비고      
			       , INST_ID            -- 작성자ID        
			       , INST_DTM           -- 작성일시        
			       , UPDT_ID            -- 수정자ID        
			       , UPDT_DTM           -- 수정일시        
			) VALUES (
			         ?                  -- 훈련요청일련번호
			       , ?                  -- 훈련장소코드    
			       , ?                  -- 훈련요청시작일  
			       , ?                  -- 훈련요청종료일  
			       , ?                  -- 훈련요청일수
			       , ?                  -- 훈련요청상태코드
			       , ?                  -- 비고           
			       , ?                  -- 작성자ID        
			       , SYSDATE            -- 작성일시        
			       , ?                  -- 수정자ID        
			       , SYSDATE            -- 수정일시        
			)
        ]]>
    </query>
    <query id="tbeb_trng_ask_ub001" desc="훈련요청수정" fetchSize="10">
        <![CDATA[
			UPDATE /* tbeb_trng_ask_ub001 */
			       TBEB_TRNG_ASK SET
			         TRNG_PLC_CD      = ?       -- 훈련장소코드    
			       , TRNG_ASK_STR_DT  = ?       -- 훈련요청시작일  
			       , TRNG_ASK_END_DT  = ?       -- 훈련요청종료일  
			       , TRNG_ASK_DD_NUM  = ?       -- 훈련요청일수  
			       , TRNG_ASK_STAT_CD = ?       -- 훈련요청상태코드
			       , RMK              = ?       -- 비고
			       , UPDT_ID          = ?       -- 수정자ID        
			       , UPDT_DTM         = SYSDATE -- 수정일시        
			WHERE  TRNG_ASK_SEQ       = ?       -- 훈련요청일련번호
        ]]>
    </query> 
    <query id="tbeb_trng_ask_ub002" desc="훈련요청상태 수정" fetchSize="10">
        <![CDATA[
			UPDATE /* tbeb_trng_ask_ub002 */
			       TBEB_TRNG_ASK SET
			         TRNG_ASK_STAT_CD = ?       -- 훈련요청상태코드
			       , UPDT_ID          = ?       -- 수정자ID        
			       , UPDT_DTM         = SYSDATE -- 수정일시        
			WHERE  TRNG_ASK_SEQ       = ?       -- 훈련요청일련번호
        ]]>
    </query> 
    <query id="tbeb_trng_ask_db001" desc="훈련요청삭제" fetchSize="10">
        <![CDATA[
			DELETE
			FROM   TBEB_TRNG_ASK
			WHERE  TRNG_ASK_SEQ       = ?         -- 훈련요청일련번호
        ]]>
    </query> 
</queryMap>