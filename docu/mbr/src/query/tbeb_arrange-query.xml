<?xml version="1.0" encoding='EUC-KR'?>
<queryMap desc="tbeb_arrange(주선)">
    <query id="tbeb_arrange_fb001" desc="출주선수 성적 조회" fetchSize="10">
        <![CDATA[
			SELECT /* tbeb_arrange_fb001 */
			         TA   .STND_YEAR                                                        -- 기준년도    
			       , TA   .MBR_CD                                                           -- 경정장코드  
			       , TA   .TMS                                                              -- 회차        
			       , DECODE(TA   .SPEC_CD, ?, '1', '0') SPEC                                -- 특선여부
			       , DECODE(TA.ST_MTHD_CD,'001', '1', '0') ONLINE_YN                        -- 온라인스타트여부
			       , TA   .RACER_NO ORG_RACER_NO                                            -- 선수등록번호
			       , ''    RACER_RSN                                                        -- 선수변경사유
			       , TA   .RACER_NO                                                         -- 선수등록번호
			       , TA   .MOT_NO ORG_MOT_NO                                                -- 모터번호    
			       , ''    MOT_RSN                                                          -- 모터변경사유
			       , TA   .MOT_NO                                                           -- 모터번호    
			       , SUBSTR(TA   .MOT_NO, 6, 3) VIEW_MOT_NO                                 -- 모터번호    
			       , TA   .BOAT_NO ORG_BOAT_NO                                              -- 보트번호    
			       , ''    BOAT_RSN                                                         -- 보트변경사유
			       , TA   .BOAT_NO                                                          -- 보트번호    
			       , SUBSTR(TA   .BOAT_NO, 6, 3) VIEW_BOAT_NO                               -- 보트번호    
			       , TPM  .RACER_GRD_CD                                                     -- 선수등급코드 
			       , TPM  .NM_KOR                                                           -- 성명 한글    
			       , TPD  .WGHT                                                             -- 체중        
			       , TRIM(TO_CHAR((NVL(TRRAS.TMS_6_AVG_RANK_SCR, 0) * 0.7) + (NVL(TMRAS.AVG_RANK_SCR, 0) * 0.25) + (NVL(TBRAS.AVG_RANK_SCR, 0) * 0.05), '99.99')) SCR
			       , RANK() OVER (ORDER BY TRIM(TO_CHAR((NVL(TRRAS.TMS_6_AVG_RANK_SCR, 0) * 0.7) + (NVL(TMRAS.AVG_RANK_SCR, 0) * 0.25) + (NVL(TBRAS.AVG_RANK_SCR, 0) * 0.05), '99.99')) DESC ) RANK
			       , TRRAS.STND_YEAR                  TRRAS_STND_YEAR              
			       , TRRAS.MBR_CD                     TRRAS_MBR_CD                 
			       , TRRAS.TMS                        TRRAS_TMS                    
			       , TRRAS.RACER_NO                   TRRAS_RACER_NO               
			       , TRRAS.TMS_6_AMU_RANK_SCR         TRRAS_TMS_6_AMU_RANK_SCR     
			       , TRRAS.TMS_6_AVG_RANK_SCR         TRRAS_TMS_6_AVG_RANK_SCR     
			       , TRRAS.TMS_6_AMU_ACDNT_SCR        TRRAS_TMS_6_AMU_ACDNT_SCR    
			       , TRRAS.TMS_6_AVG_ACDNT_SCR        TRRAS_TMS_6_AVG_ACDNT_SCR    
			       , TRRAS.TMS_6_AVG_SCR              TRRAS_TMS_6_AVG_SCR          
			       , TRRAS.TMS_6_WIN_RATIO            TRRAS_TMS_6_WIN_RATIO        
			       , TRRAS.TMS_6_HIGH_RANK_RATIO      TRRAS_TMS_6_HIGH_RANK_RATIO  
			       , TRRAS.TMS_6_HIGH_3_RANK_RATIO    TRRAS_TMS_6_HIGH_3_RANK_RATIO
			       , TRRAS.TMS_6_AVG_STRT_TM          TRRAS_TMS_6_AVG_STRT_TM      
			       , TRRAS.TMS_8_RANK_ORD             TRRAS_TMS_8_RANK_ORD         
			       , TRRAS.TMS_6_RACE_CNT             TRRAS_TMS_6_RACE_CNT         
			       , TRRAS.TMS_6_RANK_1               TRRAS_TMS_6_RANK_1           
			       , TRRAS.TMS_6_RANK_2               TRRAS_TMS_6_RANK_2           
			       , TRRAS.TMS_6_RANK_3               TRRAS_TMS_6_RANK_3           
			       , TRRAS.AMU_RANK_SCR               TRRAS_AMU_RANK_SCR           
			       , TRRAS.AVG_RANK_SCR               TRRAS_AVG_RANK_SCR           
			       , TRRAS.AMU_ACDNT_SCR              TRRAS_AMU_ACDNT_SCR          
			       , TRRAS.AVG_ACDNT_SCR              TRRAS_AVG_ACDNT_SCR          
			       , TRRAS.BF_AMU_ACDNT_SCR           TRRAS_BF_AMU_ACDNT_SCR      
			       , TRRAS.BF_AVG_ACDNT_SCR           TRRAS_BF_AVG_ACDNT_SCR      
			       , TRRAS.AF_AMU_ACDNT_SCR           TRRAS_AF_AMU_ACDNT_SCR      
			       , TRRAS.AF_AVG_ACDNT_SCR           TRRAS_AF_AVG_ACDNT_SCR      
			       , TRRAS.AVG_SCR                    TRRAS_AVG_SCR                
			       , TRRAS.WIN_RATIO                  TRRAS_WIN_RATIO              
			       , TRRAS.HIGH_RANK_RATIO            TRRAS_HIGH_RANK_RATIO        
			       , TRRAS.HIGH_3_RANK_RATIO          TRRAS_HIGH_3_RANK_RATIO      
			       , TRRAS.AVG_STRT_TM                TRRAS_AVG_STRT_TM            
			       , TRRAS.RUN_CNT                    TRRAS_RUN_CNT                
			       , TRRAS.RACE_DAY_CNT               TRRAS_RACE_DAY_CNT           
			       , TRRAS.RACE_CNT                   TRRAS_RACE_CNT               
			       , TRRAS.TOT_RACE_CNT               TRRAS_TOT_RACE_CNT           
			       , TRRAS.BF_RACE_CNT                TRRAS_BF_RACE_CNT            
			       , TRRAS.AF_RACE_CNT                TRRAS_AF_RACE_CNT            
			       , TRRAS.RANK_1_CNT                 TRRAS_RANK_1_CNT             
			       , TRRAS.RANK_2_CNT                 TRRAS_RANK_2_CNT             
			       , TRRAS.RANK_3_CNT                 TRRAS_RANK_3_CNT             
			       , TRRAS.RANK_4_CNT                 TRRAS_RANK_4_CNT             
			       , TRRAS.RANK_5_CNT                 TRRAS_RANK_5_CNT             
			       , TRRAS.RANK_6_CNT                 TRRAS_RANK_6_CNT             
			       , TRRAS.RANK_ETC_CNT               TRRAS_RANK_ETC_CNT           
			       , TRRAS.DGRE_JUDG_F_CNT            TRRAS_DGRE_JUDG_F_CNT        
			       , TRRAS.DGRE_JUDG_L_CNT            TRRAS_DGRE_JUDG_L_CNT        
			       , TRRAS.BF_F_CNT                   TRRAS_BF_F_CNT                  
			       , TRRAS.AF_F_CNT                   TRRAS_AF_F_CNT                  
			       , TRRAS.BF_F_CNT + TRRAS.AF_F_CNT  TRRAS_F_CNT                  
			       , TRRAS.BF_L_CNT                   TRRAS_BF_L_CNT                  
			       , TRRAS.AF_L_CNT                   TRRAS_AF_L_CNT                  
			       , TRRAS.BF_L_CNT + TRRAS.AF_L_CNT  TRRAS_L_CNT                  
			       , TRRAS.ABSE_CNT                   TRRAS_ABSE_CNT               
			       , TRRAS.RACE_ESC_1_CNT             TRRAS_RACE_ESC_1_CNT         
			       , TRRAS.RACE_ESC_2_CNT             TRRAS_RACE_ESC_2_CNT         
			       , TRRAS.FOUL_ELIM_CNT              TRRAS_FOUL_ELIM_CNT          
			       , TRRAS.ELIM_CNT                   TRRAS_ELIM_CNT               
			       , TRRAS.FOUL_WARN_CNT              TRRAS_FOUL_WARN_CNT          
			       , TRRAS.WARN_CNT                   TRRAS_WARN_CNT               
			       , TRRAS.ATTEN_CNT                  TRRAS_ATTEN_CNT              
			       , TRRAS.BF_TMS                     TRRAS_BF_TMS                 
			       , TRRAS.BF_BF_TMS                  TRRAS_BF_BF_TMS              
			       , TRRAS.BF_BF_BF_TMS               TRRAS_BF_BF_BF_TMS           
			       , TRRAS.BF_MBR_CD                  TRRAS_BF_MBR_CD              
			       , TRRAS.BF_BF_MBR_CD               TRRAS_BF_BF_MBR_CD           
			       , TRRAS.BF_BF_BF_MBR_CD            TRRAS_BF_BF_BF_MBR_CD        
			       , TRRAS.INST_ID                    TRRAS_INST_ID                
			       , TMRAS.STND_YEAR                  TMRAS_STND_YEAR              
			       , TMRAS.MBR_CD                     TMRAS_MBR_CD                 
			       , TMRAS.TMS                        TMRAS_TMS                    
			       , TMRAS.MOT_NO                     TMRAS_MOT_NO                 
			       , TMRAS.RUN_CNT                    TMRAS_RUN_CNT                
			       , TMRAS.RACE_CNT                   TMRAS_RACE_CNT               
			       , TMRAS.RACE_DAY_CNT               TMRAS_RACE_DAY_CNT           
			       , TMRAS.RANK_1_CNT                 TMRAS_RANK_1_CNT             
			       , TMRAS.RANK_2_CNT                 TMRAS_RANK_2_CNT             
			       , TMRAS.RANK_3_CNT                 TMRAS_RANK_3_CNT             
			       , TMRAS.RANK_4_CNT                 TMRAS_RANK_4_CNT             
			       , TMRAS.RANK_5_CNT                 TMRAS_RANK_5_CNT             
			       , TMRAS.RANK_6_CNT                 TMRAS_RANK_6_CNT             
			       , TMRAS.AMU_RANK_SCR               TMRAS_AMU_RANK_SCR          
			       , TMRAS.AVG_RANK_SCR               TMRAS_AVG_RANK_SCR           
			       , TMRAS.WIN_RATIO                  TMRAS_WIN_RATIO              
			       , TMRAS.HIGH_RANK_RATIO            TMRAS_HIGH_RANK_RATIO        
			       , TMRAS.HIGH_3_RANK_RATIO          TMRAS_HIGH_3_RANK_RATIO      
			       , TMRAS.TMS_3_ITRDT_RUN_TM         TMRAS_TMS_3_ITRDT_RUN_TM     
			       , TMRAS.AVG_ITRDT_RUN_TM           TMRAS_AVG_ITRDT_RUN_TM       
			       , TMRAS.MAX_ITRDT_RUN_TM           TMRAS_MAX_ITRDT_RUN_TM       
			       , TMRAS.MIN_ITRDT_RUN_TM           TMRAS_MIN_ITRDT_RUN_TM       
			       , TMRAS.ITRDT_RUN_TM_DVTN          TMRAS_ITRDT_RUN_TM_DVTN      
			       , TBRAS.STND_YEAR                  TBRAS_STND_YEAR              
			       , TBRAS.MBR_CD                     TBRAS_MBR_CD                 
			       , TBRAS.TMS                        TBRAS_TMS                    
			       , TBRAS.BOAT_NO                    TBRAS_BOAT_NO                
			       , TBRAS.RUN_CNT                    TBRAS_RUN_CNT                
			       , TBRAS.RACE_CNT                   TBRAS_RACE_CNT               
			       , TBRAS.RACE_DAY_CNT               TBRAS_RACE_DAY_CNT           
			       , TBRAS.RANK_1_CNT                 TBRAS_RANK_1_CNT             
			       , TBRAS.RANK_2_CNT                 TBRAS_RANK_2_CNT             
			       , TBRAS.RANK_3_CNT                 TBRAS_RANK_3_CNT             
			       , TBRAS.RANK_4_CNT                 TBRAS_RANK_4_CNT             
			       , TBRAS.RANK_5_CNT                 TBRAS_RANK_5_CNT             
			       , TBRAS.RANK_6_CNT                 TBRAS_RANK_6_CNT             
			       , TBRAS.AMU_RANK_SCR               TBRAS_AMU_RANK_SCR          
			       , TBRAS.AVG_RANK_SCR               TBRAS_AVG_RANK_SCR           
			       , TBRAS.WIN_RATIO                  TBRAS_WIN_RATIO              
			       , TBRAS.HIGH_RANK_RATIO            TBRAS_HIGH_RANK_RATIO        
			       , TBRAS.HIGH_3_RANK_RATIO          TBRAS_HIGH_3_RANK_RATIO      
			       , TBRAS.TMS_3_ITRDT_RUN_TM         TBRAS_TMS_3_ITRDT_RUN_TM     
			       , TBRAS.AVG_ITRDT_RUN_TM           TBRAS_AVG_ITRDT_RUN_TM       
			       , TBRAS.MAX_ITRDT_RUN_TM           TBRAS_MAX_ITRDT_RUN_TM       
			       , TBRAS.MIN_ITRDT_RUN_TM           TBRAS_MIN_ITRDT_RUN_TM       
			       , TBRAS.ITRDT_RUN_TM_DVTN          TBRAS_ITRDT_RUN_TM_DVTN      
                   , NVL(CNT.RACE_CNT_1, ALLOC.RACE_CNT_1) RACE_CNT_1
                   , NVL(CNT.RACE_CNT_2, ALLOC.RACE_CNT_2) RACE_CNT_2
                   , NVL(CNT.RACE_CNT_3, ALLOC.RACE_CNT_3) RACE_CNT_3
                   , NVL(CNT.RACE_CNT_4, ALLOC.RACE_CNT_4) RACE_CNT_4
                   , NVL(CNT.RACE_CNT_5, ALLOC.RACE_CNT_5) RACE_CNT_5
                   , NVL(CNT.RACE_CNT_6, ALLOC.RACE_CNT_6) RACE_CNT_6
                   , NVL(CNT.RACE_CNT_7, ALLOC.RACE_CNT_7) RACE_CNT_7
                   , PRE  .RACE_1_1
                   , PRE  .RACE_1_2
                   , PRE  .RACE_2_1
                   , PRE  .RACE_2_2
                   , PRE  .RACE_3_1
                   , PRE  .RACE_3_2
                   , PRE  .RACE_4_1
                   , PRE  .RACE_4_2
                   , PRE  .RACE_5_1
                   , PRE  .RACE_5_2
                   , PRE  .RACE_6_1
                   , PRE  .RACE_6_2
                   , PRE  .RACE_7_1
                   , PRE  .RACE_7_2
			FROM     TBEC_RACER_MASTER        TPM
			       , TBEC_RACER_DETAIL        TPD
			       , (
                        SELECT
						         TA.STND_YEAR      -- 기준년도    
						       , TA.MBR_CD         -- 경정장코드  
						       , TA.TMS            -- 회차        
						       , TA.RACER_NO       -- 선수등록번호
						       , TA.MOT_NO         -- 모터번호    
						       , TA.BOAT_NO        -- 보트번호    
						       , TA.SPEC_CD        -- 특선코드
						       , TA.ST_MTHD_CD     -- ST유형
                        FROM   TBEB_ARRANGE TA
                        WHERE  TA.STND_YEAR = ?
                        AND    TA.MBR_CD    = ?
                        AND    TA.TMS       = ?
                        AND    TA.ST_MTHD_CD = DECODE(?, '000', TA.ST_MTHD_CD, ?)
			         ) TA -- 해당회차 주선선수 리스트
			       , (
						SELECT *
						FROM   (
						            SELECT   RANK() OVER (PARTITION BY TRRAS.RACER_NO ORDER BY APLY_DT DESC) RANK
						                   , TRRAS.*
						            FROM   TBEB_RACER_RECD_ACCU_SUM TRRAS
						            WHERE  TRRAS.APLY_DT <= (
						                                        SELECT
						                                               MAX(TRDO.RACE_DAY) RACE_DAY
						                                        FROM   TBEB_RACE_DAY_ORD TRDO
						                                        WHERE  TRDO.STND_YEAR = ?
						                                        AND    TRDO.MBR_CD    = ?
						                                        AND    TRDO.TMS       = ?
						                                    )
						            AND   MBR_CD = '000'
						            AND   TMS    = 0
						            AND   TRRAS.ST_MTHD_CD = ? --ST방식전체설정
						       )
						WHERE  RANK = 1
			         ) TRRAS -- 선수별 최종 성적
			       , (
			            SELECT *
			            FROM   (
                                  SELECT   RANK() OVER (PARTITION BY TMRAS.MOT_NO 
                                                            ORDER BY TMRAS.STND_YEAR DESC
                                                                   , TMRAS.TMS DESC 
                                                       ) RANK
                                         , TMRAS.*
                                  FROM   TBEB_MOT_RECD_ACCU_SUM TMRAS
                                  WHERE  TMRAS.MBR_CD = ?
                                  AND    TMRAS.STND_YEAR || LPAD(TMRAS.TMS, 3, '0') <= ? || LPAD(?, 3, '0')
                                  AND    TMRAS.ST_MTHD_CD = ? --ST방식전체설정
			                   )
			            WHERE  RANK = 1
			         ) TMRAS -- 모터별 최종 성적
			       , (
			            SELECT *
			            FROM   (
                                  SELECT   RANK() OVER (PARTITION BY TBRAS.BOAT_NO 
                                                            ORDER BY TBRAS.STND_YEAR DESC
                                                                   , TBRAS.TMS DESC 
                                                       ) RANK
                                         , TBRAS.*
                                  FROM   TBEB_BOAT_RECD_ACCU_SUM TBRAS
                                  WHERE  TBRAS.MBR_CD = ?
                                  AND    TBRAS.STND_YEAR || LPAD(TBRAS.TMS, 3, '0') <= ? || LPAD(?, 3, '0')
                                  AND    TBRAS.ST_MTHD_CD = ? --ST방식전체설정
			                   )
			            WHERE  RANK = 1
			         ) TBRAS -- 보트별 최종 성적
			       , (
                        SELECT
                                 RACER_NO
                               , MIN(DECODE(DAY_ORD, 1, DECODE(RACE, 1, RACE_DESC))) RACE_1_1
                               , MIN(DECODE(DAY_ORD, 1, DECODE(RACE, 2, RACE_DESC))) RACE_1_2
                               , MIN(DECODE(DAY_ORD, 2, DECODE(RACE, 1, RACE_DESC))) RACE_2_1
                               , MIN(DECODE(DAY_ORD, 2, DECODE(RACE, 2, RACE_DESC))) RACE_2_2
                               , MIN(DECODE(DAY_ORD, 3, DECODE(RACE, 1, RACE_DESC))) RACE_3_1
                               , MIN(DECODE(DAY_ORD, 3, DECODE(RACE, 2, RACE_DESC))) RACE_3_2
                               , MIN(DECODE(DAY_ORD, 4, DECODE(RACE, 1, RACE_DESC))) RACE_4_1
                               , MIN(DECODE(DAY_ORD, 4, DECODE(RACE, 2, RACE_DESC))) RACE_4_2
                               , MIN(DECODE(DAY_ORD, 5, DECODE(RACE, 1, RACE_DESC))) RACE_5_1
                               , MIN(DECODE(DAY_ORD, 5, DECODE(RACE, 2, RACE_DESC))) RACE_5_2
                               , MIN(DECODE(DAY_ORD, 6, DECODE(RACE, 1, RACE_DESC))) RACE_6_1
                               , MIN(DECODE(DAY_ORD, 6, DECODE(RACE, 2, RACE_DESC))) RACE_6_2
                               , MIN(DECODE(DAY_ORD, 7, DECODE(RACE, 1, RACE_DESC))) RACE_7_1
                               , MIN(DECODE(DAY_ORD, 7, DECODE(RACE, 2, RACE_DESC))) RACE_7_2
                        FROM   (
                                    SELECT
                                              TOR.RACER_NO
                                            , TOR.DAY_ORD
                                            , TOR.RACE_NO
                                            , DECODE(TR.RACE_STTS_CD, '002', '경주불성립', '003', '경주불성립', DECODE(TOR.RANK, 0, TRVA.VOIL_NM, DECODE(TOR.ST_MTHD_CD,'001','온',SUBSTR((SELECT RMK2 FROM TBEA_SPEC_CD WHERE GRP_CD = 'E00005' AND CD = TR.RACE_DGRE_CD), 1, 1)) || TOR.RACE_NO || '/' || TOR.RANK)) RACE_DESC
                                            , RANK() OVER (PARTITION BY TOR.RACER_NO, TOR.DAY_ORD ORDER BY TOR.RACE_NO) RACE
                                    FROM      TBEB_ORGAN TOR
                                            , TBEB_RACE  TR
                                            , (
                                                SELECT
                                                          RACER_NO
                                                        , STND_YEAR
                                                        , MBR_CD
                                                        , TMS
                                                        , DAY_ORD
                                                        , RACE_NO
                                                        , RACE_REG_NO
                                                        , VOIL_NM
                                                FROM    (
                                                            SELECT
                                                                      TRVA.RACER_NO
                                                                    , TOR.STND_YEAR
                                                                    , TOR.MBR_CD
                                                                    , TOR.TMS
                                                                    , TOR.DAY_ORD
                                                                    , TOR.RACE_NO
                                                                    , TOR.RACE_REG_NO
                                                                    , (SELECT CD_NM FROM TBEA_SPEC_CD WHERE GRP_CD = 'E00035' AND CD = TRVA.VOIL_CD) VOIL_NM
                                                                    , RANK() OVER (PARTITION BY TOR.RACER_NO
                                                                                              , TOR.STND_YEAR
                                                                                              , TOR.MBR_CD
                                                                                              , TOR.TMS
                                                                                              , TOR.DAY_ORD
                                                                                              , TOR.RACE_NO
                                                                                              , TOR.RACE_REG_NO
                                                                                       ORDER BY TOR.IMMT_CLS_CD DESC 
                                                                                              , DECODE(TAS.ACDNT_SCR, 0, 100, TAS.ACDNT_SCR)   DESC) RACE
                                                            FROM      TBED_RACE_VOIL_ACT TRVA
                                                                    , TBEB_ORGAN         TOR
                                                                    , TBEB_ACDNT_SCR     TAS
                                                            WHERE   TRVA.STND_YEAR   = TOR.STND_YEAR
                                                            AND     TRVA.MBR_CD      = TOR.MBR_CD
                                                            AND     TRVA.TMS         = TOR.TMS
                                                            AND     TRVA.DAY_ORD     = TOR.DAY_ORD
                                                            AND     TRVA.RACE_NO     = TOR.RACE_NO
                                                            AND     TRVA.RACE_REG_NO = TOR.RACE_REG_NO
                                                            AND     TRVA.STND_YEAR   = TAS.STND_YEAR
                                                            AND     TRVA.VOIL_CD     = TAS.VOIL_CD
                                                            AND     TRVA.STND_YEAR   = ?
                                                            AND     TRVA.MBR_CD      = ?
                                                            AND     TRVA.TMS         = ?
                                                            AND     TOR .RANK        = 0
                                                            AND     TOR .ST_MTHD_CD = DECODE(?, '000', TOR.ST_MTHD_CD, ?)
                                                        )
                                                WHERE RACE = 1
                                              ) TRVA
                                    WHERE   TOR.STND_YEAR   = TR  .STND_YEAR
                                    AND     TOR.MBR_CD      = TR  .MBR_CD
                                    AND     TOR.TMS         = TR  .TMS
                                    AND     TOR.DAY_ORD     = TR  .DAY_ORD
                                    AND     TOR.RACE_NO     = TR  .RACE_NO
                                    AND     TOR.RACER_NO    = TRVA.RACER_NO(+)
                                    AND     TOR.STND_YEAR   = TRVA.STND_YEAR(+)
                                    AND     TOR.MBR_CD      = TRVA.MBR_CD(+)
                                    AND     TOR.TMS         = TRVA.TMS(+)
                                    AND     TOR.DAY_ORD     = TRVA.DAY_ORD(+)
                                    AND     TOR.RACE_NO     = TRVA.RACE_NO(+)
                                    AND     TOR.RACE_REG_NO = TRVA.RACE_REG_NO(+)
                                    AND     TOR.STND_YEAR   = ?
                                    AND     TOR.MBR_CD      = ?
                                    AND     TOR.TMS         = ?
                                    AND     TOR.ST_MTHD_CD = DECODE(?, '000', TOR.ST_MTHD_CD, ?)
                               )
                        GROUP BY RACER_NO
			         ) PRE -- 일차별 경주 성적
			       , (
                        SELECT
                                 RACER_NO
                               , MIN(DECODE(DAY_ORD, 1, CNT)) RACE_CNT_1
                               , MIN(DECODE(DAY_ORD, 2, CNT)) RACE_CNT_2
                               , MIN(DECODE(DAY_ORD, 3, CNT)) RACE_CNT_3
                               , MIN(DECODE(DAY_ORD, 4, CNT)) RACE_CNT_4
                               , MIN(DECODE(DAY_ORD, 5, CNT)) RACE_CNT_5
                               , MIN(DECODE(DAY_ORD, 6, CNT)) RACE_CNT_6
                               , MIN(DECODE(DAY_ORD, 7, CNT)) RACE_CNT_7
                        FROM   (
                                    SELECT
                                              TOR.RACER_NO
                                            , TOR.DAY_ORD
                                            , COUNT(*) CNT
                                    FROM      TBEB_ORGAN        TOR
                                            , TBEB_RACE_DAY_ORD TRDO
                                    WHERE   TOR.STND_YEAR = TRDO.STND_YEAR
                                    AND     TOR.MBR_CD    = TRDO.MBR_CD
                                    AND     TOR.TMS       = TRDO.TMS
                                    AND     TOR.DAY_ORD   = TRDO.DAY_ORD
                                    AND     TOR.STND_YEAR = ?
                                    AND     TOR.MBR_CD    = ?
                                    AND     TOR.TMS       = ?
                                    AND     TOR.ST_MTHD_CD= ?
                                    AND     TRDO.ORGAN_STAT_CD = '002'
                                    GROUP BY TOR.RACER_NO
                                           , TOR.DAY_ORD
                               )
                        GROUP BY RACER_NO
			         ) CNT -- 일차별 출전횟수
			       , (
                        SELECT
                                 RACER_NO
                               , MIN(DECODE(DAY_ORD, 1, RACE_ALLOC_CNT)) RACE_CNT_1
                               , MIN(DECODE(DAY_ORD, 2, RACE_ALLOC_CNT)) RACE_CNT_2
                               , MIN(DECODE(DAY_ORD, 3, RACE_ALLOC_CNT)) RACE_CNT_3
                               , MIN(DECODE(DAY_ORD, 4, RACE_ALLOC_CNT)) RACE_CNT_4
                               , MIN(DECODE(DAY_ORD, 5, RACE_ALLOC_CNT)) RACE_CNT_5
                               , MIN(DECODE(DAY_ORD, 6, RACE_ALLOC_CNT)) RACE_CNT_6
                               , MIN(DECODE(DAY_ORD, 7, RACE_ALLOC_CNT)) RACE_CNT_7
                        FROM   (
                                    SELECT
                                              TRRA.RACER_NO
                                            , TRRA.DAY_ORD
                                            , TRRA.RACE_ALLOC_CNT
                                    FROM    TBEB_RACER_RACE_ALLOC TRRA
                                    WHERE   TRRA.STND_YEAR = ?
                                    AND     TRRA.MBR_CD    = ?
                                    AND     TRRA.TMS       = ?
                               )
                        GROUP BY RACER_NO
			         ) ALLOC -- 일차별 출주 배정수
			WHERE  TPM.RACER_NO  = TA   .RACER_NO
			AND    TPM.RACER_NO  = TPD  .RACER_NO (+)
			AND    TPM.RACER_NO  = TRRAS.RACER_NO (+)
			AND    TPM.RACER_NO  = PRE  .RACER_NO (+)
			AND    TPM.RACER_NO  = CNT  .RACER_NO (+)
			AND    TPM.RACER_NO  = ALLOC.RACER_NO (+)
			AND    TA .MOT_NO    = TMRAS.MOT_NO   (+)
			AND    TA .BOAT_NO   = TBRAS.BOAT_NO  (+)
        ]]>
    </query> 
    <query id="tbeb_arrange_fb002" desc="해당선수 출주성적 조회" fetchSize="10">
        <![CDATA[
            SELECT	/*  "tbeb_arrange_fb002" IWORK_SFR-008 경정 선수편성 메뉴 개선  정번8 까지 추가 수정.  */
                     TRRAS.RACER_NO                                 
                   , TRRAS.RACER_GRD_CD
                   , TRRAS.NM_KOR
                   , TRRAS.RACER_STAT_CD
                   , TRRAS.FAVOR_COURSE_CD
                   , TRRAS.EMAIL_ADDR
                   , TRRAS.RACER_PERIO_NO
                   , TRRAS.TMS_6_AMU_RANK_SCR         TRRAS_TMS_6_AMU_RANK_SCR     
                   , TRRAS.TMS_6_AVG_RANK_SCR         TRRAS_TMS_6_AVG_RANK_SCR     
                   , TRRAS.TMS_6_AMU_ACDNT_SCR        TRRAS_TMS_6_AMU_ACDNT_SCR    
                   , TRRAS.TMS_6_AVG_ACDNT_SCR        TRRAS_TMS_6_AVG_ACDNT_SCR    
                   , TRRAS.TMS_6_AVG_SCR              TRRAS_TMS_6_AVG_SCR          
                   , TRRAS.TMS_6_WIN_RATIO            TRRAS_TMS_6_WIN_RATIO        
                   , TRRAS.TMS_6_HIGH_RANK_RATIO      TRRAS_TMS_6_HIGH_RANK_RATIO  
                   , TRRAS.TMS_6_HIGH_3_RANK_RATIO    TRRAS_TMS_6_HIGH_3_RANK_RATIO
                   , TRRAS.TMS_6_AVG_STRT_TM          TRRAS_TMS_6_AVG_STRT_TM      
                   , TRRAS.TMS_8_RANK_ORD             TRRAS_TMS_8_RANK_ORD         
                   , TRRAS.TMS_6_RACE_CNT             TRRAS_TMS_6_RACE_CNT         
                   , TRRAS.TMS_6_RANK_1               TRRAS_TMS_6_RANK_1           
                   , TRRAS.TMS_6_RANK_2               TRRAS_TMS_6_RANK_2           
                   , TRRAS.TMS_6_RANK_3               TRRAS_TMS_6_RANK_3           
                   , TRRAS.AMU_RANK_SCR               TRRAS_AMU_RANK_SCR           
                   , TRRAS.AVG_RANK_SCR               TRRAS_AVG_RANK_SCR           
                   , TRRAS.AMU_ACDNT_SCR              TRRAS_AMU_ACDNT_SCR          
                   , TRRAS.AVG_ACDNT_SCR              TRRAS_AVG_ACDNT_SCR          
			       , TRRAS.BF_AMU_ACDNT_SCR           TRRAS_BF_AMU_ACDNT_SCR      
			       , TRRAS.BF_AVG_ACDNT_SCR           TRRAS_BF_AVG_ACDNT_SCR      
			       , TRRAS.AF_AMU_ACDNT_SCR           TRRAS_AF_AMU_ACDNT_SCR      
			       , TRRAS.AF_AVG_ACDNT_SCR           TRRAS_AF_AVG_ACDNT_SCR      
                   , TRRAS.AVG_SCR                    TRRAS_AVG_SCR                
                   , TRRAS.WIN_RATIO                  TRRAS_WIN_RATIO              
                   , TRRAS.HIGH_RANK_RATIO            TRRAS_HIGH_RANK_RATIO        
                   , TRRAS.HIGH_3_RANK_RATIO          TRRAS_HIGH_3_RANK_RATIO      
                   , TRRAS.AVG_STRT_TM                TRRAS_AVG_STRT_TM            
                   , TRRAS.RUN_CNT                    TRRAS_RUN_CNT                
                   , TRRAS.RACE_DAY_CNT               TRRAS_RACE_DAY_CNT           
                   , TRRAS.RACE_CNT                   TRRAS_RACE_CNT               
                   , TRRAS.TOT_RACE_CNT               TRRAS_TOT_RACE_CNT           
                   , TRRAS.BF_RACE_CNT                TRRAS_BF_RACE_CNT            
                   , TRRAS.AF_RACE_CNT                TRRAS_AF_RACE_CNT            
                   , TRRAS.RANK_1_CNT                 TRRAS_RANK_1_CNT             
                   , TRRAS.RANK_2_CNT                 TRRAS_RANK_2_CNT             
                   , TRRAS.RANK_3_CNT                 TRRAS_RANK_3_CNT             
                   , TRRAS.RANK_4_CNT                 TRRAS_RANK_4_CNT             
                   , TRRAS.RANK_5_CNT                 TRRAS_RANK_5_CNT             
                   , TRRAS.RANK_6_CNT                 TRRAS_RANK_6_CNT
                   , TRRAS.RANK_7_CNT                 TRRAS_RANK_7_CNT
                   , TRRAS.RANK_8_CNT                 TRRAS_RANK_8_CNT             
                   , TRRAS.RANK_ETC_CNT               TRRAS_RANK_ETC_CNT           
                   , TRRAS.DGRE_JUDG_F_CNT            TRRAS_DGRE_JUDG_F_CNT        
                   , TRRAS.DGRE_JUDG_L_CNT            TRRAS_DGRE_JUDG_L_CNT        
			       , TRRAS.BF_F_CNT                   TRRAS_BF_F_CNT                  
			       , TRRAS.AF_F_CNT                   TRRAS_AF_F_CNT                  
			       , TRRAS.BF_F_CNT + TRRAS.AF_F_CNT  TRRAS_F_CNT                  
			       , TRRAS.BF_L_CNT                   TRRAS_BF_L_CNT                  
			       , TRRAS.AF_L_CNT                   TRRAS_AF_L_CNT                  
			       , TRRAS.BF_L_CNT + TRRAS.AF_L_CNT  TRRAS_L_CNT                  
                   , TRRAS.ABSE_CNT                   TRRAS_ABSE_CNT               
                   , TRRAS.RACE_ESC_1_CNT             TRRAS_RACE_ESC_1_CNT         
                   , TRRAS.RACE_ESC_2_CNT             TRRAS_RACE_ESC_2_CNT         
                   , TRRAS.FOUL_ELIM_CNT              TRRAS_FOUL_ELIM_CNT          
                   , TRRAS.ELIM_CNT                   TRRAS_ELIM_CNT               
                   , TRRAS.FOUL_WARN_CNT              TRRAS_FOUL_WARN_CNT          
                   , TRRAS.WARN_CNT                   TRRAS_WARN_CNT               
                   , TRRAS.ATTEN_CNT                  TRRAS_ATTEN_CNT              
                   , TRRAS.BF_TMS                     TRRAS_BF_TMS                 
                   , TRRAS.BF_BF_TMS                  TRRAS_BF_BF_TMS              
                   , TRRAS.BF_BF_BF_TMS               TRRAS_BF_BF_BF_TMS           
                   , TRRAS.BF_MBR_CD                  TRRAS_BF_MBR_CD              
                   , TRRAS.BF_BF_MBR_CD               TRRAS_BF_BF_MBR_CD           
                   , TRRAS.BF_BF_BF_MBR_CD            TRRAS_BF_BF_BF_MBR_CD        
                   , TMRAS.STND_YEAR                  TMRAS_STND_YEAR              
                   , TMRAS.MBR_CD                     TMRAS_MBR_CD                 
                   , TMRAS.TMS                        TMRAS_TMS                    
                   , TMRAS.MOT_NO                     TMRAS_MOT_NO                 
                   , TMRAS.RUN_CNT                    TMRAS_RUN_CNT                
                   , TMRAS.RACE_CNT                   TMRAS_RACE_CNT               
                   , TMRAS.RACE_DAY_CNT               TMRAS_RACE_DAY_CNT           
                   , TMRAS.RANK_1_CNT                 TMRAS_RANK_1_CNT             
                   , TMRAS.RANK_2_CNT                 TMRAS_RANK_2_CNT             
                   , TMRAS.RANK_3_CNT                 TMRAS_RANK_3_CNT             
                   , TMRAS.RANK_4_CNT                 TMRAS_RANK_4_CNT             
                   , TMRAS.RANK_5_CNT                 TMRAS_RANK_5_CNT             
                   , TMRAS.RANK_6_CNT                 TMRAS_RANK_6_CNT
                   , TMRAS.RANK_7_CNT                 TMRAS_RANK_7_CNT
                   , TMRAS.RANK_8_CNT                 TMRAS_RANK_8_CNT             
                   , TMRAS.AMU_RANK_SCR               TMRAS_AMU_RANK_SCR          
                   , TMRAS.AVG_RANK_SCR               TMRAS_AVG_RANK_SCR           
                   , TMRAS.WIN_RATIO                  TMRAS_WIN_RATIO              
                   , TMRAS.HIGH_RANK_RATIO            TMRAS_HIGH_RANK_RATIO        
                   , TMRAS.HIGH_3_RANK_RATIO          TMRAS_HIGH_3_RANK_RATIO      
                   , TMRAS.TMS_3_ITRDT_RUN_TM         TMRAS_TMS_3_ITRDT_RUN_TM     
                   , TMRAS.AVG_ITRDT_RUN_TM           TMRAS_AVG_ITRDT_RUN_TM       
                   , TMRAS.MAX_ITRDT_RUN_TM           TMRAS_MAX_ITRDT_RUN_TM       
                   , TMRAS.MIN_ITRDT_RUN_TM           TMRAS_MIN_ITRDT_RUN_TM       
                   , TMRAS.ITRDT_RUN_TM_DVTN          TMRAS_ITRDT_RUN_TM_DVTN      
                   , TBRAS.STND_YEAR                  TBRAS_STND_YEAR              
                   , TBRAS.MBR_CD                     TBRAS_MBR_CD                 
                   , TBRAS.TMS                        TBRAS_TMS                    
                   , TBRAS.BOAT_NO                    TBRAS_BOAT_NO                
                   , TBRAS.RUN_CNT                    TBRAS_RUN_CNT                
                   , TBRAS.RACE_CNT                   TBRAS_RACE_CNT               
                   , TBRAS.RACE_DAY_CNT               TBRAS_RACE_DAY_CNT           
                   , TBRAS.RANK_1_CNT                 TBRAS_RANK_1_CNT             
                   , TBRAS.RANK_2_CNT                 TBRAS_RANK_2_CNT             
                   , TBRAS.RANK_3_CNT                 TBRAS_RANK_3_CNT             
                   , TBRAS.RANK_4_CNT                 TBRAS_RANK_4_CNT             
                   , TBRAS.RANK_5_CNT                 TBRAS_RANK_5_CNT             
                   , TBRAS.RANK_6_CNT                 TBRAS_RANK_6_CNT
                   , TBRAS.RANK_7_CNT                 TBRAS_RANK_7_CNT
                   , TBRAS.RANK_8_CNT                 TBRAS_RANK_8_CNT             
                   , TBRAS.AMU_RANK_SCR               TBRAS_AMU_RANK_SCR          
                   , TBRAS.AVG_RANK_SCR               TBRAS_AVG_RANK_SCR           
                   , TBRAS.WIN_RATIO                  TBRAS_WIN_RATIO              
                   , TBRAS.HIGH_RANK_RATIO            TBRAS_HIGH_RANK_RATIO        
                   , TBRAS.HIGH_3_RANK_RATIO          TBRAS_HIGH_3_RANK_RATIO      
                   , TBRAS.TMS_3_ITRDT_RUN_TM         TBRAS_TMS_3_ITRDT_RUN_TM     
                   , TBRAS.AVG_ITRDT_RUN_TM           TBRAS_AVG_ITRDT_RUN_TM       
                   , TBRAS.MAX_ITRDT_RUN_TM           TBRAS_MAX_ITRDT_RUN_TM       
                   , TBRAS.MIN_ITRDT_RUN_TM           TBRAS_MIN_ITRDT_RUN_TM       
                   , TBRAS.ITRDT_RUN_TM_DVTN          TBRAS_ITRDT_RUN_TM_DVTN      
			FROM     (
			            SELECT
			                     ? RACER_NO
			                   , ? MOT_NO
			                   , ? BOAT_NO
			            FROM   DUAL
			         ) MAIN  -- 해당 선수 및 장비
			       , (
                        SELECT
                                 TRM  .RACER_NO
                               , TRM  .RACER_GRD_CD
                               , TRM  .NM_KOR
                               , TRM  .RACER_STAT_CD
                               , TRM  .FAVOR_COURSE_CD
                               , TRM  .EMAIL_ADDR
                               , TRM  .RACER_PERIO_NO
                               , TRRAS.TMS_6_AMU_RANK_SCR         
                               , TRRAS.TMS_6_AVG_RANK_SCR         
                               , TRRAS.TMS_6_AMU_ACDNT_SCR        
                               , TRRAS.TMS_6_AVG_ACDNT_SCR        
                               , TRRAS.TMS_6_AVG_SCR              
                               , TRRAS.TMS_6_WIN_RATIO            
                               , TRRAS.TMS_6_HIGH_RANK_RATIO      
                               , TRRAS.TMS_6_HIGH_3_RANK_RATIO    
                               , TRRAS.TMS_6_AVG_STRT_TM          
                               , TRRAS.TMS_8_RANK_ORD             
                               , TRRAS.TMS_6_RACE_CNT             
                               , TRRAS.TMS_6_RANK_1               
                               , TRRAS.TMS_6_RANK_2               
                               , TRRAS.TMS_6_RANK_3               
                               , TRRAS.AMU_RANK_SCR               
                               , TRRAS.AVG_RANK_SCR               
                               , TRRAS.AMU_ACDNT_SCR              
                               , TRRAS.AVG_ACDNT_SCR              
                               , TRRAS.BF_AMU_ACDNT_SCR          
                               , TRRAS.BF_AVG_ACDNT_SCR          
                               , TRRAS.AF_AMU_ACDNT_SCR          
                               , TRRAS.AF_AVG_ACDNT_SCR          
                               , TRRAS.AVG_SCR                    
                               , TRRAS.WIN_RATIO                  
                               , TRRAS.HIGH_RANK_RATIO            
                               , TRRAS.HIGH_3_RANK_RATIO          
                               , TRRAS.AVG_STRT_TM                
                               , TRRAS.RUN_CNT                    
                               , TRRAS.RACE_DAY_CNT               
                               , TRRAS.RACE_CNT                   
                               , TRRAS.TOT_RACE_CNT               
                               , TRRAS.BF_RACE_CNT                
                               , TRRAS.AF_RACE_CNT                
                               , TRRAS.RANK_1_CNT                 
                               , TRRAS.RANK_2_CNT                 
                               , TRRAS.RANK_3_CNT                 
                               , TRRAS.RANK_4_CNT                 
                               , TRRAS.RANK_5_CNT                 
                               , TRRAS.RANK_6_CNT
                               , TRRAS.RANK_7_CNT
                               , TRRAS.RANK_8_CNT
                               , TRRAS.RANK_ETC_CNT               
                               , TRRAS.DGRE_JUDG_F_CNT            
                               , TRRAS.DGRE_JUDG_L_CNT            
                               , TRRAS.BF_F_CNT                      
                               , TRRAS.AF_F_CNT                      
                               , TRRAS.BF_L_CNT                      
                               , TRRAS.AF_L_CNT                      
                               , TRRAS.ABSE_CNT                   
                               , TRRAS.RACE_ESC_1_CNT             
                               , TRRAS.RACE_ESC_2_CNT             
                               , TRRAS.FOUL_ELIM_CNT              
                               , TRRAS.ELIM_CNT                   
                               , TRRAS.FOUL_WARN_CNT              
                               , TRRAS.WARN_CNT                   
                               , TRRAS.ATTEN_CNT                  
                               , TRRAS.BF_TMS                     
                               , TRRAS.BF_BF_TMS                  
                               , TRRAS.BF_BF_BF_TMS               
                               , TRRAS.BF_MBR_CD                  
                               , TRRAS.BF_BF_MBR_CD               
                               , TRRAS.BF_BF_BF_MBR_CD            
                        FROM     TBEC_RACER_MASTER        TRM
                               , TBEC_RACER_DETAIL        TRD
                               , (
									SELECT *
									FROM   (
									            SELECT   RANK() OVER (PARTITION BY TRRAS.RACER_NO ORDER BY APLY_DT DESC) RANK
									                   , TRRAS.*
									            FROM   TBEB_RACER_RECD_ACCU_SUM TRRAS
									            WHERE  TRRAS.APLY_DT <= (
									                                        SELECT
									                                               MAX(TRDO.RACE_DAY) RACE_DAY
									                                        FROM   TBEB_RACE_DAY_ORD TRDO
									                                        WHERE  TRDO.STND_YEAR = ?
									                                        AND    TRDO.MBR_CD    = ?
									                                        AND    TRDO.TMS       = ?
									                                    )
									            AND   MBR_CD = '000'
									            AND   TMS    = 0
									            AND   TRRAS.ST_MTHD_CD = '000' --ST방식전체설정
									       )
									WHERE  RANK = 1
                                 ) TRRAS
                        WHERE  TRM.RACER_NO  = TRD  .RACER_NO (+)
                        AND    TRM.RACER_NO  = TRRAS.RACER_NO (+)
                        AND    TRM.RACER_NO  = ?
                     ) TRRAS -- 선수 최근 성적
                   , (
                        SELECT
                                 TE   .STND_YEAR
                               , TE   .MBR_CD
                               , TE   .EQUIP_TPE_CD
                               , TE   .EQUIP_NO     MOT_NO
                               , TE   .EQUIP_REG_NO
                               , TMRAS.TMS                            
--                             , TMRAS.MOT_NO                         
                               , TMRAS.RUN_CNT                        
                               , TMRAS.RACE_CNT                       
                               , TMRAS.RACE_DAY_CNT                   
                               , TMRAS.RANK_1_CNT                     
                               , TMRAS.RANK_2_CNT                     
                               , TMRAS.RANK_3_CNT                     
                               , TMRAS.RANK_4_CNT                     
                               , TMRAS.RANK_5_CNT                     
                               , TMRAS.RANK_6_CNT
                               , TMRAS.RANK_7_CNT
                               , TMRAS.RANK_8_CNT
                               , TMRAS.AMU_RANK_SCR                  
                               , TMRAS.AVG_RANK_SCR                   
                               , TMRAS.WIN_RATIO                      
                               , TMRAS.HIGH_RANK_RATIO                
                               , TMRAS.HIGH_3_RANK_RATIO              
                               , TMRAS.TMS_3_ITRDT_RUN_TM             
                               , TMRAS.AVG_ITRDT_RUN_TM               
                               , TMRAS.MAX_ITRDT_RUN_TM               
                               , TMRAS.MIN_ITRDT_RUN_TM               
                               , TMRAS.ITRDT_RUN_TM_DVTN              
                        FROM     TBEF_EQUIP        TE
                               , (
                                    SELECT *
                                    FROM   (
                                              SELECT   RANK() OVER (PARTITION BY TMRAS.MOT_NO 
                                                                        ORDER BY TMRAS.STND_YEAR DESC
                                                                               , TMRAS.TMS DESC 
                                                                   ) RANK
                                                     , TMRAS.*
                                              FROM   TBEB_MOT_RECD_ACCU_SUM TMRAS
                                              WHERE  TMRAS.MBR_CD = ?
                                              AND    TMRAS.STND_YEAR || LPAD(TMRAS.TMS, 3, '0') <= ? || LPAD(?, 3, '0')
                                              AND    TMRAS.ST_MTHD_CD = '000' --ST방식전체설정
                                           )
                                    WHERE  RANK = 1
                                 ) TMRAS
                        WHERE  TE   .MBR_CD       = TMRAS.MBR_CD(+)
                        AND    TE   .EQUIP_NO     = TMRAS.MOT_NO(+)
                        AND    TE   .MBR_CD       = ?
                        AND    TE   .EQUIP_TPE_CD = 'M'
                        AND    TE   .EQUIP_NO     = ?
                     ) TMRAS -- 모터 최근 성적
                   , (
                        SELECT
                                 TE   .STND_YEAR
                               , TE   .MBR_CD
                               , TE   .EQUIP_TPE_CD
                               , TE   .EQUIP_NO  BOAT_NO
                               , TE   .EQUIP_REG_NO
                               , TBRAS.TMS                            
--                             , TBRAS.BOAT_NO                         
                               , TBRAS.RUN_CNT                        
                               , TBRAS.RACE_CNT                       
                               , TBRAS.RACE_DAY_CNT                   
                               , TBRAS.RANK_1_CNT                     
                               , TBRAS.RANK_2_CNT                     
                               , TBRAS.RANK_3_CNT                     
                               , TBRAS.RANK_4_CNT                     
                               , TBRAS.RANK_5_CNT                     
                               , TBRAS.RANK_6_CNT
                               , TBRAS.RANK_7_CNT 
                               , TBRAS.RANK_8_CNT                      
                               , TBRAS.AMU_RANK_SCR                  
                               , TBRAS.AVG_RANK_SCR                   
                               , TBRAS.WIN_RATIO                      
                               , TBRAS.HIGH_RANK_RATIO                
                               , TBRAS.HIGH_3_RANK_RATIO              
                               , TBRAS.TMS_3_ITRDT_RUN_TM             
                               , TBRAS.AVG_ITRDT_RUN_TM               
                               , TBRAS.MAX_ITRDT_RUN_TM               
                               , TBRAS.MIN_ITRDT_RUN_TM               
                               , TBRAS.ITRDT_RUN_TM_DVTN              
                        FROM     TBEF_EQUIP        TE
                               , (
                                    SELECT *
                                    FROM   (
                                              SELECT   RANK() OVER (PARTITION BY TBRAS.BOAT_NO 
                                                                        ORDER BY TBRAS.STND_YEAR DESC
                                                                               , TBRAS.TMS DESC 
                                                                   ) RANK
                                                     , TBRAS.*
                                              FROM   TBEB_BOAT_RECD_ACCU_SUM TBRAS
                                              WHERE  TBRAS.MBR_CD = ?
                                              AND    TBRAS.STND_YEAR || LPAD(TBRAS.TMS, 3, '0') <= ? || LPAD(?, 3, '0')
                                              AND    TBRAS.ST_MTHD_CD = '000' --ST방식전체설정
                                           )
                                    WHERE  RANK = 1
                                 ) TBRAS
                        WHERE  TE   .MBR_CD       = TBRAS.MBR_CD(+)
                        AND    TE   .EQUIP_NO     = TBRAS.BOAT_NO(+)
                        AND    TE   .MBR_CD       = ?
                        AND    TE   .EQUIP_TPE_CD = 'B'
                        AND    TE   .EQUIP_NO     = ?
                     ) TBRAS -- 보트 최근 성적
            WHERE  MAIN.RACER_NO = TRRAS.RACER_NO(+)
            AND    MAIN.MOT_NO   = TMRAS.MOT_NO  (+)
            AND    MAIN.BOAT_NO  = TBRAS.BOAT_NO (+)
        ]]>
    </query> 
    <query id="tbeb_arrange_ib001" desc="주선저장" fetchSize="10">
        <![CDATA[
				INSERT INTO TBEB_ARRANGE
				(
				         STND_YEAR   -- 기준년도    
			      	   , MBR_CD      -- 경정장코드
				       , TMS         -- 회차        
				       , RACER_NO    -- 선수등록번호
				       , MOT_NO      -- 모터번호    
				       , BOAT_NO     -- 보트번호    
				       , EXCL_YN     -- 성적상위자 주선여부
				       , ST_MTHD_CD	 -- ST방식
				       , INST_ID     -- 작성자ID    
				       , INST_DTM    -- 작성일시    
				       , UPDT_ID     -- 수정자ID    
				       , UPDT_DTM    -- 수정일시    
				) VALUES (
				         ?           -- 기준년도    
			      	   , ?           -- 경정장코드
				       , ?           -- 회차        
				       , ?           -- 선수등록번호
				       , ?           -- 모터번호    
				       , ?           -- 보트번호    
				       , NVL(?,'N')  -- 성적상위자 주선여부
				       , NVL(?,'002')-- ST방식
				       , ?           -- 작성자ID    
				       , SYSDATE     -- 작성일시    
				       , ?           -- 수정자ID    
				       , SYSDATE     -- 수정일시    
				)
        ]]>
    </query> 
    <query id="tbeb_arrange_fb003" desc="주선선수수 조회" fetchSize="10">
        <![CDATA[
				SELECT
				       COUNT(*) CNT
				FROM   TBEB_ARRANGE
				WHERE  STND_YEAR    = ?       -- 기준년도    
			    AND    MBR_CD       = ?       -- 경정장코드
				AND    TMS          = ?       -- 회차        
				AND    RACER_NO     = ?       -- 선수등록번호
        ]]>
    </query> 
    <query id="tbeb_arrange_fb004" desc="주선 선수 조회" fetchSize="10">
        <![CDATA[
				SELECT
				         TA .RACER_NO
				       , TRM.NM_KOR
				FROM     TBEB_ARRANGE TA
				       , TBEC_RACER_MASTER TRM
				WHERE  TA .RACER_NO     = TRM.RACER_NO
				AND    TA .STND_YEAR    = ?       -- 기준년도    
			    AND    TA .MBR_CD       = ?       -- 경정장코드
				AND    TA .TMS          = ?       -- 회차        
				ORDER BY TRM.RACER_GRD_CD
				       , TRM.RACER_NO
        ]]>
    </query> 
    <query id="tbeb_arrange_fb005" desc="주선선수간 주선수 조회" fetchSize="10">
        <![CDATA[
            SELECT
                   COUNT(*) CNT
            FROM   (
        				SELECT
                                 STND_YEAR
                               , MBR_CD
                               , TMS
        				       , COUNT(*)
        				FROM     TBEB_ARRANGE TA
        				WHERE  (TA .STND_YEAR, TA .MBR_CD, TA .TMS) IN (
                                                                            SELECT 
                                                                                     TRDO.STND_YEAR
                                                                                   , TRDO.MBR_CD
                                                                                   , TRDO.TMS
                                                                            FROM     TBEB_RACE_DAY_ORD TRDO
                                                                                   , (
                                                                                        SELECT 
                                                                                               MIN(TRDO.RACE_DAY) STR_DT
                                                                                        FROM   TBEB_RACE_DAY_ORD TRDO
                                                                                        WHERE  TRDO.STND_YEAR = ?
                                                                                        AND    TRDO.MBR_CD    = ?
                                                                                        AND    TRDO.TMS       = ?
                                                                                     ) DT
                                                                            WHERE TRDO.RACE_DAY < DT.STR_DT
                                                                            AND   TRDO.STND_YEAR = ?
                                                                            GROUP BY 
                                                                                     TRDO.STND_YEAR
                                                                                   , TRDO.MBR_CD
                                                                                   , TRDO.TMS
                                                                       )
        				AND    TA .RACER_NO    IN (?, ?)
                        GROUP BY STND_YEAR
                               , MBR_CD
                               , TMS
                        HAVING COUNT(*) > 1
                   )
        ]]>
    </query> 
    <query id="tbeb_arrange_fb0055" desc="주선선수간 주선수 조회" fetchSize="10">
        <![CDATA[
			SELECT COUNT(*) AS CNT
			FROM (
				SELECT TMS, COUNT(*)
				FROM TBEB_ARRANGE
				WHERE STND_YEAR = ?
				AND MBR_CD      = ?
				AND TMS         < ?
				AND RACER_NO IN (? , ?)
				GROUP BY TMS
				HAVING COUNT(*)>1
			)
		]]>
    </query> 
    
    <query id="tbeb_arrange_fb0060" desc="성적상위자 주선정보 조회" fetchSize="10">
        <![CDATA[
				SELECT STND_YEAR
				      ,MBR_CD
				      ,TMS
				      ,RACER_NO
				      ,NVL(EXCL_YN,'N') AS EXCL_YN
				FROM  TBEB_ARRANGE
				WHERE 1=1
				AND   STND_YEAR = ?
				AND   MBR_CD = ?
				AND   TMS BETWEEN ? AND ?
				AND   EXCL_YN = 'Y'
        ]]>
    </query> 
    
    <query id="tbeb_arrange_fb0070" desc="온라인스타트 주선정보 조회" fetchSize="10">
        <![CDATA[
				SELECT STND_YEAR
				      ,MBR_CD
				      ,TMS
				      ,RACER_NO
				      ,NVL(ST_MTHD_CD,'002') AS ST_MTHD_CD
				FROM  TBEB_ARRANGE
				WHERE 1=1
				AND   STND_YEAR = ?
				AND   MBR_CD = ?
				AND   TMS BETWEEN ? AND ?
				AND   ST_MTHD_CD = '001'
        ]]>
    </query>
    
    <query id="tbeb_arrange_ub001" desc="주선 수정" fetchSize="10">
        <![CDATA[
				UPDATE /* tbeb_arrange_ub001 */ 
				       TBEB_ARRANGE SET
				         RACER_NO   = ?       -- 선수등록번호
				       , EXCL_YN    = NVL(?, 'N')       -- 성적상위자 주선여부    
				       , ST_MTHD_CD = NVL(?, '002')       -- ST방식
				       , MOT_NO     = NVL(?, MOT_NO)       -- 모터번호    
				       , BOAT_NO    = NVL(?, BOAT_NO)       -- 보트번호    
				       , UPDT_ID    = ?       -- 수정자ID    
				       , UPDT_DTM   = SYSDATE -- 수정일시    
				WHERE  STND_YEAR    = ?       -- 기준년도    
			    AND    MBR_CD       = ?       -- 경정장코드
				AND    TMS          = ?       -- 회차        
				AND    RACER_NO     = ?       -- 선수등록번호
        ]]>
    </query> 
    <query id="tbeb_arrange_ub003" desc="주선 수정" fetchSize="10">
        <![CDATA[
				UPDATE /* tbeb_arrange_ub003 */ 
				       TBEB_ARRANGE SET
				         RACER_NO   = ?       -- 선수등록번호
				       , MOT_NO     = NVL(?, MOT_NO)       -- 모터번호    
				       , BOAT_NO    = NVL(?, BOAT_NO)       -- 보트번호    
				       , UPDT_ID    = ?       -- 수정자ID    
				       , UPDT_DTM   = SYSDATE -- 수정일시    
				WHERE  STND_YEAR    = ?       -- 기준년도    
			    AND    MBR_CD       = ?       -- 경정장코드
				AND    TMS          = ?       -- 회차        
				AND    RACER_NO     = ?       -- 선수등록번호
        ]]>
    </query> 
    <query id="tbeb_arrange_ub002" desc="주선 수정" fetchSize="10">
        <![CDATA[
			UPDATE /* tbeb_arrange_ub002 */
			       TBEB_ARRANGE SET
			         RACER_NO   = ?       -- 선수등록번호
			       , MOT_NO     = ?       -- 모터번호    
			       , BOAT_NO    = ?       -- 보트번호    
  			       , SPEC_CD    = ?       -- 특선코드
			       , UPDT_ID    = ?       -- 수정자ID    
			       , UPDT_DTM   = SYSDATE -- 수정일시    
			       , ST_MTHD_CD = DECODE(NVL(?,0),'1','001','002')
			WHERE  STND_YEAR    = ? -- 기준년도    
			AND    MBR_CD       = ? -- 경정장코드        
			AND    TMS          = ? -- 회차        
			AND    RACER_NO     = NVL(?, RACER_NO)
			AND    NVL(MOT_NO,'-')  = NVL(?, '-')
			AND    NVL(BOAT_NO,'-') = NVL(?, '-')
        ]]>
    </query> 
    <query id="tbeb_arrange_db001" desc="주선 삭제" fetchSize="10">
        <![CDATA[
			DELETE 
			FROM   TBEB_ARRANGE
			WHERE  STND_YEAR = ? -- 기준년도    
			AND    MBR_CD    = ? -- 경정장코드        
			AND    TMS       = ? -- 회차        
        ]]>
    </query> 
</queryMap>