<?xml version="1.0" encoding='EUC-KR'?>
<queryMap desc="tbtq_checkbord_mngr(내부심사)">
	<query id="tbtq_checkbord_fa001" desc="LIST쿼리" fetchSize="10">
        <![CDATA[
		SELECT 
			      ROW_ID
                , SEQ_NO                               
                , GRP_NO                               
                , GRP_RANK_NO                          
                , GRP_LOW_NO                           
                , MAKE_MAN                              
                , SBJT       
                , SHOWSBJT                          
                , BORD_DESC                            
                , SRCH_CNT                             
                , PROG_STAT                            
                , DEL_YN                               
                , INST_ID                              
                , INST_DTM
                , UPDT_ID                              
                , UPDT_DTM
		    FROM (SELECT    
                          ROWNUM ROW_ID
                        , SEQ_NO                               
                        , GRP_NO                               
                        , GRP_RANK_NO                          
                        , GRP_LOW_NO                           
                        , MAKE_MAN                              
                        , SBJT
                        , LPAD('  ',GRP_RANK_NO *2,'  ')||SBJT SHOWSBJT                         
                        , BORD_DESC                            
                        , SRCH_CNT                             
                        , PROG_STAT                            
                        , DEL_YN                               			        	
                        , INST_ID                              			        	
                        , TO_CHAR(INST_DTM,'YYYYMMDD') INST_DTM			        	
                        , UPDT_ID                              			        	
                        , TO_CHAR(UPDT_DTM,'YYYYMMDD') UPDT_DTM			        	
			        FROM (SELECT 
			        	          SEQ_NO
				                , GRP_NO                               
				                , GRP_RANK_NO                          
				                , GRP_LOW_NO   
                                , MAKE_MAN
                                , SBJT
                                , BORD_DESC
                                , SRCH_CNT
                                , PROG_STAT
                                , DEL_YN
                                , INST_ID
                                , INST_DTM
                                , UPDT_ID
                                , UPDT_DTM
			        		FROM TBTQ_ISO_BORD
			        		WHERE DEL_YN 	= ?
							AND SBJT        LIKE NVL('%' || ? || '%', SBJT)
						    AND BORD_DESC   LIKE NVL('%' || ? || '%', BORD_DESC)
							AND MAKE_MAN    LIKE NVL('%' || ? || '%', MAKE_MAN)
							AND SEQ_NO		=    NVL(?				, SEQ_NO)
							AND GBN = '2'
			        		ORDER BY GRP_NO DESC, GRP_LOW_NO ASC
							)
			        )							
			WHERE ROW_ID BETWEEN (? - 1) * ? + 1 AND ? * ?
        ]]>
    </query>     
    <query id="tbtq_checkbord_fa002" desc="카운트쿼리" fetchSize="10">
        <![CDATA[
			SELECT COUNT(SEQ_NO) TOTCOUNT FROM TBTQ_ISO_BORD
			WHERE	DEL_YN = ?
			AND 	SBJT        LIKE NVL('%' || ? || '%', SBJT)
			AND 	BORD_DESC   LIKE NVL('%' || ? || '%', BORD_DESC)
			AND 	MAKE_MAN    LIKE NVL('%' || ? || '%', MAKE_MAN)
        ]]>
    </query>
    <query id="tbtq_checkbord_fa003" desc="SEQNOGET쿼리" fetchSize="10">
        <![CDATA[
			SELECT
			      (SELECT NVL(MAX(SEQ_NO),0) + 1 FROM TBEA_BORD) NEXTSEQNO
			 	,  NEXTFILESEQNO
			FROM DUAL
        ]]>
    </query> 
    <query id="tbtq_checkbord_fa004" desc="내부심사파일정보가져오기쿼리" fetchSize="10">
        <![CDATA[
			SELECT
			      SEQ_NO
			    , FILE_SEQ
			    , FILE_SIZE
			    , FILE_NAME
			    , FILE_URL
			    , FILE_SIZE
			    , INST_ID
			    , INST_DTM
			    , UPDT_ID
			    , UPDT_DTM
			    , 0 AS CHK
			FROM TBTQ_ISO_BORD_ATMNT
			WHERE  SEQ_NO      = ?
        ]]>
    </query> 
    <query id="tbtq_checkbord_ia001" desc="입력쿼리" fetchSize="10">
        <![CDATA[
			INSERT INTO TBTQ_ISO_BORD (
		          SEQ_NO
		        , GRP_NO
		        , GRP_RANK_NO
		        , GRP_LOW_NO
		        , MAKE_MAN
		        , SBJT
		        , BORD_DESC
		        , SRCH_CNT
		        , PROG_STAT
		        , DEL_YN
		        , INST_ID
		        , INST_DTM
		        , UPDT_ID
		        , UPDT_DTM
		        , GBN
			) VALUES (
		          (SELECT NVL(MAX(SEQ_NO),0) + 1 FROM TBTQ_ISO_BORD)
		        , (SELECT NVL(MAX(SEQ_NO),0) + 1 FROM TBTQ_ISO_BORD)
		        , 0
		        , 0
		        , ?
		        , ?
		        , ?
		        , ?
		        , ?
		        , ?
		        , ?
		        , SYSDATE
		        , ?
		        , SYSDATE
		        ,'2'
			)
        ]]>
    </query> 
    <query id="tbtq_checkbord_ua002" desc="수정쿼리" fetchSize="10">
        <![CDATA[
			UPDATE TBTQ_ISO_BORD 
				 SET SBJT = ?
			    , BORD_DESC = ?
			    , UPDT_ID = ?
			    , UPDT_DTM = SYSDATE
			WHERE SEQ_NO = ?	
        ]]>
    </query> 
    <query id="tbtq_checkbord_ra001" desc="답변쿼리" fetchSize="10">
        <![CDATA[
			INSERT INTO TBTQ_ISO_BORD (
		          SEQ_NO
		        , GRP_NO
		        , GRP_RANK_NO
		        , GRP_LOW_NO
		        , MAKE_MAN
		        , SBJT
		        , BORD_DESC
		        , SRCH_CNT
		        , PROG_STAT
		        , DEL_YN
		        , INST_ID
		        , INST_DTM
		        , UPDT_ID
		        , UPDT_DTM
		        , GBN
			) VALUES (
		         (SELECT NVL(MAX(SEQ_NO),0) + 1 FROM TBTQ_ISO_BORD)
		        , ?
		        , ?
		        , ?
		        , ?
		        , ?
		        , ?
		        , ?
		        , ?
		        , ?
		        , ?
		        , SYSDATE
		        , ?
		        , SYSDATE
		        , '2'
			)
        ]]>
    </query> 
    <query id="tbtq_checkbord_ia002" desc="답변선작업쿼리" fetchSize="10">
        <![CDATA[
			UPDATE TBTQ_ISO_BORD
			    SET GRP_LOW_NO = GRP_LOW_NO + 1 
			WHERE GRP_NO = ? 
			AND GRP_LOW_NO >= ? 
			AND GRP_RANK_NO != 0
        ]]>
    </query>
    <query id="tbtq_checkbord_da001" desc="삭제쿼리" fetchSize="10">
        <![CDATA[
			UPDATE TBTQ_ISO_BORD
				SET DEL_YN = ?
			WHERE SEQ_NO = ?
        ]]>
    </query> 
    <query id="tbtq_checkbord_ia003" desc="파일입력" fetchSize="10">
        <![CDATA[
			INSERT INTO TBTQ_ISO_BORD_ATMNT (
	              SEQ_NO
				, FILE_SEQ
				, FILE_NAME
				, FILE_URL
				, FILE_SIZE
				, INST_ID
				, INST_DTM
				, UPDT_ID
				, UPDT_DTM
			) VALUES (
		          (SELECT NVL(MAX(SEQ_NO),0) FROM TBTQ_ISO_BORD)			    -- seq_no
		        , (SELECT NVL(MAX(FILE_SEQ),0) + 1 FROM TBTQ_ISO_BORD_ATMNT)	-- file_seq
		        , ?					-- file_name
		        , ?					-- file_url
		        , ?					-- file_size
		        , ?					-- inst_id
		        , SYSDATE			-- inst_dtm
		        , ?					-- updt_id
		        , SYSDATE			-- updt_dtm
			)
        ]]>
    </query>
    <query id="tbtq_checkbord_ia004" desc="파일입력" fetchSize="10">
        <![CDATA[
			INSERT INTO TBTQ_ISO_BORD_ATMNT (
	              SEQ_NO
				, FILE_SEQ
				, FILE_NAME
				, FILE_URL
				, FILE_SIZE
				, INST_ID
				, INST_DTM
				, UPDT_ID
				, UPDT_DTM
			) VALUES (
		          ?			    -- seq_no
		        , (SELECT NVL(MAX(FILE_SEQ),0) + 1 FROM TBTQ_ISO_BORD_ATMNT)	-- file_seq
		        , ?					-- file_name
		        , ?					-- file_url
		        , ?					-- file_size
		        , ?					-- inst_id
		        , SYSDATE			-- inst_dtm
		        , ?					-- updt_id
		        , SYSDATE			-- updt_dtm
			)
        ]]>
    </query>
   <query id="tbtq_checkbord_da002" desc="삭제쿼리" fetchSize="10">
        <![CDATA[
			DELETE FROM TBTQ_ISO_BORD_ATMNT
			WHERE SEQ_NO		=    ?
			AND	  FILE_SEQ		=    NVL(?, FILE_SEQ)
        ]]>
    </query>          
 </queryMap>    