<?xml version="1.0" encoding='EUC-KR'?>

<queryMap desc="rsm6040(분실신고서 온라인접수 저장)">
    
    <query id="rsm6040_s01" desc="분실신고서 온라인접수 목록 조회" fetchSize="10">
      <![CDATA[
          SELECT
		         MISS_REPO_NO
		        ,ACDNT_TY_CD 
		        ,REFUND_TY_CD 
		        ,RCPT_DT      
		        ,PUBL_DT
		        ,RCPT_STAT_CD 
		        ,BRNC_CD		               
		        ,PLC_NO       
		        ,RACE_NO	      
		        ,BUY_CNTNT    
		        ,REFR_DESC    
		        ,CUST_ID      
		        ,CUST_NM      
		        ,CUST_PHONE_NO
		        ,CUST_EMAIL
		        ,TIC_CNTNT    
		        ,PROC_ID      
		        ,PROC_DT
		        ,INST_ID      
		        ,TO_CHAR(INST_DT,'YYYY-MM-DD') INST_DT      
		        ,UPDT_ID      
		        ,UPDT_DT   
		        ,(SELECT USER_NM FROM TBRK_USER WHERE USER_ID = PROC_ID) AS PROC_NM
		        , ACC_BGN_CD
		  FROM  TBRD_STOPPAY_ONLINE    
		 WHERE  1=1   
		   AND  DECODE(?, '', '1', RCPT_STAT_CD) = DECODE(?, '', '1', ?)
		   /* AND  DECODE(?, '', '1', BRNC_CD)    	 = DECODE(?, '', '1', ?) */
		   AND  REGEXP_LIKE(DECODE(?, '', '1', BRNC_CD), DECODE(?, '', '1', ?))    
 		   AND  CUST_NM LIKE '%' || NVL(?,CUST_NM) || '%'
 		   ORDER BY TO_NUMBER(MISS_REPO_NO) DESC	
        ]]>
   </query>
   
   <query id="rsm6040_s02" desc="지불정지온라인 접수된 목록이 지불정지해지내역에 존재하는지 조회" fetchSize="10">
      <![CDATA[
          SELECT /* rsm6040_s02 */
          		 DECODE(COUNT(*), 0, 'Y', 'N') AS CANCEL_YN
		    FROM TBRD_STOPPAY_CNCL_CNTNT
		   WHERE 1=1
		     AND MISS_REPO_NO = ?
        ]]>
   </query>
   
   <query id="rsm6040_u01" desc="분실신고서 온라인접수 저장" fetchSize="10">
      <![CDATA[
      		UPDATE TBRD_STOPPAY_ONLINE
      			SET 
 
						ACDNT_TY_CD  	= ? 		-- 사고유형
					,	REFUND_TY_CD 	= ? 		-- 환급유형						 	    
					,	PUBL_DT      	= ?			-- 발행일자
					,	BRNC_CD      	= ?			-- 지점
					,	PLC_NO       	= ?			-- 창구
					,	RACE_NO      	= ?			-- 경주
					,	BUY_CNTNT    	= ?			-- 투표내용
					,	REFR_DESC		= ? 		-- 참고내용					
      				,	RCPT_STAT_CD 	= ?			-- 접수상태
      				,	TIC_CNTNT		= ?			-- 티켓내용
   					,	RCPT_DT			= ?			-- 접수일자
      				,	PROC_ID			= ?			-- 처리자
      				,	PROC_DT			= TO_CHAR(SYSDATE,'YYYYMMDD')	-- 처리일자      			
      				,	UPDT_ID 		= ?			-- 수정자
      				,	UPDT_DT			= SYSDATE	-- 수정일자      				
      		 WHERE 	MISS_REPO_NO = ?
      				
        ]]>
    </query>
</queryMap>