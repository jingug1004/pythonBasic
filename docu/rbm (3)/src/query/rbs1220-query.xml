<?xml version="1.0" encoding='EUC-KR'?>

<queryMap desc="RBS1220(예상 내역 관리)">

    <query id="rbs1220_s01" desc="예상지 업체 조회" fetchSize="10">
        <![CDATA[  
			SELECT   /* rbs1220_s01 */
			         MEET_CD					-- 경륜/경정 구분
			        ,YES_COM_SEQ				-- 예상지업체 고유번호
			        ,YES_COM_NM   				-- 예상지 업체명
			        ,ORDR_NO
			FROM     TBRS_YES_COM 
			WHERE    1=1
			AND      USE_YN = 'Y'		
			UNION ALL
			SELECT   '001',NULL,'전체',0 FROM DUAL
			UNION ALL
			SELECT   '003',NULL,'전체',0 FROM DUAL				
			ORDER BY 4	
        ]]>
    </query>       	
    
    <query id="rbs1220_s02" desc="경주 리스트 조회" fetchSize="10">
        <![CDATA[  
			SELECT /* rbs1220_s02 */
			       V.MEET_CD
		          ,V.STND_YEAR
		          ,V.TMS
		          ,V.DAY_ORD
		          ,V.RACE_DAY
		          ,NVL2(MAX(A.YESANG),'001','002') AS EXIST_YN
			FROM  VW_SDL_INFO V LEFT OUTER JOIN TBRS_YES_SANG A
			      ON     V.STND_YEAR = A.STND_YEAR
			         AND V.MEET_CD   = A.MEET_CD
			         AND V.TMS       = A.TMS
			         AND V.DAY_ORD   = A.DAY_ORD
			         AND NVL(A.YES_COM_SEQ,'%') LIKE ?||'%'
			WHERE 1=1
			AND   V.STND_YEAR   = ?
			AND   V.MEET_CD     = ? 
			GROUP BY V.MEET_CD, V.STND_YEAR, V.TMS, V.DAY_ORD, V.RACE_DAY 
			ORDER BY V.TMS DESC, V.DAY_ORD DESC		
        ]]>
    </query>       	
    
    <query id="rbs1220_s03" desc="예상내역 조회" fetchSize="10">
        <![CDATA[  
			SELECT /* rbs1220_s03 */
			       R.STND_YEAR
		          ,R.MEET_CD
		          ,R.TMS
		          ,R.DAY_ORD
		          ,R.RACE_NO
		          ,B.YES_COM_SEQ
		          ,B.YES_COM_NM
		          ,A.YESANG
		          ,B.ORDR_NO
			FROM  TBES_SDL_TM R --VW_RACE_INFO R 
			      LEFT JOIN TBRS_YES_COM B
			      ON     B.USE_YN    = 'Y'
			         AND NVL(B.YES_COM_SEQ,'%') LIKE ?||'%'
			      LEFT OUTER JOIN TBRS_YES_SANG A   
			      ON     R.STND_YEAR = A.STND_YEAR
			         AND R.MEET_CD   = A.MEET_CD
			         AND R.MEET_CD IN ('001','003')
			         AND R.TMS       = A.TMS
			         AND R.DAY_ORD   = A.DAY_ORD
			         AND R.RACE_NO   = A.RACE_NO
                     AND B.YES_COM_SEQ = A.YES_COM_SEQ
			WHERE R.STND_YEAR   = ?
			AND   R.MEET_CD     = ?
			AND   R.TMS         = ?
			AND   R.DAY_ORD     = ?			
			ORDER BY R.STND_YEAR, R.MEET_CD, R.TMS, R.DAY_ORD, B.ORDR_NO, R.RACE_NO		
        ]]>
    </query>       	
      

    <query id="rbs1220_u01" desc="예상내역 수정" fetchSize="10">
        <![CDATA[
			MERGE    INTO   /* rbs1220_u01 */
			         TBRS_YES_SANG DST			
			USING   (
			         SELECT  ? AS STND_YEAR		-- 1.기준년도
			                ,? AS MEET_CD		-- 2.경륜경정 구분
			                ,? AS TMS  	    	-- 3.회차
			                ,? AS DAY_ORD  	    -- 4.일차
			                ,? AS RACE_NO  	    -- 5.경주
			                ,? AS YES_COM_SEQ  	-- 6.예상지업체 고유번호
			                ,? AS YESANG  	    -- 7.예상내역
			                ,? AS USER_ID  	    -- 8.입력/수정자 사번
			         FROM    DUAL
			        ) SRC
			        ON (
			        		DST.STND_YEAR   = SRC.STND_YEAR
			            AND DST.MEET_CD     = SRC.MEET_CD
			            AND DST.TMS         = SRC.TMS
			            AND DST.DAY_ORD     = SRC.DAY_ORD
			            AND DST.RACE_NO     = SRC.RACE_NO
			            AND DST.YES_COM_SEQ = SRC.YES_COM_SEQ  
			        )
			        WHEN MATCHED THEN
			             UPDATE 
			             SET    DST.YESANG  = SRC.YESANG
			                   ,DST.UPDT_ID = SRC.USER_ID
			                   ,DST.UPDT_DT = SYSDATE
			        WHEN NOT MATCHED THEN
			             INSERT (
			                   STND_YEAR
			                  ,MEET_CD
			                  ,TMS
			                  ,DAY_ORD
			                  ,RACE_NO
			                  ,YES_COM_SEQ
			                  ,YESANG
			                  ,INST_ID
			                  ,INST_DT
			                 ) VALUES (
			                   SRC.STND_YEAR
			                  ,SRC.MEET_CD
			                  ,SRC.TMS
			                  ,SRC.DAY_ORD
			                  ,SRC.RACE_NO
			                  ,SRC.YES_COM_SEQ
			                  ,SRC.YESANG
			                  ,SRC.USER_ID
			                  ,SYSDATE
			                 )
        ]]>
    </query>

        
</queryMap>