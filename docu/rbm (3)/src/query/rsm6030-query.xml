<?xml version="1.0" encoding='EUC-KR'?>

<queryMap desc="rsm6030(TSN검증)">
    
    <query id="rsm6030_s01" desc="지불정지만존재 조회" fetchSize="10">
      <![CDATA[
	      	SELECT /* rsm6030_s01 */
	         		  '1' AS CHK	  	-- 체크박스	
			        , PUBL_DT       	-- 발행일자   
			        , TSN_NO           	-- TSN 번호
			        , PLC_NO           	-- 창구번호
			        , SALES_AMT        	-- 판매금액		
			        , STOPPAY_DT		-- 지불정지일자
			        , TIC_STAS         	-- 티켓상태
			        , TIC_CONT         	-- 티켓내용
			        , VERI_RSLT_CD     	-- 검증조치코드
			        , VERI_RSLT_DT		-- 검증조치일자
			        , BRNC_CD          	-- 지점
			        , COMM_NO	-- 지점 코드
			        , C.CD_NM AS BRNC_NM			-- 지점 이름
			        , DIV_NO           	-- 투표소번호
			        , TIC_TYPE_CD      	-- 티켓타입
			        , RACE_NO          	-- 경주번호		                  
			FROM
			(
	         SELECT 
	         		  '1' AS CHK	  	-- 체크박스	
			        , PUBL_DT       	-- 발행일자   
			        , TSN_NO           	-- TSN 번호
			        , PLC_NO           	-- 창구번호
			        , SALES_AMT        	-- 판매금액		
			        , STOPPAY_DT		-- 지불정지일자
			        , TIC_STAS         	-- 티켓상태
			        , TIC_CONT         	-- 티켓내용
			        , VERI_RSLT_CD     	-- 검증조치코드
			        , VERI_RSLT_DT		-- 검증조치일자
			        , BRNC_CD          	-- 지점
			        , CASE 
		                 WHEN BRNC_CD ='06' THEN '06'
		                 WHEN BRNC_CD < '11' THEN '00'
		                 ELSE BRNC_CD 
		              END AS COMM_NO	-- 지점 코드
			        , DIV_NO           	-- 투표소번호
			        , TIC_TYPE_CD      	-- 티켓타입
			        , RACE_NO          	-- 경주번호		                  
			FROM TBRD_STOPPAY_CNCL_CNTNT
			WHERE VERI_RSLT_CD 	= '001' 	-- 지불정지만 존재	
			  AND TSN_NO LIKE '%'  || NVL(?,TSN_NO) || '%'
			  AND VERI_RSLT_DT BETWEEN ? AND ? 	  		
			)A,
			(
				SELECT CD,CD_NM
				FROM 
				TBRK_SPEC_CD C
				WHERE  1=1    
				AND C.GRP_CD IN ('018')
			)C 
			WHERE 1=1
			AND A.BRNC_CD=C.CD(+)
			--AND DECODE(?, '', 1, COMM_NO) = DECODE(?, '' , 1, ?)
		    AND  REGEXP_LIKE (DECODE(?, '', '1',A.COMM_NO),DECODE(?,'','1',?) )           	 
        ]]>
   </query>
   
   <query id="rsm6030_s02" desc="DAS와 지불정지 존재 조회" fetchSize="10">
      <![CDATA[
      		SELECT /* rsm6030_s02 */ 
			     PUBL_DT       	-- 발행일자   
			    , TSN_NO           	-- TSN 번호
			    , PLC_NO           	-- 창구번호
			    , SALES_AMT        	-- 판매금액		
			    , STOPPAY_DT		-- 지불정지일자
			    , TIC_STAS         	-- 티켓상태
			    , TIC_CONT         	-- 티켓내용
			    , VERI_RSLT_CD     	-- 검증조치코드
			    , VERI_RSLT_DT		-- 검증조치일자
			    , BRNC_CD          	-- 지점
			    , COMM_NO			-- 지점 코드
			    , C.CD_NM AS BRNC_NM			-- 지점 이름
			    , DIV_NO           	-- 투표소번호
			    , TIC_TYPE_CD      	-- 티켓타입
			    , RACE_NO          	-- 경주번호		 
			FROM
			(            
		      	SELECT /* rsm6030_s02 */
				          PUBL_DT       	-- 발행일자   
				        , TSN_NO           	-- TSN 번호
				        , PLC_NO           	-- 창구번호
				        , SALES_AMT        	-- 판매금액		
				        , STOPPAY_DT		-- 지불정지일자
				        , TIC_STAS         	-- 티켓상태
				        , TIC_CONT         	-- 티켓내용
				        , VERI_RSLT_CD     	-- 검증조치코드
				        , VERI_RSLT_DT		-- 검증조치일자
				        , BRNC_CD          	-- 지점
				        , CASE 
			                 WHEN BRNC_CD ='06' THEN '06'
			                 WHEN BRNC_CD < '11' THEN '00'
			                 ELSE BRNC_CD 
			              END AS COMM_NO	-- 지점 코드
				        , DIV_NO           	-- 투표소번호
				        , TIC_TYPE_CD      	-- 티켓타입
				        , RACE_NO          	-- 경주번호		                  	                  
				FROM TBRD_STOPPAY_CNCL_CNTNT A
				WHERE   1=1  
				  AND VERI_RSLT_CD IN ('002','003')
				  AND VERI_RSLT_CD LIKE '%' || NVL(?,VERI_RSLT_CD) || '%'
				  AND TSN_NO LIKE '%' || NVL(?,TSN_NO) || '%'
				  AND VERI_RSLT_DT BETWEEN ? AND ?
			)A,
		  (
				SELECT CD,CD_NM
				FROM 
				TBRK_SPEC_CD C
				WHERE  1=1    
				AND C.GRP_CD IN ('018')
			)C 
			WHERE 1=1
			AND A.BRNC_CD=C.CD(+)
			--AND DECODE(?, '', 1, COMM_NO) = DECODE(?, '' , 1, ?)              
			AND  REGEXP_LIKE (DECODE(?, '', '1',A.COMM_NO),DECODE(?,'','1',?) )   
        ]]>
    </query>
   
   <query id="rsm6030_s02(X)" desc="DAS와 지불정지 존재 조회" fetchSize="10">
      <![CDATA[
	      	SELECT 
			          PUBL_DT       	-- 발행일자   
			        , TSN_NO           	-- TSN 번호
			        , PLC_NO           	-- 창구번호
			        , SALES_AMT        	-- 판매금액		
			        , STOPPAY_DT		-- 지불정지일자
			        , TIC_STAS         	-- 티켓상태
			        , TIC_CONT         	-- 티켓내용
			        , VERI_RSLT_CD     	-- 검증조치코드
			        , VERI_RSLT_DT		-- 검증조치일자
			        , BRNC_CD          	-- 지점
			        , DIV_NO           	-- 투표소번호
			        , TIC_TYPE_CD      	-- 티켓타입
			        , RACE_NO          	-- 경주번호		                  	                  
			FROM TBRD_STOPPAY_CNCL_CNTNT
			WHERE 1=1
			  AND VERI_RSLT_CD = ? 		-- 검증조치 
			  AND TSN_NO LIKE '%' || NVL(?,TSN_NO) || '%'
			  AND DECODE(?, '', 1, BRNC_CD) = DECODE(?, '' , 1, ?)	 
			  AND VERI_RSLT_DT BETWEEN ? AND ?
			  
        ]]>
    </query>
    
     <query id="rsm6030_d01" desc="지불정지존재만 삭제" fetchSize="10">
      <![CDATA[
	      	DELETE TBRD_STOPPAY_CNCL_CNTNT
			WHERE MISS_REPO_NO 	= ?
			  AND TSN_NO 	= ?
        ]]>
    </query>
    
</queryMap>