<?xml version="1.0" encoding='EUC-KR'?>

<queryMap desc="rem7030(지정좌석실 매출현황)">
  
    <query id="rem7030_s01" desc="지정좌석실 매출현황 조회" fetchSize="10">
      <![CDATA[
            WITH SEAT_NUM AS (	/*rem7030_s01*/--좌석수
				SELECT BRNC_CD COMM_NO, SEAT_NUM_NORMAL, SEAT_NUM_FIXED, SEAT_NUM_GREEN
				FROM TBRA_COMM_DESC
				WHERE 1=1
				AND BRNC_CD NOT IN ('29') --교차제외
				AND STND_YEAR = SUBSTR(?,0,4)
			),
			SALES_FIXED AS (	--지정좌석실 매출액
				SELECT
					RACE_DAY, COMM_NO,
					SUM(DECODE(WIN_TYPE,'1',AMT,'3',AMT,0)) CASH_AMT_FIXED,
					SUM(DECODE(WIN_TYPE,'14',AMT,0)) GREEN_AMT_FIXED
				FROM TBJI_PC_TELMP_FIXEDSEAT
				WHERE 1=1
				AND RACE_DAY BETWEEN ? AND ?
				AND GRN_ZN_CD IN ('002','003')
				GROUP BY RACE_DAY, COMM_NO
			)
			
			
			SELECT
				DECODE(COMM_NO, '98', '09', COMM_NO) ORD_NO,
				COMM_NO,
				FC_CODE_NM('018',COMM_NO) COMM_NM, 
				SEAT_NUM_FIXED,
				ROUND((CASH_AMT_FIXED_TOT+GREEN_AMT_FIXED_TOT)/SALES_DAY_CNT) AMT_FIXED_AVG,
				(CASH_AMT_FIXED_TOT+GREEN_AMT_FIXED_TOT) AMT_FIXED_TOT,
				SALES_DAY_CNT,
				
				CASH_AMT_FIXED_TOT,
				GREEN_AMT_FIXED_TOT,
				
				AMT_FIXED_WED,
				AMT_FIXED_THU,
				AMT_FIXED_FRI,
				AMT_FIXED_SAT,
				AMT_FIXED_SUN,
				
				CASH_AMT_FIXED_WED+GREEN_AMT_FIXED_WED TOT_AMT_FIXED_WED,
				CASH_AMT_FIXED_THU+GREEN_AMT_FIXED_THU TOT_AMT_FIXED_THU,
				CASH_AMT_FIXED_FRI+GREEN_AMT_FIXED_FRI TOT_AMT_FIXED_FRI,
				CASH_AMT_FIXED_SAT+GREEN_AMT_FIXED_SAT TOT_AMT_FIXED_SAT,
				CASH_AMT_FIXED_SUN+GREEN_AMT_FIXED_SUN TOT_AMT_FIXED_SUN,
				
				CASH_AMT_FIXED_WED,
				DECODE(AMT_FIXED_WED,0,0,ROUND(CASH_AMT_FIXED_WED/AMT_FIXED_WED*100,2)) CASH_AMT_FIXED_RATIO,
				CASH_AMT_FIXED_THU,
				DECODE(AMT_FIXED_THU,0,0,ROUND(CASH_AMT_FIXED_THU/AMT_FIXED_THU*100,2)) CASH_AMT_FIXED_THU_RATIO,
				CASH_AMT_FIXED_FRI,
				DECODE(AMT_FIXED_FRI,0,0,ROUND(CASH_AMT_FIXED_FRI/AMT_FIXED_FRI*100,2)) CASH_AMT_FIXED_FRI_RATIO,
				CASH_AMT_FIXED_SAT,
				DECODE(AMT_FIXED_SAT,0,0,ROUND(CASH_AMT_FIXED_SAT/AMT_FIXED_SAT*100,2)) CASH_AMT_FIXED_SAT_RATIO,
				CASH_AMT_FIXED_SUN,
				DECODE(AMT_FIXED_SUN,0,0,ROUND(CASH_AMT_FIXED_SUN/AMT_FIXED_SUN*100,2)) CASH_AMT_FIXED_SUN_RATIO,
			
				GREEN_AMT_FIXED_WED,
				DECODE(AMT_FIXED_WED,0,0,ROUND(GREEN_AMT_FIXED_WED/AMT_FIXED_WED*100,2)) GREEN_AMT_FIXED_WED_RATIO,
				GREEN_AMT_FIXED_THU,
				DECODE(AMT_FIXED_THU,0,0,ROUND(GREEN_AMT_FIXED_THU/AMT_FIXED_THU*100,2)) GREEN_AMT_FIXED_THU_RATIO,
				GREEN_AMT_FIXED_FRI,
				DECODE(AMT_FIXED_FRI,0,0,ROUND(GREEN_AMT_FIXED_FRI/AMT_FIXED_FRI*100,2)) GREEN_AMT_FIXED_FRI_RATIO,
				GREEN_AMT_FIXED_SAT,
				DECODE(AMT_FIXED_SAT,0,0,ROUND(GREEN_AMT_FIXED_SAT/AMT_FIXED_SAT*100,2)) GREEN_AMT_FIXED_SAT_RATIO,
				GREEN_AMT_FIXED_SUN,
				DECODE(AMT_FIXED_SUN,0,0,ROUND(GREEN_AMT_FIXED_SUN/AMT_FIXED_SUN*100,2)) GREEN_AMT_FIXED_SUN_RATIO
			
			FROM (
				SELECT T1.COMM_NO,
					MAX(SEAT_NUM_FIXED) SEAT_NUM_FIXED,
					NVL(SUM(CASH_AMT_FIXED),0.001) CASH_AMT_FIXED_TOT,
					NVL(SUM(DECODE(RACE_YOIL, 'WED', CASH_AMT_FIXED)),0) CASH_AMT_FIXED_WED,
					NVL(SUM(DECODE(RACE_YOIL, 'THU', CASH_AMT_FIXED)),0) CASH_AMT_FIXED_THU,
					NVL(SUM(DECODE(RACE_YOIL, 'FRI', CASH_AMT_FIXED)),0) CASH_AMT_FIXED_FRI,
					NVL(SUM(DECODE(RACE_YOIL, 'SAT', CASH_AMT_FIXED)),0) CASH_AMT_FIXED_SAT,
					NVL(SUM(DECODE(RACE_YOIL, 'SUN', CASH_AMT_FIXED)),0) CASH_AMT_FIXED_SUN,
			
					NVL(SUM(GREEN_AMT_FIXED),0) GREEN_AMT_FIXED_TOT,
					NVL(SUM(DECODE(RACE_YOIL, 'WED', GREEN_AMT_FIXED)),0) GREEN_AMT_FIXED_WED,
					NVL(SUM(DECODE(RACE_YOIL, 'THU', GREEN_AMT_FIXED)),0) GREEN_AMT_FIXED_THU,
					NVL(SUM(DECODE(RACE_YOIL, 'FRI', GREEN_AMT_FIXED)),0) GREEN_AMT_FIXED_FRI,
					NVL(SUM(DECODE(RACE_YOIL, 'SAT', GREEN_AMT_FIXED)),0) GREEN_AMT_FIXED_SAT,
					NVL(SUM(DECODE(RACE_YOIL, 'SUN', GREEN_AMT_FIXED)),0) GREEN_AMT_FIXED_SUN,
					
					NVL(SUM(DECODE(RACE_YOIL, 'WED', CASH_AMT_FIXED))
					+SUM(DECODE(RACE_YOIL, 'WED', GREEN_AMT_FIXED)),0) AMT_FIXED_WED,
					NVL(SUM(DECODE(RACE_YOIL, 'THU', CASH_AMT_FIXED))
					+SUM(DECODE(RACE_YOIL, 'THU', GREEN_AMT_FIXED)),0) AMT_FIXED_THU,
					NVL(SUM(DECODE(RACE_YOIL, 'FRI', CASH_AMT_FIXED))
					+SUM(DECODE(RACE_YOIL, 'FRI', GREEN_AMT_FIXED)),0) AMT_FIXED_FRI,
					NVL(SUM(DECODE(RACE_YOIL, 'SAT', CASH_AMT_FIXED))
					+SUM(DECODE(RACE_YOIL, 'SAT', GREEN_AMT_FIXED)),0) AMT_FIXED_SAT,
					NVL(SUM(DECODE(RACE_YOIL, 'SUN', CASH_AMT_FIXED))
					+SUM(DECODE(RACE_YOIL, 'SUN', GREEN_AMT_FIXED)),0) AMT_FIXED_SUN,
					SUM(DECODE(CASH_AMT_FIXED,0,0,1)) SALES_DAY_CNT
					
				FROM SEAT_NUM T1, SALES_FIXED T5, VW_SDL_INFO T6
				WHERE 1=1
				AND T6.RACE_DAY = T5.RACE_DAY
				AND T1.COMM_NO = T5.COMM_NO(+)
				AND T6.MEET_CD IN ('001','003')
				AND LENGTH(ROUND(TO_NUMBER(SUBSTR(T6.MEET_CD,3,1))/3,5)) =
					( CASE WHEN ?= '003' THEN 1 --경정
						   WHEN ?= '001' THEN 6 --경륜
						   ELSE LENGTH(ROUND(TO_NUMBER(SUBSTR(T6.MEET_CD,3,1))/3,5)) --전체
						   END
					)
				GROUP BY T1.COMM_NO
			)
			ORDER BY 1
        ]]>
    </query> 
    
</queryMap>