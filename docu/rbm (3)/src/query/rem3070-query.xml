<?xml version="1.0" encoding='EUC-KR'?>

<queryMap desc="rem3070(마감취소   관리)">
    <query id="rem3070_s01" desc="마감취소  조회" fetchSize="10">
      <![CDATA[
            SELECT /* rem3070_s01 */
                '0' AS CHK
                
				,A.RACE_DT        --경주일자
				,A.BRNC_CD        --지점코드
				,A.REQ_DT         --요청일자
				,A.REQ_RSN        --요청사유
				,A.MEET_CD        --경륜장코드
				,A.SEQ            --순번 
				
				,A.ATT_FILE_KEY   --첨부파일키				
				,A.PROC_DT        --처리일자
				,A.RMK            --비고
				
				,A.STAY_END_STAT_CD --마감상태
				
				,A.INST_ID        --작성자
				,A.INST_DT        --작성일시
				,A.UPDT_ID        --수정자
				,A.UPDT_DT        --수정일시

                ,B.FILE_NM        --첨부파일명
                ,B.FILE_PATH      --첨부파일경로 
                
                
                ,NVL((SELECT TMS FROM VW_SDL_INFO C
                            WHERE  C.RACE_DAY = A.RACE_DT
                                    AND  C.MEET_CD =A.MEET_CD),'') TMS  --회차 
                                    
            FROM  TBRC_STAY_END_MANA  A --체류인원마감관리
                 ,TBRK_FILE_MANA B      -- 첨부파일
            WHERE  A.ATT_FILE_KEY = B.ATT_FILE_KEY(+)
                 AND A.BRNC_CD LIKE  '%' || NVL(? , A.BRNC_CD) || '%'
                 AND A.MEET_CD LIKE  '%' || NVL(? , A.MEET_CD) || '%' 
                 
                 AND A.RACE_DT >= NVL(? , '19000101')
                 AND A.RACE_DT <= NVL(? , '99991231')
                 
                 AND A.STAY_END_STAT_CD LIKE  '%' || NVL(? , A.STAY_END_STAT_CD) || '%' 

             ORDER BY A.PROC_DT desc, A.REQ_DT DESC, A.RACE_DT DESC, A.BRNC_CD
  
        ]]>
    </query> 
    
  

    <query id="rem3070_u01" desc=" 마감취소 확인 (수정)" fetchSize="10">

        <![CDATA[
            UPDATE TBRC_STAY_END_MANA SET  /* rem3070_u01 */
            
                 PROC_DT        = TO_CHAR(SYSDATE,'YYYYMMDD')    --처리일자
                ,RMK            = ?          --비고
                ,STAY_END_STAT_CD  = ?       --마감상태
                ,UPDT_ID        = ?          --수정자
                ,UPDT_DT        = SYSDATE    --수정일시
                
           WHERE  RACE_DT = ?     --경주일자
                AND MEET_CD = ?   --구분
                AND BRNC_CD = ?   --지점코드
                AND SEQ = ?       --순번
                  
        ]]>

    </query> 
    
    
    <query id="rem3070_u02" desc=" 마감취소 확인(수정)" fetchSize="10">

        <![CDATA[
            UPDATE TBRC_STAY_MANA SET  /* rem3070_u02 */
            
                 END_REQ_DT     = TO_CHAR(SYSDATE,'YYYYMMDD')      --요청일자
                ,UPDT_ID        = ?          --수정자
                ,UPDT_DT        = SYSDATE    --수정일시
                
           WHERE  RACE_DT = ?     --경주일자
                AND MEET_CD = ?   --구분
                AND BRNC_CD = ?   --지점코드
                  
        ]]>

    </query>       


    <query id="rem3070_u03" desc=" 마감정보 수정 " fetchSize="10">

        <![CDATA[
            UPDATE TBRC_STAY_END_MANA SET  /* rem3070_u03 */
            
                 RMK            = ?          --비고
                ,UPDT_ID        = ?          --수정자
                ,UPDT_DT        = SYSDATE    --수정일시
                
           WHERE  RACE_DT = ?     --경주일자
                AND MEET_CD = ?   --구분
                AND BRNC_CD = ?   --지점코드
                AND SEQ = ?       --순번
                  
        ]]>

    </query> 
</queryMap>