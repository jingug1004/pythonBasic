<?xml version="1.0" encoding='EUC-KR'?>

<queryMap desc="REV4050(업무수행평가 세부내역 조회)">
	<query id="rev4050_s01" desc="업무수행평가 세부내역 조회" fetchSize="10">
		<![CDATA[
			SELECT /* rev4050_s01 */
                     A.DEPT_CD   
                    ,(SELECT DEPT_NM FROM TBRF_EV_DEPT WHERE ESTM_YEAR = A.ESTM_YEAR AND ESTM_NUM = A.ESTM_NUM AND DEPT_CD = A.DEPT_CD) AS DEPT_NM   
                    ,A.EMP_NO  
                    ,A.EMP_NM  
                    ,A.WK_JOB_CD 
                    ,(SELECT WK_JOB_NM FROM TBRF_EV_WORK_JOB WHERE ESTM_YEAR = A.ESTM_YEAR AND ESTM_NUM = A.ESTM_NUM AND WK_JOB_CD = A.WK_JOB_CD ) AS WK_JOB_NM 
                    ,A.ESTM_DEPT   
                    ,(SELECT DEPT_NM FROM TBRF_EV_DEPT WHERE ESTM_YEAR = A.ESTM_YEAR AND ESTM_NUM = A.ESTM_NUM AND DEPT_CD = A.ESTM_DEPT) AS ESTM_DEPT_NM  
                    ,(B.FST_ESTM_SCR + B.SND_ESTM_SCR) AS PRM_SCR 
                    ,NVL(B.FST_ESTM_SCR, 0) AS FST_ESTM_SCR  
                    ,NVL(B.SND_ESTM_SCR, 0) AS SND_ESTM_SCR  
                    ,NVL(B.FST_RELEA_RSLT, 0) AS FST_RELEA_RSLT  
              FROM  TBRF_EV_EMP A   
                   ,TBRF_EV_WK_PRM B   
             WHERE 1 = 1     
               AND A.ESTM_YEAR = B.ESTM_YEAR   
               AND A.ESTM_NUM  = B.ESTM_NUM   
               AND A.ESTM_DEPT = B.ESTM_DEPT   
               AND A.EMP_NO    = B.EMP_NO     
		       AND A.ESTM_YEAR = ?
		       AND A.ESTM_NUM  = ? 
		       AND DECODE(?, '', '1', A.DEPT_CD  ) = DECODE(?, '', '1', ?) 
		       AND DECODE(?, '', '1', A.WK_JOB_CD) = DECODE(?, '', '1', ?)  
		       AND A.EMP_NM LIKE '%' || NVL(?, A.EMP_NM) || '%' 
		  ORDER BY A.DEPT_CD, A.WK_JOB_CD, A.EMP_NO 
        ]]>
	</query>
	
	<query id="rev4050_s02" desc="근무태도 평가 세부내역 조회" fetchSize="10">
		<![CDATA[
			SELECT /* rev4050_s02 */
                     A.DEPT_CD   
                    ,(SELECT DEPT_NM FROM TBRF_EV_DEPT WHERE ESTM_YEAR = A.ESTM_YEAR AND ESTM_NUM = A.ESTM_NUM AND DEPT_CD = A.DEPT_CD) AS DEPT_NM   
                    ,A.EMP_NO  
                    ,A.EMP_NM  
                    ,A.WK_JOB_CD 
                    ,(SELECT WK_JOB_NM FROM TBRF_EV_WORK_JOB WHERE ESTM_YEAR = A.ESTM_YEAR AND ESTM_NUM = A.ESTM_NUM AND WK_JOB_CD = A.WK_JOB_CD ) AS WK_JOB_NM 
                    ,A.ESTM_DEPT   
                    ,(SELECT DEPT_NM FROM TBRF_EV_DEPT WHERE ESTM_YEAR = A.ESTM_YEAR AND ESTM_NUM = A.ESTM_NUM AND DEPT_CD = A.ESTM_DEPT) AS ESTM_DEPT_NM  
                    ,(NVL(B.ESTM_SCR, 0) + NVL(P.FST_RELEA_RSLT, 0)) AS MNR_SCR                     
                    ,NVL(P.FST_RELEA_RSLT, 0) AS FST_RELEA_RSLT 
                    ,NVL(B.ESTM_SCR, 0) AS ESTM_SCR  
              FROM  TBRF_EV_EMP A   
                   ,TBRF_EV_WK_MNR B  
                   ,TBRF_EV_WK_PRM P 
             WHERE 1 = 1    
               AND A.ESTM_YEAR = B.ESTM_YEAR   
               AND A.ESTM_NUM  = B.ESTM_NUM   
               AND A.ESTM_DEPT = B.ESTM_DEPT   
               AND A.EMP_NO    = B.EMP_NO                    
               AND A.ESTM_YEAR = P.ESTM_YEAR   
               AND A.ESTM_NUM  = P.ESTM_NUM   
               AND A.ESTM_DEPT = P.ESTM_DEPT   
               AND A.EMP_NO    = P.EMP_NO  
		       AND A.ESTM_YEAR = ?
		       AND A.ESTM_NUM  = ? 
		       AND DECODE(?, '', '1', A.DEPT_CD  ) = DECODE(?, '', '1', ?) 
		       AND DECODE(?, '', '1', A.WK_JOB_CD) = DECODE(?, '', '1', ?)  
		       AND A.EMP_NM LIKE '%' || NVL(?, A.EMP_NM) || '%' 
		  ORDER BY A.DEPT_CD, A.WK_JOB_CD, A.EMP_NO 
        ]]>
	</query>
	
	<query id="rev4050_s03" desc="서비스 평가 세부내역 조회" fetchSize="10">
		<![CDATA[
			SELECT /* rev4050_s03 */
                     A.DEPT_CD   
                    ,(SELECT DEPT_NM FROM TBRF_EV_DEPT WHERE ESTM_YEAR = A.ESTM_YEAR AND ESTM_NUM = A.ESTM_NUM AND DEPT_CD = A.DEPT_CD) AS DEPT_NM   
                    ,A.EMP_NO  
                    ,A.EMP_NM  
                    ,A.WK_JOB_CD 
                    ,(SELECT WK_JOB_NM FROM TBRF_EV_WORK_JOB WHERE ESTM_YEAR = A.ESTM_YEAR AND ESTM_NUM = A.ESTM_NUM AND WK_JOB_CD = A.WK_JOB_CD ) AS WK_JOB_NM 
                    ,A.ESTM_DEPT   
                    ,(SELECT DEPT_NM FROM TBRF_EV_DEPT WHERE ESTM_YEAR = A.ESTM_YEAR AND ESTM_NUM = A.ESTM_NUM AND DEPT_CD = A.ESTM_DEPT) AS ESTM_DEPT_NM  
                    ,(NVL(B.ESTM_SCR,0) + NVL(B.KCSI_ESTM_SCR,0)) AS SRV_SCR
                    ,NVL(B.KCSI_ESTM_SCR,0) AS KCSI_ESTM_SCR 
                    ,NVL(B.ESTM_SCR, 0) AS ESTM_SCR  
              FROM  TBRF_EV_EMP A   
                   ,TBRF_EV_WK_SRV B   
             WHERE 1 = 1   
               AND A.ESTM_YEAR = B.ESTM_YEAR   
               AND A.ESTM_NUM  = B.ESTM_NUM   
               AND A.ESTM_DEPT = B.ESTM_DEPT   
               AND A.EMP_NO    = B.EMP_NO     
		       AND A.ESTM_YEAR = ?
		       AND A.ESTM_NUM  = ? 
		       AND DECODE(?, '', '1', A.DEPT_CD  ) = DECODE(?, '', '1', ?) 
		       AND DECODE(?, '', '1', A.WK_JOB_CD) = DECODE(?, '', '1', ?)  
		       AND A.EMP_NM LIKE '%' || NVL(?, A.EMP_NM) || '%' 
		  ORDER BY A.DEPT_CD, A.WK_JOB_CD, A.EMP_NO 
        ]]>
	</query>
	
	<query id="rev4050_s04" desc="다면평가 세부내역 조회" fetchSize="10">
		<![CDATA[
			SELECT /* rev4050_s04 */
		             A.DEPT_CD   
		            ,(SELECT DEPT_NM FROM TBRF_EV_DEPT WHERE ESTM_YEAR = A.ESTM_YEAR AND ESTM_NUM = A.ESTM_NUM AND DEPT_CD = A.DEPT_CD) AS DEPT_NM   
		            ,A.EMP_NO  
		            ,A.EMP_NM  
		            ,A.WK_JOB_CD 
		            ,(SELECT WK_JOB_NM FROM TBRF_EV_WORK_JOB WHERE ESTM_YEAR = A.ESTM_YEAR AND ESTM_NUM = A.ESTM_NUM AND WK_JOB_CD = A.WK_JOB_CD ) AS WK_JOB_NM 
		            ,A.ESTM_DEPT   
		            ,(SELECT DEPT_NM FROM TBRF_EV_DEPT WHERE ESTM_YEAR = A.ESTM_YEAR AND ESTM_NUM = A.ESTM_NUM AND DEPT_CD = A.ESTM_DEPT) AS ESTM_DEPT_NM  
		            ,R.MULT_SCR 
		            ,MULT_ESTM_1
		            ,MULT_ESTM_2
		            ,MULT_ESTM_3
		            ,MULT_ESTM_4
		            ,MULT_ESTM_5
		            ,MULT_ESTM_6
		            ,MULT_ESTM_7
		            ,MULT_ESTM_8
		            ,MULT_ESTM_9
		            ,ESTM_CNT
		            ,ESTM_EXPT_CNT
		            ,B.MULT_ESTM_GRP
		    FROM  TBRF_EV_EMP A   
		         ,TBRF_EV_TOTAL_RSLT R
		         ,(
		            SELECT ESTM_YEAR
		                       ,ESTM_NUM
		                       ,ESTM_DEPT
		                       ,EMP_NO
		                       ,SUM(DECODE(RNUM, 1, ESTM_SCR)) MULT_ESTM_1
		                       ,SUM(DECODE(RNUM, 2, ESTM_SCR)) MULT_ESTM_2
		                       ,SUM(DECODE(RNUM, 3, ESTM_SCR)) MULT_ESTM_3
		                       ,SUM(DECODE(RNUM, 4, ESTM_SCR)) MULT_ESTM_4
		                       ,SUM(DECODE(RNUM, 5, ESTM_SCR)) MULT_ESTM_5
		                       ,SUM(DECODE(RNUM, 6, ESTM_SCR)) MULT_ESTM_6
		                       ,SUM(DECODE(RNUM, 7, ESTM_SCR)) MULT_ESTM_7
		                       ,SUM(DECODE(RNUM, 8, ESTM_SCR)) MULT_ESTM_8
		                       ,SUM(DECODE(RNUM, 9, ESTM_SCR)) MULT_ESTM_9
		                       ,COUNT(*) ESTM_CNT
		                       ,SUM(CASE WHEN EXPT_YN = 'Y' THEN 1 ELSE 0 END) ESTM_EXPT_CNT
		                       ,MULT_ESTM_GRP
		            FROM (           
		                        SELECT ESTM_YEAR
		                                   ,ESTM_NUM
		                                   ,ESTM_DEPT
		                                   ,ESTM_EMP
		                                   ,EMP_NO
		                                   ,ESTM_SCR
		                                   ,MULT_ESTM_GRP
		                                   ,NVL(EXPT_YN,'N') AS EXPT_YN
		                                   ,ROW_NUMBER() OVER(PARTITION BY ESTM_YEAR, ESTM_NUM, MULT_ESTM_GRP, ESTM_DEPT, EMP_NO  
		                                                                     ORDER BY  ESTM_YEAR, ESTM_NUM, MULT_ESTM_GRP, ESTM_DEPT, EMP_NO, ESTM_EMP, ESTM_SCR) RNUM
		                        FROM  TBRF_EV_WK_MULT            
		                        WHERE MULT_ESTM_GRP <> '0'
		                        )
		            GROUP BY ESTM_YEAR
		                       ,ESTM_NUM
		                       ,ESTM_DEPT
		                       ,EMP_NO
		                       ,MULT_ESTM_GRP
		            )  B   
		             WHERE 1 = 1   
		               AND A.ESTM_YEAR = R.ESTM_YEAR(+)   
		               AND A.ESTM_NUM  = R.ESTM_NUM(+)   
		               AND A.EMP_NO    = R.EMP_NO(+)   
		               AND A.ESTM_YEAR = B.ESTM_YEAR   
		               AND A.ESTM_NUM  = B.ESTM_NUM   
		               AND A.ESTM_DEPT = B.ESTM_DEPT   
		               AND A.EMP_NO    = B.EMP_NO     
				       AND A.ESTM_YEAR = ?
				       AND A.ESTM_NUM  = ? 
				       AND DECODE(?, '', '1', A.DEPT_CD  ) = DECODE(?, '', '1', ?) 
				       AND DECODE(?, '', '1', A.WK_JOB_CD) = DECODE(?, '', '1', ?)  
				       AND A.EMP_NM LIKE '%' || NVL(?, A.EMP_NM) || '%' 
		        ORDER BY A.DEPT_CD, A.WK_JOB_CD, A.EMP_NO                            
        ]]>
	</query>
	
	<query id="rev4050_s05" desc="전체 평가 세부내역 조회" fetchSize="10">
		<![CDATA[
			SELECT /* rev4050_s05 */
		             A.DEPT_CD   
		            ,(SELECT DEPT_NM FROM TBRF_EV_DEPT WHERE ESTM_YEAR = A.ESTM_YEAR AND ESTM_NUM = A.ESTM_NUM AND DEPT_CD = A.DEPT_CD) AS DEPT_NM   
		            ,A.EMP_NO  
		            ,A.EMP_NM  
		            ,A.WK_JOB_CD 
		            ,(SELECT WK_JOB_NM FROM TBRF_EV_WORK_JOB WHERE ESTM_YEAR = A.ESTM_YEAR AND ESTM_NUM = A.ESTM_NUM AND WK_JOB_CD = A.WK_JOB_CD ) AS WK_JOB_NM 
		            ,A.ESTM_DEPT   
		            ,(SELECT DEPT_NM FROM TBRF_EV_DEPT WHERE ESTM_YEAR = A.ESTM_YEAR AND ESTM_NUM = A.ESTM_NUM AND DEPT_CD = A.ESTM_DEPT) AS ESTM_DEPT_NM  
		            ,R.MULT_SCR 
		            ,(NVL(B1.FST_ESTM_SCR,0) + NVL(B1.SND_ESTM_SCR,0) + NVL(B2.ESTM_SCR,0) + NVL(B1.FST_RELEA_RSLT,0) + NVL(B3.ESTM_SCR,0) + NVL(B3.KCSI_ESTM_SCR,0) + R.MULT_SCR) AS TOT_SCR 
		            ,R.CNTR_ITM_CD 
		            ,R.CNTR_ITM_NM 
		            ,R.TOT_GRD 
		            ,CASE WHEN A0.CNT = 1 THEN 100 
		                  WHEN A0.CNT = 2 AND A.CO_WRK_GBN = '001' THEN M.CRA_RATE
		                  WHEN A0.CNT = 2 AND A.CO_WRK_GBN = '002' THEN M.MRA_RATE END AS ESTM_RATIO
		            ,NVL(B1.FST_ESTM_SCR, 0) AS PRM_FST_SCR  
		            ,NVL(B1.SND_ESTM_SCR, 0) AS PRM_SND_SCR  
		            ,CASE WHEN B1.ESTM_YEAR >= '2013' THEN 0 ELSE NVL(B1.FST_RELEA_RSLT, 0) END AS FST_RELEA_RSLT1  
		            ,(NVL(B1.FST_ESTM_SCR,0) + NVL(B1.SND_ESTM_SCR,0)+(CASE WHEN B1.ESTM_YEAR >= '2013' THEN 0 ELSE NVL(B1.FST_RELEA_RSLT, 0) END)) AS PRM_SCR_SUM 
		            ,NVL(B2.ESTM_SCR, 0) AS MNR_SCR  
		            ,CASE WHEN B1.ESTM_YEAR >= '2013' THEN NVL(B1.FST_RELEA_RSLT, 0) ELSE 0 END AS FST_RELEA_RSLT2  
		            ,(NVL(B2.ESTM_SCR,0) + CASE WHEN B1.ESTM_YEAR >= '2013' THEN NVL(B1.FST_RELEA_RSLT, 0) ELSE 0 END)   AS MNR_SCR_SUM 
		            ,NVL(B3.ESTM_SCR, 0) AS SRV_SCR 
		            ,NVL(B3.KCSI_ESTM_SCR, 0) AS KCSI_ESTM_SCR 
		            ,(NVL(B3.ESTM_SCR,0) + NVL(B3.KCSI_ESTM_SCR, 0))   AS SRV_SCR_SUM 
		            ,B4.MULT_ESTM_1
		            ,B4.MULT_ESTM_2
		            ,B4.MULT_ESTM_3
		            ,B4.MULT_ESTM_4
		            ,B4.MULT_ESTM_5
		            ,B4.MULT_ESTM_6
		            ,B4.MULT_ESTM_7
		            ,B4.MULT_ESTM_8
		            ,B4.MULT_ESTM_9
		            ,B4.ESTM_CNT
		            ,B4.ESTM_EXPT_CNT
		            ,B4.MULT_ESTM_GRP
			FROM  TBRF_EV_EMP A  
			     ,(SELECT EMP_NO, COUNT(*) AS CNT  
				   FROM   TBRF_EV_EMP  
				   WHERE  1 = 1  
					AND   ESTM_YEAR = ?
					AND   ESTM_NUM  = ? 
					AND   PERM_TEMP_GBN = '002'  
					AND   ESTM_ESC_GBN = 'Y'  
					GROUP BY EMP_NO) A0
                 ,TBRF_EV_MASTER M 
		         ,TBRF_EV_TOTAL_RSLT R
		         ,TBRF_EV_WK_PRM B1
		         ,TBRF_EV_WK_MNR B2
		         ,TBRF_EV_WK_SRV B3
		         ,(
		            SELECT ESTM_YEAR
		                       ,ESTM_NUM
		                       ,ESTM_DEPT
		                       ,EMP_NO
		                       ,SUM(DECODE(RNUM, 1, ESTM_SCR)) MULT_ESTM_1
		                       ,SUM(DECODE(RNUM, 2, ESTM_SCR)) MULT_ESTM_2
		                       ,SUM(DECODE(RNUM, 3, ESTM_SCR)) MULT_ESTM_3
		                       ,SUM(DECODE(RNUM, 4, ESTM_SCR)) MULT_ESTM_4
		                       ,SUM(DECODE(RNUM, 5, ESTM_SCR)) MULT_ESTM_5
		                       ,SUM(DECODE(RNUM, 6, ESTM_SCR)) MULT_ESTM_6
		                       ,SUM(DECODE(RNUM, 7, ESTM_SCR)) MULT_ESTM_7
		                       ,SUM(DECODE(RNUM, 8, ESTM_SCR)) MULT_ESTM_8
		                       ,SUM(DECODE(RNUM, 9, ESTM_SCR)) MULT_ESTM_9
		                       ,COUNT(*) ESTM_CNT
		                       ,SUM(CASE WHEN EXPT_YN = 'Y' THEN 1 ELSE 0 END) ESTM_EXPT_CNT
		                       ,MULT_ESTM_GRP
		            FROM (           
		                        SELECT ESTM_YEAR
		                                   ,ESTM_NUM
		                                   ,ESTM_DEPT
		                                   ,ESTM_EMP
		                                   ,EMP_NO
		                                   ,ESTM_SCR
		                                   ,MULT_ESTM_GRP
		                                   ,NVL(EXPT_YN,'N') AS EXPT_YN
		                                   ,ROW_NUMBER() OVER(PARTITION BY ESTM_YEAR, ESTM_NUM, MULT_ESTM_GRP, ESTM_DEPT, EMP_NO  
		                                                                     ORDER BY  ESTM_YEAR, ESTM_NUM, MULT_ESTM_GRP, ESTM_DEPT, EMP_NO, ESTM_EMP, ESTM_SCR) RNUM
		                        FROM  TBRF_EV_WK_MULT            
		                        WHERE MULT_ESTM_GRP <> '0'
		                        )
		            GROUP BY ESTM_YEAR
		                       ,ESTM_NUM
		                       ,ESTM_DEPT
		                       ,EMP_NO
		                       ,MULT_ESTM_GRP
		            )  B4   
		             WHERE 1 = 1   
		               AND A.EMP_NO    = A0.EMP_NO
		               AND A.ESTM_YEAR = M.ESTM_YEAR   
		               AND A.ESTM_NUM  = M.ESTM_NUM   
		               AND A.ESTM_YEAR = R.ESTM_YEAR(+)   
		               AND A.ESTM_NUM  = R.ESTM_NUM(+)   
		               AND A.EMP_NO      = R.EMP_NO(+)   
		               AND A.ESTM_YEAR = B1.ESTM_YEAR   
		               AND A.ESTM_NUM  = B1.ESTM_NUM   
		               AND A.ESTM_DEPT = B1.ESTM_DEPT   
		               AND A.EMP_NO       = B1.EMP_NO     
		               AND A.ESTM_YEAR = B2.ESTM_YEAR(+)   
		               AND A.ESTM_NUM  = B2.ESTM_NUM(+)   
		               AND A.ESTM_DEPT = B2.ESTM_DEPT(+)   
		               AND A.EMP_NO      = B2.EMP_NO(+)  
		               AND A.ESTM_YEAR = B3.ESTM_YEAR(+)   
		               AND A.ESTM_NUM  = B3.ESTM_NUM(+)   
		               AND A.ESTM_DEPT = B3.ESTM_DEPT(+)   
		               AND A.EMP_NO      = B3.EMP_NO(+)  
		               AND A.ESTM_YEAR = B4.ESTM_YEAR(+)   
		               AND A.ESTM_NUM  = B4.ESTM_NUM(+)   
		               AND A.ESTM_DEPT = B4.ESTM_DEPT(+)   
		               AND A.EMP_NO     = B4.EMP_NO(+)  
				       AND A.ESTM_YEAR = ?
				       AND A.ESTM_NUM  = ? 
				       AND A.DEPT_CD   LIKE ?||'%' 
				       AND A.WK_JOB_CD LIKE ?||'%'
				       AND A.EMP_NM LIKE '%' || ? || '%' 
				  ORDER BY A.DEPT_CD, A.WK_JOB_CD, A.EMP_NO 
        ]]>
	</query>
	
</queryMap>