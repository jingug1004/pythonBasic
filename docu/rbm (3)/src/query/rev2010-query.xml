<?xml version="1.0" encoding='EUC-KR'?>

<queryMap desc="REV2010(업무수행평가)">
    
    <query id="rev2010_s01" desc="투표소장 배분표 인원수 조회" fetchSize="10">
        <![CDATA[		
        	SELECT   /* rev2010_s01 */ 
			         C.ESTM_LITEM_TYPE
			        ,COUNT(DISTINCT A.EMP_NO) AS EMP_CNT
			FROM     TBRF_EV_EMP A
		           , TBRF_EV_WK_PRM_DT B
		           , TBRF_EV_LARGE_ITEM C
			WHERE    1 = 1
            AND      A.ESTM_YEAR = B.ESTM_YEAR
            AND      A.ESTM_NUM = B.ESTM_NUM
            AND      A.ESTM_DEPT = B.ESTM_DEPT
            AND      A.EMP_NO = B.EMP_NO
            AND      B.ESTM_YEAR = C.ESTM_YEAR
            AND      B.ESTM_NUM = C.ESTM_NUM
            AND      B.ESTM_LITEM_CD = C.ESTM_LITEM_CD
            AND      B.ESTM_YEAR     = ?
            AND      B.ESTM_NUM      = ?
            AND      B.ESTM_DEPT       = ?
            AND      B.ESTM_EMP        = ?
            AND      A.PERM_TEMP_GBN = '002'
            AND      A.ESTM_ESC_GBN    = 'Y' 
            AND      C.ESTM_ITEM_CD = '1'
			GROUP BY C.ESTM_LITEM_TYPE
        ]]>
    </query>
    
    <query id="rev2010_s011" desc="2차평가자의 배분표인원수 조회(계약직 전체를 가져옴)" fetchSize="10">
        <![CDATA[		
        	SELECT   /* rev2010_s011 */ 
			         C.ESTM_LITEM_TYPE
			        ,COUNT(DISTINCT A.EMP_NO) AS EMP_CNT
			FROM     TBRF_EV_EMP A
		           , TBRF_EV_WK_PRM_DT B
		           , TBRF_EV_LARGE_ITEM C
			WHERE    1 = 1
            AND      A.ESTM_YEAR = B.ESTM_YEAR
            AND      A.ESTM_NUM = B.ESTM_NUM
            AND      A.ESTM_DEPT = B.ESTM_DEPT
            AND      A.EMP_NO = B.EMP_NO
            AND      B.ESTM_YEAR = C.ESTM_YEAR
            AND      B.ESTM_NUM = C.ESTM_NUM
            AND      B.ESTM_LITEM_CD = C.ESTM_LITEM_CD
            AND      A.ESTM_YEAR = ?
            AND      A.ESTM_NUM = ?
            AND      A.ESTM_DEPT = ?
            AND      A.PERM_TEMP_GBN = '002' 
            AND      A.ESTM_ESC_GBN = 'Y'
            AND      C.ESTM_ITEM_CD = '1'
			GROUP BY C.ESTM_LITEM_TYPE
        ]]>
    </query>
    
    <query id="rev2010_s012" desc="1차 평가자의 배분표 조회(매점평가자)" fetchSize="10">
        <![CDATA[		
        	SELECT   /* rev2010_s012 */ 
			         C.ESTM_LITEM_TYPE
			        ,COUNT(DISTINCT A.EMP_NO) AS EMP_CNT
			FROM     TBRF_EV_EMP A
		           , TBRF_EV_WK_PRM_DT B
		           , TBRF_EV_LARGE_ITEM C
			WHERE    1 = 1
            AND      A.ESTM_YEAR = B.ESTM_YEAR
            AND      A.ESTM_NUM = B.ESTM_NUM
            AND      A.ESTM_DEPT = B.ESTM_DEPT
            AND      A.EMP_NO = B.EMP_NO
            AND      B.ESTM_YEAR = C.ESTM_YEAR
            AND      B.ESTM_NUM = C.ESTM_NUM
            AND      B.ESTM_LITEM_CD = C.ESTM_LITEM_CD
            AND      A.ESTM_YEAR = ?
            AND      A.ESTM_NUM = ?
            AND      A.ESTM_DEPT = ?
            AND      A.ESTM_WK_JOB NOT IN ('1003', '1006')
            AND      A.ESTM_WK_JOB = '5007'
            AND      A.PERM_TEMP_GBN = '002' 
            AND      A.ESTM_ESC_GBN = 'Y'
            AND      C.ESTM_ITEM_CD = '1'
			GROUP BY C.ESTM_LITEM_TYPE
            
        ]]>
    </query>
    
    <query id="rev2010_s013" desc="1차 평가자의 배분표 조회(매점제외평가자)" fetchSize="10">
        <![CDATA[		
        	SELECT   /* rev2010_s013 */ 
			         C.ESTM_LITEM_TYPE
			        ,COUNT(DISTINCT A.EMP_NO) AS EMP_CNT
			FROM     TBRF_EV_EMP A
		           , TBRF_EV_WK_PRM_DT B
		           , TBRF_EV_LARGE_ITEM C
			WHERE    1 = 1
            AND      A.ESTM_YEAR = B.ESTM_YEAR
            AND      A.ESTM_NUM = B.ESTM_NUM
            AND      A.ESTM_DEPT = B.ESTM_DEPT
            AND      A.EMP_NO = B.EMP_NO
            AND      B.ESTM_YEAR = C.ESTM_YEAR
            AND      B.ESTM_NUM = C.ESTM_NUM
            AND      B.ESTM_LITEM_CD = C.ESTM_LITEM_CD
            AND      A.ESTM_YEAR = ?
            AND      A.ESTM_NUM = ?
            AND      A.ESTM_DEPT = ?
            AND      A.ESTM_WK_JOB NOT IN ('1003', '1006', '5007')
            AND      A.PERM_TEMP_GBN = '002' 
            AND      A.ESTM_ESC_GBN = 'Y'
            AND      C.ESTM_ITEM_CD = '1'
			GROUP BY C.ESTM_LITEM_TYPE
            
        ]]>
    </query>
    
	
    <query id="rev2010_s04" desc="전체 발매실적 조회" fetchSize="10">
        <![CDATA[		
        	SELECT   /* rev2010_s04 */
					COUNT(*) AS EMP_CNT
			FROM TBRF_EV_EMP A, TBRF_EV_RELEA_RSLT B
			WHERE 1 = 1
			AND A.ESTM_YEAR = B.ESTM_YEAR(+)
			AND A.ESTM_NUM  = B.ESTM_NUM(+)
			AND A.ESTM_DEPT = B.DEPT_CD(+)
			AND A.EMP_NO    = B.EMP_NO(+)
			AND A.ESTM_WK_JOB = '1003'	-- 발매원
			AND A.ESTM_YEAR = ?     --1. 평가년도
			AND A.ESTM_NUM  = ?		--2. 평가회차
			AND A.ESTM_DEPT 	= ? 	--3. 평가부서
			AND A.PERM_TEMP_GBN = '002'
			AND A.ESTM_ESC_GBN = 'Y'
        ]]>
    </query>

	<query id="rev2010_s02" desc="년도-회차 조회 " fetchSize="10">
        <![CDATA[
			SELECT   /* rev2010_s02 */
					 ESTM_YEAR,
					 ESTM_NUM,
					 ESTM_STR_DT,
			         ESTM_END_DT
			FROM     TBRF_EV_MASTER
			WHERE    1 = 1 
			AND      INST_DT = (SELECT MAX(INST_DT) 
			                    FROM   TBRF_EV_MASTER
	                   			)
        ]]>
    </query>
    
    <query id="rev2010_s03" desc="배분표  조회 " fetchSize="10">
        <![CDATA[
        	SELECT   /* rev2010_s03 */
        	         '0' AS CHK,
        	         ESTM_YEAR,
					 ESTM_NUM,
					 DISTR_CD,
					 ESTM_OBJ_NUM,
					 S_GRD_NUM,
					 A_GRD_NUM,
					 B_GRD_NUM,
					 C_GRD_NUM,
                     D_GRD_NUM
            FROM     TBRF_EV_DISTR
            WHERE    1 = 1
            AND      ESTM_YEAR = ?
            AND      ESTM_NUM = ?
            AND      ESTM_OBJ_NUM = ?
            ORDER BY DISTR_CD
        ]]>
    </query>
	
	<query id="rev2010_s06" desc="1차 평가자 업무수행평가 조회 " fetchSize="10">
        <![CDATA[
        SELECT /* rev2010_s06 */
                ESTM_YEAR
               ,ESTM_NUM
               ,EMP_NO 
               ,EMP_NM
               ,ESTM_WK_JOB 
               ,ESTM_WK_NM 
               ,MAX(ESTM_LITEM_CD_1) AS ESTM_LITEM_CD_1 
               ,MAX(ESTM_LITEM_NM_1) AS ESTM_LITEM_NM_1 
               ,MAX(S_GRD_1) AS S_GRD_1 
               ,MAX(A_GRD_1) AS A_GRD_1 
               ,MAX(B_GRD_1) AS B_GRD_1 
               ,MAX(C_GRD_1) AS C_GRD_1 
               ,MAX(D_GRD_1) AS D_GRD_1 
               ,MAX(RATE_1) AS RATE_1 
               ,MAX(ESTM_LITEM_CD_2) AS ESTM_LITEM_CD_2 
               ,MAX(ESTM_LITEM_NM_2) AS ESTM_LITEM_NM_2 
               ,MAX(S_GRD_2) AS S_GRD_2 
               ,MAX(A_GRD_2) AS A_GRD_2 
               ,MAX(B_GRD_2) AS B_GRD_2 
               ,MAX(C_GRD_2) AS C_GRD_2 
               ,MAX(D_GRD_2) AS D_GRD_2 
               ,MAX(RATE_2) AS RATE_2 
               ,MAX(ESTM_LITEM_CD_3) AS  ESTM_LITEM_CD_3 
               ,MAX(ESTM_LITEM_NM_3) AS ESTM_LITEM_NM_3 
               ,MAX(S_GRD_3) AS S_GRD_3 
               ,MAX(A_GRD_3) AS A_GRD_3 
               ,MAX(B_GRD_3) AS B_GRD_3 
               ,MAX(C_GRD_3) AS C_GRD_3 
               ,MAX(D_GRD_3) AS D_GRD_3 
               ,MAX(RATE_3) AS RATE_3 
               ,MAX(ESTM_LITEM_CD_4) AS ESTM_LITEM_CD_4 
               ,MAX(ESTM_LITEM_NM_4) AS ESTM_LITEM_NM_4 
               ,MAX(S_GRD_4) AS S_GRD_4 
               ,MAX(A_GRD_4) AS A_GRD_4 
               ,MAX(B_GRD_4) AS B_GRD_4 
               ,MAX(C_GRD_4) AS C_GRD_4 
               ,MAX(D_GRD_4) AS D_GRD_4 
               ,MAX(RATE_4) AS RATE_4 
               ,MAX(ESTM_LITEM_CD_5) AS ESTM_LITEM_CD_5 
               ,MAX(ESTM_LITEM_NM_5) AS ESTM_LITEM_NM_5 
               ,MAX(S_GRD_5) AS S_GRD_5 
               ,MAX(A_GRD_5) AS A_GRD_5 
               ,MAX(B_GRD_5) AS B_GRD_5 
               ,MAX(C_GRD_5) AS C_GRD_5 
               ,MAX(D_GRD_5) AS D_GRD_5 
               ,MAX(RATE_5) AS RATE_5 
               ,NULL AS ESTM_EMP
               ,NULL AS RESULT
               ,DISTR_CD
               ,NULL AS ESTM_DEPT
               ,FST_SND_GBN
               ,NULL AS RATE
               ,ESTM_LITEM_TYPE
         FROM ( 
               SELECT   
                     A.ESTM_YEAR
                    ,A.ESTM_NUM   
                    ,A.EMP_NO
                    ,E.DISTR_CD 
                    ,(SELECT EMP_NM FROM TBRF_EV_EMP WHERE EMP_NO = A.EMP_NO AND ESTM_YEAR = A.ESTM_YEAR AND ESTM_NUM = A.ESTM_NUM AND ESTM_DEPT = A.ESTM_DEPT ) AS EMP_NM  
                    ,(SELECT ESTM_WK_JOB FROM TBRF_EV_EMP WHERE EMP_NO = A.EMP_NO AND ESTM_YEAR = A.ESTM_YEAR AND ESTM_NUM = A.ESTM_NUM AND ESTM_DEPT = A.ESTM_DEPT ) AS ESTM_WK_JOB  
                    ,(SELECT (SELECT WK_JOB_NM FROM TBRF_EV_WORK_JOB WHERE WK_JOB_CD = B1.ESTM_WK_JOB AND ESTM_YEAR = A.ESTM_YEAR AND ESTM_NUM = A.ESTM_NUM) FROM TBRF_EV_EMP B1 WHERE EMP_NO = A.EMP_NO AND ESTM_YEAR = A.ESTM_YEAR AND ESTM_NUM = A.ESTM_NUM AND ESTM_DEPT = A.ESTM_DEPT ) AS ESTM_WK_NM  
                    ,CASE WHEN RNUM = 1 THEN ESTM_LITEM_CD END AS ESTM_LITEM_CD_1  
                    ,CASE WHEN RNUM = 1 THEN ESTM_LITEM_NM END AS ESTM_LITEM_NM_1  
                    ,CASE WHEN RNUM = 1 AND GRD = S_RATE THEN 1 ELSE 0 END AS S_GRD_1  
                    ,CASE WHEN RNUM = 1 AND GRD = A_RATE THEN 1 ELSE 0 END AS A_GRD_1  
                    ,CASE WHEN RNUM = 1 AND GRD = B_RATE THEN 1 ELSE 0 END AS B_GRD_1  
                    ,CASE WHEN RNUM = 1 AND GRD = C_RATE THEN 1 ELSE 0 END AS C_GRD_1  
                    ,CASE WHEN RNUM = 1 AND GRD = D_RATE THEN 1 ELSE 0 END AS D_GRD_1  
                    ,CASE WHEN RNUM = 1 THEN ESTM_RATE+NVL(FC_EV_PERM_SCR_ADJ(A.ESTM_YEAR, A.ESTM_NUM, A.CNTR_ITM_CD, A.ESTM_LITEM_CD, A.FST_SND_GBN, A.ESTM_WK_JOB),0) END AS RATE_1  
                    ,CASE WHEN RNUM = 2 THEN ESTM_LITEM_CD END AS ESTM_LITEM_CD_2  
                    ,CASE WHEN RNUM = 2 THEN ESTM_LITEM_NM END AS ESTM_LITEM_NM_2  
                    ,CASE WHEN RNUM = 2 AND GRD = S_RATE THEN 1 ELSE 0 END AS S_GRD_2  
                    ,CASE WHEN RNUM = 2 AND GRD = A_RATE THEN 1 ELSE 0 END AS A_GRD_2  
                    ,CASE WHEN RNUM = 2 AND GRD = B_RATE THEN 1 ELSE 0 END AS B_GRD_2  
                    ,CASE WHEN RNUM = 2 AND GRD = C_RATE THEN 1 ELSE 0 END AS C_GRD_2  
                    ,CASE WHEN RNUM = 2 AND GRD = D_RATE THEN 1 ELSE 0 END AS D_GRD_2  
                    ,CASE WHEN RNUM = 2 THEN ESTM_RATE+NVL(FC_EV_PERM_SCR_ADJ(A.ESTM_YEAR, A.ESTM_NUM, A.CNTR_ITM_CD, A.ESTM_LITEM_CD, A.FST_SND_GBN, A.ESTM_WK_JOB),0) END AS RATE_2  
                    ,CASE WHEN RNUM = 3 THEN ESTM_LITEM_CD END AS ESTM_LITEM_CD_3  
                    ,CASE WHEN RNUM = 3 THEN ESTM_LITEM_NM END AS ESTM_LITEM_NM_3  
                    ,CASE WHEN RNUM = 3 AND GRD = S_RATE THEN 1 ELSE 0 END AS S_GRD_3  
                    ,CASE WHEN RNUM = 3 AND GRD = A_RATE THEN 1 ELSE 0 END AS A_GRD_3  
                    ,CASE WHEN RNUM = 3 AND GRD = B_RATE THEN 1 ELSE 0 END AS B_GRD_3  
                    ,CASE WHEN RNUM = 3 AND GRD = C_RATE THEN 1 ELSE 0 END AS C_GRD_3  
                    ,CASE WHEN RNUM = 3 AND GRD = D_RATE THEN 1 ELSE 0 END AS D_GRD_3  
                    ,CASE WHEN RNUM = 3 THEN ESTM_RATE+NVL(FC_EV_PERM_SCR_ADJ(A.ESTM_YEAR, A.ESTM_NUM, A.CNTR_ITM_CD, A.ESTM_LITEM_CD, A.FST_SND_GBN, A.ESTM_WK_JOB),0) END AS RATE_3  
                    ,CASE WHEN RNUM = 4 THEN ESTM_LITEM_CD END AS ESTM_LITEM_CD_4  
                    ,CASE WHEN RNUM = 4 THEN ESTM_LITEM_NM END AS ESTM_LITEM_NM_4  
                    ,CASE WHEN RNUM = 4 AND GRD = S_RATE THEN 1 ELSE 0 END AS S_GRD_4  
                    ,CASE WHEN RNUM = 4 AND GRD = A_RATE THEN 1 ELSE 0 END AS A_GRD_4  
                    ,CASE WHEN RNUM = 4 AND GRD = B_RATE THEN 1 ELSE 0 END AS B_GRD_4  
                    ,CASE WHEN RNUM = 4 AND GRD = C_RATE THEN 1 ELSE 0 END AS C_GRD_4  
                    ,CASE WHEN RNUM = 4 AND GRD = D_RATE THEN 1 ELSE 0 END AS D_GRD_4  
                    ,CASE WHEN RNUM = 4 THEN ESTM_RATE+NVL(FC_EV_PERM_SCR_ADJ(A.ESTM_YEAR, A.ESTM_NUM, A.CNTR_ITM_CD, A.ESTM_LITEM_CD, A.FST_SND_GBN, A.ESTM_WK_JOB),0) END AS RATE_4  
                    ,CASE WHEN RNUM = 5 THEN ESTM_LITEM_CD END AS ESTM_LITEM_CD_5  
                    ,CASE WHEN RNUM = 5 THEN ESTM_LITEM_NM END AS ESTM_LITEM_NM_5  
                    ,CASE WHEN RNUM = 5 AND GRD = S_RATE THEN 1 ELSE 0 END AS S_GRD_5  
                    ,CASE WHEN RNUM = 5 AND GRD = A_RATE THEN 1 ELSE 0 END AS A_GRD_5  
                    ,CASE WHEN RNUM = 5 AND GRD = B_RATE THEN 1 ELSE 0 END AS B_GRD_5  
                    ,CASE WHEN RNUM = 5 AND GRD = C_RATE THEN 1 ELSE 0 END AS C_GRD_5  
                    ,CASE WHEN RNUM = 5 AND GRD = D_RATE THEN 1 ELSE 0 END AS D_GRD_5  
                    ,CASE WHEN RNUM = 5  THEN ESTM_RATE+NVL(FC_EV_PERM_SCR_ADJ(A.ESTM_YEAR, A.ESTM_NUM, A.CNTR_ITM_CD, A.ESTM_LITEM_CD, A.FST_SND_GBN, A.ESTM_WK_JOB),0) END AS RATE_5  
                    ,A.FST_SND_GBN
                    ,A.ESTM_LITEM_TYPE
              FROM  (
                    SELECT  A.ESTM_YEAR
                                ,A.ESTM_NUM
                                ,A.ESTM_EMP   
                                ,A.EMP_NO
                                ,(SELECT EMP_NM FROM TBRF_EV_EMP WHERE EMP_NO = A.EMP_NO AND ESTM_YEAR = A.ESTM_YEAR AND ESTM_NUM = A.ESTM_NUM AND ESTM_DEPT = A.ESTM_DEPT ) AS EMP_NM  
                                ,(SELECT ESTM_WK_JOB FROM TBRF_EV_EMP WHERE EMP_NO = A.EMP_NO AND ESTM_YEAR = A.ESTM_YEAR AND ESTM_NUM = A.ESTM_NUM AND ESTM_DEPT = A.ESTM_DEPT ) AS ESTM_WK_JOB  
                                ,(SELECT (SELECT WK_JOB_NM FROM TBRF_EV_WORK_JOB WHERE WK_JOB_CD = B1.ESTM_WK_JOB AND ESTM_YEAR = A.ESTM_YEAR AND ESTM_NUM = A.ESTM_NUM) FROM TBRF_EV_EMP B1 WHERE EMP_NO = A.EMP_NO AND ESTM_YEAR = A.ESTM_YEAR AND ESTM_NUM = A.ESTM_NUM AND ESTM_DEPT = A.ESTM_DEPT ) AS ESTM_WK_NM  
                               ,B.ESTM_LITEM_TYPE
                               ,B.CNTR_ITM_CD
                               ,A.ESTM_LITEM_CD
                               ,B.FST_SND_GBN
                               ,B.ESTM_RATE
                               ,A.ESTM_DEPT
                               ,A.GRD
                               ,S_RATE 
                               ,A_RATE 
                               ,B_RATE 
                               ,C_RATE 
                               ,D_RATE 
                               ,ESTM_LITEM_NM
                               ,ROW_NUMBER() OVER (PARTITION BY D.EMP_NO ORDER BY B.ESTM_LITEM_CD) AS RNUM
                        FROM  TBRF_EV_WK_PRM_DT A 
                               ,TBRF_EV_LARGE_ITEM B 
                                ,(SELECT  ESTM_YEAR 
                                       ,ESTM_NUM 
                                       ,S_RATE 
                                       ,A_RATE 
                                       ,B_RATE 
                                       ,C_RATE 
                                       ,D_RATE 
                                  FROM TBRF_EV_ITEM_GRD 
                                 WHERE 1 = 1 
					               AND ESTM_YEAR = ?
					               AND ESTM_NUM = ?
                                   AND ESTM_ITEM_CD = '1' ) C
                               ,TBRF_EV_WK_PRM D       
                         WHERE 1 = 1 
                           AND A.ESTM_YEAR = B.ESTM_YEAR 
                           AND A.ESTM_YEAR = D.ESTM_YEAR 
                           AND A.ESTM_NUM = B.ESTM_NUM 
                           AND A.ESTM_NUM = D.ESTM_NUM 
                           AND A.ESTM_DEPT = D.ESTM_DEPT
                           AND A.EMP_NO    = D.EMP_NO
                           AND A.ESTM_LITEM_CD = B.ESTM_LITEM_CD 
                           AND B.ESTM_ITEM_CD = '1' 
					       AND A.ESTM_YEAR = ?
					       AND A.ESTM_NUM = ?
					       AND A.ESTM_DEPT = ?
					       AND A.ESTM_EMP IN (D.ESTM_FST_EMP, D.ESTM_SND_EMP)
					       AND A.ESTM_EMP = ?
					       AND B.FST_SND_GBN = ?
					       AND B.ESTM_LITEM_TYPE = ?
                          ORDER BY  A.EMP_NO, ESTM_WK_JOB, SUBSTR(A.ESTM_LITEM_CD, 3, 4)                
                          ) A
                         ,TBRF_EV_WK_PRM_TYPE E   
                 WHERE 1=1
                   AND A.ESTM_NUM        = E.ESTM_NUM(+) 
                   AND A.ESTM_YEAR       = E.ESTM_YEAR(+)
                   AND A.ESTM_DEPT       = E.ESTM_DEPT(+)
                   AND A.ESTM_EMP        = E.ESTM_EMP(+)
                   AND A.EMP_NO          = E.EMP_NO(+)
                   AND A.FST_SND_GBN     = E.FST_SND_GBN(+)  
                   AND A.ESTM_LITEM_TYPE = E.ESTM_LITEM_TYPE(+)              
              ) 
             GROUP BY ESTM_YEAR
                       ,ESTM_NUM 
                       ,EMP_NO 
                       ,EMP_NM 
                       ,ESTM_WK_JOB 
                       ,ESTM_WK_NM
                       ,DISTR_CD  
                       ,FST_SND_GBN
                       ,ESTM_LITEM_TYPE
             ORDER BY ESTM_WK_JOB, EMP_NO          

		 ]]>
    </query>

	<query id="rev2010_s062" desc="2차평가자(지점장) 업무수행평가 조회 " fetchSize="10">
        <![CDATA[
		SELECT /* rev2010_s062 */ESTM_YEAR
			   ,ESTM_NUM
		       ,EMP_NO 
		       ,EMP_NM 
		       ,ESTM_WK_JOB 
		       ,ESTM_WK_NM 
		       ,MAX(ESTM_LITEM_CD_1) AS ESTM_LITEM_CD_1 
		       ,MAX(ESTM_LITEM_NM_1) AS ESTM_LITEM_NM_1 
		       ,MAX(S_GRD_1) AS S_GRD_1 
		       ,MAX(A_GRD_1) AS A_GRD_1 
		       ,MAX(B_GRD_1) AS B_GRD_1 
		       ,MAX(C_GRD_1) AS C_GRD_1 
		       ,MAX(D_GRD_1) AS D_GRD_1 
		       ,MAX(RATE_1) AS RATE_1 
		       ,MAX(ESTM_LITEM_CD_2) AS ESTM_LITEM_CD_2 
		       ,MAX(ESTM_LITEM_NM_2) AS ESTM_LITEM_NM_2 
		       ,MAX(S_GRD_2) AS S_GRD_2 
		       ,MAX(A_GRD_2) AS A_GRD_2 
		       ,MAX(B_GRD_2) AS B_GRD_2 
		       ,MAX(C_GRD_2) AS C_GRD_2 
		       ,MAX(D_GRD_2) AS D_GRD_2 
		       ,MAX(RATE_2) AS RATE_2 
		       ,MAX(ESTM_LITEM_CD_3) AS  ESTM_LITEM_CD_3 
		       ,MAX(ESTM_LITEM_NM_3) AS ESTM_LITEM_NM_3 
		       ,MAX(S_GRD_3) AS S_GRD_3 
		       ,MAX(A_GRD_3) AS A_GRD_3 
		       ,MAX(B_GRD_3) AS B_GRD_3 
		       ,MAX(C_GRD_3) AS C_GRD_3 
		       ,MAX(D_GRD_3) AS D_GRD_3 
		       ,MAX(RATE_3) AS RATE_3 
		       ,MAX(ESTM_LITEM_CD_4) AS ESTM_LITEM_CD_4 
		       ,MAX(ESTM_LITEM_NM_4) AS ESTM_LITEM_NM_4 
		       ,MAX(S_GRD_4) AS S_GRD_4 
		       ,MAX(A_GRD_4) AS A_GRD_4 
		       ,MAX(B_GRD_4) AS B_GRD_4 
		       ,MAX(C_GRD_4) AS C_GRD_4 
		       ,MAX(D_GRD_4) AS D_GRD_4 
		       ,MAX(RATE_4) AS RATE_4 
		       ,MAX(ESTM_LITEM_CD_5) AS ESTM_LITEM_CD_5 
		       ,MAX(ESTM_LITEM_NM_5) AS ESTM_LITEM_NM_5 
		       ,MAX(S_GRD_5) AS S_GRD_5 
		       ,MAX(A_GRD_5) AS A_GRD_5 
		       ,MAX(B_GRD_5) AS B_GRD_5 
		       ,MAX(C_GRD_5) AS C_GRD_5 
		       ,MAX(D_GRD_5) AS D_GRD_5 
		       ,MAX(RATE_5) AS RATE_5 
		       ,NULL AS ESTM_EMP
		       ,NULL AS RESULT
               ,DISTR_CD
		       ,NULL AS ESTM_DEPT
		       ,FST_SND_GBN
		       ,NULL AS RATE
		       ,ESTM_LITEM_TYPE
		 FROM ( 
               SELECT   
                     A.ESTM_YEAR
                    ,A.ESTM_NUM   
                    ,A.EMP_NO
                    ,E.DISTR_CD 
                    ,(SELECT EMP_NM FROM TBRF_EV_EMP WHERE EMP_NO = A.EMP_NO AND ESTM_YEAR = A.ESTM_YEAR AND ESTM_NUM = A.ESTM_NUM AND ESTM_DEPT = A.ESTM_DEPT ) AS EMP_NM  
                    ,(SELECT ESTM_WK_JOB FROM TBRF_EV_EMP WHERE EMP_NO = A.EMP_NO AND ESTM_YEAR = A.ESTM_YEAR AND ESTM_NUM = A.ESTM_NUM AND ESTM_DEPT = A.ESTM_DEPT ) AS ESTM_WK_JOB  
                    ,(SELECT (SELECT WK_JOB_NM FROM TBRF_EV_WORK_JOB WHERE WK_JOB_CD = B1.ESTM_WK_JOB AND ESTM_YEAR = A.ESTM_YEAR AND ESTM_NUM = A.ESTM_NUM) FROM TBRF_EV_EMP B1 WHERE EMP_NO = A.EMP_NO AND ESTM_YEAR = A.ESTM_YEAR AND ESTM_NUM = A.ESTM_NUM AND ESTM_DEPT = A.ESTM_DEPT ) AS ESTM_WK_NM  
                    ,CASE WHEN RNUM = 1 THEN ESTM_LITEM_CD END AS ESTM_LITEM_CD_1  
                    ,CASE WHEN RNUM = 1 THEN ESTM_LITEM_NM END AS ESTM_LITEM_NM_1  
                    ,CASE WHEN RNUM = 1 AND GRD = S_RATE THEN 1 ELSE 0 END AS S_GRD_1  
                    ,CASE WHEN RNUM = 1 AND GRD = A_RATE THEN 1 ELSE 0 END AS A_GRD_1  
                    ,CASE WHEN RNUM = 1 AND GRD = B_RATE THEN 1 ELSE 0 END AS B_GRD_1  
                    ,CASE WHEN RNUM = 1 AND GRD = C_RATE THEN 1 ELSE 0 END AS C_GRD_1  
                    ,CASE WHEN RNUM = 1 AND GRD = D_RATE THEN 1 ELSE 0 END AS D_GRD_1  
                    ,CASE WHEN RNUM = 1 THEN ESTM_RATE+NVL(FC_EV_PERM_SCR_ADJ(A.ESTM_YEAR, A.ESTM_NUM, A.CNTR_ITM_CD, A.ESTM_LITEM_CD, A.FST_SND_GBN, A.ESTM_WK_JOB),0) END AS RATE_1  
                    ,CASE WHEN RNUM = 2 THEN ESTM_LITEM_CD END AS ESTM_LITEM_CD_2  
                    ,CASE WHEN RNUM = 2 THEN ESTM_LITEM_NM END AS ESTM_LITEM_NM_2  
                    ,CASE WHEN RNUM = 2 AND GRD = S_RATE THEN 1 ELSE 0 END AS S_GRD_2  
                    ,CASE WHEN RNUM = 2 AND GRD = A_RATE THEN 1 ELSE 0 END AS A_GRD_2  
                    ,CASE WHEN RNUM = 2 AND GRD = B_RATE THEN 1 ELSE 0 END AS B_GRD_2  
                    ,CASE WHEN RNUM = 2 AND GRD = C_RATE THEN 1 ELSE 0 END AS C_GRD_2  
                    ,CASE WHEN RNUM = 2 AND GRD = D_RATE THEN 1 ELSE 0 END AS D_GRD_2  
                    ,CASE WHEN RNUM = 2 THEN ESTM_RATE+NVL(FC_EV_PERM_SCR_ADJ(A.ESTM_YEAR, A.ESTM_NUM, A.CNTR_ITM_CD, A.ESTM_LITEM_CD, A.FST_SND_GBN, A.ESTM_WK_JOB),0) END AS RATE_2  
                    ,CASE WHEN RNUM = 3 THEN ESTM_LITEM_CD END AS ESTM_LITEM_CD_3  
                    ,CASE WHEN RNUM = 3 THEN ESTM_LITEM_NM END AS ESTM_LITEM_NM_3  
                    ,CASE WHEN RNUM = 3 AND GRD = S_RATE THEN 1 ELSE 0 END AS S_GRD_3  
                    ,CASE WHEN RNUM = 3 AND GRD = A_RATE THEN 1 ELSE 0 END AS A_GRD_3  
                    ,CASE WHEN RNUM = 3 AND GRD = B_RATE THEN 1 ELSE 0 END AS B_GRD_3  
                    ,CASE WHEN RNUM = 3 AND GRD = C_RATE THEN 1 ELSE 0 END AS C_GRD_3  
                    ,CASE WHEN RNUM = 3 AND GRD = D_RATE THEN 1 ELSE 0 END AS D_GRD_3  
                    ,CASE WHEN RNUM = 3 THEN ESTM_RATE+NVL(FC_EV_PERM_SCR_ADJ(A.ESTM_YEAR, A.ESTM_NUM, A.CNTR_ITM_CD, A.ESTM_LITEM_CD, A.FST_SND_GBN, A.ESTM_WK_JOB),0) END AS RATE_3  
                    ,CASE WHEN RNUM = 4 THEN ESTM_LITEM_CD END AS ESTM_LITEM_CD_4  
                    ,CASE WHEN RNUM = 4 THEN ESTM_LITEM_NM END AS ESTM_LITEM_NM_4  
                    ,CASE WHEN RNUM = 4 AND GRD = S_RATE THEN 1 ELSE 0 END AS S_GRD_4  
                    ,CASE WHEN RNUM = 4 AND GRD = A_RATE THEN 1 ELSE 0 END AS A_GRD_4  
                    ,CASE WHEN RNUM = 4 AND GRD = B_RATE THEN 1 ELSE 0 END AS B_GRD_4  
                    ,CASE WHEN RNUM = 4 AND GRD = C_RATE THEN 1 ELSE 0 END AS C_GRD_4  
                    ,CASE WHEN RNUM = 4 AND GRD = D_RATE THEN 1 ELSE 0 END AS D_GRD_4  
                    ,CASE WHEN RNUM = 4 THEN ESTM_RATE+NVL(FC_EV_PERM_SCR_ADJ(A.ESTM_YEAR, A.ESTM_NUM, A.CNTR_ITM_CD, A.ESTM_LITEM_CD, A.FST_SND_GBN, A.ESTM_WK_JOB),0) END AS RATE_4  
                    ,CASE WHEN RNUM = 5 THEN ESTM_LITEM_CD END AS ESTM_LITEM_CD_5  
                    ,CASE WHEN RNUM = 5 THEN ESTM_LITEM_NM END AS ESTM_LITEM_NM_5  
                    ,CASE WHEN RNUM = 5 AND GRD = S_RATE THEN 1 ELSE 0 END AS S_GRD_5  
                    ,CASE WHEN RNUM = 5 AND GRD = A_RATE THEN 1 ELSE 0 END AS A_GRD_5  
                    ,CASE WHEN RNUM = 5 AND GRD = B_RATE THEN 1 ELSE 0 END AS B_GRD_5  
                    ,CASE WHEN RNUM = 5 AND GRD = C_RATE THEN 1 ELSE 0 END AS C_GRD_5  
                    ,CASE WHEN RNUM = 5 AND GRD = D_RATE THEN 1 ELSE 0 END AS D_GRD_5  
                    ,CASE WHEN RNUM = 5  THEN ESTM_RATE+NVL(FC_EV_PERM_SCR_ADJ(A.ESTM_YEAR, A.ESTM_NUM, A.CNTR_ITM_CD, A.ESTM_LITEM_CD, A.FST_SND_GBN, A.ESTM_WK_JOB),0) END AS RATE_5  
                    ,A.FST_SND_GBN
                    ,A.ESTM_LITEM_TYPE
              FROM  (
                    SELECT  A.ESTM_YEAR
                               ,A.ESTM_NUM  
                               ,A.ESTM_EMP    
                               ,A.EMP_NO
                               ,(SELECT EMP_NM FROM TBRF_EV_EMP WHERE EMP_NO = A.EMP_NO AND ESTM_YEAR = A.ESTM_YEAR AND ESTM_NUM = A.ESTM_NUM AND ESTM_DEPT = A.ESTM_DEPT ) AS EMP_NM  
                               ,(SELECT ESTM_WK_JOB FROM TBRF_EV_EMP WHERE EMP_NO = A.EMP_NO AND ESTM_YEAR = A.ESTM_YEAR AND ESTM_NUM = A.ESTM_NUM AND ESTM_DEPT = A.ESTM_DEPT ) AS ESTM_WK_JOB  
                               ,(SELECT (SELECT WK_JOB_NM FROM TBRF_EV_WORK_JOB WHERE WK_JOB_CD = B1.ESTM_WK_JOB AND ESTM_YEAR = A.ESTM_YEAR AND ESTM_NUM = A.ESTM_NUM) FROM TBRF_EV_EMP B1 WHERE EMP_NO = A.EMP_NO AND ESTM_YEAR = A.ESTM_YEAR AND ESTM_NUM = A.ESTM_NUM AND ESTM_DEPT = A.ESTM_DEPT ) AS ESTM_WK_NM  
                              ,B.ESTM_LITEM_TYPE
                              ,B.CNTR_ITM_CD
                              ,A.ESTM_LITEM_CD
                              ,B.FST_SND_GBN
                              ,B.ESTM_RATE
                              ,A.ESTM_DEPT
                              ,A.GRD
                              ,S_RATE 
                              ,A_RATE 
                              ,B_RATE 
                              ,C_RATE 
                              ,D_RATE 
                              ,ESTM_LITEM_NM
                              ,ROW_NUMBER() OVER (PARTITION BY D.EMP_NO ORDER BY B.ESTM_LITEM_CD) AS RNUM
                       FROM  (
								SELECT ESTM_YEAR, ESTM_NUM, ESTM_DEPT, ESTM_LITEM_CD, ESTM_EMP, EMP_NO, MAX(GRD) GRD
								FROM TBRF_EV_WK_PRM_DT
								GROUP BY ESTM_YEAR, ESTM_NUM, ESTM_DEPT, ESTM_LITEM_CD, ESTM_EMP, EMP_NO
                              ) A 
                              ,TBRF_EV_LARGE_ITEM B 
                               ,(SELECT  ESTM_YEAR 
                                      ,ESTM_NUM 
                                      ,S_RATE 
                                      ,A_RATE 
                                      ,B_RATE 
                                      ,C_RATE 
                                      ,D_RATE 
                                 FROM TBRF_EV_ITEM_GRD 
                                WHERE 1 = 1 
				               AND ESTM_YEAR = ?
				               AND ESTM_NUM = ?
                                  AND ESTM_ITEM_CD = '1' ) C
                              ,(
								SELECT ESTM_YEAR, ESTM_NUM, ESTM_DEPT, EMP_NO
								FROM TBRF_EV_WK_PRM
								GROUP BY ESTM_YEAR, ESTM_NUM, ESTM_DEPT, EMP_NO
                              ) D      
                        WHERE 1 = 1 
                          AND A.ESTM_YEAR = B.ESTM_YEAR 
                          AND A.ESTM_YEAR = D.ESTM_YEAR 
                          AND A.ESTM_NUM = B.ESTM_NUM 
                          AND A.ESTM_NUM = D.ESTM_NUM 
                          AND A.ESTM_DEPT = D.ESTM_DEPT
                          AND A.EMP_NO    = D.EMP_NO
                          AND A.ESTM_LITEM_CD = B.ESTM_LITEM_CD 
                          AND B.ESTM_ITEM_CD = '1' 
				       AND A.ESTM_YEAR = ?
				       AND A.ESTM_NUM = ?
				       AND A.ESTM_DEPT = ?
				       AND A.ESTM_EMP = ?
				       AND B.FST_SND_GBN = ?
				       AND B.ESTM_LITEM_TYPE = ?
				      ORDER BY  A.EMP_NO, ESTM_WK_JOB, SUBSTR(A.ESTM_LITEM_CD, 3, 4) 
                         ) A   
                        ,TBRF_EV_WK_PRM_TYPE E   
                 WHERE 1=1
                   AND A.ESTM_NUM        = E.ESTM_NUM(+) 
                   AND A.ESTM_YEAR       = E.ESTM_YEAR(+)
                   AND A.ESTM_DEPT       = E.ESTM_DEPT(+)
                   AND A.ESTM_EMP        = E.ESTM_EMP(+)
                   AND A.EMP_NO          = E.EMP_NO(+)
                   AND A.FST_SND_GBN     = E.FST_SND_GBN(+)  
                   AND A.ESTM_LITEM_TYPE = E.ESTM_LITEM_TYPE(+)             
                       ) 
			     GROUP BY ESTM_YEAR
						 ,ESTM_NUM 
						 ,EMP_NO 
			             ,EMP_NM 
			             ,ESTM_WK_JOB 
			             ,ESTM_WK_NM
			             ,DISTR_CD 
			             ,FST_SND_GBN
			             ,ESTM_LITEM_TYPE
             ORDER BY ESTM_WK_JOB, EMP_NO  
		               
		 ]]>
    </query>
    
	<query id="rev2010_s07" desc="발매실적평가 조회 " fetchSize="10">
        <![CDATA[
	      SELECT  /* rev2010_s07 */
				 A.ESTM_YEAR
				,A.ESTM_NUM
				,A.ESTM_DEPT
				,A.EMP_NO
				,(SELECT EMP_NM    FROM TBRF_EV_EMP WHERE ESTM_YEAR = A.ESTM_YEAR AND ESTM_NUM = A.ESTM_NUM AND EMP_NO = A.EMP_NO  AND ESTM_DEPT = A.ESTM_DEPT )AS EMP_NM
				,(SELECT ESTM_WK_JOB FROM TBRF_EV_EMP WHERE ESTM_YEAR = A.ESTM_YEAR AND ESTM_NUM = A.ESTM_NUM AND EMP_NO = A.EMP_NO AND ESTM_DEPT = A.ESTM_DEPT ) AS ESTM_WK_JOB
				,(SELECT WK_JOB_NM FROM TBRF_EV_WORK_JOB WHERE ESTM_YEAR = A.ESTM_YEAR AND ESTM_NUM = A.ESTM_NUM AND WK_JOB_CD = (SELECT ESTM_WK_JOB FROM TBRF_EV_EMP WHERE ESTM_YEAR = A.ESTM_YEAR AND ESTM_NUM = A.ESTM_NUM AND EMP_NO = A.EMP_NO  AND ESTM_DEPT = A.ESTM_DEPT )) AS WK_JOB_NM
				,D.RELEA_RSLT
				,RANK() OVER(PARTITION BY A.ESTM_DEPT ORDER BY D.RELEA_RSLT DESC) RNK
				,FC_NM_CODE('109',A.FST_RELEA_RSLT*RELEA_RATE) AS GRD
				,A.RELEA_DISTR
				,D.TOTAL_CNT
				,D.WK_DAY_CNT
				,B.RELEA_RATE
			FROM  TBRF_EV_WK_PRM A, TBRF_EV_MASTER B, TBRF_EV_RELEA_RSLT D
			WHERE 1 = 1
			AND A.ESTM_YEAR = B.ESTM_YEAR
			AND A.ESTM_NUM  = B.ESTM_NUM
			AND A.ESTM_YEAR = D.ESTM_YEAR
			AND A.ESTM_NUM  = D.ESTM_NUM
			AND A.ESTM_DEPT = D.DEPT_CD
			AND A.EMP_NO    = D.EMP_NO
			AND A.ESTM_YEAR = ?	--1. 평가년도
			AND A.ESTM_NUM  = ?	--2. 평가회차
			AND A.ESTM_DEPT = ? --3. 평가부서
			ORDER BY RNK
        ]]>
    </query>
    
    <query id="rev2010_s072" desc="발매실적평가 조회 " fetchSize="10">
        <![CDATA[
	      SELECT  /* rev2010_s072 */
				 A.ESTM_YEAR
				,A.ESTM_NUM
				,A.ESTM_DEPT
				,A.EMP_NO
				,B.EMP_NM
				,B.ESTM_WK_JOB
			    ,(SELECT WK_JOB_NM FROM TBRF_EV_WORK_JOB WHERE ESTM_YEAR = A.ESTM_YEAR AND ESTM_NUM = A.ESTM_NUM AND WK_JOB_CD = B.ESTM_WK_JOB) WK_JOB_NM
				,D.RELEA_RSLT
				,RANK() OVER(PARTITION BY A.ESTM_DEPT ORDER BY DECODE(B.RELEA_ESC_YN,'Y',0,D.RELEA_RSLT) DESC) RNK
				,FC_NM_CODE('109',A.FST_RELEA_RSLT*RELEA_RATE) AS GRD
				,A.RELEA_DISTR
				,C.RELEA_RATE
				,D.TOTAL_CNT
				,D.WK_DAY_CNT
                ,NVL(B.RELEA_ESC_YN, 'N') AS RELEA_ESC_YN
			FROM  TBRF_EV_WK_PRM A ,TBRF_EV_EMP B, TBRF_EV_MASTER C, TBRF_EV_RELEA_RSLT D
			WHERE 1 = 1
			AND A.ESTM_YEAR = B.ESTM_YEAR
			AND A.ESTM_NUM  = B.ESTM_NUM
			AND A.ESTM_DEPT = B.ESTM_DEPT
			AND A.EMP_NO    = B.EMP_NO
			AND A.ESTM_YEAR = C.ESTM_YEAR
			AND A.ESTM_NUM  = C.ESTM_NUM
			AND A.ESTM_YEAR = D.ESTM_YEAR(+)
			AND A.ESTM_NUM  = D.ESTM_NUM(+)
			AND A.ESTM_DEPT = D.DEPT_CD(+)
			AND A.EMP_NO    = D.EMP_NO(+)
			AND B.ESTM_WK_JOB = '1003'-- 발매원
			AND A.ESTM_YEAR = ?	    --1. 평가년도
			AND A.ESTM_NUM  = ?		--2. 평가회차
			AND A.ESTM_DEPT = ? 	--3. 평가부서
			ORDER BY RNK
        ]]>
    </query>
    
    <query id="rev2010_s05" desc="평가자구분/보직/정규직구분 조회 " fetchSize="10">
        <![CDATA[
        	SELECT   /* rev2010_s05 */ 
        	         CASE WHEN ESTM_WK_JOB = '1003' AND ESTM_ESC_GBN = 'Y' THEN '001' --발매원은 1차 평가자
        	         ELSE FST_SND_GBN END FST_SND_GBN,        	         
					 ESTM_WK_JOB,
                     PERM_TEMP_GBN,
                     SNACK_ESTM_YN 
        	FROM     TBRF_EV_EMP
        	WHERE    1 = 1 
        	AND      ESTM_YEAR = ? 
            AND      ESTM_NUM  = ?
        	AND      ESTM_DEPT   = ?
	        AND      EMP_NO    = ?
        ]]>
    </query>
    
    <query id="rev2010_u01" desc="업무수행평가 점수 저장 " fetchSize="10">
        <![CDATA[
        	UPDATE   /* rev2010_u01 */
        	         TBRF_EV_WK_PRM_DT
            SET      GRD = (select sum(DECODE(?, '1', (SELECT  
											                   S_RATE 
											             FROM TBRF_EV_ITEM_GRD 
											             WHERE 1 = 1 
											               AND ESTM_YEAR = ?
											               AND ESTM_NUM = ?
											               AND ESTM_ITEM_CD = '1'), '0', 0) +
                              DECODE(?, '1', (SELECT  
											                   A_RATE 
											             FROM TBRF_EV_ITEM_GRD 
											             WHERE 1 = 1 
											               AND ESTM_YEAR = ?
											               AND ESTM_NUM = ?
											               AND ESTM_ITEM_CD = '1'), '0', 0) +
                               DECODE(?, '1', (SELECT  
											                   B_RATE 
											             FROM TBRF_EV_ITEM_GRD 
											             WHERE 1 = 1 
											               AND ESTM_YEAR = ?
											               AND ESTM_NUM = ?
											               AND ESTM_ITEM_CD = '1'), '0', 0) +
                               DECODE(?, '1', (SELECT  
											                   C_RATE 
											             FROM TBRF_EV_ITEM_GRD 
											             WHERE 1 = 1 
											               AND ESTM_YEAR = ?
											               AND ESTM_NUM = ?
											               AND ESTM_ITEM_CD = '1'), '0', 0) +
                               DECODE(?, '1', (SELECT  
											                   D_RATE 
											             FROM TBRF_EV_ITEM_GRD 
											             WHERE 1 = 1 
											               AND ESTM_YEAR = ?
											               AND ESTM_NUM = ?
											               AND ESTM_ITEM_CD = '1'), '0', 0)) from dual)
	                 ,UPDT_ID = ?
	                 ,UPDT_DT = SYSDATE
            WHERE    1=1
			AND      ESTM_YEAR = ?
			AND      ESTM_NUM = ?
			AND      ESTM_DEPT = ?
			AND      ESTM_EMP = ?
			AND      EMP_NO = ?
			AND      ESTM_LITEM_CD = ?
        ]]>
    </query>
    
    <query id="rev2010_u02" desc="업무수행평가 코드 및 점수 저장(1차평가자) " fetchSize="10">
        <![CDATA[
        	UPDATE   /* rev2010_u02 */
        	         TBRF_EV_WK_PRM
            SET      DISTR_CD     = ?,
            		 FST_ESTM_SCR = (
            		 	SELECT
							 ROUND(SUM(A.GRD*
									( B.ESTM_RATE
										 +NVL(FC_EV_PERM_SCR_ADJ(B.ESTM_YEAR, B.ESTM_NUM, B.CNTR_ITM_CD, B.ESTM_LITEM_CD, B.FST_SND_GBN,
															 FC_EV_ESTM_WK_JOB(B.ESTM_YEAR, B.ESTM_NUM,A.EMP_NO,A.ESTM_DEPT)
									         ),0)
									 )/100),2) SCR
						FROM TBRF_EV_WK_PRM_DT A, TBRF_EV_LARGE_ITEM B, TBRF_EV_WK_PRM C
						WHERE 1=1
						AND A.ESTM_YEAR     = B.ESTM_YEAR
						AND A.ESTM_NUM      = B.ESTM_NUM
						AND A.ESTM_LITEM_CD = B.ESTM_LITEM_CD
						AND A.ESTM_YEAR     = C.ESTM_YEAR
						AND A.ESTM_NUM      = C.ESTM_NUM
						AND A.ESTM_DEPT     = C.ESTM_DEPT
						AND A.EMP_NO        = C.EMP_NO
						AND B.ESTM_ITEM_CD  = '1'       --역량평가
						AND A.ESTM_YEAR     = ?
						AND A.ESTM_NUM      = ?
						AND A.ESTM_DEPT     = ?
						AND A.EMP_NO        = ?
						AND A.ESTM_EMP      = ?
						AND B.FST_SND_GBN   = '001'       --1차 평가자
						AND A.ESTM_EMP = C.ESTM_FST_EMP --1차 평가자
						GROUP BY A.ESTM_YEAR, A.ESTM_NUM, A.ESTM_DEPT, A.ESTM_EMP, A.EMP_NO
            		 ),
            		 UPDT_ID = ?,
                     UPDT_DT = SYSDATE    
            WHERE    1 = 1
			AND      ESTM_YEAR = ?
			AND      ESTM_NUM = ?
			AND      ESTM_DEPT = ?
			AND      EMP_NO = ?
			AND      ESTM_FST_EMP = ?
        ]]>
    </query>
    
    <query id="rev2010_u03" desc="업무수행평가 코드 및 점수 저장(2차 평가자) " fetchSize="10">
        <![CDATA[
        	UPDATE   /* rev2010_u03 */
        	         TBRF_EV_WK_PRM
            SET      DISTR_SND = ?,
            		 SND_ESTM_SCR = (
            		 	SELECT
							ROUND(SUM(SCR),2) SCR
						FROM (
		            		SELECT
								A.ESTM_YEAR, A.ESTM_NUM, A.ESTM_DEPT, A.ESTM_EMP, A.EMP_NO, A.ESTM_LITEM_CD, 
								AVG(A.GRD*
								  ( B.ESTM_RATE
									 +NVL(FC_EV_PERM_SCR_ADJ(B.ESTM_YEAR, B.ESTM_NUM, B.CNTR_ITM_CD, B.ESTM_LITEM_CD, B.FST_SND_GBN,
														 FC_EV_ESTM_WK_JOB(B.ESTM_YEAR, B.ESTM_NUM,A.EMP_NO,A.ESTM_DEPT)
								         ),0)
								 )/100) SCR
							FROM TBRF_EV_WK_PRM_DT A, TBRF_EV_LARGE_ITEM B, TBRF_EV_WK_PRM C
							WHERE 1=1
							AND A.ESTM_YEAR     = B.ESTM_YEAR
							AND A.ESTM_NUM      = B.ESTM_NUM
							AND A.ESTM_LITEM_CD = B.ESTM_LITEM_CD
							AND A.ESTM_YEAR     = C.ESTM_YEAR
							AND A.ESTM_NUM      = C.ESTM_NUM
							AND A.ESTM_DEPT     = C.ESTM_DEPT
							AND A.EMP_NO        = C.EMP_NO
							AND B.ESTM_ITEM_CD  = '1'     --역량평가
							AND A.ESTM_YEAR     = ?
							AND A.ESTM_NUM      = ?
							AND A.ESTM_DEPT     = ?
							AND A.EMP_NO        = ?
							AND A.ESTM_EMP      = ?
							AND B.FST_SND_GBN   = '002'   --2차 평가자
							AND A.ESTM_EMP      = C.ESTM_SND_EMP
							GROUP BY A.ESTM_YEAR, A.ESTM_NUM, A.ESTM_DEPT, A.ESTM_EMP, A.EMP_NO, A.ESTM_LITEM_CD
						)
						GROUP BY ESTM_YEAR, ESTM_NUM, ESTM_DEPT, ESTM_EMP, EMP_NO	
            		 ),
            		 UPDT_ID = ?,
                     UPDT_DT = SYSDATE
            WHERE    1 = 1
			AND      ESTM_YEAR = ?
			AND      ESTM_NUM = ?
			AND      ESTM_DEPT = ?
			AND      EMP_NO = ?
			AND      ESTM_SND_EMP = ?
        ]]>
    </query>
    
    <query id="rev2010_u04" desc="발매실적 저장 " fetchSize="10">
        <![CDATA[
			UPDATE   /* rev2010_u04 */
        	         TBRF_EV_WK_PRM
            SET      FST_RELEA_RSLT = FC_CODE_NM('109',?)/100*?,
                     RELEA_DISTR = ?,
                     UPDT_ID = ?,
                     UPDT_DT = SYSDATE
			WHERE    1 = 1
			AND      ESTM_YEAR    = ?
			AND      ESTM_NUM     = ?
			AND      ESTM_DEPT    = ?
			AND      EMP_NO       = ?
			AND      ESTM_DEPT NOT IN (SELECT DEPT_CD 
			                           FROM   TBRF_EV_DEPT
			                           WHERE  ESTM_YEAR           = ?
			                           AND    ESTM_NUM            = ?
			                           AND    TELLER_RELEA_ESC_YN = 'Y') 
        ]]>
    </query>
    
    <query id="rev2010_u05" desc="평가항목별 항목구분  저장 " fetchSize="10">
        <![CDATA[
			MERGE INTO  /* rev2010_u05 */
			            TBRF_EV_WK_PRM_TYPE DST
			USING   (
			              SELECT ? AS ESTM_YEAR
			                         ,? AS ESTM_NUM
			                         ,? AS ESTM_DEPT
			                         ,? AS ESTM_EMP
			                         ,? AS EMP_NO
			                         ,? AS ESTM_LITEM_TYPE
			                         ,? AS DISTR_CD
			                         ,? AS SCR
			                         ,? AS FST_SND_GBN
			                         ,? AS USER_ID
			              FROM  DUAL
		            ) SRC
		            ON (
		                        DST.ESTM_YEAR = SRC.ESTM_YEAR
		                   AND  DST.ESTM_NUM  = SRC.ESTM_NUM
		                   AND  DST.ESTM_DEPT = SRC.ESTM_DEPT
		                   AND  DST.ESTM_EMP  = SRC.ESTM_EMP
		                   AND  DST.EMP_NO    = SRC.EMP_NO
		                   AND  DST.ESTM_LITEM_TYPE = SRC.ESTM_LITEM_TYPE
		            )
            WHEN MATCHED THEN
                  UPDATE SET
                               DST.DISTR_CD = SRC.DISTR_CD
                              ,DST.SCR      = SRC.SCR
                              ,DST.UPDT_ID  = SRC.USER_ID
                              ,DST.UPDT_DT  = SYSDATE
            WHEN NOT MATCHED THEN
                   INSERT (
                               ESTM_YEAR
                              ,ESTM_NUM
                              ,ESTM_DEPT
                              ,ESTM_EMP
                              ,EMP_NO
                              ,ESTM_LITEM_TYPE
                              ,DISTR_CD
                              ,SCR
                              ,FST_SND_GBN
                              ,INST_ID
                              ,INST_DT
                           ) VALUES (
                              SRC.ESTM_YEAR
                             ,SRC.ESTM_NUM
                             ,SRC.ESTM_DEPT
                             ,SRC.ESTM_EMP
                             ,SRC.EMP_NO
                             ,SRC.ESTM_LITEM_TYPE
                             ,SRC.DISTR_CD
                             ,SRC.SCR
                             ,SRC.FST_SND_GBN
                             ,SRC.USER_ID
                             ,SYSDATE
                           )
        ]]>
    </query>
    
    <query id="rev2010_s08" desc="평가항목등급 " fetchSize="10">
        <![CDATA[
			SELECT   /* rev2010_s08 */  
				ESTM_YEAR 
                   ,ESTM_NUM 
                   ,S_RATE 
                   ,A_RATE 
                   ,B_RATE 
                   ,C_RATE 
                   ,D_RATE 
              FROM TBRF_EV_ITEM_GRD 
             WHERE 1 = 1 
               AND ESTM_YEAR = ?
               AND ESTM_NUM = ?
               AND ESTM_ITEM_CD = '1'
      	]]>
    </query>
    
    <query id="rev2010_s09" desc="부서조회 " fetchSize="10">
        <![CDATA[
            SELECT  /* rev2010_s09 */  
            		A.ESTM_YEAR     
			       ,A.ESTM_NUM     
                   ,A.ESTM_DEPT AS CD     
                   ,C.DEPT_NM   AS CD_NM     
                   ,(SELECT CASE WHEN SUM(FST_ESTM_SCR) > 0 THEN 'Y'    
                                 ELSE 'N' END  
                     FROM TBRF_EV_WK_PRM   
                    WHERE 1 = 1   
                      AND ESTM_YEAR = A.ESTM_YEAR   
                      AND ESTM_NUM  = A.ESTM_NUM   
                      AND ESTM_DEPT = A.ESTM_DEPT   
                      AND ESTM_FST_EMP = A.EMP_NO) AS EV_GBN
                    ,C.TELLER_RELEA_ESC_YN     
               FROM TBRF_EV_EMP A 
                   ,TBRF_EV_WK_PRM B
                   ,TBRF_EV_DEPT C
               WHERE 1 = 1    
                 AND A.ESTM_YEAR = B.ESTM_YEAR 
                 AND A.ESTM_NUM = B.ESTM_NUM 
                 AND A.ESTM_DEPT = B.ESTM_DEPT 
                 AND (A.EMP_NO = B.ESTM_FST_EMP 
                  OR  A.EMP_NO = B.ESTM_SND_EMP )
                 AND A.ESTM_YEAR = C.ESTM_YEAR
                 AND A.ESTM_NUM  = C.ESTM_NUM
                 AND A.ESTM_DEPT = C.DEPT_CD 
                 AND A.ESTM_YEAR = ?  
                 AND A.ESTM_NUM  = ?   
                 AND ( A.FST_SND_GBN IN ('001', '002') OR --1차/2차 평가자
                      (A.ESTM_WK_JOB = '1003' AND ESTM_ESC_GBN = 'Y') --발매종사원
                      )
                 AND A.EMP_NO    = ? 
              GROUP BY  A.ESTM_YEAR     
                         ,A.ESTM_NUM     
                         ,A.ESTM_DEPT   
                         ,A.EMP_NO 
                         ,C.DEPT_NM
                         ,C.TELLER_RELEA_ESC_YN
        ]]>
    </query>
    
    <query id="rev2010_s10" desc="발매실적비율 조회" fetchSize="10">
        <![CDATA[
        	SELECT /* REV2010_S10 */ 
        			RELEA_RATE 
        	FROM 	TBRF_EV_MASTER  
        	WHERE 	1 = 1 
	       AND		 ESTM_YEAR = ? 
	       AND 		ESTM_NUM  = ? 
         
        ]]>
    </query>
    
    <query id="rev2010_s11" desc="마감여부 조회" fetchSize="10">
        <![CDATA[
            SELECT  ESTM_END_YN  
			  FROM  TBRF_EV_MASTER
			 WHERE  1=1
			   AND  ESTM_YEAR = ?
			   AND  ESTM_NUM  = ?
        ]]>
    </query>
    
    <query id="rev2010_s12" desc="마감여부 조회" fetchSize="10">
        <![CDATA[
                SELECT  /* rev2010_s12 */
                        ESTM_END_YN  
				  FROM  TBRF_EV_MASTER
				 WHERE  1=1
				   AND  ESTM_YEAR = ?
				   AND  ESTM_NUM  = ?
        ]]>
    </query>
    
    <query id="rev2010_s13" desc="평가개시 조회" fetchSize="10">
        <![CDATA[
                SELECT  /* rev2010_s13 */
                        ESTM_OPN_YN  
                  FROM  TBRF_EV_MASTER
                 WHERE  1=1
                   AND  ESTM_YEAR = ?
                   AND  ESTM_NUM  = ?
        ]]>
    </query>
    
    <query id="rev2010_s14" desc="평가항목 설명(역량정의, 고려요소) 조회 " fetchSize="10">
        <![CDATA[
			SELECT /* rev2010_s14 */ 
			       ESTM_LITEM_TYPE
			      ,TRUNC((ROW_NUMBER() OVER (PARTITION BY ESTM_LITEM_TYPE ORDER BY SUBSTR(ESTM_LITEM_CD,3,2))+1)/2) AS ESTM_LITEM_NO
			      ,MAX(ESTM_LITEM_NM) AS ESTM_LITEM_NM
			      ,MAX(DECODE(FST_SND_GBN, '001', LITEM_DEF,'002', LITEM_CNDR)) LITEM_DESC
			FROM   TBRF_EV_LARGE_ITEM
			WHERE  ESTM_YEAR    =  ? 
			AND    ESTM_NUM     =  ?
			AND    ESTM_ITEM_CD = '1'
			GROUP BY ESTM_LITEM_TYPE
			        ,SUBSTR(ESTM_LITEM_CD,3,2)
			        ,FST_SND_GBN
			ORDER BY 1,2
        ]]>
    </query>
    
</queryMap>