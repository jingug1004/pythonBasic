<?xml version="1.0" encoding='EUC-KR'?>

<queryMap desc="RSM2110(사업장별 매출목표 달성현황)">
	<query id="rsm2110_s01" desc="사업장별 매출목표 달성현황" fetchSize="10">
        <![CDATA[
        	WITH SALES_TOT AS ( /* rsm2110_s01 사업장별 매출목표 달성현황*/
				SELECT
					BRNC_CD,
					SUM(CASE WHEN MEET_CD IN ('001','002','004') THEN DIV_TOTAL ELSE 0 END) TOTAL_124,
					SUM(CASE WHEN MEET_CD IN ('001') THEN DIV_TOTAL ELSE 0 END) TOTAL_001,
					SUM(CASE WHEN MEET_CD IN ('003') THEN DIV_TOTAL ELSE 0 END) TOTAL_003,
					SUM(CASE WHEN MEET_CD IN ('002','004') THEN DIV_TOTAL ELSE 0 END) TOTAL_024
				FROM (
					SELECT MEET_CD, BRNC_CD, SUM(DIV_TOTAL) DIV_TOTAL
					FROM (
						SELECT A.MEET_CD, A.STND_YEAR, A.TMS, A.DAY_ORD, A.SELL_CD,
							CASE WHEN A.SELL_CD = '01' AND A.COMM_NO IN ('01','02','03','04','08')  THEN '01' --광명
					             WHEN A.SELL_CD = '03' AND A.COMM_NO IN ('01','02','03','04','08')  THEN '98' --미사리
					             WHEN A.SELL_CD IN ('02','04') THEN '29'                                         							 --교차
					             ELSE COMM_NO
							END AS BRNC_CD,
							A.DIV_TOTAL
						FROM   TBES_SDL_DT A, VW_SDL_INFO B
						WHERE 1=1
						AND A.MEET_CD = B.MEET_CD
						AND A.STND_YEAR = B.STND_YEAR
						AND A.TMS = B.TMS
						AND A.DAY_ORD = B.DAY_ORD
						AND A.STND_YEAR = SUBSTR( ?,0,4)
						AND B.RACE_DAY BETWEEN  ? AND ?
						AND A.COMM_NO != '06'
					) GROUP BY MEET_CD, BRNC_CD
				)
				GROUP BY BRNC_CD
			),
			SALES_GREEN AS (
				SELECT
					BRNC_CD,
					SUM(CASE WHEN MEET_CD IN ('001','002','004') THEN DIV_TOTAL ELSE 0 END) GREEN_124,
					SUM(CASE WHEN MEET_CD IN ('001') THEN DIV_TOTAL ELSE 0 END) GREEN_001,
					SUM(CASE WHEN MEET_CD IN ('003') THEN DIV_TOTAL ELSE 0 END) GREEN_003,
					SUM(CASE WHEN MEET_CD IN ('002','004') THEN DIV_TOTAL ELSE 0 END) GREEN_024,
					SUM(CASE WHEN MEET_CD IN ('001','002','004') THEN SELL_COUNT ELSE 0 END) GREEN_SC_124,
					SUM(CASE WHEN MEET_CD IN ('001') THEN SELL_COUNT ELSE 0 END) GREEN_SC_001,
					SUM(CASE WHEN MEET_CD IN ('003') THEN SELL_COUNT ELSE 0 END) GREEN_SC_003,
					SUM(CASE WHEN MEET_CD IN ('002','004') THEN SELL_COUNT ELSE 0 END) GREEN_SC_024,

					SUM(CASE WHEN MEET_CD IN ('001','002','004') THEN DIV_TOTAL_DEV ELSE 0 END) GREEN_DEV_124,
					SUM(CASE WHEN MEET_CD IN ('001') THEN DIV_TOTAL_DEV ELSE 0 END) GREEN_DEV_001,
					SUM(CASE WHEN MEET_CD IN ('003') THEN DIV_TOTAL_DEV ELSE 0 END) GREEN_DEV_003,
					SUM(CASE WHEN MEET_CD IN ('002','004') THEN DIV_TOTAL_DEV ELSE 0 END) GREEN_DEV_024,
					SUM(CASE WHEN MEET_CD IN ('001','002','004') THEN SELL_COUNT_DEV ELSE 0 END) GREEN_SC_DEV_124,
					SUM(CASE WHEN MEET_CD IN ('001') THEN SELL_COUNT_DEV ELSE 0 END) GREEN_SC_DEV_001,
					SUM(CASE WHEN MEET_CD IN ('003') THEN SELL_COUNT_DEV ELSE 0 END) GREEN_SC_DEV_003,
					SUM(CASE WHEN MEET_CD IN ('002','004') THEN SELL_COUNT_DEV ELSE 0 END) GREEN_SC_DEV_024,

					SUM(CASE WHEN MEET_CD IN ('001','002','004') THEN DIV_TOTAL_APP ELSE 0 END) GREEN_APP_124,
					SUM(CASE WHEN MEET_CD IN ('001') THEN DIV_TOTAL_APP ELSE 0 END) GREEN_APP_001,
					SUM(CASE WHEN MEET_CD IN ('003') THEN DIV_TOTAL_APP ELSE 0 END) GREEN_APP_003,
					SUM(CASE WHEN MEET_CD IN ('002','004') THEN DIV_TOTAL_APP ELSE 0 END) GREEN_APP_024,
					SUM(CASE WHEN MEET_CD IN ('001','002','004') THEN SELL_COUNT_APP ELSE 0 END) GREEN_SC_APP_124,
					SUM(CASE WHEN MEET_CD IN ('001') THEN SELL_COUNT_APP ELSE 0 END) GREEN_SC_APP_001,
					SUM(CASE WHEN MEET_CD IN ('003') THEN SELL_COUNT_APP ELSE 0 END) GREEN_SC_APP_003,
					SUM(CASE WHEN MEET_CD IN ('002','004') THEN SELL_COUNT_APP ELSE 0 END) GREEN_SC_APP_024

				FROM (
					SELECT MEET_CD, BRNC_CD, SUM(DIV_TOTAL) DIV_TOTAL, SUM(SELL_COUNT) SELL_COUNT,
					SUM(DECODE(CHANNEL_CD,'001',DIV_TOTAL,0)) DIV_TOTAL_DEV,
					SUM(DECODE(CHANNEL_CD,'002',DIV_TOTAL,0)) DIV_TOTAL_APP,
					SUM(DECODE(CHANNEL_CD,'001',SELL_COUNT,0)) SELL_COUNT_DEV,
					SUM(DECODE(CHANNEL_CD,'002',SELL_COUNT,0)) SELL_COUNT_APP
					FROM (
						SELECT A.MEET_CD, A.STND_YEAR, A.TMS, A.DAY_ORD, B.SELL_CD,
						 	CASE WHEN A.MEET_CD = '001' AND B.SELL_CD IN ('01','03') AND B.DIV_NO = '00' THEN '01'  --광명그린카드
					            WHEN A.MEET_CD = '003' AND B.SELL_CD IN ('01','03') AND B.DIV_NO = '00' THEN '98'   --미사리그린카드
					               WHEN B.SELL_CD IN ('01','03') AND B.COMM_NO = '06' THEN FC_CODE_NM2('127',B.DIV_NO) --지점그린카드
					               ELSE '999'
					          	END AS BRNC_CD,
					          	B.NET_AMT AS DIV_TOTAL,
					          	B.COUNT8 AS SELL_COUNT,
					          	B.CHANNEL_CD
						FROM  TBJI_PC_FILE_VERI A, TBES_MYCAT_SALES_DET B
						WHERE  1=1
						AND A.STND_YEAR = B.STND_YEAR
			            AND A.MEET_CD = B.MEET_CD
			            AND A.TMS = B.TMS
			            AND A.DAY_ORD = B.DAY_ORD
						AND B.STND_YEAR = SUBSTR( ?,0,4)
						AND B.RACE_DAY  BETWEEN  ? AND ?
					) GROUP BY MEET_CD, BRNC_CD
				)
				GROUP BY BRNC_CD
			),
			SALES_GOAL AS (   -- 매출목표
				SELECT  --사업장별매출목표
					DECODE(BRNC_CD, '00', '01', BRNC_CD) BRNC_CD,
					SALES_GOAL_CRA*1000000 SALES_GOAL_CRA,
					SALES_GOAL_MRA*1000000 SALES_GOAL_MRA,
					SALES_GOAL_CRA_GREEN*1000000 SALES_GOAL_CRA_GREEN,
					SALES_GOAL_MRA_GREEN*1000000 SALES_GOAL_MRA_GREEN
				FROM TBRA_COMM_DESC
				WHERE 1=1
				AND STND_YEAR = SUBSTR( ?,0,4)
			),
			BRNC_ORD AS (   --정렬순서
				SELECT
					CD AS BRNC_CD,
					CASE WHEN CD = '01' THEN 2
					     WHEN CD = '98' THEN 3
					     ELSE ORD_NO+3
					END AS ORD_NO
				FROM TBRK_SPEC_CD
				WHERE GRP_CD = '060'
			),
			SALES_COUNT AS ( --발매건수
				SELECT
					BRNC_CD,
					SUM(CASE WHEN MEET_CD IN ('001','002','004') THEN CNT ELSE 0 END) CASH_SC_124,
					SUM(CASE WHEN MEET_CD IN ('001') THEN CNT ELSE 0 END) CASH_SC_001,
					SUM(CASE WHEN MEET_CD IN ('003') THEN CNT ELSE 0 END) CASH_SC_003,
					SUM(CASE WHEN MEET_CD IN ('002','004') THEN CNT ELSE 0 END) CASH_SC_024
				FROM (
					SELECT A.MEET_CD, A.STND_YEAR, A.TMS, A.DAY_ORD, A.SELL_CD,
							CASE WHEN A.SELL_CD = '01' AND A.COMM_NO IN ('01','02','03','04','08')  THEN '01' --광명
					             WHEN A.SELL_CD = '03' AND A.COMM_NO IN ('01','02','03','04','08')  THEN '98' --미사리
					             WHEN A.SELL_CD IN ('02','04') THEN '29'                                         							 --교차
					             ELSE COMM_NO
							END AS BRNC_CD,
							NVL(A.COUNT8,0) CNT
					FROM VW_PC_SELLST A,		 -- 경주일 정보
					     VW_SDL_INFO D
					WHERE 1=1
					AND A.MEET_CD   = D.MEET_CD
					AND A.STND_YEAR = D.STND_YEAR
					AND A.TMS       = D.TMS
					AND A.DAY_ORD   = D.DAY_ORD
					AND A.SELL_CD   IN ('01','03')
					AND A.COMM_NO  != '06'
					AND D.STND_YEAR = SUBSTR( ?,0,4)
					AND D.RACE_DAY  BETWEEN  ? AND ?
				)
				GROUP BY BRNC_CD
			)
			
			SELECT
				BRNC_CD,
				DECODE(FC_CODE_NM('060',BRNC_CD),'본장','경륜본장','미사리','경정본장',FC_CODE_NM('060',BRNC_CD)) BRNC_NM,
				(SALES_GOAL_CRA+SALES_GOAL_MRA) SALES_GOAL_TOT, --매출목표(전체)
				SALES_GOAL_CRA AS SALES_GOAL_CRA,                      --매출목표(경륜)
				SALES_GOAL_MRA AS SALES_GOAL_MRA,                      --매출목표(경정)
			
				(TOTAL_001+TOTAL_003) GOAL_ARCH_TOT,                          --실적(전체)
				TOTAL_001 GOAL_ARCH_CRA,         							  --실적(경륜)
				TOTAL_003 GOAL_ARCH_MRA,                                      --실적(경정)
			
				DECODE(SALES_GOAL_CRA+SALES_GOAL_MRA,0,0,
					ROUND((TOTAL_001+TOTAL_003)/(SALES_GOAL_CRA+SALES_GOAL_MRA)*100,2)) AS GOAL_ARCH_RATIO_TOT, --달성률(전체)
				DECODE(SALES_GOAL_CRA,0,0,
					ROUND(TOTAL_001/SALES_GOAL_CRA*100,2)) AS GOAL_ARCH_RATIO_CRA,                              --달성률(경륜)
				DECODE(SALES_GOAL_MRA,0,0,
					ROUND(TOTAL_003/SALES_GOAL_MRA*100,2)) AS GOAL_ARCH_RATIO_MRA,                              --달성률(경정)
			
				(SALES_GOAL_CRA+SALES_GOAL_MRA)-(TOTAL_001+TOTAL_003) AS REM_GOAL_TOT,		--잔여목표(전체)
				SALES_GOAL_CRA-TOTAL_001 AS REM_GOAL_CRA,                                   --잔여목표(경륜)
				SALES_GOAL_MRA-TOTAL_003 AS REM_GOAL_MRA,                                   --잔여목표(경정)
				
				SALES_GOAL_CRA_GREEN + SALES_GOAL_MRA_GREEN SALES_GOAL_GREEN_TOT, --그린카드매출목표(전체)
				SALES_GOAL_CRA_GREEN SALES_GOAL_GREEN_CRA, --그린카드매출목표(경륜)
				SALES_GOAL_MRA_GREEN SALES_GOAL_GREEN_MRA, --그린카드매출목표(경정)
			
				(GREEN_001+GREEN_003) GOAL_ARCH_GREEN_TOT,	--그린카드실적(전체)
				GREEN_001 GOAL_ARCH_GREEN_CRA, --그린카드매출액(경륜)
				GREEN_003 GOAL_ARCH_GREEN_MRA, --그린카드매출액(경정)
				
				DECODE(SALES_GOAL_CRA_GREEN+SALES_GOAL_MRA_GREEN,0,0,
					ROUND((GREEN_001+GREEN_003)/(SALES_GOAL_CRA_GREEN+SALES_GOAL_MRA_GREEN)*100,2)) AS GOAL_ARCH_RATIO_GREEN_TOT, --그린카드달성률(전체)
				DECODE(SALES_GOAL_CRA_GREEN,0,0,
					ROUND(GREEN_001/SALES_GOAL_CRA_GREEN*100,2)) AS GOAL_ARCH_RATIO_GREEN_CRA,                              --그린카드달성률(경륜)
				DECODE(SALES_GOAL_MRA_GREEN,0,0,
					ROUND(GREEN_003/SALES_GOAL_MRA_GREEN*100,2)) AS GOAL_ARCH_RATIO_GREEN_MRA,                              --그린카드달성률(경정)
			
				(SALES_GOAL_CRA_GREEN+SALES_GOAL_MRA_GREEN)-(GREEN_001+GREEN_003) AS REM_GOAL_GREEN_TOT,	--그린카드잔여목표(전체)
				SALES_GOAL_CRA_GREEN-GREEN_001 AS REM_GOAL_GREEN_CRA,                                   	--그린카드잔여목표(경륜)
				SALES_GOAL_MRA_GREEN-GREEN_003 AS REM_GOAL_GREEN_MRA,                                   	--그린카드잔여목표(경정)
			
				DECODE(SALES_GOAL_CRA+SALES_GOAL_MRA, 0, 0,
					ROUND((SALES_GOAL_CRA_GREEN+SALES_GOAL_MRA_GREEN)/(SALES_GOAL_CRA+SALES_GOAL_MRA)*100,2)) AS GOAL_RATIO_GREEN_TOT, --그린카드목표비율(전체)
				DECODE(SALES_GOAL_CRA, 0, 0,
					ROUND(SALES_GOAL_CRA_GREEN/SALES_GOAL_CRA*100,2)) AS GOAL_RATIO_GREEN_CRA, --그린카드목표비율(경륜)
				DECODE(SALES_GOAL_MRA, 0, 0,
					ROUND(SALES_GOAL_MRA_GREEN/SALES_GOAL_MRA*100,2)) AS GOAL_RATIO_GREEN_MRA, --그린카드목표비율(경정)
			
				DECODE(TOTAL_124+TOTAL_003, 0, 0,
					ROUND((GREEN_124+GREEN_003)/(TOTAL_124+TOTAL_003)*100,2)) AS SHARE_RATIO_GREEN_TOT,  --그린카드점유율(전체)
				DECODE(TOTAL_124, 0, 0,
					ROUND(GREEN_124/TOTAL_124*100,2)) AS SHARE_RATIO_GREEN_CRA,  --그린카드점유율(경륜)
				DECODE(TOTAL_003, 0, 0,
					ROUND(GREEN_003/TOTAL_003*100,2)) AS SHARE_RATIO_GREEN_MRA,	--그린카드점유율(경정)
			
				DECODE(TOTAL_124+TOTAL_003, 0, 0,
					ROUND((GREEN_124+GREEN_003)/(TOTAL_124+TOTAL_003)*100,2))
					-
				DECODE(SALES_GOAL_CRA_GREEN+SALES_GOAL_MRA_GREEN, 0, 0,
					ROUND((SALES_GOAL_CRA_GREEN+SALES_GOAL_MRA_GREEN)/(SALES_GOAL_CRA+SALES_GOAL_MRA)*100,2)) AS DIFF_RATIO_GREEN_TOT, --그린카드차이율(전체)
			 
				DECODE(TOTAL_124, 0, 0,
					ROUND(GREEN_124/TOTAL_124*100,2))
					-
				DECODE(SALES_GOAL_CRA_GREEN, 0, 0,
					ROUND(SALES_GOAL_CRA_GREEN/SALES_GOAL_CRA*100,2)) AS DIFF_RATIO_GREEN_CRA, --그린카드차이율(경륜)

				DECODE(TOTAL_003, 0, 0,
					ROUND(GREEN_003/TOTAL_003*100,2))
					-
				DECODE(SALES_GOAL_MRA_GREEN, 0, 0,
					ROUND(SALES_GOAL_MRA_GREEN/SALES_GOAL_MRA*100,2)) AS DIFF_RATIO_GREEN_MRA, --그린카드차이율(경정
			
				DECODE(TOTAL_SC_124+TOTAL_SC_003, 0, 0,
					ROUND((GREEN_SC_124+GREEN_SC_003)/(TOTAL_SC_124+TOTAL_SC_003)*100,2)) AS SHARE_RATIO_GREEN_SC_TOT,  --그린카드건수점유율(전체)
				DECODE(TOTAL_SC_124, 0, 0,
					ROUND(GREEN_SC_124/TOTAL_SC_124*100,2)) AS SHARE_RATIO_GREEN_SC_CRA,  --그린카드건수점유율(경륜)
				DECODE(TOTAL_SC_003, 0, 0,
					ROUND(GREEN_SC_003/TOTAL_SC_003*100,2)) AS SHARE_RATIO_GREEN_SC_MRA,	--그린카드건수점유율(경정)
			
				TOTAL_124, --총매출액(광명,창원,부산)
				TOTAL_001, --총매출액(광명)
				TOTAL_003, --총매출액(미사리)
				TOTAL_024, --총매출액(창원,부산)
			
				GREEN_124, --그린카드매출액(광명,창원,부산)
				GREEN_001, --그린카드매출액(광명)
				GREEN_003, --그린카드매출액(미사리)
				GREEN_024, --그린카드매출액(창원,부산)
				
				GREEN_DEV_124, --그린카드(단말)매출액(광명,창원,부산)
				GREEN_DEV_001, --그린카드(단말)매출액(광명)
				GREEN_DEV_003, --그린카드(단말)매출액(미사리)
				GREEN_DEV_024, --그린카드(단말)매출액(창원,부산)
				
				GREEN_APP_124, --그린카드(앱)매출액(광명,창원,부산)
				GREEN_APP_001, --그린카드(앱)매출액(광명)
				GREEN_APP_003, --그린카드(앱)매출액(미사리)
				GREEN_APP_024, --그린카드(앱)매출액(창원,부산)
				
				DECODE(GREEN_124+GREEN_003, 0, 0,
					ROUND((GREEN_DEV_124+GREEN_DEV_003)/(GREEN_124+GREEN_003)*100,2)) AS SHARE_RATIO_GREEN_DEV_TOT,  --그린카드(단말)매출점유율(전체)
				DECODE(GREEN_124, 0, 0,
					ROUND(GREEN_DEV_124/(GREEN_124)*100,2)) AS SHARE_RATIO_GREEN_DEV_CRA,  --그린카드(단말)매출점유율(경륜)
				DECODE(GREEN_003, 0, 0,
					ROUND(GREEN_DEV_003/(GREEN_003)*100,2)) AS SHARE_RATIO_GREEN_DEV_MRA,	--그린카드(단말)매출점유율(경정)
				
				DECODE(GREEN_124+GREEN_003, 0, 0,
					ROUND((GREEN_APP_124+GREEN_APP_003)/(GREEN_124+GREEN_003)*100,2)) AS SHARE_RATIO_GREEN_APP_TOT,  --그린카드(앱)매출점유율(전체)
				DECODE(GREEN_124, 0, 0,
					ROUND(GREEN_APP_124/(GREEN_124)*100,2)) AS SHARE_RATIO_GREEN_APP_CRA,  --그린카드(앱)매출점유율(경륜)
				DECODE(GREEN_003, 0, 0,
					ROUND(GREEN_APP_003/(GREEN_003)*100,2)) AS SHARE_RATIO_GREEN_APP_MRA,	--그린카드(앱)매출점유율(경정)	
			
				TOTAL_SC_124,  --총발매건수(광명,창원,부산)
				TOTAL_SC_001,  --총발매건수(광명)
				TOTAL_SC_003,  --총발매건수(미사리)
				TOTAL_SC_024,  --총발매건수(창원,부산)
			
				GREEN_SC_124, --그린카드발매건수(광명,창원,부산)
				GREEN_SC_001, --그린카드발매건수(광명)
				GREEN_SC_003, --그린카드발매건수(미사리)
				GREEN_SC_024, --그린카드발매건수(창원,부산)
			
				DECODE(TOTAL_001+TOTAL_003, 0, 0,
					ROUND((GREEN_001+GREEN_003)/(TOTAL_001+TOTAL_003)*100,2)) AS TOT_RATIO_GREEN,	--그린카드 경륜 자체경주비율
				DECODE(TOTAL_001, 0, 0,
					ROUND(GREEN_001/TOTAL_001*100,2)) AS CRA_RATIO_GREEN,	--그린카드 경륜 자체경주비율
				DECODE(TOTAL_003, 0, 0,
					ROUND(GREEN_003/TOTAL_003*100,2)) AS MRA_RATIO_GREEN,	--그린카드 경정 자체경주비율	
				DECODE(TOTAL_024, 0, 0,
					ROUND(GREEN_024/TOTAL_024*100,2)) AS CRS_RATIO_GREEN, 	--그린카드 경륜 지방경주비율
				ORD_NO
			
			FROM (
				SELECT
					T4.BRNC_CD,
					NVL(T1.TOTAL_124,0)+NVL(T2.GREEN_124,0) AS TOTAL_124,
					NVL(T1.TOTAL_001,0)+NVL(T2.GREEN_001,0) AS TOTAL_001,
					NVL(T1.TOTAL_003,0)+NVL(T2.GREEN_003,0) AS TOTAL_003,
					NVL(T1.TOTAL_024,0)+NVL(T2.GREEN_024,0) AS TOTAL_024,
					NVL(T2.GREEN_124,0) AS GREEN_124,
					NVL(T2.GREEN_001,0) AS GREEN_001,
					NVL(T2.GREEN_003,0) AS GREEN_003,
					NVL(T2.GREEN_024,0) AS GREEN_024,
					
					NVL(T2.GREEN_DEV_124,0) AS GREEN_DEV_124,
					NVL(T2.GREEN_DEV_001,0) AS GREEN_DEV_001,
					NVL(T2.GREEN_DEV_003,0) AS GREEN_DEV_003,
					NVL(T2.GREEN_DEV_024,0) AS GREEN_DEV_024,
					
					NVL(T2.GREEN_APP_124,0) AS GREEN_APP_124,
					NVL(T2.GREEN_APP_001,0) AS GREEN_APP_001,
					NVL(T2.GREEN_APP_003,0) AS GREEN_APP_003,
					NVL(T2.GREEN_APP_024,0) AS GREEN_APP_024,
					
					NVL(T5.CASH_SC_124,0)+NVL(T2.GREEN_SC_124,0) AS TOTAL_SC_124,
					NVL(T5.CASH_SC_001,0)+NVL(T2.GREEN_SC_001,0) AS TOTAL_SC_001,
					NVL(T5.CASH_SC_003,0)+NVL(T2.GREEN_SC_003,0) AS TOTAL_SC_003,
					NVL(T5.CASH_SC_024,0)+NVL(T2.GREEN_SC_024,0) AS TOTAL_SC_024,
					NVL(T2.GREEN_SC_124,0) AS GREEN_SC_124,
					NVL(T2.GREEN_SC_001,0) AS GREEN_SC_001,
					NVL(T2.GREEN_SC_003,0) AS GREEN_SC_003,
					NVL(T2.GREEN_SC_024,0) AS GREEN_SC_024,
					NVL(T3.SALES_GOAL_CRA,0) AS SALES_GOAL_CRA,
					NVL(T3.SALES_GOAL_MRA,0) AS SALES_GOAL_MRA,
					NVL(T3.SALES_GOAL_CRA_GREEN,0) AS SALES_GOAL_CRA_GREEN,
					NVL(T3.SALES_GOAL_MRA_GREEN,0) AS SALES_GOAL_MRA_GREEN,
					T4.ORD_NO
			
				FROM SALES_TOT T1, SALES_GREEN T2, SALES_GOAL T3, BRNC_ORD T4, SALES_COUNT T5
				WHERE 1=1
				AND T4.BRNC_CD = T1.BRNC_CD(+)
				AND T4.BRNC_CD = T2.BRNC_CD(+)
				AND T4.BRNC_CD = T3.BRNC_CD(+)
				AND T4.BRNC_CD = T5.BRNC_CD(+)
			)
			WHERE 1=1
			AND (TOTAL_124+TOTAL_003) > 0
			ORDER BY ORD_NO
				         
        ]]>
    </query>
	<query id="rsm2110_s11" desc="사업장별 매출목표 달성현황" fetchSize="10">
        <![CDATA[
        	SELECT /* rsm2110_s01 사업장별 매출목표 달성현황 */
				T2.MEET_CD,
				FC_CODE_NM2('062',T2.MEET_CD) MEET_NM,
				T2.BRNC_CD,
				DECODE(BRNC_NM,'본장','경륜본장','미사리','경정본장',BRNC_NM) BRNC_NM,
				ROUND(DECODE(MEET_CD,'001',S2.SALES_GOAL_CRA,'003',S2.SALES_GOAL_MRA,0)) GOAL_AMT, --목표
				ROUND(T2.SUM_TOTAL) SUM_TOTAL,	--실적
				T2.SUM_TOTAL_RAW, --실적(단위 원)
			    ROUND(T2.SUM_TOTAL/DECODE(MEET_CD,'001',S2.SALES_GOAL_CRA,'003',S2.SALES_GOAL_MRA,1)*100,1) GOAL_ARCH_RATIO, --달성률
				ROUND(DECODE(MEET_CD,'001',S2.SALES_GOAL_CRA,'003',S2.SALES_GOAL_MRA,0) - T2.SUM_TOTAL) REMAIN_GOAL_AMT, --잔여목표
				ROUND(DECODE(MEET_CD,'001',S2.SALES_GOAL_CRA_GREEN,'003',S2.SALES_GOAL_MRA_GREEN,0)) GOAL_AMT_GREEN, --목표(그린카드)
				ROUND(T2.GREEN_TOTAL) GREEN_TOTAL,  --실적(그린카드)
				T2.GREEN_TOTAL_RAW, --실적(그린카드 단위 원)
			    ROUND(T2.GREEN_TOTAL/DECODE(MEET_CD,'001',S2.SALES_GOAL_CRA_GREEN,'003',S2.SALES_GOAL_MRA_GREEN,1)*100,1) GOAL_ARCH_RATIO_GREEN, --달성률(그린카드)
				ROUND(DECODE(MEET_CD,'001',S2.SALES_GOAL_CRA_GREEN,'003',S2.SALES_GOAL_MRA_GREEN,0)-T2.GREEN_TOTAL) REMAIN_GOAL_AMT_GREEN, --잔여목표(그린카드)
				ROUND(T2.GREEN_TOTAL/T2.SUM_TOTAL*100,1) GREEN_RATIO_TO_TOTAL, --그린카드 점유율
			
				T2.MAX_MYCAT_DAY,
				U2.ORD_NO
			FROM (
				SELECT 
					MEET_CD,
					BRNC_CD,
					FC_CODE_NM('060',BRNC_CD) BRNC_NM,
					TOTAL/1000000 TOTAL,
					TOTAL TOTAL_RAW, 
					GREEN_TOTAL/1000000 GREEN_TOTAL,
					GREEN_TOTAL GREEN_TOTAL_RAW,
					SUM_TOTAL/1000000 SUM_TOTAL,
					SUM_TOTAL SUM_TOTAL_RAW, 
					MAX_MYCAT_DAY
				FROM (
					SELECT MEET_CD, BRNC_CD,
						SUM(DIV_TOTAL) TOTAL,
						SUM(GREEN_DIV_TOTAL) GREEN_TOTAL,
						SUM(DIV_TOTAL)+SUM(GREEN_DIV_TOTAL) SUM_TOTAL,
						MAX(RACE_DAY) MAX_MYCAT_DAY
					FROM (
						SELECT A.MEET_CD, A.STND_YEAR, A.TMS, A.DAY_ORD, A.SELL_CD,
							CASE WHEN A.MEET_CD IN ('001','003') AND A.SELL_CD = '01' AND A.COMM_NO IN ('01','02','03','04','08')  THEN '01' --광명
				                 WHEN A.MEET_CD IN ('001','003') AND A.SELL_CD = '03' AND A.COMM_NO IN ('01','02','03','04','08')  THEN '98' --미사리
				                 WHEN A.SELL_CD IN ('02','04') THEN '29'                                         							 --교차
				                 ELSE COMM_NO
							END AS BRNC_CD,
							A.DIV_TOTAL, 0 AS GREEN_DIV_TOTAL, '' AS RACE_DAY
						FROM   TBES_SDL_DT A, VW_SDL_INFO B
						WHERE 1=1
						AND A.MEET_CD = B.MEET_CD
						AND A.STND_YEAR = B.STND_YEAR
						AND A.TMS = B.TMS
						AND A.DAY_ORD = B.DAY_ORD
						AND A.STND_YEAR = SUBSTR(?,0,4)
						AND B.RACE_DAY <= ?
						AND A.COMM_NO != '06'
						AND A.MEET_CD IN ('001','003')
						UNION ALL
						--TBES_SDL_DT에서는 그린카드를 통으로 보여주기 때문에 지점별로 분리된 데이터를 TBES_MYCAT_SALES에서 가져옮
						SELECT MEET_CD, STND_YEAR, TMS, DAY_ORD, SELL_CD,
						 	CASE WHEN MEET_CD = '001' AND SELL_CD IN ('01','03') AND DIV_NO = '00' THEN '01'  --광명그린카드
					            WHEN MEET_CD = '003' AND SELL_CD IN ('01','03') AND DIV_NO = '00' THEN '98'   --미사리그린카드
				                WHEN SELL_CD IN ('01','03') AND COMM_NO = '06' THEN FC_CODE_NM2('127',DIV_NO) --지점그린카드
				                ELSE '999'
				           	END AS BRNC_CD,
				           	0 AS DIV_TOTAL, NET_AMT AS GREEN_DIV_TOTAL, RACE_DAY
						FROM   TBES_MYCAT_SALES
						WHERE  1=1
						AND STND_YEAR = SUBSTR(?,0,4)
						AND RACE_DAY  <= ?
						AND MEET_CD IN ('001','003')
					)
					GROUP BY MEET_CD, BRNC_CD
				)
			) T2,
			(   -- 매출목표
				SELECT  --사업장별매출목표
					DECODE(BRNC_CD, '00', '01', BRNC_CD) BRNC_CD,
					SALES_GOAL_CRA,
					SALES_GOAL_MRA,
					SALES_GOAL_CRA_GREEN,
					SALES_GOAL_MRA_GREEN
				FROM TBRA_COMM_DESC
				WHERE 1=1
				AND STND_YEAR = SUBSTR(?,0,4)
			) S2,
			(   --정렬순서
				SELECT
					CD AS BRNC_CD,
					CASE WHEN CD = '01' THEN 2
					     WHEN CD = '98' THEN 3
					     ELSE ORD_NO+3
					END AS ORD_NO
				FROM TBRK_SPEC_CD
				WHERE GRP_CD = '060'
			) U2
			WHERE T2.BRNC_CD = S2.BRNC_CD(+)
			AND T2.BRNC_CD = U2.BRNC_CD
			ORDER BY U2.ORD_NO ASC, T2.MEET_CD ASC
				         
        ]]>
    </query>
    
    <query id="rsm2110_s02" desc="경주일 진행률" fetchSize="10">
        <![CDATA[
        	SELECT /* rsm2110_s02 경주일 진행률 */ 
        	MEET_CD, RACE_DAYS, YEAR_RACE_DAYS, ROUND(RACE_DAYS/YEAR_RACE_DAYS*100,1) PROCESS_RATIO
			FROM (
				SELECT MEET_CD, COUNT(TMS) RACE_DAYS, FC_CODE_NM('172', STND_YEAR||MEET_CD) YEAR_RACE_DAYS
				FROM VW_SDL_INFO
				WHERE 1=1
				AND STND_YEAR = SUBSTR(?,0,4)
				AND MEET_CD IN ('001','003')
				GROUP BY STND_YEAR, MEET_CD
			)
			ORDER BY MEET_CD ASC
        ]]>
    </query>
       
</queryMap>