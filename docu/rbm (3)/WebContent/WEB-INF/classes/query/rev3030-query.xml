<?xml version="1.0" encoding='EUC-KR'?>


<queryMap desc="REV3030(평가진행현황)">
    
    <query id="rev3030_s01" desc="그리드조회" fetchSize="10">
        <![CDATA[			
                           SELECT   /* rev3030_s01 */ 
                            '0' AS CHK
                           , T0.ESTM_YEAR 
                        ,T0.ESTM_NUM 
                        ,T0.DEPT_CD 
                        ,(SELECT DEPT_NM FROM TBRF_EV_DEPT WHERE DEPT_CD = T0.DEPT_CD AND ESTM_YEAR = T0.ESTM_YEAR AND ESTM_NUM = T0.ESTM_NUM) AS DEPT_NM
                        ,T0.EMP_NO 
                        ,T0.EMP_NM 
                        ,T0.HP_NO 
                        ,NVL(T1.PRM_YN_1, '미완료') AS PRM_YN_1 
                        ,NVL(T2.PRM_YN_2, '미완료') AS PRM_YN_2 
                        ,NVL(T3.MNR_YN, '미완료') AS MNR_YN 
                        ,NVL(T4.SVR_YN, '미완료') AS SVR_YN 
                        ,NVL(T5.MULT_YN, '미완료') AS MULT_YN 
                         
                 FROM  (SELECT  ESTM_YEAR 
                                ,ESTM_NUM 
                                ,EMP_NO 
                                ,EMP_NM 
                                ,HP_NO 
                                ,DEPT_CD 
                          FROM TBRF_EV_EMP A 
                         WHERE 1 = 1 
                           AND MNG_GBN = 'Y'  
                           AND EXISTS (                           
                           SELECT *
                           FROM TBRF_EV_EMP B
                           WHERE ESTM_ESC_GBN = 'Y'
                           AND   A.ESTM_YEAR = B.ESTM_YEAR
                           AND   A.ESTM_NUM  = B.ESTM_NUM
                           AND   A.DEPT_CD   = B.ESTM_DEPT                         
                           )
                        ) T0 
                        ,( SELECT  ESTM_YEAR
		                          ,ESTM_NUM
		                          ,DEPT_CD
					  		      ,DECODE(CNT, 3, '완료', '미완료') AS PRM_YN_1 
					        FROM (SELECT ESTM_YEAR
			                            ,ESTM_NUM
			                            ,APRV_DEPT AS DEPT_CD
			                            ,NVL(MIN(TO_NUMBER(APRV_STAS)), 1) AS CNT
			                       FROM TBRF_EV_APRV
			                      WHERE 1 = 1
			                        AND APRV_SEQ = '1'
			                        AND APRV_REQ_NO IS NOT NULL
			                     GROUP BY  ESTM_YEAR
			                       ,ESTM_NUM
			                       ,APRV_DEPT 
			                       ,APRV_STAS                            
			                         ) 
			               WHERE 1 = 1
			            GROUP BY ESTM_YEAR
			                  ,ESTM_NUM
			                  ,DEPT_CD
			                  ,CNT
                          ) T1 
                          ,(SELECT  ESTM_YEAR
		                          ,ESTM_NUM
		                          ,DEPT_CD
					  		      ,DECODE(CNT, 3, '완료', '미완료') AS PRM_YN_2 
					        FROM (SELECT ESTM_YEAR
			                            ,ESTM_NUM
			                            ,APRV_DEPT AS DEPT_CD
			                            ,NVL(MIN(TO_NUMBER(APRV_STAS)), 1) AS CNT
			                       FROM TBRF_EV_APRV
			                      WHERE 1 = 1
			                        AND APRV_SEQ = '1'
			                        AND APRV_REQ_NO IS NOT NULL
			                     GROUP BY  ESTM_YEAR
			                       ,ESTM_NUM
			                       ,APRV_DEPT 
			                       ,APRV_STAS                            
			                         ) 
			               WHERE 1 = 1
			            GROUP BY ESTM_YEAR
			                  ,ESTM_NUM
			                  ,DEPT_CD
			                  ,CNT 
                           ) T2 
                          ,(SELECT  ESTM_YEAR
		                          ,ESTM_NUM
		                          ,DEPT_CD
					  		      ,DECODE(CNT, 3, '완료', '미완료') AS MNR_YN 
					        FROM (SELECT ESTM_YEAR
			                            ,ESTM_NUM
			                            ,APRV_DEPT AS DEPT_CD
			                            ,NVL(MIN(TO_NUMBER(APRV_STAS)), 1) AS CNT
			                       FROM TBRF_EV_APRV
			                      WHERE 1 = 1
			                        AND APRV_SEQ = '1'
			                        AND APRV_REQ_NO IS NOT NULL
			                     GROUP BY  ESTM_YEAR
			                       ,ESTM_NUM
			                       ,APRV_DEPT 
			                       ,APRV_STAS                            
			                         ) 
			               WHERE 1 = 1
			            GROUP BY ESTM_YEAR
			                  ,ESTM_NUM
			                  ,DEPT_CD
			                  ,CNT
                           ) T3     
                           ,(SELECT  ESTM_YEAR
		                          ,ESTM_NUM
		                          ,DEPT_CD
					  		      ,DECODE(CNT, 3, '완료', '미완료') AS SVR_YN 
					        FROM (SELECT ESTM_YEAR
			                            ,ESTM_NUM
			                            ,APRV_DEPT AS DEPT_CD
			                            ,NVL(MIN(TO_NUMBER(APRV_STAS)), 1) AS CNT
			                       FROM TBRF_EV_APRV
			                      WHERE 1 = 1
			                        AND APRV_SEQ = '1'
			                        AND APRV_REQ_NO IS NOT NULL
			                     GROUP BY  ESTM_YEAR
			                       ,ESTM_NUM
			                       ,APRV_DEPT 
			                       ,APRV_STAS                            
			                         ) 
			               WHERE 1 = 1
			            GROUP BY ESTM_YEAR
			                  ,ESTM_NUM
			                  ,DEPT_CD
			                  ,CNT   
                           ) T4   
                          ,(SELECT  ESTM_YEAR
		                          ,ESTM_NUM
		                          ,DEPT_CD
					  		      ,DECODE(CNT, 3, '완료', '미완료') AS MULT_YN 
					        FROM (SELECT ESTM_YEAR
			                            ,ESTM_NUM
			                            ,APRV_DEPT AS DEPT_CD
			                            ,NVL(MIN(TO_NUMBER(APRV_STAS)), 1) AS CNT
			                       FROM TBRF_EV_APRV
			                      WHERE 1 = 1
			                        AND APRV_SEQ = '13'
			                        AND APRV_REQ_NO IS NOT NULL
			                     GROUP BY  ESTM_YEAR
			                       ,ESTM_NUM
			                       ,APRV_DEPT 
			                       ,APRV_STAS                            
			                         ) 
			               WHERE 1 = 1
			            GROUP BY ESTM_YEAR
			                  ,ESTM_NUM
			                  ,DEPT_CD
			                  ,CNT    
                           ) T5  
                WHERE 1 = 1 
                  AND T0.ESTM_YEAR = T1.ESTM_YEAR(+) 
                  AND T0.ESTM_YEAR = T2.ESTM_YEAR(+) 
                  AND T0.ESTM_YEAR = T3.ESTM_YEAR(+) 
                  AND T0.ESTM_YEAR = T4.ESTM_YEAR(+) 
                  AND T0.ESTM_YEAR = T5.ESTM_YEAR(+) 
                  AND T0.ESTM_NUM = T1.ESTM_NUM(+) 
                  AND T0.ESTM_NUM = T2.ESTM_NUM(+) 
                  AND T0.ESTM_NUM = T3.ESTM_NUM(+) 
                  AND T0.ESTM_NUM = T4.ESTM_NUM(+) 
                  AND T0.ESTM_NUM = T5.ESTM_NUM(+) 
                  AND T0.DEPT_CD = T1.DEPT_CD(+) 
                  AND T0.DEPT_CD = T2.DEPT_CD(+) 
                  AND T0.DEPT_CD = T3.DEPT_CD(+) 
                  AND T0.DEPT_CD = T4.DEPT_CD(+) 
                  AND T0.ESTM_YEAR = ?
                  AND T0.ESTM_NUM = ?
                  AND DECODE(?, '', '2',T0.DEPT_CD) = DECODE(?, '', '2', ?)      
        ]]>
    </query>
      
</queryMap>