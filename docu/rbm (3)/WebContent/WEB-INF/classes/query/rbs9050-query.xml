<?xml version="1.0" encoding='EUC-KR'?>

<queryMap desc="rbs9050(그린카드 이용률 관리 )">
  <query id="rbs9050_s01" desc="그린카드 이용률 조회" fetchSize="10">
      <![CDATA[
				WITH X AS ( /* rbs9050_s01 */
				SELECT    ? -1 AS PREV_YEAR
				          ,?  AS THIS_YEAR
				          ,STND_YEAR
				          ,COMM_NO
				          ,NEW_CARD_CNT
				          ,NET_AMT
				          ,NCARD_DAY
				          ,BUY_CNT  
				FROM TBRS_MYCAT_SALES_STAT
				WHERE STND_YEAR BETWEEN ? -1 AND ?
				AND MEET_CD = ?
				)
				SELECT  '전자카드 발급수' AS RSLT_TITLE
				           ,COMM_NO
				           ,SUM(CASE WHEN STND_YEAR = PREV_YEAR THEN NEW_CARD_CNT END) AS AMT_PREV
				           ,SUM(CASE WHEN STND_YEAR = THIS_YEAR THEN NEW_CARD_CNT END) AS AMT_THIS           
				FROM X
				GROUP BY ROLLUP(COMM_NO)
				UNION ALL
				SELECT  '1인당 연간평균이용액' AS RSLT_DESC
				           ,COMM_NO
				           ,ROUND(SUM(CASE WHEN STND_YEAR = PREV_YEAR THEN NET_AMT  END)/SUM(CASE WHEN STND_YEAR = PREV_YEAR THEN NCARD_DAY  END)) AS AMT_PREV
				           ,ROUND(SUM(CASE WHEN STND_YEAR = THIS_YEAR THEN NET_AMT  END)/SUM(CASE WHEN STND_YEAR = THIS_YEAR THEN NCARD_DAY  END)) AS AMT_THIS           
				FROM X
				GROUP BY ROLLUP(COMM_NO)
				UNION ALL
				SELECT  '전자카드 이용건수' AS RSLT_DESC
				           ,COMM_NO
				           ,SUM(CASE WHEN STND_YEAR = PREV_YEAR THEN BUY_CNT END) AS AMT_PREV
				           ,SUM(CASE WHEN STND_YEAR = THIS_YEAR THEN BUY_CNT END) AS AMT_THIS           
				FROM X
				GROUP BY ROLLUP(COMM_NO)
				UNION ALL
				SELECT  '전자카드 발매액' AS RSLT_DESC
				           ,COMM_NO
				           ,SUM(CASE WHEN STND_YEAR = PREV_YEAR THEN NET_AMT END) AS AMT_PREV
				           ,SUM(CASE WHEN STND_YEAR = THIS_YEAR THEN NET_AMT END) AS AMT_THIS           
				FROM X
				GROUP BY ROLLUP(COMM_NO)
				UNION ALL
				SELECT  '전자카드 1건당 발매액' AS RSLT_DESC
				           ,COMM_NO
				           ,ROUND(SUM(CASE WHEN STND_YEAR = PREV_YEAR THEN NET_AMT END)/SUM(CASE WHEN STND_YEAR = PREV_YEAR THEN BUY_CNT END)) AS AMT_PREV
				           ,ROUND(SUM(CASE WHEN STND_YEAR = THIS_YEAR THEN NET_AMT END)/SUM(CASE WHEN STND_YEAR = THIS_YEAR THEN BUY_CNT END)) AS AMT_THIS           
				FROM X
				GROUP BY ROLLUP(COMM_NO)
				
        ]]>
    </query>       
    
    
    
    <query id="rbs9050_s02" desc="그린카드 기준년도 조회 " fetchSize="10">
      <![CDATA[
            SELECT /* rbs9050_s02 */
                   STND_YEAR AS CD
                  ,STND_YEAR||'년' AS CD_NM
            FROM   TBRS_MYCAT_SALES_STAT
	        GROUP BY STND_YEAR
	        ORDER BY STND_YEAR DESC
        ]]>
    </query>       
</queryMap>