<?xml version="1.0" encoding='EUC-KR'?>

<queryMap desc="rbs9030(교차투표율 관리 )">
  <query id="rbs9030_s01" desc="교차투표율 조회" fetchSize="10">
      <![CDATA[
			SELECT  /* rbs9030_s01 */
			        '총경주수' AS RSLT_TITLE
			       ,SUM(CASE WHEN STND_YEAR = ?-1 THEN 1 ELSE 0 END) AS AMT_PREV
			       ,SUM(CASE WHEN STND_YEAR = ? THEN 1 ELSE 0 END) AS AMT_THIS            
			FROM   TBRS_RACE_INFO
			WHERE  STND_YEAR BETWEEN ? -1 AND ?
			AND    MEET_CD != '003'
			UNION ALL
			SELECT  '교차투표수' AS RSLT_TITLE
			       ,SUM(CASE WHEN STND_YEAR = ?-1 THEN 1 ELSE 0 END) AS AMT_PREV
			       ,SUM(CASE WHEN STND_YEAR = ? THEN 1 ELSE 0 END) AS AMT_THIS            
			FROM   TBRS_RACE_INFO
			WHERE  STND_YEAR BETWEEN ? -1 AND ?
			AND    RCV_ORG_CD <> MEET_CD
			AND    MEET_CD != '003'
            UNION ALL
            SELECT  '교차투표율(%)' AS RSLT_TITLE
                   ,ROUND(SUM(CASE WHEN STND_YEAR = ?-1 AND RCV_ORG_CD <> MEET_CD THEN 1 ELSE 0 END)/SUM(CASE WHEN STND_YEAR = ?-1 THEN 1 ELSE 0 END)*100,2) AS AMT_PREV
                   ,ROUND(SUM(CASE WHEN STND_YEAR = ?   AND RCV_ORG_CD <> MEET_CD THEN 1 ELSE 0 END)/SUM(CASE WHEN STND_YEAR = ?   THEN 1 ELSE 0 END)*100,2) AS AMT_THIS            
            FROM   TBRS_RACE_INFO
			WHERE  STND_YEAR BETWEEN ? -1 AND ?
			AND    MEET_CD != '003'
        ]]>
    </query>   
        
    <query id="rbs9030_s02" desc="교차투표율 조회" fetchSize="10">
      <![CDATA[
			SELECT  /* rbs9030_s02 */
			        '계' AS RSLT_TITLE
			       ,COUNT(*) AS RACE_CNT_TOTAL
			       ,SUM(CASE WHEN RCV_ORG_CD = MEET_CD THEN 1 ELSE 0 END) AS RACE_CNT_SELF            
			       ,SUM(CASE WHEN RCV_ORG_CD != MEET_CD THEN 1 ELSE 0 END) AS RACE_CNT_CROSS            
			FROM   TBRS_RACE_INFO
			WHERE  STND_YEAR = ?
			AND    MEET_CD != '003'
			UNION ALL
			SELECT  /* rbs9030_s02 */
			        '광명' AS RSLT_TITLE
			       ,COUNT(*) AS RACE_CNT_TOTAL
			       ,SUM(CASE WHEN RCV_ORG_CD = MEET_CD THEN 1 ELSE 0 END) AS RACE_CNT_SELF            
			       ,SUM(CASE WHEN RCV_ORG_CD != MEET_CD THEN 1 ELSE 0 END) AS RACE_CNT_CROSS            
			FROM   TBRS_RACE_INFO
			WHERE  STND_YEAR = ?
			AND    RCV_ORG_CD = '001'  
			AND    MEET_CD != '003'
			UNION ALL
			SELECT  '부산' AS RSLT_TITLE
			       ,COUNT(*) AS RACE_CNT_TOTAL
			       ,SUM(CASE WHEN RCV_ORG_CD = MEET_CD THEN 1 ELSE 0 END) AS RACE_CNT_SELF            
			       ,SUM(CASE WHEN RCV_ORG_CD != MEET_CD THEN 1 ELSE 0 END) AS RACE_CNT_CROSS            
			FROM   TBRS_RACE_INFO
			WHERE  STND_YEAR = ?
			AND    RCV_ORG_CD = '004'  
			AND    MEET_CD != '003'
			UNION ALL
			SELECT  '창원' AS RSLT_TITLE
			       ,COUNT(*) AS RACE_CNT_TOTAL
			       ,SUM(CASE WHEN RCV_ORG_CD = MEET_CD THEN 1 ELSE 0 END) AS RACE_CNT_SELF            
			       ,SUM(CASE WHEN RCV_ORG_CD != MEET_CD THEN 1 ELSE 0 END) AS RACE_CNT_CROSS            
			FROM   TBRS_RACE_INFO
			WHERE  STND_YEAR = ?
			AND    RCV_ORG_CD = '002'  
			AND    MEET_CD != '003'
        ]]>
    </query>       
    
</queryMap>