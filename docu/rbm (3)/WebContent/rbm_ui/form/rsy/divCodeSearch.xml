<?xml version="1.0" encoding="euc-kr"?>
<Window>
	<Form Height="1024" Id="divCodeSearch" Left="8" OnLoadCompleted="divCodeSearch_OnLoadCompleted" PidAttrib="7" Title="New&#32;Form" Top="8" Ver="1.0" Width="1280" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="dsDivCode">
				<Contents></Contents>
			</Dataset>
		</Datasets>
		<Static Align="Right" Border="None" Height="20" Id="staTitle" Style="snis_if_lable" TabOrder="3" Text="사&#32;&#32;&#32;&#32;&#32;원&#32;" VAlign="Middle" Width="90"></Static>
		<Edit AutoSelect="TRUE" Border="Flat" CheckLength="Byte" Height="20" Id="edCode" ImeMode="native" Left="92" LeftMargin="2" OnFocus="edCode_OnFocus" OnKeyDown="edCode_OnKeyDown" OnKillFocus="edCode_OnKillFocus" Style="snis_if_input01" TabOrder="1" Width="48"></Edit>
		<Edit AutoSelect="TRUE" Border="Flat" CheckLength="Byte" Enable="FALSE" Height="20" Id="edCodeNm" ImeMode="native" Left="161" LeftMargin="2" Style="snis_if_input01" TabOrder="2" TabStop="FALSE" Width="160"></Edit>
		<Button Cursor="HAND" Height="18" Id="btnCode" ImageID="btn_pop_search" Left="142" OnClick="fcHelpDialoge" TabOrder="4" TabStop="FALSE" Text="Button0" Top="2" Width="16"></Button>
	</Form>
	<Script><![CDATA[/***************************************************************************************************
*     현재 총 100 컬럼임 되도록 100 컬럼 안으로 코딩을 하세요                                      *
123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 1234567890
***************************************************************************************************/


/************************
*  공통 Script Include  *
************************/
#include "lib::rbm_app_script.js";

var sDivCodeType = "";		//코드 Type 정의 : 001-공통코드, 002-선수번호 
var sDivCodeGubun = "";		//코드 구분 : 공통코드인 경우-그룹코드
var sDivCodeValue = "";		//마지막 코드 값
var sDivNmValue = "";		//마지막 코드명 값
var sDivCallType = "";		//호출구분 1-button 2-edit 
var sDivOwnerType = "";		//호출 Type 정의 : 1-Edit, 2-Grid
var sDivCodeColumn = "";	//코드 컬럼명
var sDivNmColumn = "";		//코드명 컬럼명
var sDivVal1 = "";
var sDivVal2 = "";
var sDivVal3 = "";
var sDivVal4 = "";
var sDivVal5 = "";

var nTitleW = 0;
var nCodeW = 0; 
var nSpace = 2;

function setDivOptionParamInit(val1, val2, val3, val4, val5) {
	if (val1 != null) sDivVal1 = val1;
	if (val2 != null) sDivVal2 = val2;
	if (val3 != null) sDivVal3 = val3;
	if (val4 != null) sDivVal4 = val4;
	if (val5 != null) sDivVal5 = val5;
}

function setDivParamInit(codeType, codeGubun, val1, val2, val3, val4, val5) {
	sDivCodeType 	= codeType;
	sDivCodeGubun	= codeGubun;
	setDivOptionParamInit(val1, val2, val3, val4, val5);
	switch (sDivCodeType) {
		case "001" : //공통코드
			if (sDivOwnerType == "1") 
				setDivWidths(60, 30, 120);
				
			sDivCodeColumn = "CD";
			sDivNmColumn = "CD_NM";
			
			break;
		
	}		
	
	if (sDivOwnerType == "1")  {
		nTitleW = staTitle.Width;
		nCodeW = edCode.Width;
		nSpace = edCode.Left - (staTitle.Left +  staTitle.Width);	
	}
}

/**************************************************************************************************
*  함   수  명				: setDivInit
*  설       명				: div 초기화 
*  param1) codeType			: 코드종류
*  param2) codeGubun		: 대분류 코드 or 기타 정의된 코드값
*  param3) val1				: 미정의
*  return Type				: 해당 없음
*  return 내용				: 해당 없음
**************************************************************************************************/
function setDivInit(codeType, codeGubun, val1, val2, val3, val4, val5) {
	sDivOwnerType = "1";
	setDivParamInit(codeType, codeGubun, val1, val2, val3, val4, val5);
}

function setDivGridInit(codeType, codeGubun, val1, val2, val3, val4, val5) {
	sDivOwnerType = "2";
	setDivParamInit(codeType, codeGubun, val1, val2, val3, val4, val5);
}

/**************************************************************************************************
*  함   수  명				: setDivTitle
*  설       명				: title Caption Setting
*  param1) title			: title
*  return Type				: 해당 없음
*  return 내용				: 해당 없음
**************************************************************************************************/
function setDivTitle(title) {
	staTitle.Text = title;
}

/**************************************************************************************************
*  함   수  명				: setDivLeft
*  설       명				: Object Width 변경에 따른 Left Value 변경
*  param1) obj				: Object
*  param2) val				: 변경된 Width
*  return Type				: 해당 없음
*  return 내용				: 해당 없음
**************************************************************************************************/
function setDivLeft(obj, val) {
	obj.Left = obj.Left - val;
}

/**************************************************************************************************
*  함   수  명				: setDivTitleWidth
*  설       명				: title Width 변경
*  param1) val				: Width
*  return Type				: 해당 없음
*  return 내용				: 해당 없음
**************************************************************************************************/
function setDivTitleWidth(val) {
	if (val == 0 || val == null) return;
	staTitle.Width = val;
	
	setDivLeft(edCode, nTitleW - val);
	setDivLeft(btnCode, nTitleW - val);
	setDivLeft(edCodeNm, nTitleW - val);
}

/**************************************************************************************************
*  함   수  명				: setDivCodeWidth
*  설       명				: code Width 변경
*  param1) val				: Width
*  return Type				: 해당 없음
*  return 내용				: 해당 없음
**************************************************************************************************/
function setDivCodeWidth(val) {
	if (val == 0 || val == null)  return;
	edCode.Width = val;

	setDivLeft(btnCode, nCodeW - val);
	setDivLeft(edCodeNm, nCodeW - val);
}

/**************************************************************************************************
*  함   수  명				: setDivCodeWidth
*  설       명				: code 명 Width 변경
*  param1) val				: Width
*  return Type				: 해당 없음
*  return 내용				: 해당 없음
**************************************************************************************************/
function setDivNmWidth(val) {
	if (val == 0 || val == null)  return;
	edCodeNm.Width = val;
}

/**************************************************************************************************
*  함   수  명				: setDivWidths
*  설       명				: Div Object Width 변경
*  param1) val1				: title Width
*  param2) val2				: code Width
*  param3) val3				: code명 Width
*  return Type				: 해당 없음
*  return 내용				: 해당 없음
**************************************************************************************************/
function setDivWidths(val1, val2, val3) {
	setDivTitleWidth(val1);
	setDivCodeWidth(val2);
	setDivNmWidth(val3); 
}

/**************************************************************************************************
*  함   수  명				: setDivDataset
*  설       명				: code, code 명에 DataSet Bind 및 Column Mapping
*  param1) sDataset			: dataset 이름
*  param2) sCode			: code Column
*  param3) sNm				: code명 Column
*  return Type				: 해당 없음
*  return 내용				: 해당 없음
**************************************************************************************************/
function setDivDataset(sDataset, sCode, sNm) {
	edCode.BindDataset = sDataset;
	edCodeNm.BindDataset = sDataset;
	
	edCode.Column = sCode;
	edCodeNm.Column = sNm;
}

/**************************************************************************************************
*  함   수  명				: setDivEnabled
*  설       명				: code, button Enabled 속정 변경
*  param1) val				: true/false
*  return Type				: 해당 없음
*  return 내용				: 해당 없음
**************************************************************************************************/
function setDivEnabled(val) {
	edCode.Enable = val;
	btnCode.Enable = val;
}

/**************************************************************************************************
*  함   수  명				: setDivStyle
*  설       명				: 조회/입력 Style 지정
*  param1) val				: true/false
*  return Type				: 해당 없음
*  return 내용				: 해당 없음
**************************************************************************************************/
function setDivStyle(bEdit) {
	staTitle.Style 	= "snis_" + iif(bEdit, "m" , "if") + "_lable" ;
	edCode.Style	= "snis_" + iif(bEdit, "m" , "if") + "_input01" ;
	edCodeNm.Style	= "snis_" + iif(bEdit, "m" , "if") + "_input01" ;
	
	if (bEdit) staTitle.Border = "none";
	else staTitle.Border = "Flat";

}

/**************************************************************************************************
*  함   수  명				: setDivSpace
*  설       명				: title과 code의 간격 조정
*  param1) val				: width
*  return Type				: 해당 없음
*  return 내용				: 해당 없음
**************************************************************************************************/
function setDivSpace(val) {
	setDivLeft(edCode, (nSpace - val));
	setDivLeft(btnCode, (nSpace - val));
	setDivLeft(edCodeNm, (nSpace - val));
	nSpace = val;
}

/**************************************************************************************************
*  함   수  명				: getDivCode
*  설       명				: 코드값으로 코드명 조회
*  param1) val				: 호출구분 1-edit 2-button
*  return Type				: 해당 없음
*  return 내용				: 해당 없음
**************************************************************************************************/
function getDivCode(val) {	
	var sServiceName = "common-service:searchDivCode";
    var sInDataSet   = "";
    var sOutDataSet  = "dsDivCode=dsDivCode ";
    
    sDivCallType = val;
    
    if (val == 1) {	//버튼 Click
		showDivPopup();	
    } else {
		fcd_AddParam("CODE_TYPE", sDivCodeType); 
		fcd_AddParam("CODE_GUBUN", sDivCodeGubun);
		fcd_AddParam("SEARCH_VALUE", edCode.Text);
		fcd_AddParam("VAL1", sDivVal1);
		fcd_AddParam("VAL2", sDivVal2);
		fcd_AddParam("VAL3", sDivVal3);
		fcd_AddParam("VAL4", sDivVal4);
		fcd_AddParam("VAL5", sDivVal5);
		fcd_AddParam("DS_OUT", "dsDivCode");
		
		fcd_SendTransaction(sServiceName, sInDataSet, sOutDataSet, "fcCallBack", false);
	}
}


/**************************************************************************************************
*  함   수  명				: fcCallBack
*  설       명				: CallBack
**************************************************************************************************/
function fcCallBack(sServiceName, ErrorCode, ErrorMSG) {

	if ( !fnc_result(ErrorCode, ErrorMSG) ) return;
	
	//입력된 값이 없는 경우-메시지 처리, 이전값으로 되돌림
	if (dsDivCode.GetRowCount() == 0) {	
		fnc_Message(SNIS_CRA_0021, "N", staTitle.Text);
		edCode.Text = sDivCodeValue;
	} else if (dsDivCode.GetRowCount() == 1) {	//한건인 경우 코드/코드명 Display
		edCode.Text = dsDivCode.GetColumn(0, sDivCodeColumn);
		edCodeNm.Text = dsDivCode.GetColumn(0, sDivNmColumn);
	} else {
		showDivPopup();	
	}
	

	//조회 후 처리 - 각 화면에 Function 이 정의된 경우 호출
	if (sDivCallType == "1") {	//Button Click
		if (sDivOwnerType == "1" && IsExistFunc("fcDivCodeClick", true)) {
			if (!fcDivCodeClick(this)) return;
		}	
	} else if (sDivCallType == "2") {	//KillFocus
		if (sDivOwnerType == "1" && IsExistFunc("fcDivKillFocus", true)) {
			if (!fcDivKillFocus(this)) return;
		}	
	} 
}

/**************************************************************************************************
*  함   수  명				: showDivPopup
*  설       명				: 팝업화면 호출
*  param1) formId			: 팝업화면 ID
*  param1) args				: 호출 Parameters
*  return Type				: 해당 없음
*  return 내용				: 해당 없음
**************************************************************************************************/
function showDivPopup() {
	var sArgs = "";
	var sFormId = "";
	
	switch (sDivCodeType) {
		case "001" : 
			sFormId = "common::comCodePopup.xml";
			sArgs = " CODE_TYPE=" + quote(sDivCodeType) + 
					" CODE_GUBUN=" + quote(sDivCodeGubun) + 
					" SEARCH_VALUE=" + quote(edCode.Text) ;			   			
			break;
		
	}
	
	if (!fnc_isNull(sFormId)) {
		if (Dialog(sFormId, sArgs, 334, 443, "")) {
			fnc_SetReturnDs(gdsPopup, 0, dsDivCode);

			edCode.text = gdsPopup.GetColumn(0, sDivCodeColumn);
			edCodeNm.text = gdsPopup.GetColumn(0, sDivNmColumn);	
				
		} else {
			if (!fnc_isNull(edCode.Text) && edCode.Text != sDivCodeValue) {
				edCode.Text = sDivCodeValue;	
				edCodeNm.text = sDivNmValue;			
			}
		}

		if (sDivOwnerType == "1" && IsExistFunc("fcDivCodeClick", true)) {
			if (!fcDivCodeClick(this)) return;
		}	
		
	}
}

/**************************************************************************************************
*  함   수  명				: fcHelpDialoge
*  설       명				: button Click시 sDivCodeType 에 따른 팝업 조회
*  return Type				: 해당 없음
*  return 내용				: 해당 없음
**************************************************************************************************/
function fcHelpDialoge(obj,nX,nY){
	if (sDivOwnerType == "1" && IsExistFunc("fcDivPreCodeClick", true)) {
		if (!fcDivPreCodeClick(this)) return;
	}
	
	getDivCode(1);
}

function divCodeSearch_OnLoadCompleted(obj)
{
	nTitleW = staTitle.Width;
	nCodeW = edCode.Width;
	if (Parent.IsExistFunc("fcSetDivInit")) {
		Parent.fcSetDivInit(this);	
	}		
}

function edCode_OnFocus(obj)
{
	sDivCodeValue = edCode.Text;
	sDivNmValue = edCodeNm.Text;
}

function edCode_OnKillFocus(obj)
{
	if (sDivOwnerType == "1" && IsExistFunc("fcDivPreKillFocus", true)) {
		if (!fcDivPreKillFocus(this)) return;
	}
	
	if (fnc_isNull(edCode.Text)){	
		edCode.Text = "";
		edCodeNm.Text = "";
	} else if (obj.text != sDivCodeValue) {		
		getDivCode(2);
	}	
}

function getDivDataSet(sCol) {
	return dsDivCode.GetColumn(0, sCol);
}

function edCode_OnKeyDown(obj,nChar,bShift,bCtrl, bAlt,LLParam,HLParam)
{
	if ( nChar == 13 ) {
		edCode_OnKillFocus(obj);
	}
}
]]></Script>
</Window>