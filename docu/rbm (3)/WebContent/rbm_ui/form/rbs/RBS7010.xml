<?xml version="1.0" encoding="euc-kr"?>
<Window>
	<Form Height="576" Id="comSendSms" Left="8" OnLoadCompleted="fcFormLoadSetting" OnUnloadCompleted="fcFormUnloadProcess" PidAttrib="7" Title="SMS" Top="8" Ver="1.0" Width="816" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="dsSendSms">
				<Contents>
					<colinfo id="SEND_USER_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="SEND_USER_NAME" size="256" summ="default" type="STRING"/>
					<colinfo id="RECEIVE_PHONE_NUMBER" size="256" summ="default" type="STRING"/>
					<colinfo id="RECEIVE_NAME" size="256" summ="default" type="STRING"/>
					<colinfo id="SEND_SUBJECT" size="256" summ="default" type="STRING"/>
					<colinfo id="SEND_PHONE_NUMBER" size="256" summ="default" type="STRING"/>
					<colinfo id="RECEIVE_USER_ID" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="dsRecvUser">
				<Contents>
					<colinfo id="USER_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="USER_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="HP_NO" size="256" summ="default" type="STRING"/>
					<colinfo id="CHK" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="dsUserPhone">
				<Contents>
					<colinfo id="USER_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="USER_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="HP_NO" size="256" summ="default" type="STRING"/>
					<colinfo id="CHK" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" FilterExpr="CD&#32;=&#32;&apos;001&apos;" Id="dsFile"></Dataset>
			<Dataset DataSetType="Dataset" Id="dsInComCd">
				<Contents>
					<colinfo id="DSNAME" size="20" summ="default" type="STRING"/>
					<colinfo id="CD_GRP_ID" size="6" summ="default" type="STRING"/>
					<colinfo id="QUERY_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="TERM1" size="256" summ="default" type="STRING"/>
					<colinfo id="TERM2" size="256" summ="default" type="STRING"/>
					<colinfo id="TERM3" size="256" summ="default" type="STRING"/>
					<colinfo id="TERM4" size="256" summ="default" type="STRING"/>
					<colinfo id="TERM5" size="256" summ="default" type="STRING"/>
					<colinfo id="DESCRIPTION" size="256" summ="default" type="STRING"/>
					<colinfo id="ALL_YN" size="1" summ="default" type="STRING"/>
					<record>
						<ALL_YN></ALL_YN>
						<CD_GRP_ID>067</CD_GRP_ID>
						<DESCRIPTION></DESCRIPTION>
						<DSNAME>dsFile</DSNAME>
						<QUERY_ID></QUERY_ID>
						<TERM1></TERM1>
						<TERM2></TERM2>
						<TERM3></TERM3>
						<TERM4></TERM4>
						<TERM5></TERM5>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="dsExcel"></Dataset>
		</Datasets>
		<Div Height="20" Id="divBtnLst" Left="437" TabOrder="19" Text="Div0" Top="4" Url="common::comButtonType.xml" Width="374">
			<Contents></Contents>
		</Div>
		<Static Align="Center" Border="Flat" Height="136" Id="Static1" Left="8" Style="snis_m_lable" TabOrder="3" Text="내용" Top="38" VAlign="Middle" Width="80"></Static>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="btnSend" ImageID="btn_txt_04" Left="612" OnClick="fcSave" TabOrder="2" Text="전송" Top="3" Width="64"></Button>
		<TextArea BindDataset="dsSendSms" Border="Flat" CheckLength="Byte" Column="SEND_SUBJECT" Height="136" Id="taSendSubject" ImeMode="native" Left="96" MaxLength="2000" OnKeyDown="fctaOnKeyDown" Style="snis_if_input01" TabOrder="1" Top="36" Width="696"></TextArea>
		<Static Align="Center" Border="Flat" Height="24" Id="Static0" Left="8" Style="snis_m_lable" TabOrder="4" Text="보내는사람" Top="177" VAlign="Middle" Width="80"></Static>
		<Edit AutoSelect="TRUE" BindDataset="dsSendSms" Border="Flat" CheckLength="Byte" Column="SEND_USER_NAME" Height="21" Id="edendUserName" Left="96" LeftMargin="2" MaxLength="100" Readonly="TRUE" Style="snis_if_input01" TabOrder="5" Top="179" Width="96"></Edit>
		<Edit AutoSelect="TRUE" BindDataset="dsSendSms" Border="Flat" CheckLength="Byte" Column="SEND_PHONE_NUMBER" Height="21" Id="edSendPhoneNumber" Left="194" LeftMargin="2" MaxLength="100" Style="snis_if_input01" TabOrder="6" Top="179" Width="126"></Edit>
		<Grid AutoEnter="TRUE" AutoFit="TRUE" AutoFitEndLine="Hide" BindDataset="dsRecvUser" BKColor="user15" BkColor2="user16" BkSelColor="user17" BoldHead="true" Border="Flat" BorderColor="user22" Bottom="550" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="20" Height="278" Id="grdRecvUser" InputPanel="FALSE" Left="12" LineColor="user18" MinWidth="100" OnHeadClick="fcGridSort" Right="792" SelColor="user19" Style="snis_grid" TabOrder="7" TabStop="true" Top="272" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="780">
			<contents>
				<format id="Default">
					<columns>
						<col width="29"/>
						<col width="36"/>
						<col width="109"/>
						<col width="106"/>
						<col width="169"/>
					</columns>
					<head>
						<cell bkcolor="user20" col="0" color="user21" display="checkbox" edit="checkbox" text="√"/>
						<cell col="1" color="user21" display="text" font="굴림,9,Bold" text="No"/>
						<cell bkcolor="user20" col="2" color="user21" display="text" font="굴림,9,Bold" text="사용자ID"/>
						<cell bkcolor="user20" col="3" color="user21" display="text" font="굴림,9,Bold" text="사용자명"/>
						<cell bkcolor="user20" col="4" color="user21" display="text" font="굴림,9,Bold" text="이동전화번호"/>
					</head>
					<body>
						<cell col="0" colid="CHK" display="checkbox" edit="checkbox"/>
						<cell align="center" col="1" display="number" expr="currow+1"/>
						<cell align="center" col="2" colid="USER_ID" display="text"/>
						<cell align="center" col="3" colid="USER_NM" display="text"/>
						<cell align="left" col="4" colid="HP_NO" display="text" multiline="true"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Static Font="굴림,10,Bold" Height="22" Id="Static2" Left="24" Style="snis_m_title" TabOrder="8" Text="전송대상&#32;목록" Top="233" VAlign="Middle" Width="105"></Static>
		<Image Height="20" Id="Image0" ImageID="m_titleblet2" Left="10" TabOrder="9" Top="236" Width="8"></Image>
		<Static Align="Center" Border="Flat" Height="24" Id="Static3" Left="8" Style="snis_m_lable" TabOrder="10" Text="예약일시" Top="204" VAlign="Middle" Width="80"></Static>
		<Checkbox Height="17" Id="chkResv" Left="267" OnClick="fcchkOnClick" TabOrder="11" Text="예약발송" Top="208" Value="FALSE" Width="67"></Checkbox>
		<Calendar Border="Flat" Height="24" Id="calReqDate" Left="96" SaturdayTextColor="blue" Style="snis_if_input01" SundayTextColor="red" TabOrder="12" Top="204" Width="96"></Calendar>
		<MaskEdit Align="Center" Border="Flat" BorderColor="user3" Height="21" Id="emReqTime" Left="195" Mask="##:##" Style="snis_txt" TabOrder="13" Top="206" Type="STRING" Value="MaskEdit0" Width="60"></MaskEdit>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="21" Id="excelBtn" ImageID="btn_txt_06" Left="673" OnClick="fcBtnOnClick" TabOrder="14" Text="엑셀&#32;업로드" Top="230" Width="74"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="21" Id="downBtn" ImageID="btn_txt_07" Left="588" OnClick="fcBtnOnClick" TabOrder="15" Text="엑셀&#32;다운로드" Top="230" Width="82"></Button>
		<FileDialog Bottom="28" Height="24" Id="fdSaveAs" Left="260" Right="284" TabOrder="19" Top="4" Width="24"></FileDialog>
		<FileDialog Bottom="28" Filter="Excel(*.xls)|*.xls|" Height="24" Id="fdo" Left="234" Right="258" TabOrder="18" Top="4" Width="24"></FileDialog>
		<Div Height="19" Id="mngBtnRow" Left="749" Style="snis_grid" TabOrder="16" Text="Div0" ToolTipText="그룹코드" Top="232" Url="common::comButtonRow.xml" Width="43">
			<Contents></Contents>
		</Div>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="btnSmsHistory" ImageID="btn_txt_04" Left="676" OnClick="fcbtnSmsHistory" TabOrder="17" Text="전송결과" Top="3" Width="64"></Button>
		<Static Height="20" Id="stFormTitle" Left="23" Style="snis_m_title" TabOrder="20" Text="문자메세지&#32;전송" Top="4" VAlign="Middle" Width="430"></Static>
		<Image Height="20" Id="Image1" ImageID="m_titleblet" Left="12" TabOrder="18" Top="6" Width="11"></Image>
	</Form>
	<Script><![CDATA[
/***************************************************************************************************
*                                         공통 Script Include                                      *
***************************************************************************************************/
#include "lib::rbm_common_script.js";
#include "lib::rbm_app_script.js";

/***************************************************************************************************
*                                          화면 변수 선언부                                        *
***************************************************************************************************/
var sFormId       =  this.getform().id;
var sBUTTONLIST   = 'TTTTTT';                          //공통기능정의(버튼순으로 T or F)
var sUSERAUTH     = '';                                //사용자별 프로그램 사용 권한
var sFORMCAPTION  = '';                                //Form의 Title 정보
var sFORMLOCATION = '';                                //Form의 Location 정보
var sUSERLAVEL    = '';                                //Form의 사용  Level
var vREVOBJ       = Array(9);                          //결과값 처리를 위한 오브젝트 
var sGRDTIT       = "";                                //그리드 제목
var sCUROBJ       ;                                    //현재 LOST FOCUS 오브젝트

var sMenuGrpNum     = "0";                         // 메뉴그룹의 갯수보관
var sMenuListNum    = "0";                          // 메뉴리스트의 갯수보관
var sMenuUpId       = "";
var sMenuUpNm       = "";

var sRaceDt       = "";
var sBrncCd       = "";
var sBrncNm       = "";
var sMeetCd		  = "";
var sSeq		  = "";
var sGbn 	  	  = "";
var sUserId 	  = "";
var sSendPhoneNumber 	= "";
var sSendUserId  		= "";
var sSendUserName  		= "";
var sReceivePhoneNumber = "";
var sReceiveName  		= "";
var sReceiveId  		= "";
var sSendSubject  		= "";

/***************************************************************************************************
*                                         공통 Event 처리 부분                                     *
***************************************************************************************************/
/*-------------------------------------------------------------------------------------------------+
>>  최초 화면 Load時 처리 할 사항
+-------------------------------------------------------------------------------------------------*/
function fcFormLoadSetting(obj) { 
    sBUTTONLIST   = 'FFFFFFT';
  
 	//화면환경 설정
	sFORMCAPTION  = obj.Title;
	sFORMLOCATION = "";

	//화면 정보 Display 및 Button 권한 설정
	fnc_FormLoadSetting(obj, sFORMCAPTION, sFORMLOCATION, sBUTTONLIST, sUSERAUTH);
		
	dsSendSms.ClearData();
	var nRow = dsSendSms.AddRow();
	
	if (fnc_IsNull(sSendUserName)) sSendUserName = gdsUser.GetColumn(0, "USER_NM");
    dsSendSms.SetColumn(nRow,"SEND_PHONE_NUMBER",sSendPhoneNumber);			// 송신자 번호
    dsSendSms.SetColumn(nRow,"SEND_USER_ID",sSendUserId);					// 송신자 사번
    dsSendSms.SetColumn(nRow,"SEND_USER_NAME",sSendUserName);				// 송신자 성명
    dsSendSms.SetColumn(nRow,"RECEIVE_PHONE_NUMBER",sReceivePhoneNumber);  	// 수신자 번호, 여러명인경우 ; 로 구분 
    dsSendSms.SetColumn(nRow,"RECEIVE_NAME",sReceiveName);					// 수신자명, 여러명인경우 ; 로 구분 
    
	dsUserPhone.ClearData();
	var nTmpRow = -1;
	
	var aReceivePhone = split(dsSendSms.GetColumn(0,"RECEIVE_PHONE_NUMBER"),";");
	var aReceiveId    = split(sReceiveId,";");
	var aReceiveNm    = split(sReceiveName,";");   
	
	calReqDate.Value = "";
	emReqTime.Text   = "";
	
    //공통코드 조회
    fcd_GetComboDs(dsInComCd); 
   
	for(var i = 0; i < aReceiveId.length;i++){
		//if (length(trim(aReceivePhone[i])) == 0) continue;
		nTmpRow = dsUserPhone.AddRow();
		dsUserPhone.setColumn(nTmpRow,"CHK", "1");
		dsUserPhone.setColumn(nTmpRow,"USER_ID", aReceiveId[i]);
		dsUserPhone.setColumn(nTmpRow,"HP_NO"  , aReceivePhone[i]);
		dsUserPhone.setColumn(nTmpRow,"USER_NM", aReceiveNm[i]);
	}
    
	taSendSubject.SetFocus();
	if (sRecvrUserType == "002") {
		dsRecvUser.copy(dsUserPhone);
    } else {
		fcSearch();
	}	
}

/*-------------------------------------------------------------------------------------------------+
>>  최초 화면 UNLoad時 처리 할 사항
+-------------------------------------------------------------------------------------------------*/
function fcFormUnloadProcess(obj) {

}

/*-------------------------------------------------------------------------------------------------+
>>  단축키 처리(Form KeyDown)
+-------------------------------------------------------------------------------------------------*/
function fcHotKey(obj,objSenderObj,nChar,bShift,bControl,bAlt,nLLParam,nHLParam) {

	// Return Key Press時 Next Component focus
	if ( nChar == 13 ) {
		var oFocusComponent = GetNextComponent(true);
		oFocusComponent.setfocus();
		return;
	}

}

/***************************************************************************************************
*                                      공통 버튼 Event 처리 부분                                   *
***************************************************************************************************/


/*-------------------------------------------------------------------------------------------------+
>>  조회 
+-------------------------------------------------------------------------------------------------*/
function fcSearch() {

	var sServiceName = "";
	var sInDataSet   = "";
	var sOutDataSet  = "";

	 sServiceName = "common-service:searchAlarmUser";
	 sInDataSet   = "";
	 sOutDataSet  = "dsRecvUser=dsRecvUser";

	 //조회조건 : 
	 fcd_AddParam("USER_IDS", replace(sReceiveId,";","','") );
    
	 fcd_SendTransaction(sServiceName, sInDataSet, sOutDataSet, "fcCallBack", true);

}


/*-------------------------------------------------------------------------------------------------+
>>  저장 하기전에 필수항목 체크
+-------------------------------------------------------------------------------------------------*/
function fcSaveCheck(obj) {

	//  발송자 필수항목체크
	oDataSet          = dsSendSms;
	sMandatoryColID   = "SEND_USER_NAME|SEND_PHONE_NUMBER|SEND_SUBJECT";
	sMandatoryColName = "발송자명|발송자전화번호|전송내용";
	oGrid             = grdRecvUser;
	if ( fnc_GetMandatoryViolateRow(oDataSet, sMandatoryColID, sMandatoryColName, oGrid) > -1 ) {
		return false;
	}
	
	// 수신자 필수항목체크
	oDataSet          = dsRecvUser;
	sMandatoryColID   = "USER_NM|HP_NO";
	sMandatoryColName = "수신자명|수신자전화번호";
	oGrid             = grdSendSms;
	if ( fnc_GetMandatoryViolateRow(oDataSet, sMandatoryColID, sMandatoryColName, oGrid) > -1 ) {
		return false;
	}

	if (chkResv.Value == 1) {
		var sReqTime = "";
		sReqTime = calReqDate.Value + Replace(emReqTime.Text,":","");
		if (Length(sReqTime) != 12) {
			fnc_message("예약전송시 예약발송일시를 정확히 입력하셔야 합니다.\n"+sReqTime);
			return false;
		}
	}
	
	return true;
}

/*-------------------------------------------------------------------------------------------------+
>>  저장 버튼 클릭 時 처리
+-------------------------------------------------------------------------------------------------*/
function fcSave(obj) {

	if (!fcSaveCheck(obj)) return;
	
	var aReceivePhone = split(dsSendSms.GetColumn(0,"RECEIVE_PHONE_NUMBER"),";");
	var aReceiveName = split(dsSendSms.GetColumn(0,"RECEIVE_NAME"),";");
	var aReceiveId = split(sReceiveId,";");	
	
	var sReceivePhone="";
	var sReceiveName="";
	var sReceiveId ="";
   
	var sReqTime = "";
	if (chkResv.Value == 1) {
		sReqTime = calReqDate.Value + Replace(emReqTime.Text,":","")+"00";
	} else {
		sReqTime = "";
	}
	
	for(var i = 0; i < dsRecvUser.GetRowCount();i++){
	
		if(dsRecvUser.GetColumn(i,"CHK") == "1"){
		
			sReceivePhone += Replace(dsRecvUser.GetColumn(i,"HP_NO"),"-","") +",";
			sReceiveName  += dsRecvUser.GetColumn(i,"USER_NM")+",";
			sReceiveId    += dsRecvUser.GetColumn(i,"USER_ID")+",";
  
		}
	}
   
	if(Length(sReceiveId) >0) {
   
		sReceivePhone = sReceivePhone.SubStr(0,Length(sReceivePhone)-1);
		sReceiveName  = sReceiveName.SubStr(0,Length(sReceiveName)-1);
		sReceiveId    = sReceiveId.SubStr(0,Length(sReceiveId)-1);
		
		
		fcd_SendSms(  dsSendSms.GetColumn(0,"SEND_PHONE_NUMBER")	    // 송신자 번호
					, dsSendSms.GetColumn(0,"SEND_USER_ID")		    // 송신자 사번 
					, dsSendSms.GetColumn(0,"SEND_USER_NAME")	    // 송신자 성명
					, sReceivePhone      //수신자 번호
					, sReceiveName 	     //수신자명
					, sTitle
					, sReceiveId
					, dsSendSms.GetColumn(0,"SEND_SUBJECT")
					, sReqTime);			//예약발송일시
		
		
		fnc_Message(L_COM_ALT_0011,"N","SMS 전송");
		
		
		fcEnd();			
	}
}




/*-------------------------------------------------------------------------------------------------+
>>  화면 종료(닫기) 버튼 클릭 時 처리
+-------------------------------------------------------------------------------------------------*/
function fcEnd(obj) {
	// 화면 종료
	Close();
}




/***************************************************************************************************
*                                      사용자 정의  처리 부분                                      *
***************************************************************************************************/
/*-------------------------------------------------------------------------------------------------+
>>  Transaction 후 처리 해야 할 내용!
+-------------------------------------------------------------------------------------------------*/
function fcCallBack(sServiceName, ErrorCode, ErrorMSG) {
	if ( !fnc_result(ErrorCode, ErrorMSG) ) return;
	
	if ( sServiceName == "common-service:searchAlarmUser" ) {
		
		if(dsRecvUser.GetRowCount() >0){
			for(var i= 0;i <dsRecvUser ; i++){
				dsRecvUser.SetColumn(i,"HP_NO",dsUserPhone.LookUp("USER_ID",dsRecvUser.getcolumn(i,"USER_ID")," HP_NO"));			
			}		
		}	
	}
}



/*-------------------------------------------------------------------------------------------------+
>>  행추가 버튼 클릭 時 처리
+-------------------------------------------------------------------------------------------------*/
function fcAddRow(obj) {
	// DataSet의 Header 정보가 있을 때  Add 처리
	switch ( obj.GetForm().id ) {

		case "mngBtnRow" : // 수신자 조회			
						
			sUrl = "common::comDeptTree.xml";	//조직도 선택
			sArgs = "";							
			arrReturn = Dialog(sUrl, sArgs, 334, 443, "");
						
			if(arrReturn.length > 0){				
				nRow = dsRecvUser.AddRow(); // Record Add				
				dsRecvUser.SetColumn(nRow, "CHK"       , "1");
				dsRecvUser.SetColumn(nRow, "USER_ID"   , arrReturn[0]);
				dsRecvUser.SetColumn(nRow, "USER_NM"   , arrReturn[1]);
				dsRecvUser.SetColumn(nRow, "HP_NO"     , arrReturn[6]);								
			}
			break;

	}
}



/*-------------------------------------------------------------------------------------------------+
>>  행삭제 버튼 클릭 時 처리
+-------------------------------------------------------------------------------------------------*/
function fcDelRow(obj) {
	// DataSet의 Header 정보가 있을 때  Add 처리
	switch ( obj.GetForm().id ) {
		case "mngBtnRow" : //양식담당자 그리드 행추가,삭제 
			if ( !fnc_DeleteCheck(dsRecvUser, "chk", "1") ) return;

			break;
	}
}



function fcGridSort(obj,nCell,nX,nY,nPivotIndex)
{
	// 특정 Head 클릭 시 해당 항목으로 Sort(만약 특정 컬럼을 누를때만 소트하고자 한다면 nCell로 조건)
	if ( nCell > 1 ) {
		fnc_GridSort(obj, object(obj.BindDataset), nCell);
	} else 	if ( nCell == 0 ) {
 		fnc_GridAllChk(obj);
	}
}

function fctaOnKeyDown(obj,nChar,bShift,bCtrl,bAlt,nLLParam,nHLParam)
{
	if (obj.id == "taSendSubject") {
		if (lengthb(taSendSubject.text) > 90) {
			taSendSubject.BKColor = "lavenderblush";
		} else {
			taSendSubject.BKColor = "white";
		}
	}
}

function fcchkOnClick(obj,strValue)
{
	if (obj.id == "chkResv") {
		if (chkResv.Value == 1) {
			calReqDate.Value = AddDate(today(),1);
			emReqTime.Text =  "09:00";
		} else {
			calReqDate.Value = "";
			emReqTime.Text   = "";
		}
	}
}



function fcBtnOnClick(obj)
{
	switch( obj.id ) {
		case "excelBtn" :
			
			// 화일을 읽어들인다
			fdo.Type = "OPEN";	
			if ( !fdo.open() )	return;
			
			var v_Path 	= fdo.FilePath + "\\" + fdo.FileName;
			// 화일을 import한다
			var rtn = ext_ExcelImportByIndex(v_Path, 0, "dsExcel", 0);
			
			// 첫째 로우를 삭제한다(엑셀 헤더값)
			dsExcel.DeleteRow(0);			
			
			dsRecvUser.fireEvent = false;
			dsRecvUser.ClearData();
			var nRow;
			for(var i=0; i< dsExcel.rowcount;i++){
			
				var sCheck     = "";		
				var sRecvId    = dsExcel.GetColumn(i, "COL01");
				var sRecvNm    = dsExcel.GetColumn(i, "COL02");
				var sRecvHpNo  = dsExcel.GetColumn(i, "COL03");
				
				if (length(sRecvHpNo)<10) continue;
				
				nRow = dsRecvUser.AddRow();
				
				if (fnc_IsNull(sRecvId)) sRecvId = "00000";
				dsRecvUser.SetColumn(nRow, "CHK"       , "1");
				dsRecvUser.SetColumn(nRow, "USER_ID"   , sRecvId);
				dsRecvUser.SetColumn(nRow, "USER_NM"   , sRecvNm);
				dsRecvUser.SetColumn(nRow, "HP_NO"     , sRecvHpNo);
				
			}	
			dsRecvUser.fireEvent = true;
			dsExcel.fireEvent = true;
			
			break;
			
		case "downBtn" :	
			var sServerFileName = dsFile.Lookup("CD", "002", "CD_NM");
			if (sServerFileName == null) {
				fnc_message("다운받을 엑셀 파일 정보가 존재하지 않습니다.", "N");
				return;
			}

			var arrRtn  = split(sServerFileName, "/");
			var sFileNm = arrRtn[arrRtn.length-1];
			var sLocalFileName  = fcd_GetSelectFile("Save", sFileNm);	
			
			if ( sLocalFileName == null ) return;

			fnc_FileRead(divBtnLst.HttpFile, sLocalFileName[0] + "\\" + sLocalFileName[1], sServerFileName);
			break;			
	}
}

function fcbtnSmsHistory(obj)
{
	global.FrameBottom.fcOpenMdiForm("RBS7020", "SMS발송결과", "frm_rsy::RSY7010.xml");
}
]]></Script>
</Window>